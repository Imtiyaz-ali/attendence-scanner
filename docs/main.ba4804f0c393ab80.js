(self.webpackChunkweb3=self.webpackChunkweb3||[]).push([[179],{94:(Yf,d0,Gs)=>{"use strict";function lt(t){return"function"==typeof t}function Jf(t){const e=t(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Zf=Jf(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function Vc(t,n){if(t){const e=t.indexOf(n);0<=e&&t.splice(e,1)}}class jn{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const i of e)i.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(lt(r))try{r()}catch(i){n=i instanceof Zf?i.errors:[i]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const i of o)try{p0(i)}catch(a){n=n??[],a instanceof Zf?n=[...n,...a.errors]:n.push(a)}}if(n)throw new Zf(n)}}add(n){var e;if(n&&n!==this)if(this.closed)p0(n);else{if(n instanceof jn){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(n)}}_hasParent(n){const{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){const{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&Vc(e,n)}remove(n){const{_finalizers:e}=this;e&&Vc(e,n),n instanceof jn&&n._removeParent(this)}}jn.EMPTY=(()=>{const t=new jn;return t.closed=!0,t})();const f0=jn.EMPTY;function h0(t){return t instanceof jn||t&&"closed"in t&&lt(t.remove)&&lt(t.add)&&lt(t.unsubscribe)}function p0(t){lt(t)?t():t.unsubscribe()}const Bi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},jc={setTimeout(t,n,...e){const{delegate:r}=jc;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){const{delegate:n}=jc;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function g0(t){jc.setTimeout(()=>{const{onUnhandledError:n}=Bi;if(!n)throw t;n(t)})}function m0(){}const DR=eh("C",void 0,void 0);function eh(t,n,e){return{kind:t,value:n,error:e}}let Ui=null;function Hc(t){if(Bi.useDeprecatedSynchronousErrorHandling){const n=!Ui;if(n&&(Ui={errorThrown:!1,error:null}),t(),n){const{errorThrown:e,error:r}=Ui;if(Ui=null,e)throw r}}else t()}class th extends jn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,h0(n)&&n.add(this)):this.destination=AR}static create(n,e,r){return new qs(n,e,r)}next(n){this.isStopped?rh(function SR(t){return eh("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?rh(function ER(t){return eh("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?rh(DR,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const MR=Function.prototype.bind;function nh(t,n){return MR.call(t,n)}class RR{constructor(n){this.partialObserver=n}next(n){const{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Wc(r)}}error(n){const{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Wc(r)}else Wc(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Wc(e)}}}class qs extends th{constructor(n,e,r){let o;if(super(),lt(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&Bi.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&nh(n.next,i),error:n.error&&nh(n.error,i),complete:n.complete&&nh(n.complete,i)}):o=n}this.destination=new RR(o)}}function Wc(t){Bi.useDeprecatedSynchronousErrorHandling?function IR(t){Bi.useDeprecatedSynchronousErrorHandling&&Ui&&(Ui.errorThrown=!0,Ui.error=t)}(t):g0(t)}function rh(t,n){const{onStoppedNotification:e}=Bi;e&&jc.setTimeout(()=>e(t,n))}const AR={closed:!0,next:m0,error:function TR(t){throw t},complete:m0},oh="function"==typeof Symbol&&Symbol.observable||"@@observable";function ai(t){return t}function v0(t){return 0===t.length?ai:1===t.length?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}let Et=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){const i=function OR(t){return t&&t instanceof th||function kR(t){return t&&lt(t.next)&&lt(t.error)&&lt(t.complete)}(t)&&h0(t)}(e)?e:new qs(e,r,o);return Hc(()=>{const{operator:a,source:s}=this;i.add(a?a.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=y0(r))((o,i)=>{const a=new qs({next:s=>{try{e(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});this.subscribe(a)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[oh](){return this}pipe(...e){return v0(e)(this)}toPromise(e){return new(e=y0(e))((r,o)=>{let i;this.subscribe(a=>i=a,a=>o(a),()=>r(i))})}}return t.create=n=>new t(n),t})();function y0(t){var n;return null!==(n=t??Bi.Promise)&&void 0!==n?n:Promise}const NR=Jf(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Vr=(()=>{class t extends Et{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const r=new b0(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new NR}next(e){Hc(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(e)}})}error(e){Hc(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){Hc(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:r,isStopped:o,observers:i}=this;return r||o?f0:(this.currentObservers=null,i.push(e),new jn(()=>{this.currentObservers=null,Vc(i,e)}))}_checkFinalizedStatuses(e){const{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){const e=new Et;return e.source=this,e}}return t.create=(n,e)=>new b0(n,e),t})();class b0 extends Vr{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,n)}error(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,n)}complete(){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===e||e.call(n)}_subscribe(n){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(n))&&void 0!==r?r:f0}}function w0(t){return lt(t?.lift)}function jt(t){return n=>{if(w0(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Pt(t,n,e,r,o){return new FR(t,n,e,r,o)}class FR extends th{constructor(n,e,r,o,i,a){super(n),this.onFinalize=i,this.shouldUnsubscribe=a,this._next=e?function(s){try{e(s)}catch(u){n.error(u)}}:super._next,this._error=o?function(s){try{o(s)}catch(u){n.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(s){n.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function Pe(t,n){return jt((e,r)=>{let o=0;e.subscribe(Pt(r,i=>{r.next(t.call(n,i,o++))}))})}function Vi(t){return this instanceof Vi?(this.v=t,this):new Vi(t)}function VR(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function C0(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(a){return new Promise(function(s,u){!function o(i,a,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},a)}(s,u,(a=t[i](a)).done,a.value)})}}}const D0=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function E0(t){return lt(t?.then)}function S0(t){return lt(t[oh])}function I0(t){return Symbol.asyncIterator&&lt(t?.[Symbol.asyncIterator])}function M0(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const R0=function HR(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function T0(t){return lt(t?.[R0])}function A0(t){return function UR(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=e.apply(t,n||[]),i=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(f){r[f]&&(o[f]=function(h){return new Promise(function(p,g){i.push([f,h,p,g])>1||s(f,h)})})}function s(f,h){try{!function u(f){f.value instanceof Vi?Promise.resolve(f.value.v).then(c,l):d(i[0][2],f)}(r[f](h))}catch(p){d(i[0][3],p)}}function c(f){s("next",f)}function l(f){s("throw",f)}function d(f,h){f(h),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:r,done:o}=yield Vi(e.read());if(o)return yield Vi(void 0);yield yield Vi(r)}}finally{e.releaseLock()}})}function P0(t){return lt(t?.getReader)}function ar(t){if(t instanceof Et)return t;if(null!=t){if(S0(t))return function WR(t){return new Et(n=>{const e=t[oh]();if(lt(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(D0(t))return function zR(t){return new Et(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}(t);if(E0(t))return function $R(t){return new Et(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,g0)})}(t);if(I0(t))return k0(t);if(T0(t))return function GR(t){return new Et(n=>{for(const e of t)if(n.next(e),n.closed)return;n.complete()})}(t);if(P0(t))return function qR(t){return k0(A0(t))}(t)}throw M0(t)}function k0(t){return new Et(n=>{(function KR(t,n){var e,r,o,i;return function LR(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(e=VR(t);!(r=yield e.next()).done;)if(n.next(r.value),n.closed)return}catch(a){o={error:a}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})})(t,n).catch(e=>n.error(e))})}function _o(t,n,e,r=0,o=!1){const i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function Zt(t,n,e=1/0){return lt(n)?Zt((r,o)=>Pe((i,a)=>n(r,i,o,a))(ar(t(r,o))),e):("number"==typeof n&&(e=n),jt((r,o)=>function XR(t,n,e,r,o,i,a,s){const u=[];let c=0,l=0,d=!1;const f=()=>{d&&!u.length&&!c&&n.complete()},h=g=>c<r?p(g):u.push(g),p=g=>{i&&n.next(g),c++;let m=!1;ar(e(g,l++)).subscribe(Pt(n,v=>{o?.(v),i?h(v):n.next(v)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;u.length&&c<r;){const v=u.shift();a?_o(n,a,()=>p(v)):p(v)}f()}catch(v){n.error(v)}}))};return t.subscribe(Pt(n,h,()=>{d=!0,f()})),()=>{s?.()}}(r,o,t,e)))}function xa(t=1/0){return Zt(ai,t)}const jr=new Et(t=>t.complete());function O0(t){return t&&lt(t.schedule)}function ah(t){return t[t.length-1]}function Ks(t){return O0(ah(t))?t.pop():void 0}function N0(t,n=0){return jt((e,r)=>{e.subscribe(Pt(r,o=>_o(r,t,()=>r.next(o),n),()=>_o(r,t,()=>r.complete(),n),o=>_o(r,t,()=>r.error(o),n)))})}function F0(t,n=0){return jt((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function L0(t,n){if(!t)throw new Error("Iterable cannot be null");return new Et(e=>{_o(e,n,()=>{const r=t[Symbol.asyncIterator]();_o(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function Ht(t,n){return n?function oT(t,n){if(null!=t){if(S0(t))return function ZR(t,n){return ar(t).pipe(F0(n),N0(n))}(t,n);if(D0(t))return function tT(t,n){return new Et(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}(t,n);if(E0(t))return function eT(t,n){return ar(t).pipe(F0(n),N0(n))}(t,n);if(I0(t))return L0(t,n);if(T0(t))return function nT(t,n){return new Et(e=>{let r;return _o(e,n,()=>{r=t[R0](),_o(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(a){return void e.error(a)}i?e.complete():e.next(o)},0,!0)}),()=>lt(r?.return)&&r.return()})}(t,n);if(P0(t))return function rT(t,n){return L0(A0(t),n)}(t,n)}throw M0(t)}(t,n):ar(t)}function sh(t,n,...e){if(!0===n)return void t();if(!1===n)return;const r=new qs({next:()=>{r.unsubscribe(),t()}});return ar(n(...e)).subscribe(r)}function rt(t){for(let n in t)if(t[n]===rt)return n;throw Error("Could not find renamed property on target object.")}function it(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(it).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function ch(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const sT=rt({__forward_ref__:rt});function lh(t){return t.__forward_ref__=lh,t.toString=function(){return it(this())},t}function ye(t){return dh(t)?t():t}function dh(t){return"function"==typeof t&&t.hasOwnProperty(sT)&&t.__forward_ref__===lh}function fh(t){return t&&!!t.\u0275providers}const B0="https://g.co/ng/security#xss";class Q extends Error{constructor(n,e){super(zc(n,e)),this.code=n}}function zc(t,n){return`NG0${Math.abs(t)}${n?": "+n.trim():""}`}function Ce(t){return"string"==typeof t?t:null==t?"":String(t)}function $c(t,n){throw new Q(-201,!1)}function sr(t,n){null==t&&function Je(t,n,e,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${e} ${r} ${n} <=Actual]`))}(n,t,null,"!=")}function de(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}const hT=de;function Hr(t){return{providers:t.providers||[],imports:t.imports||[]}}function Gc(t){return U0(t,qc)||U0(t,j0)}function U0(t,n){return t.hasOwnProperty(n)?t[n]:null}function V0(t){return t&&(t.hasOwnProperty(hh)||t.hasOwnProperty(vT))?t[hh]:null}const qc=rt({\u0275prov:rt}),hh=rt({\u0275inj:rt}),j0=rt({ngInjectableDef:rt}),vT=rt({ngInjectorDef:rt});var be=(()=>((be=be||{})[be.Default=0]="Default",be[be.Host=1]="Host",be[be.Self=2]="Self",be[be.SkipSelf=4]="SkipSelf",be[be.Optional=8]="Optional",be))();let ph;function ur(t){const n=ph;return ph=t,n}function H0(t,n,e){const r=Gc(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:e&be.Optional?null:void 0!==n?n:void $c(it(t))}const dt=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Xs={},gh="__NG_DI_FLAG__",Kc="ngTempTokenPath",bT="ngTokenPath",wT=/\n/gm,xT="\u0275",W0="__source";let Qs;function _a(t){const n=Qs;return Qs=t,n}function _T(t,n=be.Default){if(void 0===Qs)throw new Q(-203,!1);return null===Qs?H0(t,void 0,n):Qs.get(t,n&be.Optional?null:void 0,n)}function ce(t,n=be.Default){return(function yT(){return ph}()||_T)(ye(t),n)}function Ne(t,n=be.Default){return ce(t,Xc(n))}function Xc(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function mh(t){const n=[];for(let e=0;e<t.length;e++){const r=ye(t[e]);if(Array.isArray(r)){if(0===r.length)throw new Q(900,!1);let o,i=be.Default;for(let a=0;a<r.length;a++){const s=r[a],u=CT(s);"number"==typeof u?-1===u?o=s.token:i|=u:o=s}n.push(ce(o,i))}else n.push(ce(r))}return n}function Ys(t,n){return t[gh]=n,t.prototype[gh]=n,t}function CT(t){return t[gh]}function Co(t){return{toString:t}.toString()}var Wr=(()=>((Wr=Wr||{})[Wr.OnPush=0]="OnPush",Wr[Wr.Default=1]="Default",Wr))(),zr=(()=>{return(t=zr||(zr={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",zr;var t})();const Do={},Ke=[],Qc=rt({\u0275cmp:rt}),vh=rt({\u0275dir:rt}),yh=rt({\u0275pipe:rt}),$0=rt({\u0275mod:rt}),Eo=rt({\u0275fac:rt}),Js=rt({__NG_ELEMENT_ID__:rt});let ST=0;function ui(t){return Co(()=>{const n=q0(t),e={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Wr.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,data:t.data||{},encapsulation:t.encapsulation||zr.Emulated,id:"c"+ST++,styles:t.styles||Ke,_:null,schemas:t.schemas||null,tView:null};K0(e);const r=t.dependencies;return e.directiveDefs=Yc(r,!1),e.pipeDefs=Yc(r,!0),e})}function MT(t){return Ze(t)||ln(t)}function RT(t){return null!==t}function So(t){return Co(()=>({type:t.type,bootstrap:t.bootstrap||Ke,declarations:t.declarations||Ke,imports:t.imports||Ke,exports:t.exports||Ke,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function G0(t,n){if(null==t)return Do;const e={};for(const r in t)if(t.hasOwnProperty(r)){let o=t[r],i=o;Array.isArray(o)&&(i=o[1],o=o[0]),e[o]=r,n&&(n[o]=i)}return e}function _n(t){return Co(()=>{const n=q0(t);return K0(n),n})}function An(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function Ze(t){return t[Qc]||null}function ln(t){return t[vh]||null}function Pn(t){return t[yh]||null}function Wn(t,n){const e=t[$0]||null;if(!e&&!0===n)throw new Error(`Type ${it(t)} does not have '\u0275mod' property.`);return e}function q0(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,exportAs:t.exportAs||null,standalone:!0===t.standalone,selectors:t.selectors||Ke,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:G0(t.inputs,n),outputs:G0(t.outputs)}}function K0(t){t.features?.forEach(n=>n(t))}function Yc(t,n){if(!t)return null;const e=n?Pn:MT;return()=>("function"==typeof t?t():t).map(r=>e(r)).filter(RT)}const Io=0,te=1,Me=2,xt=3,br=4,ji=5,dn=6,Da=7,St=8,Jc=9,Zc=10,Ae=11,bh=12,Zs=13,X0=14,Ea=15,fn=16,eu=17,Sa=18,$r=19,tu=20,Q0=21,ft=22,wh=1,Y0=2,el=7,tl=8,Ia=9,Cn=10;function zn(t){return Array.isArray(t)&&"object"==typeof t[wh]}function wr(t){return Array.isArray(t)&&!0===t[wh]}function xh(t){return 0!=(4&t.flags)}function nu(t){return t.componentOffset>-1}function nl(t){return 1==(1&t.flags)}function xr(t){return!!t.template}function AT(t){return 0!=(256&t[Me])}function Hi(t,n){return t.hasOwnProperty(Eo)?t[Eo]:null}class OT{constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function Wi(){return eb}function eb(t){return t.type.prototype.ngOnChanges&&(t.setInput=FT),NT}function NT(){const t=nb(this),n=t?.current;if(n){const e=t.previous;if(e===Do)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function FT(t,n,e,r){const o=this.declaredInputs[e],i=nb(t)||function LT(t,n){return t[tb]=n}(t,{previous:Do,current:null}),a=i.current||(i.current={}),s=i.previous,u=s[o];a[o]=new OT(u&&u.currentValue,n,s===Do),t[r]=n}Wi.ngInherit=!0;const tb="__ngSimpleChanges__";function nb(t){return t[tb]||null}const cr=function(t,n,e){},rb="svg";function en(t){for(;Array.isArray(t);)t=t[Io];return t}function $n(t,n){return en(n[t.index])}function ib(t,n){return t.data[n]}function Gn(t,n){const e=n[t];return zn(e)?e:e[Io]}function ol(t){return 64==(64&t[Me])}function ci(t,n){return null==n?null:t[n]}function ab(t){t[Sa]=0}function Ch(t,n){t[ji]+=n;let e=t,r=t[xt];for(;null!==r&&(1===n&&1===e[ji]||-1===n&&0===e[ji]);)r[ji]+=n,e=r,r=r[xt]}const De={lFrame:yb(null),bindingsEnabled:!0};function ub(){return De.bindingsEnabled}function G(){return De.lFrame.lView}function We(){return De.lFrame.tView}function tn(){let t=db();for(;null!==t&&64===t.type;)t=t.parent;return t}function db(){return De.lFrame.currentTNode}function Gr(t,n){const e=De.lFrame;e.currentTNode=t,e.isParent=n}function Dh(){return De.lFrame.isParent}function Eh(){De.lFrame.isParent=!1}function Ra(){return De.lFrame.bindingIndex++}function QT(t,n){const e=De.lFrame;e.bindingIndex=e.bindingRootIndex=t,Sh(n)}function Sh(t){De.lFrame.currentDirectiveIndex=t}function gb(){return De.lFrame.currentQueryIndex}function Mh(t){De.lFrame.currentQueryIndex=t}function JT(t){const n=t[te];return 2===n.type?n.declTNode:1===n.type?t[dn]:null}function mb(t,n,e){if(e&be.SkipSelf){let o=n,i=t;for(;!(o=o.parent,null!==o||e&be.Host||(o=JT(i),null===o||(i=i[Ea],10&o.type))););if(null===o)return!1;n=o,t=i}const r=De.lFrame=vb();return r.currentTNode=n,r.lView=t,!0}function Rh(t){const n=vb(),e=t[te];De.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function vb(){const t=De.lFrame,n=null===t?null:t.child;return null===n?yb(t):n}function yb(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function bb(){const t=De.lFrame;return De.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const wb=bb;function Th(){const t=bb();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function En(){return De.lFrame.selectedIndex}function zi(t){De.lFrame.selectedIndex=t}function gt(){const t=De.lFrame;return ib(t.tView,t.selectedIndex)}function hn(){De.lFrame.currentNamespace=rb}function kn(){!function nA(){De.lFrame.currentNamespace=null}()}function il(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){const i=t.data[e].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;a&&(t.contentHooks||(t.contentHooks=[])).push(-e,a),s&&((t.contentHooks||(t.contentHooks=[])).push(e,s),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(e,s)),u&&(t.viewHooks||(t.viewHooks=[])).push(-e,u),c&&((t.viewHooks||(t.viewHooks=[])).push(e,c),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(e,c)),null!=l&&(t.destroyHooks||(t.destroyHooks=[])).push(e,l)}}function al(t,n,e){xb(t,n,3,e)}function sl(t,n,e,r){(3&t[Me])===e&&xb(t,n,e,r)}function Ah(t,n){let e=t[Me];(3&e)===n&&(e&=2047,e+=1,t[Me]=e)}function xb(t,n,e,r){const i=r??-1,a=n.length-1;let s=0;for(let u=void 0!==r?65535&t[Sa]:0;u<a;u++)if("number"==typeof n[u+1]){if(s=n[u],null!=r&&s>=r)break}else n[u]<0&&(t[Sa]+=65536),(s<i||-1==i)&&(iA(t,e,n,u),t[Sa]=(4294901760&t[Sa])+u+2),u++}function iA(t,n,e,r){const o=e[r]<0,i=e[r+1],s=t[o?-e[r]:e[r]];if(o){if(t[Me]>>11<t[Sa]>>16&&(3&t[Me])===n){t[Me]+=2048,cr(4,s,i);try{i.call(s)}finally{cr(5,s,i)}}}else{cr(4,s,i);try{i.call(s)}finally{cr(5,s,i)}}}const Ta=-1;class ou{constructor(n,e,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}}function kh(t,n,e){let r=0;for(;r<e.length;){const o=e[r];if("number"==typeof o){if(0!==o)break;r++;const i=e[r++],a=e[r++],s=e[r++];t.setAttribute(n,a,s,i)}else{const i=o,a=e[++r];Cb(i)?t.setProperty(n,i,a):t.setAttribute(n,i,a),r++}}return r}function _b(t){return 3===t||4===t||6===t}function Cb(t){return 64===t.charCodeAt(0)}function iu(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){const o=n[r];"number"==typeof o?e=o:0===e||Db(t,e,o,null,-1===e||2===e?n[++r]:null)}}return t}function Db(t,n,e,r,o){let i=0,a=t.length;if(-1===n)a=-1;else for(;i<t.length;){const s=t[i++];if("number"==typeof s){if(s===n){a=-1;break}if(s>n){a=i-1;break}}}for(;i<t.length;){const s=t[i];if("number"==typeof s)break;if(s===e){if(null===r)return void(null!==o&&(t[i+1]=o));if(r===t[i+1])return void(t[i+2]=o)}i++,null!==r&&i++,null!==o&&i++}-1!==a&&(t.splice(a,0,n),i=a+1),t.splice(i++,0,e),null!==r&&t.splice(i++,0,r),null!==o&&t.splice(i++,0,o)}function Eb(t){return t!==Ta}function ul(t){return 32767&t}function cl(t,n){let e=function cA(t){return t>>16}(t),r=n;for(;e>0;)r=r[Ea],e--;return r}let Oh=!0;function ll(t){const n=Oh;return Oh=t,n}const Sb=255,Ib=5;let lA=0;const qr={};function dl(t,n){const e=Mb(t,n);if(-1!==e)return e;const r=n[te];r.firstCreatePass&&(t.injectorIndex=n.length,Nh(r.data,t),Nh(n,null),Nh(r.blueprint,null));const o=Fh(t,n),i=t.injectorIndex;if(Eb(o)){const a=ul(o),s=cl(o,n),u=s[te].data;for(let c=0;c<8;c++)n[i+c]=s[a+c]|u[a+c]}return n[i+8]=o,i}function Nh(t,n){t.push(0,0,0,0,0,0,0,0,n)}function Mb(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Fh(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;null!==o;){if(r=Fb(o),null===r)return Ta;if(e++,o=o[Ea],-1!==r.injectorIndex)return r.injectorIndex|e<<16}return Ta}function Lh(t,n,e){!function dA(t,n,e){let r;"string"==typeof e?r=e.charCodeAt(0)||0:e.hasOwnProperty(Js)&&(r=e[Js]),null==r&&(r=e[Js]=lA++);const o=r&Sb;n.data[t+(o>>Ib)]|=1<<o}(t,n,e)}function Rb(t,n,e){if(e&be.Optional||void 0!==t)return t;$c()}function Tb(t,n,e,r){if(e&be.Optional&&void 0===r&&(r=null),!(e&(be.Self|be.Host))){const o=t[Jc],i=ur(void 0);try{return o?o.get(n,r,e&be.Optional):H0(n,r,e&be.Optional)}finally{ur(i)}}return Rb(r,0,e)}function Ab(t,n,e,r=be.Default,o){if(null!==t){if(1024&n[Me]){const a=function mA(t,n,e,r,o){let i=t,a=n;for(;null!==i&&null!==a&&1024&a[Me]&&!(256&a[Me]);){const s=Pb(i,a,e,r|be.Self,qr);if(s!==qr)return s;let u=i.parent;if(!u){const c=a[Q0];if(c){const l=c.get(e,qr,r);if(l!==qr)return l}u=Fb(a),a=a[Ea]}i=u}return o}(t,n,e,r,qr);if(a!==qr)return a}const i=Pb(t,n,e,r,qr);if(i!==qr)return i}return Tb(n,e,r,o)}function Pb(t,n,e,r,o){const i=function pA(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Js)?t[Js]:void 0;return"number"==typeof n?n>=0?n&Sb:gA:n}(e);if("function"==typeof i){if(!mb(n,t,r))return r&be.Host?Rb(o,0,r):Tb(n,e,r,o);try{const a=i(r);if(null!=a||r&be.Optional)return a;$c()}finally{wb()}}else if("number"==typeof i){let a=null,s=Mb(t,n),u=Ta,c=r&be.Host?n[fn][dn]:null;for((-1===s||r&be.SkipSelf)&&(u=-1===s?Fh(t,n):n[s+8],u!==Ta&&Ob(r,!1)?(a=n[te],s=ul(u),n=cl(u,n)):s=-1);-1!==s;){const l=n[te];if(kb(i,s,l.data)){const d=hA(s,n,e,a,r,c);if(d!==qr)return d}u=n[s+8],u!==Ta&&Ob(r,n[te].data[s+8]===c)&&kb(i,s,n)?(a=l,s=ul(u),n=cl(u,n)):s=-1}}return o}function hA(t,n,e,r,o,i){const a=n[te],s=a.data[t+8],l=fl(s,a,e,null==r?nu(s)&&Oh:r!=a&&0!=(3&s.type),o&be.Host&&i===s);return null!==l?$i(n,a,l,s):qr}function fl(t,n,e,r,o){const i=t.providerIndexes,a=n.data,s=1048575&i,u=t.directiveStart,l=i>>20,f=o?s+l:t.directiveEnd;for(let h=r?s:s+l;h<f;h++){const p=a[h];if(h<u&&e===p||h>=u&&p.type===e)return h}if(o){const h=a[u];if(h&&xr(h)&&h.type===e)return u}return null}function $i(t,n,e,r){let o=t[e];const i=n.data;if(function aA(t){return t instanceof ou}(o)){const a=o;a.resolving&&function uT(t,n){const e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new Q(-200,`Circular dependency in DI detected for ${t}${e}`)}(function Ye(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Ce(t)}(i[e]));const s=ll(a.canSeeViewProviders);a.resolving=!0;const u=a.injectImpl?ur(a.injectImpl):null;mb(t,r,be.Default);try{o=t[e]=a.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&function oA(t,n,e){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){const a=eb(n);(e.preOrderHooks||(e.preOrderHooks=[])).push(t,a),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,a)}o&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-t,o),i&&((e.preOrderHooks||(e.preOrderHooks=[])).push(t,i),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,i))}(e,i[e],n)}finally{null!==u&&ur(u),ll(s),a.resolving=!1,wb()}}return o}function kb(t,n,e){return!!(e[n+(t>>Ib)]&1<<t)}function Ob(t,n){return!(t&be.Self||t&be.Host&&n)}class Aa{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return Ab(this._tNode,this._lView,n,Xc(r),e)}}function gA(){return new Aa(tn(),G())}function Bh(t){return dh(t)?()=>{const n=Bh(ye(t));return n&&n()}:Hi(t)}function Fb(t){const n=t[te],e=n.type;return 2===e?n.declTNode:1===e?t[dn]:null}const ka="__parameters__";function Na(t,n,e){return Co(()=>{const r=function Uh(t){return function(...e){if(t){const r=t(...e);for(const o in r)this[o]=r[o]}}}(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;const a=new o(...i);return s.annotation=a,s;function s(u,c,l){const d=u.hasOwnProperty(ka)?u[ka]:Object.defineProperty(u,ka,{value:[]})[ka];for(;d.length<=l;)d.push(null);return(d[l]=d[l]||[]).push(a),u}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}class fe{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=de({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Gi(t,n){t.forEach(e=>Array.isArray(e)?Gi(e,n):n(e))}function Bb(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function pl(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}const cu=Ys(Na("Optional"),8),lu=Ys(Na("SkipSelf"),4);var On=(()=>((On=On||{})[On.Important=1]="Important",On[On.DashCase=2]="DashCase",On))();const qh=new Map;let HA=0;const Xh="__ngContext__";function pn(t,n){zn(n)?(t[Xh]=n[tu],function zA(t){qh.set(t[tu],t)}(n)):t[Xh]=n}let Qh;function Yh(t,n){return Qh(t,n)}function pu(t){const n=t[xt];return wr(n)?n[xt]:n}function Jh(t){return iw(t[Zs])}function Zh(t){return iw(t[br])}function iw(t){for(;null!==t&&!wr(t);)t=t[br];return t}function Ba(t,n,e,r,o){if(null!=r){let i,a=!1;wr(r)?i=r:zn(r)&&(a=!0,r=r[Io]);const s=en(r);0===t&&null!==e?null==o?dw(n,e,s):qi(n,e,s,o||null,!0):1===t&&null!==e?qi(n,e,s,o||null,!0):2===t?function ap(t,n,e){const r=yl(t,n);r&&function lP(t,n,e,r){t.removeChild(n,e,r)}(t,r,n,e)}(n,s,a):3===t&&n.destroyNode(s),null!=i&&function hP(t,n,e,r,o){const i=e[el];i!==en(e)&&Ba(n,t,r,i,o);for(let s=Cn;s<e.length;s++){const u=e[s];gu(u[te],u,t,n,r,i)}}(n,t,i,e,o)}}function tp(t,n,e){return t.createElement(n,e)}function sw(t,n){const e=t[Ia],r=e.indexOf(n),o=n[xt];512&n[Me]&&(n[Me]&=-513,Ch(o,-1)),e.splice(r,1)}function np(t,n){if(t.length<=Cn)return;const e=Cn+n,r=t[e];if(r){const o=r[eu];null!==o&&o!==t&&sw(o,r),n>0&&(t[e-1][br]=r[br]);const i=pl(t,Cn+n);!function nP(t,n){gu(t,n,n[Ae],2,null,null),n[Io]=null,n[dn]=null}(r[te],r);const a=i[$r];null!==a&&a.detachView(i[te]),r[xt]=null,r[br]=null,r[Me]&=-65}return r}function uw(t,n){if(!(128&n[Me])){const e=n[Ae];e.destroyNode&&gu(t,n,e,3,null,null),function iP(t){let n=t[Zs];if(!n)return rp(t[te],t);for(;n;){let e=null;if(zn(n))e=n[Zs];else{const r=n[Cn];r&&(e=r)}if(!e){for(;n&&!n[br]&&n!==t;)zn(n)&&rp(n[te],n),n=n[xt];null===n&&(n=t),zn(n)&&rp(n[te],n),e=n&&n[br]}n=e}}(n)}}function rp(t,n){if(!(128&n[Me])){n[Me]&=-65,n[Me]|=128,function cP(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let r=0;r<e.length;r+=2){const o=n[e[r]];if(!(o instanceof ou)){const i=e[r+1];if(Array.isArray(i))for(let a=0;a<i.length;a+=2){const s=o[i[a]],u=i[a+1];cr(4,s,u);try{u.call(s)}finally{cr(5,s,u)}}else{cr(4,o,i);try{i.call(o)}finally{cr(5,o,i)}}}}}(t,n),function uP(t,n){const e=t.cleanup,r=n[Da];let o=-1;if(null!==e)for(let i=0;i<e.length-1;i+=2)if("string"==typeof e[i]){const a=e[i+3];a>=0?r[o=a]():r[o=-a].unsubscribe(),i+=2}else{const a=r[o=e[i+1]];e[i].call(a)}if(null!==r){for(let i=o+1;i<r.length;i++)(0,r[i])();n[Da]=null}}(t,n),1===n[te].type&&n[Ae].destroy();const e=n[eu];if(null!==e&&wr(n[xt])){e!==n[xt]&&sw(e,n);const r=n[$r];null!==r&&r.detachView(t)}!function $A(t){qh.delete(t[tu])}(n)}}function cw(t,n,e){return function lw(t,n,e){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return e[Io];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:i}=t.data[r.directiveStart+o];if(i===zr.None||i===zr.Emulated)return null}return $n(r,e)}}(t,n.parent,e)}function qi(t,n,e,r,o){t.insertBefore(n,e,r,o)}function dw(t,n,e){t.appendChild(n,e)}function fw(t,n,e,r,o){null!==r?qi(t,n,e,r,o):dw(t,n,e)}function yl(t,n){return t.parentNode(n)}let op,cp,_l,gw=function pw(t,n,e){return 40&t.type?$n(t,e):null};function bl(t,n,e,r){const o=cw(t,r,n),i=n[Ae],s=function hw(t,n,e){return gw(t,n,e)}(r.parent||n[dn],r,n);if(null!=o)if(Array.isArray(e))for(let u=0;u<e.length;u++)fw(i,o,e[u],s,!1);else fw(i,o,e,s,!1);void 0!==op&&op(i,r,n,e,o)}function wl(t,n){if(null!==n){const e=n.type;if(3&e)return $n(n,t);if(4&e)return ip(-1,t[n.index]);if(8&e){const r=n.child;if(null!==r)return wl(t,r);{const o=t[n.index];return wr(o)?ip(-1,o):en(o)}}if(32&e)return Yh(n,t)()||en(t[n.index]);{const r=vw(t,n);return null!==r?Array.isArray(r)?r[0]:wl(pu(t[fn]),r):wl(t,n.next)}}return null}function vw(t,n){return null!==n?t[fn][dn].projection[n.projection]:null}function ip(t,n){const e=Cn+t+1;if(e<n.length){const r=n[e],o=r[te].firstChild;if(null!==o)return wl(r,o)}return n[el]}function sp(t,n,e,r,o,i,a){for(;null!=e;){const s=r[e.index],u=e.type;if(a&&0===n&&(s&&pn(en(s),r),e.flags|=2),32!=(32&e.flags))if(8&u)sp(t,n,e.child,r,o,i,!1),Ba(n,t,o,s,i);else if(32&u){const c=Yh(e,r);let l;for(;l=c();)Ba(n,t,o,l,i);Ba(n,t,o,s,i)}else 16&u?yw(t,n,r,e,o,i):Ba(n,t,o,s,i);e=a?e.projectionNext:e.next}}function gu(t,n,e,r,o,i){sp(e,r,t.firstChild,n,o,i,!1)}function yw(t,n,e,r,o,i){const a=e[fn],u=a[dn].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)Ba(n,t,o,u[c],i);else sp(t,n,u,a[xt],o,i,!0)}function bw(t,n,e){""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function ww(t,n,e){const{mergedAttrs:r,classes:o,styles:i}=e;null!==r&&kh(t,n,r),null!==o&&bw(t,n,o),null!==i&&function gP(t,n,e){t.setAttribute(n,"style",e)}(t,n,i)}function Dw(t){return function lp(){if(void 0===_l&&(_l=null,dt.trustedTypes))try{_l=dt.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return _l}()?.createScriptURL(t)||t}class Ew{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${B0})`}}function li(t){return t instanceof Ew?t.changingThisBreaksApplicationSecurity:t}function mu(t,n){const e=function EP(t){return t instanceof Ew&&t.getTypeName()||null}(t);if(null!=e&&e!==n){if("ResourceURL"===e&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${B0})`)}return e===n}const RP=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var kt=(()=>((kt=kt||{})[kt.NONE=0]="NONE",kt[kt.HTML=1]="HTML",kt[kt.STYLE=2]="STYLE",kt[kt.SCRIPT=3]="SCRIPT",kt[kt.URL=4]="URL",kt[kt.RESOURCE_URL=5]="RESOURCE_URL",kt))();function Va(t){const n=yu();return n?n.sanitize(kt.URL,t)||"":mu(t,"URL")?li(t):function dp(t){return(t=String(t)).match(RP)?t:"unsafe:"+t}(Ce(t))}function Pw(t){const n=yu();if(n)return Dw(n.sanitize(kt.RESOURCE_URL,t)||"");if(mu(t,"ResourceURL"))return Dw(li(t));throw new Q(904,!1)}function yu(){const t=G();return t&&t[bh]}const Dl=new fe("ENVIRONMENT_INITIALIZER"),Ow=new fe("INJECTOR",-1),Nw=new fe("INJECTOR_DEF_TYPES");class Fw{get(n,e=Xs){if(e===Xs){const r=new Error(`NullInjectorError: No provider for ${it(n)}!`);throw r.name="NullInjectorError",r}return e}}function WP(...t){return{\u0275providers:Lw(0,t),\u0275fromNgModule:!0}}function Lw(t,...n){const e=[],r=new Set;let o;return Gi(n,i=>{const a=i;gp(a,e,[],r)&&(o||(o=[]),o.push(a))}),void 0!==o&&Bw(o,e),e}function Bw(t,n){for(let e=0;e<t.length;e++){const{providers:o}=t[e];mp(o,i=>{n.push(i)})}}function gp(t,n,e,r){if(!(t=ye(t)))return!1;let o=null,i=V0(t);const a=!i&&Ze(t);if(i||a){if(a&&!a.standalone)return!1;o=t}else{const u=t.ngModule;if(i=V0(u),!i)return!1;o=u}const s=r.has(o);if(a){if(s)return!1;if(r.add(o),a.dependencies){const u="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const c of u)gp(c,n,e,r)}}else{if(!i)return!1;{if(null!=i.imports&&!s){let c;r.add(o);try{Gi(i.imports,l=>{gp(l,n,e,r)&&(c||(c=[]),c.push(l))})}finally{}void 0!==c&&Bw(c,n)}if(!s){const c=Hi(o)||(()=>new o);n.push({provide:o,useFactory:c,deps:Ke},{provide:Nw,useValue:o,multi:!0},{provide:Dl,useValue:()=>ce(o),multi:!0})}const u=i.providers;null==u||s||mp(u,l=>{n.push(l)})}}return o!==t&&void 0!==t.providers}function mp(t,n){for(let e of t)fh(e)&&(e=e.\u0275providers),Array.isArray(e)?mp(e,n):n(e)}const zP=rt({provide:String,useValue:rt});function vp(t){return null!==t&&"object"==typeof t&&zP in t}function Ki(t){return"function"==typeof t}const yp=new fe("Set Injector scope."),El={},GP={};let bp;function Sl(){return void 0===bp&&(bp=new Fw),bp}class Kr{}class jw extends Kr{get destroyed(){return this._destroyed}constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,xp(n,a=>this.processProvider(a)),this.records.set(Ow,ja(void 0,this)),o.has("environment")&&this.records.set(Kr,ja(void 0,this));const i=this.records.get(yp);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(Nw.multi,Ke,be.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();for(const n of this._onDestroyHooks)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(n){this._onDestroyHooks.push(n)}runInContext(n){this.assertNotDestroyed();const e=_a(this),r=ur(void 0);try{return n()}finally{_a(e),ur(r)}}get(n,e=Xs,r=be.Default){this.assertNotDestroyed(),r=Xc(r);const o=_a(this),i=ur(void 0);try{if(!(r&be.SkipSelf)){let s=this.records.get(n);if(void 0===s){const u=function YP(t){return"function"==typeof t||"object"==typeof t&&t instanceof fe}(n)&&Gc(n);s=u&&this.injectableDefInScope(u)?ja(wp(n),El):null,this.records.set(n,s)}if(null!=s)return this.hydrate(n,s)}return(r&be.Self?Sl():this.parent).get(n,e=r&be.Optional&&e===Xs?null:e)}catch(a){if("NullInjectorError"===a.name){if((a[Kc]=a[Kc]||[]).unshift(it(n)),o)throw a;return function DT(t,n,e,r){const o=t[Kc];throw n[W0]&&o.unshift(n[W0]),t.message=function ET(t,n,e,r=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==xT?t.slice(2):t;let o=it(n);if(Array.isArray(n))o=n.map(it).join(" -> ");else if("object"==typeof n){let i=[];for(let a in n)if(n.hasOwnProperty(a)){let s=n[a];i.push(a+":"+("string"==typeof s?JSON.stringify(s):it(s)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(wT,"\n  ")}`}("\n"+t.message,o,e,r),t[bT]=o,t[Kc]=null,t}(a,n,"R3InjectorError",this.source)}throw a}finally{ur(i),_a(o)}}resolveInjectorInitializers(){const n=_a(this),e=ur(void 0);try{const r=this.get(Dl.multi,Ke,be.Self);for(const o of r)o()}finally{_a(n),ur(e)}}toString(){const n=[],e=this.records;for(const r of e.keys())n.push(it(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Q(205,!1)}processProvider(n){let e=Ki(n=ye(n))?n:ye(n&&n.provide);const r=function KP(t){return vp(t)?ja(void 0,t.useValue):ja(function Hw(t,n,e){let r;if(Ki(t)){const o=ye(t);return Hi(o)||wp(o)}if(vp(t))r=()=>ye(t.useValue);else if(function Vw(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...mh(t.deps||[]));else if(function Uw(t){return!(!t||!t.useExisting)}(t))r=()=>ce(ye(t.useExisting));else{const o=ye(t&&(t.useClass||t.provide));if(!function XP(t){return!!t.deps}(t))return Hi(o)||wp(o);r=()=>new o(...mh(t.deps))}return r}(t),El)}(n);if(Ki(n)||!0!==n.multi)this.records.get(e);else{let o=this.records.get(e);o||(o=ja(void 0,El,!0),o.factory=()=>mh(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){return e.value===El&&(e.value=GP,e.value=e.factory()),"object"==typeof e.value&&e.value&&function QP(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=ye(n.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function wp(t){const n=Gc(t),e=null!==n?n.factory:Hi(t);if(null!==e)return e;if(t instanceof fe)throw new Q(204,!1);if(t instanceof Function)return function qP(t){const n=t.length;if(n>0)throw function uu(t,n){const e=[];for(let r=0;r<t;r++)e.push(n);return e}(n,"?"),new Q(204,!1);const e=function gT(t){const n=t&&(t[qc]||t[j0]);return n?(function mT(t){if(t.hasOwnProperty("name"))return t.name;(""+t).match(/^function\s*([^\s(]+)/)}(t),n):null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new Q(204,!1)}function ja(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function xp(t,n){for(const e of t)Array.isArray(e)?xp(e,n):e&&fh(e)?xp(e.\u0275providers,n):n(e)}class JP{}class Ww{}class ek{resolveComponentFactory(n){throw function ZP(t){const n=Error(`No component factory found for ${it(t)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=t,n}(n)}}let bu=(()=>{class t{}return t.NULL=new ek,t})();function tk(){return Ha(tn(),G())}function Ha(t,n){return new Ao($n(t,n))}let Ao=(()=>{class t{constructor(e){this.nativeElement=e}}return t.__NG_ELEMENT_ID__=tk,t})();function nk(t){return t instanceof Ao?t.nativeElement:t}class $w{}let Wa=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function rk(){const t=G(),e=Gn(tn().index,t);return(zn(e)?e:t)[Ae]}(),t})(),ok=(()=>{class t{}return t.\u0275prov=de({token:t,providedIn:"root",factory:()=>null}),t})();class Il{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const ik=new Il("15.2.3"),_p={},Cp="ngOriginalError";function Dp(t){return t[Cp]}class za{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n);this._console.error("ERROR",n),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(n){let e=n&&Dp(n);for(;e&&Dp(e);)e=Dp(e);return e||null}}function Po(t){return t instanceof Function?t():t}function qw(t,n,e){let r=t.length;for(;;){const o=t.indexOf(n,e);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}const Kw="ng-template";function mk(t,n,e){let r=0;for(;r<t.length;){let o=t[r++];if(e&&"class"===o){if(o=t[r],-1!==qw(o.toLowerCase(),n,0))return!0}else if(1===o){for(;r<t.length&&"string"==typeof(o=t[r++]);)if(o.toLowerCase()===n)return!0;return!1}}return!1}function Xw(t){return 4===t.type&&t.value!==Kw}function vk(t,n,e){return n===(4!==t.type||e?t.value:Kw)}function yk(t,n,e){let r=4;const o=t.attrs||[],i=function xk(t){for(let n=0;n<t.length;n++)if(_b(t[n]))return n;return t.length}(o);let a=!1;for(let s=0;s<n.length;s++){const u=n[s];if("number"!=typeof u){if(!a)if(4&r){if(r=2|1&r,""!==u&&!vk(t,u,e)||""===u&&1===n.length){if(_r(r))return!1;a=!0}}else{const c=8&r?u:n[++s];if(8&r&&null!==t.attrs){if(!mk(t.attrs,c,e)){if(_r(r))return!1;a=!0}continue}const d=bk(8&r?"class":u,o,Xw(t),e);if(-1===d){if(_r(r))return!1;a=!0;continue}if(""!==c){let f;f=d>i?"":o[d+1].toLowerCase();const h=8&r?f:null;if(h&&-1!==qw(h,c,0)||2&r&&c!==f){if(_r(r))return!1;a=!0}}}}else{if(!a&&!_r(r)&&!_r(u))return!1;if(a&&_r(u))continue;a=!1,r=u|1&r}}return _r(r)||a}function _r(t){return 0==(1&t)}function bk(t,n,e,r){if(null===n)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){const a=n[o];if(a===t)return o;if(3===a||6===a)i=!0;else{if(1===a||2===a){let s=n[++o];for(;"string"==typeof s;)s=n[++o];continue}if(4===a)break;if(0===a){o+=4;continue}}o+=i?1:2}return-1}return function _k(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const r=t[e];if("number"==typeof r)return-1;if(r===n)return e;e++}return-1}(n,t)}function Qw(t,n,e=!1){for(let r=0;r<n.length;r++)if(yk(t,n[r],e))return!0;return!1}function Yw(t,n){return t?":not("+n.trim()+")":n}function Dk(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let a=t[e];if("string"==typeof a)if(2&r){const s=t[++e];o+="["+a+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?o+="."+a:4&r&&(o+=" "+a);else""!==o&&!_r(a)&&(n+=Yw(i,o),o=""),r=a,i=i||!_r(r);e++}return""!==o&&(n+=Yw(i,o)),n}const Ee={};function tt(t){Jw(We(),G(),En()+t,!1)}function Jw(t,n,e,r){if(!r)if(3==(3&n[Me])){const i=t.preOrderCheckHooks;null!==i&&al(n,i,e)}else{const i=t.preOrderHooks;null!==i&&sl(n,i,0,e)}zi(e)}function n1(t,n=null,e=null,r){const o=r1(t,n,e,r);return o.resolveInjectorInitializers(),o}function r1(t,n=null,e=null,r,o=new Set){const i=[e||Ke,WP(t)];return r=r||("object"==typeof t?void 0:it(t)),new jw(i,n||Sl(),r||null,o)}let Xr=(()=>{class t{static create(e,r){if(Array.isArray(e))return n1({name:""},r,e,"");{const o=e.name??"";return n1({name:o},e.parent,e.providers,o)}}}return t.THROW_IF_NOT_FOUND=Xs,t.NULL=new Fw,t.\u0275prov=de({token:t,providedIn:"any",factory:()=>ce(Ow)}),t.__NG_ELEMENT_ID__=-1,t})();function he(t,n=be.Default){const e=G();return null===e?ce(t,n):Ab(tn(),e,ye(t),n)}function d1(t,n){const e=t.contentQueries;if(null!==e)for(let r=0;r<e.length;r+=2){const i=e[r+1];if(-1!==i){const a=t.data[i];Mh(e[r]),a.contentQueries(2,n[i],i)}}}function Rl(t,n,e,r,o,i,a,s,u,c,l){const d=n.blueprint.slice();return d[Io]=o,d[Me]=76|r,(null!==l||t&&1024&t[Me])&&(d[Me]|=1024),ab(d),d[xt]=d[Ea]=t,d[St]=e,d[Zc]=a||t&&t[Zc],d[Ae]=s||t&&t[Ae],d[bh]=u||t&&t[bh]||null,d[Jc]=c||t&&t[Jc]||null,d[dn]=i,d[tu]=function WA(){return HA++}(),d[Q0]=l,d[fn]=2==n.type?t[fn]:d,d}function qa(t,n,e,r,o){let i=t.data[n];if(null===i)i=function Rp(t,n,e,r,o){const i=db(),a=Dh(),u=t.data[n]=function Qk(t,n,e,r,o,i){return{type:e,index:r,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?i:i&&i.parent,e,n,r,o);return null===t.firstChild&&(t.firstChild=u),null!==i&&(a?null==i.child&&null!==u.parent&&(i.child=u):null===i.next&&(i.next=u,u.prev=i)),u}(t,n,e,r,o),function XT(){return De.lFrame.inI18n}()&&(i.flags|=32);else if(64&i.type){i.type=e,i.value=r,i.attrs=o;const a=function ru(){const t=De.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();i.injectorIndex=null===a?-1:a.injectorIndex}return Gr(i,!0),i}function wu(t,n,e,r){if(0===e)return-1;const o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function Tp(t,n,e){Rh(n);try{const r=t.viewQuery;null!==r&&Vp(1,r,e);const o=t.template;null!==o&&f1(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&d1(t,n),t.staticViewQueries&&Vp(2,t.viewQuery,e);const i=t.components;null!==i&&function qk(t,n){for(let e=0;e<n.length;e++)gO(t,n[e])}(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Me]&=-5,Th()}}function Tl(t,n,e,r){const o=n[Me];if(128!=(128&o)){Rh(n);try{ab(n),function hb(t){return De.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&f1(t,n,e,2,r);const a=3==(3&o);if(a){const c=t.preOrderCheckHooks;null!==c&&al(n,c,null)}else{const c=t.preOrderHooks;null!==c&&sl(n,c,0,null),Ah(n,0)}if(function hO(t){for(let n=Jh(t);null!==n;n=Zh(n)){if(!n[Y0])continue;const e=n[Ia];for(let r=0;r<e.length;r++){const o=e[r];512&o[Me]||Ch(o[xt],1),o[Me]|=512}}}(n),function fO(t){for(let n=Jh(t);null!==n;n=Zh(n))for(let e=Cn;e<n.length;e++){const r=n[e],o=r[te];ol(r)&&Tl(o,r,o.template,r[St])}}(n),null!==t.contentQueries&&d1(t,n),a){const c=t.contentCheckHooks;null!==c&&al(n,c)}else{const c=t.contentHooks;null!==c&&sl(n,c,1),Ah(n,1)}!function $k(t,n){const e=t.hostBindingOpCodes;if(null!==e)try{for(let r=0;r<e.length;r++){const o=e[r];if(o<0)zi(~o);else{const i=o,a=e[++r],s=e[++r];QT(a,i),s(2,n[i])}}}finally{zi(-1)}}(t,n);const s=t.components;null!==s&&function Gk(t,n){for(let e=0;e<n.length;e++)pO(t,n[e])}(n,s);const u=t.viewQuery;if(null!==u&&Vp(2,u,r),a){const c=t.viewCheckHooks;null!==c&&al(n,c)}else{const c=t.viewHooks;null!==c&&sl(n,c,2),Ah(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[Me]&=-41,512&n[Me]&&(n[Me]&=-513,Ch(n[xt],-1))}finally{Th()}}}function f1(t,n,e,r,o){const i=En(),a=2&r;try{zi(-1),a&&n.length>ft&&Jw(t,n,ft,!1),cr(a?2:0,o),e(r,o)}finally{zi(i),cr(a?3:1,o)}}function Ap(t,n,e){if(xh(n)){const o=n.directiveEnd;for(let i=n.directiveStart;i<o;i++){const a=t.data[i];a.contentQueries&&a.contentQueries(1,e[i],i)}}}function Pp(t,n,e){ub()&&(function nO(t,n,e,r){const o=e.directiveStart,i=e.directiveEnd;nu(e)&&function cO(t,n,e){const r=$n(n,t),o=h1(e),i=t[Zc],a=Al(t,Rl(t,o,null,e.onPush?32:16,r,n,i,i.createRenderer(r,e),null,null,null));t[n.index]=a}(n,e,t.data[o+e.componentOffset]),t.firstCreatePass||dl(e,n),pn(r,n);const a=e.initialInputs;for(let s=o;s<i;s++){const u=t.data[s],c=$i(n,t,s,e);pn(c,n),null!==a&&lO(0,s-o,c,u,0,a),xr(u)&&(Gn(e.index,n)[St]=$i(n,t,s,e))}}(t,n,e,$n(e,n)),64==(64&e.flags)&&b1(t,n,e))}function kp(t,n,e=$n){const r=n.localNames;if(null!==r){let o=n.index+1;for(let i=0;i<r.length;i+=2){const a=r[i+1],s=-1===a?e(n,t):t[a];t[o++]=s}}}function h1(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=Op(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function Op(t,n,e,r,o,i,a,s,u,c){const l=ft+r,d=l+o,f=function Kk(t,n){const e=[];for(let r=0;r<n;r++)e.push(r<t?null:Ee);return e}(l,d),h="function"==typeof c?c():c;return f[te]={type:t,blueprint:f,template:e,queries:null,viewQuery:s,declTNode:n,data:f.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:u,consts:h,incompleteFirstPass:!1}}function p1(t,n,e,r){const o=x1(n);null===e?o.push(r):(o.push(e),t.firstCreatePass&&_1(t).push(r,o.length-1))}function g1(t,n,e,r){for(let o in t)if(t.hasOwnProperty(o)){e=null===e?{}:e;const i=t[o];null===r?m1(e,n,o,i):r.hasOwnProperty(o)&&m1(e,n,r[o],i)}return e}function m1(t,n,e,r){t.hasOwnProperty(e)?t[e].push(n,r):t[e]=[n,r]}function v1(t,n){const e=Gn(n,t);16&e[Me]||(e[Me]|=32)}function Np(t,n,e,r){if(ub()){const o=null===r?null:{"":-1},i=function oO(t,n){const e=t.directiveRegistry;let r=null,o=null;if(e)for(let i=0;i<e.length;i++){const a=e[i];if(Qw(n,a.selectors,!1))if(r||(r=[]),xr(a))if(null!==a.findHostDirectiveDefs){const s=[];o=o||new Map,a.findHostDirectiveDefs(a,s,o),r.unshift(...s,a),Fp(t,n,s.length)}else r.unshift(a),Fp(t,n,0);else o=o||new Map,a.findHostDirectiveDefs?.(a,r,o),r.push(a)}return null===r?null:[r,o]}(t,e);let a,s;null===i?a=s=null:[a,s]=i,null!==a&&y1(t,n,e,a,o,s),o&&function iO(t,n,e){if(n){const r=t.localNames=[];for(let o=0;o<n.length;o+=2){const i=e[n[o+1]];if(null==i)throw new Q(-301,!1);r.push(n[o],i)}}}(e,r,o)}e.mergedAttrs=iu(e.mergedAttrs,e.attrs)}function y1(t,n,e,r,o,i){for(let c=0;c<r.length;c++)Lh(dl(e,n),t,r[c].type);!function sO(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}(e,t.data.length,r.length);for(let c=0;c<r.length;c++){const l=r[c];l.providersResolver&&l.providersResolver(l)}let a=!1,s=!1,u=wu(t,n,r.length,null);for(let c=0;c<r.length;c++){const l=r[c];e.mergedAttrs=iu(e.mergedAttrs,l.hostAttrs),uO(t,e,n,u,l),aO(u,l,o),null!==l.contentQueries&&(e.flags|=4),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(e.flags|=64);const d=l.type.prototype;!a&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(e.index),a=!0),!s&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(e.index),s=!0),u++}!function Yk(t,n,e){const o=n.directiveEnd,i=t.data,a=n.attrs,s=[];let u=null,c=null;for(let l=n.directiveStart;l<o;l++){const d=i[l],f=e?e.get(d):null,p=f?f.outputs:null;u=g1(d.inputs,l,u,f?f.inputs:null),c=g1(d.outputs,l,c,p);const g=null===u||null===a||Xw(n)?null:dO(u,l,a);s.push(g)}null!==u&&(u.hasOwnProperty("class")&&(n.flags|=8),u.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=s,n.inputs=u,n.outputs=c}(t,e,i)}function b1(t,n,e){const r=e.directiveStart,o=e.directiveEnd,i=e.index,a=function YT(){return De.lFrame.currentDirectiveIndex}();try{zi(i);for(let s=r;s<o;s++){const u=t.data[s],c=n[s];Sh(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&rO(u,c)}}finally{zi(-1),Sh(a)}}function rO(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function Fp(t,n,e){n.componentOffset=e,(t.components||(t.components=[])).push(n.index)}function aO(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;xr(n)&&(e[""]=t)}}function uO(t,n,e,r,o){t.data[r]=o;const i=o.factory||(o.factory=Hi(o.type)),a=new ou(i,xr(o),he);t.blueprint[r]=a,e[r]=a,function eO(t,n,e,r,o){const i=o.hostBindings;if(i){let a=t.hostBindingOpCodes;null===a&&(a=t.hostBindingOpCodes=[]);const s=~n.index;(function tO(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(a)!=s&&a.push(s),a.push(e,r,i)}}(t,n,r,wu(t,e,o.hostVars,Ee),o)}function Qr(t,n,e,r,o,i){const a=$n(t,n);!function Lp(t,n,e,r,o,i,a){if(null==i)t.removeAttribute(n,o,e);else{const s=null==a?Ce(i):a(i,r||"",o);t.setAttribute(n,o,s,e)}}(n[Ae],a,i,t.value,e,r,o)}function lO(t,n,e,r,o,i){const a=i[n];if(null!==a){const s=r.setInput;for(let u=0;u<a.length;){const c=a[u++],l=a[u++],d=a[u++];null!==s?r.setInput(e,d,c,l):e[l]=d}}}function dO(t,n,e){let r=null,o=0;for(;o<e.length;){const i=e[o];if(0!==i)if(5!==i){if("number"==typeof i)break;if(t.hasOwnProperty(i)){null===r&&(r=[]);const a=t[i];for(let s=0;s<a.length;s+=2)if(a[s]===n){r.push(i,a[s+1],e[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function w1(t,n,e,r){return[t,!0,!1,n,null,0,r,e,null,null]}function pO(t,n){const e=Gn(n,t);if(ol(e)){const r=e[te];48&e[Me]?Tl(r,e,r.template,e[St]):e[ji]>0&&Bp(e)}}function Bp(t){for(let r=Jh(t);null!==r;r=Zh(r))for(let o=Cn;o<r.length;o++){const i=r[o];if(ol(i))if(512&i[Me]){const a=i[te];Tl(a,i,a.template,i[St])}else i[ji]>0&&Bp(i)}const e=t[te].components;if(null!==e)for(let r=0;r<e.length;r++){const o=Gn(e[r],t);ol(o)&&o[ji]>0&&Bp(o)}}function gO(t,n){const e=Gn(n,t),r=e[te];(function mO(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])})(r,e),Tp(r,e,e[St])}function Al(t,n){return t[Zs]?t[X0][br]=n:t[Zs]=n,t[X0]=n,n}function Up(t){for(;t;){t[Me]|=32;const n=pu(t);if(AT(t)&&!n)return t;t=n}return null}function Pl(t,n,e,r=!0){const o=n[Zc];o.begin&&o.begin();try{Tl(t,n,t.template,e)}catch(a){throw r&&D1(n,a),a}finally{o.end&&o.end()}}function Vp(t,n,e){Mh(0),n(t,e)}function x1(t){return t[Da]||(t[Da]=[])}function _1(t){return t.cleanup||(t.cleanup=[])}function D1(t,n){const e=t[Jc],r=e?e.get(za,null):null;r&&r.handleError(n)}function jp(t,n,e,r,o){for(let i=0;i<e.length;){const a=e[i++],s=e[i++],u=n[a],c=t.data[a];null!==c.setInput?c.setInput(u,o,r,s):u[s]=o}}function ko(t,n,e){const r=function rl(t,n){return en(n[t])}(n,t);!function aw(t,n,e){t.setValue(n,e)}(t[Ae],r,e)}function kl(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(null!==n)for(let a=0;a<n.length;a++){const s=n[a];"number"==typeof s?i=s:1==i?o=ch(o,s):2==i&&(r=ch(r,s+": "+n[++a]+";"))}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}function Ol(t,n,e,r,o=!1){for(;null!==e;){const i=n[e.index];if(null!==i&&r.push(en(i)),wr(i))for(let s=Cn;s<i.length;s++){const u=i[s],c=u[te].firstChild;null!==c&&Ol(u[te],u,c,r)}const a=e.type;if(8&a)Ol(t,n,e.child,r);else if(32&a){const s=Yh(e,n);let u;for(;u=s();)r.push(u)}else if(16&a){const s=vw(n,e);if(Array.isArray(s))r.push(...s);else{const u=pu(n[fn]);Ol(u[te],u,s,r,!0)}}e=o?e.projectionNext:e.next}return r}class xu{get rootNodes(){const n=this._lView,e=n[te];return Ol(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[St]}set context(n){this._lView[St]=n}get destroyed(){return 128==(128&this._lView[Me])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[xt];if(wr(n)){const e=n[tl],r=e?e.indexOf(this):-1;r>-1&&(np(n,r),pl(e,r))}this._attachedToViewContainer=!1}uw(this._lView[te],this._lView)}onDestroy(n){p1(this._lView[te],this._lView,null,n)}markForCheck(){Up(this._cdRefInjectingView||this._lView)}detach(){this._lView[Me]&=-65}reattach(){this._lView[Me]|=64}detectChanges(){Pl(this._lView[te],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Q(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function oP(t,n){gu(t,n,n[Ae],2,null,null)}(this._lView[te],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Q(902,!1);this._appRef=n}}class vO extends xu{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Pl(n[te],n,n[St],!1)}checkNoChanges(){}get context(){return null}}class E1 extends bu{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=Ze(n);return new _u(e,this.ngModule)}}function S1(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}class bO{constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=Xc(r);const o=this.injector.get(n,_p,r);return o!==_p||e===_p?o:this.parentInjector.get(n,e,r)}}class _u extends Ww{get inputs(){return S1(this.componentDef.inputs)}get outputs(){return S1(this.componentDef.outputs)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function Ek(t){return t.map(Dk).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}create(n,e,r,o){let i=(o=o||this.ngModule)instanceof Kr?o:o?.injector;i&&null!==this.componentDef.getStandaloneInjector&&(i=this.componentDef.getStandaloneInjector(i)||i);const a=i?new bO(n,i):n,s=a.get($w,null);if(null===s)throw new Q(407,!1);const u=a.get(ok,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",d=r?function Xk(t,n,e){return t.selectRootElement(n,e===zr.ShadowDom)}(c,r,this.componentDef.encapsulation):tp(c,l,function yO(t){const n=t.toLowerCase();return"svg"===n?rb:"math"===n?"math":null}(l)),f=this.componentDef.onPush?288:272,h=Op(0,null,null,1,0,null,null,null,null,null),p=Rl(null,h,null,f,null,null,s,c,u,a,null);let g,m;Rh(p);try{const v=this.componentDef;let b,y=null;v.findHostDirectiveDefs?(b=[],y=new Map,v.findHostDirectiveDefs(v,b,y),b.push(v)):b=[v];const w=function xO(t,n){const e=t[te],r=ft;return t[r]=n,qa(e,r,2,"#host",null)}(p,d),x=function _O(t,n,e,r,o,i,a,s){const u=o[te];!function CO(t,n,e,r){for(const o of t)n.mergedAttrs=iu(n.mergedAttrs,o.hostAttrs);null!==n.mergedAttrs&&(kl(n,n.mergedAttrs,!0),null!==e&&ww(r,e,n))}(r,t,n,a);const c=i.createRenderer(n,e),l=Rl(o,h1(e),null,e.onPush?32:16,o[t.index],t,i,c,s||null,null,null);return u.firstCreatePass&&Fp(u,t,r.length-1),Al(o,l),o[t.index]=l}(w,d,v,b,p,s,c);m=ib(h,ft),d&&function EO(t,n,e,r){if(r)kh(t,e,["ng-version",ik.full]);else{const{attrs:o,classes:i}=function Sk(t){const n=[],e=[];let r=1,o=2;for(;r<t.length;){let i=t[r];if("string"==typeof i)2===o?""!==i&&n.push(i,t[++r]):8===o&&e.push(i);else{if(!_r(o))break;o=i}r++}return{attrs:n,classes:e}}(n.selectors[0]);o&&kh(t,e,o),i&&i.length>0&&bw(t,e,i.join(" "))}}(c,v,d,r),void 0!==e&&function SO(t,n,e){const r=t.projection=[];for(let o=0;o<n.length;o++){const i=e[o];r.push(null!=i?Array.from(i):null)}}(m,this.ngContentSelectors,e),g=function DO(t,n,e,r,o,i){const a=tn(),s=o[te],u=$n(a,o);y1(s,o,a,e,null,r);for(let l=0;l<e.length;l++)pn($i(o,s,a.directiveStart+l,a),o);b1(s,o,a),u&&pn(u,o);const c=$i(o,s,a.directiveStart+a.componentOffset,a);if(t[St]=o[St]=c,null!==i)for(const l of i)l(c,n);return Ap(s,a,t),c}(x,v,b,y,p,[IO]),Tp(h,p,null)}finally{Th()}return new wO(this.componentType,g,Ha(m,p),p,m)}}class wO extends JP{constructor(n,e,r,o,i){super(),this.location=r,this._rootLView=o,this._tNode=i,this.instance=e,this.hostView=this.changeDetectorRef=new vO(o),this.componentType=n}setInput(n,e){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[n])){const i=this._rootLView;jp(i[te],i,o,n,e),v1(i,this._tNode.index)}}get injector(){return new Aa(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function IO(){const t=tn();il(G()[te],t)}function Nl(t){return!!Wp(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function Wp(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function gn(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function zp(t,n,e,r){const o=G();return gn(o,Ra(),n)&&(We(),Qr(gt(),o,t,n,e,r)),zp}function di(t,n,e,r,o,i,a,s){const u=G(),c=We(),l=t+ft,d=c.firstCreatePass?function jO(t,n,e,r,o,i,a,s,u){const c=n.consts,l=qa(n,t,4,a||null,ci(c,s));Np(n,e,l,ci(c,u)),il(n,l);const d=l.tView=Op(2,l,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c);return null!==n.queries&&(n.queries.template(n,l),d.queries=n.queries.embeddedTView(l)),l}(l,c,u,n,e,r,o,i,a):c.data[l];Gr(d,!1);const f=u[Ae].createComment("");bl(c,u,f,d),pn(f,u),Al(u,u[l]=w1(f,u,f,d)),nl(d)&&Pp(c,u,d),null!=a&&kp(u,d,s)}function nn(t,n,e){const r=G();return gn(r,Ra(),n)&&function Kn(t,n,e,r,o,i,a,s){const u=$n(n,e);let l,c=n.inputs;!s&&null!=c&&(l=c[r])?(jp(t,e,l,r,o),nu(n)&&v1(e,n.index)):3&n.type&&(r=function Jk(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(r),o=null!=a?a(o,n.value||"",r):o,i.setProperty(u,r,o))}(We(),gt(),r,t,n,r[Ae],e,!1),nn}function $p(t,n,e,r,o){const a=o?"class":"style";jp(t,e,n.inputs[a],a,r)}function O(t,n,e,r){const o=G(),i=We(),a=ft+t,s=o[Ae],u=i.firstCreatePass?function zO(t,n,e,r,o,i){const a=n.consts,u=qa(n,t,2,r,ci(a,o));return Np(n,e,u,ci(a,i)),null!==u.attrs&&kl(u,u.attrs,!1),null!==u.mergedAttrs&&kl(u,u.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,u),u}(a,i,o,n,e,r):i.data[a],c=o[a]=tp(s,n,function rA(){return De.lFrame.currentNamespace}()),l=nl(u);return Gr(u,!0),ww(s,c,u),32!=(32&u.flags)&&bl(i,o,c,u),0===function WT(){return De.lFrame.elementDepthCount}()&&pn(c,o),function zT(){De.lFrame.elementDepthCount++}(),l&&(Pp(i,o,u),Ap(i,u,o)),null!==r&&kp(o,u),O}function B(){let t=tn();Dh()?Eh():(t=t.parent,Gr(t,!1));const n=t;!function $T(){De.lFrame.elementDepthCount--}();const e=We();return e.firstCreatePass&&(il(e,t),xh(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function sA(t){return 0!=(8&t.flags)}(n)&&$p(e,n,G(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function uA(t){return 0!=(16&t.flags)}(n)&&$p(e,n,G(),n.stylesWithoutHost,!1),B}function Z(t,n,e,r){return O(t,n,e,r),B(),Z}function Ll(t,n,e){const r=G(),o=We(),i=t+ft,a=o.firstCreatePass?function $O(t,n,e,r,o){const i=n.consts,a=ci(i,r),s=qa(n,t,8,"ng-container",a);return null!==a&&kl(s,a,!0),Np(n,e,s,ci(i,o)),null!==n.queries&&n.queries.elementStart(n,s),s}(i,o,r,n,e):o.data[i];Gr(a,!0);const s=r[i]=r[Ae].createComment("");return bl(o,r,s,a),pn(s,r),nl(a)&&(Pp(o,r,a),Ap(o,a,r)),null!=e&&kp(r,a),Ll}function Bl(){let t=tn();const n=We();return Dh()?Eh():(t=t.parent,Gr(t,!1)),n.firstCreatePass&&(il(n,t),xh(t)&&n.queries.elementEnd(t)),Bl}function Ul(t){return!!t&&"function"==typeof t.then}const z1=function W1(t){return!!t&&"function"==typeof t.subscribe};function fi(t,n,e,r){const o=G(),i=We(),a=tn();return function G1(t,n,e,r,o,i,a){const s=nl(r),c=t.firstCreatePass&&_1(t),l=n[St],d=x1(n);let f=!0;if(3&r.type||a){const g=$n(r,n),m=a?a(g):g,v=d.length,b=a?w=>a(en(w[r.index])):r.index;let y=null;if(!a&&s&&(y=function GO(t,n,e,r){const o=t.cleanup;if(null!=o)for(let i=0;i<o.length-1;i+=2){const a=o[i];if(a===e&&o[i+1]===r){const s=n[Da],u=o[i+2];return s.length>u?s[u]:null}"string"==typeof a&&(i+=2)}return null}(t,n,o,r.index)),null!==y)(y.__ngLastListenerFn__||y).__ngNextListenerFn__=i,y.__ngLastListenerFn__=i,f=!1;else{i=K1(r,n,l,i,!1);const w=e.listen(m,o,i);d.push(i,w),c&&c.push(o,b,v,v+1)}}else i=K1(r,n,l,i,!1);const h=r.outputs;let p;if(f&&null!==h&&(p=h[o])){const g=p.length;if(g)for(let m=0;m<g;m+=2){const x=n[p[m]][p[m+1]].subscribe(i),_=d.length;d.push(i,x),c&&c.push(o,r.index,_,-(_+1))}}}(i,o,o[Ae],a,t,n,r),fi}function q1(t,n,e,r){try{return cr(6,n,e),!1!==e(r)}catch(o){return D1(t,o),!1}finally{cr(7,n,e)}}function K1(t,n,e,r,o){return function i(a){if(a===Function)return r;Up(t.componentOffset>-1?Gn(t.index,n):n);let u=q1(n,e,r,a),c=i.__ngNextListenerFn__;for(;c;)u=q1(n,e,c,a)&&u,c=c.__ngNextListenerFn__;return o&&!1===u&&(a.preventDefault(),a.returnValue=!1),u}}function Du(t=1){return function ZT(t){return(De.lFrame.contextLView=function eA(t,n){for(;t>0;)n=n[Ea],t--;return n}(t,De.lFrame.contextLView))[St]}(t)}function X(t,n=""){const e=G(),r=We(),o=t+ft,i=r.firstCreatePass?qa(r,o,1,n,null):r.data[o],a=e[o]=function ep(t,n){return t.createText(n)}(e[Ae],n);bl(r,e,a,i),Gr(i,!1)}function Xn(t){return pi("",t,""),Xn}function pi(t,n,e){const r=G(),o=function Xa(t,n,e,r){return gn(t,Ra(),e)?n+Ce(e)+r:Ee}(r,t,n,e);return o!==Ee&&ko(r,En(),o),pi}const is="en-US";let Vx=is;class as{}class f_{}class h_ extends as{constructor(n,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new E1(this);const r=Wn(n);this._bootstrapComponents=Po(r.bootstrap),this._r3Injector=r1(n,e,[{provide:as,useValue:this},{provide:bu,useValue:this.componentFactoryResolver}],it(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class rg extends f_{constructor(n){super(),this.moduleType=n}create(n){return new h_(this.moduleType,n)}}class LF extends as{constructor(n,e,r){super(),this.componentFactoryResolver=new E1(this),this.instance=null;const o=new jw([...n,{provide:as,useValue:this},{provide:bu,useValue:this.componentFactoryResolver}],e||Sl(),r,new Set(["environment"]));this.injector=o,o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function Gl(t,n,e=null){return new LF(t,n,e).injector}let BF=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const r=Lw(0,e.type),o=r.length>0?Gl([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,o)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return t.\u0275prov=de({token:t,providedIn:"environment",factory:()=>new t(ce(Kr))}),t})();function p_(t){t.getStandaloneInjector=n=>n.get(BF).getOrCreateStandaloneInjector(t)}function x_(t,n,e,r,o,i){const a=n+e;return gn(t,a,o)?function Yr(t,n,e){return t[n]=e}(t,a+1,i?r.call(i,o):r(o)):function Au(t,n){const e=t[n];return e===Ee?void 0:e}(t,a+1)}function ig(t,n){const e=We();let r;const o=t+ft;e.firstCreatePass?(r=function r3(t,n){if(n)for(let e=n.length-1;e>=0;e--){const r=n[e];if(t===r.name)return r}}(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(o,r.onDestroy)):r=e.data[o];const i=r.factory||(r.factory=Hi(r.type)),a=ur(he);try{const s=ll(!1),u=i();return ll(s),function HO(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}(e,G(),o,u),u}finally{ur(a)}}function ag(t,n,e){const r=t+ft,o=G(),i=function Ma(t,n){return t[n]}(o,r);return function Pu(t,n){return t[te].data[n].pure}(o,r)?x_(o,function Dn(){const t=De.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}(),n,i.transform,e,i):i.transform(e)}function sg(t){return n=>{setTimeout(t,void 0,n)}}const mn=class u3 extends Vr{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,r){let o=n,i=e||(()=>null),a=r;if(n&&"object"==typeof n){const u=n;o=u.next?.bind(u),i=u.error?.bind(u),a=u.complete?.bind(u)}this.__isAsync&&(i=sg(i),o&&(o=sg(o)),a&&(a=sg(a)));const s=super.subscribe({next:o,error:i,complete:a});return n instanceof jn&&n.add(s),s}};function c3(){return this._results[Symbol.iterator]()}class ug{get changes(){return this._changes||(this._changes=new mn)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=ug.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=c3)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){const r=this;r.dirty=!1;const o=function lr(t){return t.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function yA(t,n,e){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let o=t[r],i=n[r];if(e&&(o=e(o),i=e(i)),i!==o)return!1}return!0}(r._results,o,e))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Oo=(()=>{class t{}return t.__NG_ELEMENT_ID__=f3,t})();const l3=Oo,d3=class extends l3{constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}createEmbeddedView(n,e){const r=this._declarationTContainer.tView,o=Rl(this._declarationLView,r,n,16,null,r.declTNode,null,null,null,null,e||null);o[eu]=this._declarationLView[this._declarationTContainer.index];const a=this._declarationLView[$r];return null!==a&&(o[$r]=a.createEmbeddedView(r)),Tp(r,o,n),new xu(o)}};function f3(){return ql(tn(),G())}function ql(t,n){return 4&t.type?new d3(n,t,Ha(t,n)):null}let Er=(()=>{class t{}return t.__NG_ELEMENT_ID__=h3,t})();function h3(){return M_(tn(),G())}const p3=Er,S_=class extends p3{constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return Ha(this._hostTNode,this._hostLView)}get injector(){return new Aa(this._hostTNode,this._hostLView)}get parentInjector(){const n=Fh(this._hostTNode,this._hostLView);if(Eb(n)){const e=cl(n,this._hostLView),r=ul(n);return new Aa(e[te].data[r+8],e)}return new Aa(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=I_(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-Cn}createEmbeddedView(n,e,r){let o,i;"number"==typeof r?o=r:null!=r&&(o=r.index,i=r.injector);const a=n.createEmbeddedView(e||{},i);return this.insert(a,o),a}createComponent(n,e,r,o,i){const a=n&&!function su(t){return"function"==typeof t}(n);let s;if(a)s=e;else{const d=e||{};s=d.index,r=d.injector,o=d.projectableNodes,i=d.environmentInjector||d.ngModuleRef}const u=a?n:new _u(Ze(n)),c=r||this.parentInjector;if(!i&&null==u.ngModule){const f=(a?c:this.parentInjector).get(Kr,null);f&&(i=f)}const l=u.create(c,o,void 0,i);return this.insert(l.hostView,s),l}insert(n,e){const r=n._lView,o=r[te];if(function HT(t){return wr(t[xt])}(r)){const l=this.indexOf(n);if(-1!==l)this.detach(l);else{const d=r[xt],f=new S_(d,d[dn],d[xt]);f.detach(f.indexOf(n))}}const i=this._adjustIndex(e),a=this._lContainer;!function aP(t,n,e,r){const o=Cn+r,i=e.length;r>0&&(e[o-1][br]=n),r<i-Cn?(n[br]=e[o],Bb(e,Cn+r,n)):(e.push(n),n[br]=null),n[xt]=e;const a=n[eu];null!==a&&e!==a&&function sP(t,n){const e=t[Ia];n[fn]!==n[xt][xt][fn]&&(t[Y0]=!0),null===e?t[Ia]=[n]:e.push(n)}(a,n);const s=n[$r];null!==s&&s.insertView(t),n[Me]|=64}(o,r,a,i);const s=ip(i,a),u=r[Ae],c=yl(u,a[el]);return null!==c&&function rP(t,n,e,r,o,i){r[Io]=o,r[dn]=n,gu(t,r,e,1,o,i)}(o,a[dn],u,r,c,s),n.attachToViewContainerRef(),Bb(cg(a),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=I_(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),r=np(this._lContainer,e);r&&(pl(cg(this._lContainer),e),uw(r[te],r))}detach(n){const e=this._adjustIndex(n,-1),r=np(this._lContainer,e);return r&&null!=pl(cg(this._lContainer),e)?new xu(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function I_(t){return t[tl]}function cg(t){return t[tl]||(t[tl]=[])}function M_(t,n){let e;const r=n[t.index];if(wr(r))e=r;else{let o;if(8&t.type)o=en(r);else{const i=n[Ae];o=i.createComment("");const a=$n(t,n);qi(i,yl(i,a),o,function dP(t,n){return t.nextSibling(n)}(i,a),!1)}n[t.index]=e=w1(r,n,o,t),Al(n,e)}return new S_(e,t,n)}class lg{constructor(n){this.queryList=n,this.matches=null}clone(){return new lg(this.queryList)}setDirty(){this.queryList.setDirty()}}class dg{constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const r=null!==n.contentQueries?n.contentQueries[0]:e.length,o=[];for(let i=0;i<r;i++){const a=e.getByIndex(i);o.push(this.queries[a.indexInDeclarationView].clone())}return new dg(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==O_(n,e).matches&&this.queries[e].setDirty()}}class R_{constructor(n,e,r=null){this.predicate=n,this.flags=e,this.read=r}}class fg{constructor(n=[]){this.queries=n}elementStart(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let r=0;r<this.length;r++){const o=null!==e?e.length:0,i=this.getByIndex(r).embeddedTView(n,o);i&&(i.indexInDeclarationView=r,null!==e?e.push(i):e=[i])}return null!==e?new fg(e):null}template(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class hg{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new hg(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==e;)r=r.parent;return e===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const i=r[o];this.matchTNodeWithReadOption(n,e,g3(e,i)),this.matchTNodeWithReadOption(n,e,fl(e,n,i,!1,!1))}else r===Oo?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,fl(e,n,r,!1,!1))}matchTNodeWithReadOption(n,e,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===Ao||o===Er||o===Oo&&4&e.type)this.addMatch(e.index,-2);else{const i=fl(e,n,o,!1,!1);null!==i&&this.addMatch(e.index,i)}else this.addMatch(e.index,r)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function g3(t,n){const e=t.localNames;if(null!==e)for(let r=0;r<e.length;r+=2)if(e[r]===n)return e[r+1];return null}function v3(t,n,e,r){return-1===e?function m3(t,n){return 11&t.type?Ha(t,n):4&t.type?ql(t,n):null}(n,t):-2===e?function y3(t,n,e){return e===Ao?Ha(n,t):e===Oo?ql(n,t):e===Er?M_(n,t):void 0}(t,n,r):$i(t,t[te],e,n)}function T_(t,n,e,r){const o=n[$r].queries[r];if(null===o.matches){const i=t.data,a=e.matches,s=[];for(let u=0;u<a.length;u+=2){const c=a[u];s.push(c<0?null:v3(n,i[c],a[u+1],e.metadata.read))}o.matches=s}return o.matches}function pg(t,n,e,r){const o=t.queries.getByIndex(e),i=o.matches;if(null!==i){const a=T_(t,n,o,e);for(let s=0;s<i.length;s+=2){const u=i[s];if(u>0)r.push(a[s/2]);else{const c=i[s+1],l=n[-u];for(let d=Cn;d<l.length;d++){const f=l[d];f[eu]===f[xt]&&pg(f[te],f,c,r)}if(null!==l[Ia]){const d=l[Ia];for(let f=0;f<d.length;f++){const h=d[f];pg(h[te],h,c,r)}}}}}return r}function Sr(t){const n=G(),e=We(),r=gb();Mh(r+1);const o=O_(e,r);if(t.dirty&&function jT(t){return 4==(4&t[Me])}(n)===(2==(2&o.metadata.flags))){if(null===o.matches)t.reset([]);else{const i=o.crossesNgTemplate?pg(e,n,r,[]):T_(e,n,o,r);t.reset(i,nk),t.notifyOnChanges()}return!0}return!1}function eo(t,n,e){const r=We();r.firstCreatePass&&(k_(r,new R_(t,n,e),-1),2==(2&n)&&(r.staticViewQueries=!0)),P_(r,G(),n)}function Ir(){return function b3(t,n){return t[$r].queries[n].queryList}(G(),gb())}function P_(t,n,e){const r=new ug(4==(4&e));p1(t,n,r,r.destroy),null===n[$r]&&(n[$r]=new dg),n[$r].queries.push(new lg(r))}function k_(t,n,e){null===t.queries&&(t.queries=new fg),t.queries.track(new hg(n,e))}function O_(t,n){return t.queries.getByIndex(n)}function Xl(...t){}const Ql=new fe("Application Initializer");let Yl=(()=>{class t{constructor(e){this.appInits=e,this.resolve=Xl,this.reject=Xl,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}runInitializers(){if(this.initialized)return;const e=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const i=this.appInits[o]();if(Ul(i))e.push(i);else if(z1(i)){const a=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});e.push(a)}}Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),0===e.length&&r(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(ce(Ql,8))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Ou=new fe("AppId",{providedIn:"root",factory:function J_(){return`${wg()}${wg()}${wg()}`}});function wg(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Z_=new fe("Platform Initializer"),xg=new fe("Platform ID",{providedIn:"platform",factory:()=>"unknown"});let j3=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const No=new fe("LocaleId",{providedIn:"root",factory:()=>Ne(No,be.Optional|be.SkipSelf)||function H3(){return typeof $localize<"u"&&$localize.locale||is}()});class z3{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}let eC=(()=>{class t{compileModuleSync(e){return new rg(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const r=this.compileModuleSync(e),i=Po(Wn(e).declarations).reduce((a,s)=>{const u=Ze(s);return u&&a.push(new _u(u)),a},[]);return new z3(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const q3=(()=>Promise.resolve(0))();function _g(t){typeof Zone>"u"?q3.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class It{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new mn(!1),this.onMicrotaskEmpty=new mn(!1),this.onStable=new mn(!1),this.onError=new mn(!1),typeof Zone>"u")throw new Q(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&e,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function K3(){let t=dt.requestAnimationFrame,n=dt.cancelAnimationFrame;if(typeof Zone<"u"&&t&&n){const e=t[Zone.__symbol__("OriginalDelegate")];e&&(t=e);const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function Y3(t){const n=()=>{!function Q3(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(dt,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Dg(t),t.isCheckStableRunning=!0,Cg(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Dg(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,o,i,a,s)=>{try{return rC(t),e.invokeTask(o,i,a,s)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||t.shouldCoalesceRunChangeDetection)&&n(),oC(t)}},onInvoke:(e,r,o,i,a,s,u)=>{try{return rC(t),e.invoke(o,i,a,s,u)}finally{t.shouldCoalesceRunChangeDetection&&n(),oC(t)}},onHasTask:(e,r,o,i)=>{e.hasTask(o,i),r===o&&("microTask"==i.change?(t._hasPendingMicrotasks=i.microTask,Dg(t),Cg(t)):"macroTask"==i.change&&(t.hasPendingMacrotasks=i.macroTask))},onHandleError:(e,r,o,i)=>(e.handleError(o,i),t.runOutsideAngular(()=>t.onError.emit(i)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!It.isInAngularZone())throw new Q(909,!1)}static assertNotInAngularZone(){if(It.isInAngularZone())throw new Q(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){const i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+o,n,X3,Xl,Xl);try{return i.runTask(a,e,r)}finally{i.cancelTask(a)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}}const X3={};function Cg(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Dg(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function rC(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function oC(t){t._nesting--,Cg(t)}class J3{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new mn,this.onMicrotaskEmpty=new mn,this.onStable=new mn,this.onError=new mn}run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}}const iC=new fe(""),Jl=new fe("");let Ig,Eg=(()=>{class t{constructor(e,r,o){this._ngZone=e,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ig||(function Z3(t){Ig=t}(o),o.addToWindow(r)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{It.assertNotInAngularZone(),_g(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())_g(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(e)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,r,o){let i=-1;r&&r>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==i),e(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:e,timeoutId:i,updateCb:o})}whenStable(e,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,r,o){return[]}}return t.\u0275fac=function(e){return new(e||t)(ce(It),ce(Sg),ce(Jl))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),Sg=(()=>{class t{constructor(){this._applications=new Map}registerApplication(e,r){this._applications.set(e,r)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,r=!0){return Ig?.findTestabilityInTree(this,e,r)??null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Fo=!1;let gi=null;const aC=new fe("AllowMultipleToken"),Mg=new fe("PlatformDestroyListeners"),sC=new fe("appBootstrapListener");class uC{constructor(n,e){this.name=n,this.token=e}}function lC(t,n,e=[]){const r=`Platform: ${n}`,o=new fe(r);return(i=[])=>{let a=Rg();if(!a||a.injector.get(aC,!1)){const s=[...e,...i,{provide:o,useValue:!0}];t?t(s):function nL(t){if(gi&&!gi.get(aC,!1))throw new Q(400,!1);gi=t;const n=t.get(fC);(function cC(t){const n=t.get(Z_,null);n&&n.forEach(e=>e())})(t)}(function dC(t=[],n){return Xr.create({name:n,providers:[{provide:yp,useValue:"platform"},{provide:Mg,useValue:new Set([()=>gi=null])},...t]})}(s,r))}return function oL(t){const n=Rg();if(!n)throw new Q(401,!1);return n}()}}function Rg(){return gi?.get(fC)??null}let fC=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,r){const o=function pC(t,n){let e;return e="noop"===t?new J3:("zone.js"===t?void 0:t)||new It(n),e}(r?.ngZone,function hC(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!t||!t.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!t||!t.ngZoneRunCoalescing)||!1}}(r)),i=[{provide:It,useValue:o}];return o.run(()=>{const a=Xr.create({providers:i,parent:this.injector,name:e.moduleType.name}),s=e.create(a),u=s.injector.get(za,null);if(!u)throw new Q(402,!1);return o.runOutsideAngular(()=>{const c=o.onError.subscribe({next:l=>{u.handleError(l)}});s.onDestroy(()=>{ed(this._modules,s),c.unsubscribe()})}),function gC(t,n,e){try{const r=e();return Ul(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}(u,o,()=>{const c=s.injector.get(Yl);return c.runInitializers(),c.donePromise.then(()=>(function jx(t){sr(t,"Expected localeId to be defined"),"string"==typeof t&&(Vx=t.toLowerCase().replace(/_/g,"-"))}(s.injector.get(No,is)||is),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,r=[]){const o=mC({},r);return function eL(t,n,e){const r=new rg(e);return Promise.resolve(r)}(0,0,e).then(i=>this.bootstrapModuleFactory(i,o))}_moduleDoBootstrap(e){const r=e.injector.get(Zl);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!e.instance.ngDoBootstrap)throw new Q(-403,!1);e.instance.ngDoBootstrap(r)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Q(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const e=this._injector.get(Mg,null);e&&(e.forEach(r=>r()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(ce(Xr))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function mC(t,n){return Array.isArray(n)?n.reduce(mC,t):{...t,...n}}let Zl=(()=>{class t{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(e,r,o){this._zone=e,this._injector=r,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const i=new Et(s=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{s.next(this._stable),s.complete()})}),a=new Et(s=>{let u;this._zone.runOutsideAngular(()=>{u=this._zone.onStable.subscribe(()=>{It.assertNotInAngularZone(),_g(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,s.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{It.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{s.next(!1)}))});return()=>{u.unsubscribe(),c.unsubscribe()}});this.isStable=function iT(...t){const n=Ks(t),e=function JR(t,n){return"number"==typeof ah(t)?t.pop():n}(t,1/0),r=t;return r.length?1===r.length?ar(r[0]):xa(e)(Ht(r,n)):jr}(i,a.pipe(function aT(t={}){const{connector:n=(()=>new Vr),resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=t;return i=>{let a,s,u,c=0,l=!1,d=!1;const f=()=>{s?.unsubscribe(),s=void 0},h=()=>{f(),a=u=void 0,l=d=!1},p=()=>{const g=a;h(),g?.unsubscribe()};return jt((g,m)=>{c++,!d&&!l&&f();const v=u=u??n();m.add(()=>{c--,0===c&&!d&&!l&&(s=sh(p,o))}),v.subscribe(m),!a&&c>0&&(a=new qs({next:b=>v.next(b),error:b=>{d=!0,f(),s=sh(h,e,b),v.error(b)},complete:()=>{l=!0,f(),s=sh(h,r),v.complete()}}),ar(g).subscribe(a))})(i)}}()))}bootstrap(e,r){const o=e instanceof Ww;if(!this._injector.get(Yl).done){!o&&function Ca(t){const n=Ze(t)||ln(t)||Pn(t);return null!==n&&n.standalone}(e);throw new Q(405,Fo)}let a;a=o?e:this._injector.get(bu).resolveComponentFactory(e),this.componentTypes.push(a.componentType);const s=function tL(t){return t.isBoundToModule}(a)?void 0:this._injector.get(as),c=a.create(Xr.NULL,[],r||a.selector,s),l=c.location.nativeElement,d=c.injector.get(iC,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),ed(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new Q(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){const r=e;ed(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const r=this._injector.get(sC,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>ed(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Q(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return t.\u0275fac=function(e){return new(e||t)(ce(It),ce(Kr),ce(za))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function ed(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}let Tg=(()=>{class t{}return t.__NG_ELEMENT_ID__=aL,t})();function aL(t){return function sL(t,n,e){if(nu(t)&&!e){const r=Gn(t.index,n);return new xu(r,r)}return 47&t.type?new xu(n[fn],n):null}(tn(),G(),16==(16&t))}class xC{constructor(){}supports(n){return Nl(n)}create(n){return new hL(n)}}const fL=(t,n)=>n;class hL{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||fL}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){const a=!r||e&&e.currentIndex<CC(r,o,i)?e:r,s=CC(a,o,i),u=a.currentIndex;if(a===r)o--,r=r._nextRemoved;else if(e=e._next,null==a.previousIndex)o++;else{i||(i=[]);const c=s-o,l=u-o;if(c!=l){for(let f=0;f<c;f++){const h=f<i.length?i[f]:i[f]=0,p=h+f;l<=p&&p<c&&(i[f]=h+1)}i[a.previousIndex]=l-c}}s!==u&&n(a,s,u)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!Nl(n))throw new Q(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o,i,a,e=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let s=0;s<this.length;s++)i=n[s],a=this._trackByFn(s,i),null!==e&&Object.is(e.trackById,a)?(r&&(e=this._verifyReinsertion(e,i,a,s)),Object.is(e.item,i)||this._addIdentityChange(e,i)):(e=this._mismatch(e,i,a,s),r=!0),e=e._next}else o=0,function BO(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Symbol.iterator]();let r;for(;!(r=e.next()).done;)n(r.value)}}(n,s=>{a=this._trackByFn(o,s),null!==e&&Object.is(e.trackById,a)?(r&&(e=this._verifyReinsertion(e,s,a,o)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,a,o),r=!0),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return null===n?i=this._itTail:(i=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new pL(e,r),i,o),n}_verifyReinsertion(n,e,r,o){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const o=n._prevRemoved,i=n._nextRemoved;return null===o?this._removalsHead=i:o._nextRemoved=i,null===i?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){const o=null===e?this._itHead:e._next;return n._next=o,n._prev=e,null===o?this._itTail=n:o._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new _C),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,r=n._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new _C),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class pL{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class gL{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const e=n._prevDup,r=n._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class _C{constructor(){this.map=new Map}put(n){const e=n.trackById;let r=this.map.get(e);r||(r=new gL,this.map.set(e,r)),r.add(n)}get(n,e){const o=this.map.get(n);return o?o.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function CC(t,n,e){const r=t.previousIndex;if(null===r)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}class DC{constructor(){}supports(n){return n instanceof Map||Wp(n)}create(){return new mL}}class mL{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||Wp(n)))throw new Q(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,o)=>{if(e&&e.key===o)this._maybeAddToChanges(e,r),this._appendAfter=e,e=e._next;else{const i=this._getOrCreateRecordForKey(o,r);e=this._insertBeforeOrAppend(e,i)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let r=e;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const r=n._prev;return e._next=n,e._prev=r,n._prev=e,r&&(r._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const o=this._records.get(n);this._maybeAddToChanges(o,e);const i=o._prev,a=o._next;return i&&(i._next=a),a&&(a._prev=i),o._next=null,o._prev=null,o}const r=new vL(n);return this._records.set(n,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(r=>e(n[r],r))}}class vL{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function EC(){return new rd([new xC])}let rd=(()=>{class t{constructor(e){this.factories=e}static create(e,r){if(null!=r){const o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||EC()),deps:[[t,new lu,new cu]]}}find(e){const r=this.factories.find(o=>o.supports(e));if(null!=r)return r;throw new Q(901,!1)}}return t.\u0275prov=de({token:t,providedIn:"root",factory:EC}),t})();function SC(){return new Nu([new DC])}let Nu=(()=>{class t{constructor(e){this.factories=e}static create(e,r){if(r){const o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||SC()),deps:[[t,new lu,new cu]]}}find(e){const r=this.factories.find(o=>o.supports(e));if(r)return r;throw new Q(901,!1)}}return t.\u0275prov=de({token:t,providedIn:"root",factory:SC}),t})();const wL=lC(null,"core",[]);let xL=(()=>{class t{constructor(e){}}return t.\u0275fac=function(e){return new(e||t)(ce(Zl))},t.\u0275mod=So({type:t}),t.\u0275inj=Hr({}),t})();function Ng(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}let Fg=null;function Zi(){return Fg}class DL{}const Mn=new fe("DocumentToken");let Lg=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return function EL(){return ce(IC)}()},providedIn:"platform"}),t})();const SL=new fe("Location Initialized");let IC=(()=>{class t extends Lg{constructor(e){super(),this._doc=e,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Zi().getBaseHref(this._doc)}onPopState(e){const r=Zi().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){const r=Zi().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){MC()?this._history.pushState(e,r,o):this._location.hash=o}replaceState(e,r,o){MC()?this._history.replaceState(e,r,o):this._location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(ce(Mn))},t.\u0275prov=de({token:t,factory:function(){return function IL(){return new IC(ce(Mn))}()},providedIn:"platform"}),t})();function MC(){return!!window.history.pushState}function Bg(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function RC(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function Lo(t){return t&&"?"!==t[0]?"?"+t:t}let ea=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne(AC)},providedIn:"root"}),t})();const TC=new fe("appBaseHref");let AC=(()=>{class t extends ea{constructor(e,r){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Ne(Mn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Bg(this._baseHref,e)}path(e=!1){const r=this._platformLocation.pathname+Lo(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){const a=this.prepareExternalUrl(o+Lo(i));this._platformLocation.pushState(e,r,a)}replaceState(e,r,o,i){const a=this.prepareExternalUrl(o+Lo(i));this._platformLocation.replaceState(e,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return t.\u0275fac=function(e){return new(e||t)(ce(Lg),ce(TC,8))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ML=(()=>{class t extends ea{constructor(e,r){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(e){const r=Bg(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,o,i){let a=this.prepareExternalUrl(o+Lo(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(e,r,a)}replaceState(e,r,o,i){let a=this.prepareExternalUrl(o+Lo(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(e,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return t.\u0275fac=function(e){return new(e||t)(ce(Lg),ce(TC,8))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),Ug=(()=>{class t{constructor(e){this._subject=new mn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const r=this._locationStrategy.getBaseHref();this._basePath=function AL(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(RC(PC(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Lo(r))}normalize(e){return t.stripTrailingSlash(function TL(t,n){if(!t||!n.startsWith(t))return n;const e=n.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:n}(this._basePath,PC(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Lo(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Lo(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r,complete:o})}}return t.normalizeQueryParams=Lo,t.joinWithSlash=Bg,t.stripTrailingSlash=RC,t.\u0275fac=function(e){return new(e||t)(ce(ea))},t.\u0275prov=de({token:t,factory:function(){return function RL(){return new Ug(ce(ea))}()},providedIn:"root"}),t})();function PC(t){return t.replace(/\/index.html$/,"")}function jC(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const r=e.indexOf("="),[o,i]=-1==r?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}class m4{constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let $C=(()=>{class t{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const r=this._viewContainer;e.forEachOperation((o,i,a)=>{if(null==o.previousIndex)r.createEmbeddedView(this._template,new m4(o.item,this._ngForOf,-1,-1),null===a?void 0:a);else if(null==a)r.remove(null===i?void 0:i);else if(null!==i){const s=r.get(i);r.move(s,a),GC(s,o)}});for(let o=0,i=r.length;o<i;o++){const s=r.get(o).context;s.index=o,s.count=i,s.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{GC(r.get(o.currentIndex),o)})}static ngTemplateContextGuard(e,r){return!0}}return t.\u0275fac=function(e){return new(e||t)(he(Er),he(Oo),he(rd))},t.\u0275dir=_n({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function GC(t,n){t.context.$implicit=n.item}let hd=(()=>{class t{constructor(e,r){this._viewContainer=e,this._context=new y4,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){qC("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){qC("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,r){return!0}}return t.\u0275fac=function(e){return new(e||t)(he(Er),he(Oo))},t.\u0275dir=_n({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class y4{constructor(){this.$implicit=null,this.ngIf=null}}function qC(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${it(n)}'.`)}let XC=(()=>{class t{constructor(e){this.differs=e,this.keyValues=[],this.compareFn=QC}transform(e,r=QC){if(!e||!(e instanceof Map)&&"object"!=typeof e)return null;this.differ||(this.differ=this.differs.find(e).create());const o=this.differ.diff(e),i=r!==this.compareFn;return o&&(this.keyValues=[],o.forEachItem(a=>{this.keyValues.push(function B4(t,n){return{key:t,value:n}}(a.key,a.currentValue))})),(o||i)&&(this.keyValues.sort(r),this.compareFn=r),this.keyValues}}return t.\u0275fac=function(e){return new(e||t)(he(Nu,16))},t.\u0275pipe=An({name:"keyvalue",type:t,pure:!1,standalone:!0}),t})();function QC(t,n){const e=t.key,r=n.key;if(e===r)return 0;if(void 0===e)return 1;if(void 0===r)return-1;if(null===e)return 1;if(null===r)return-1;if("string"==typeof e&&"string"==typeof r)return e<r?-1:1;if("number"==typeof e&&"number"==typeof r)return e-r;if("boolean"==typeof e&&"boolean"==typeof r)return e<r?-1:1;const o=String(e),i=String(r);return o==i?0:o<i?-1:1}let H4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=So({type:t}),t.\u0275inj=Hr({}),t})();let G4=(()=>{class t{}return t.\u0275prov=de({token:t,providedIn:"root",factory:()=>new q4(ce(Mn),window)}),t})();class q4{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function K4(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const i=o.shadowRoot;if(i){const a=i.getElementById(n)||i.querySelector(`[name="${n}"]`);if(a)return a}o=r.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=n)}}scrollToElement(n){const e=n.getBoundingClientRect(),r=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(r-i[0],o-i[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=JC(this.window.history)||JC(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function JC(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class ZC{}class xB extends DL{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class nm extends xB{static makeCurrent(){!function CL(t){Fg||(Fg=t)}(new nm)}onAndCancel(n,e,r){return n.addEventListener(e,r,!1),()=>{n.removeEventListener(e,r,!1)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=function _B(){return Uu=Uu||document.querySelector("base"),Uu?Uu.getAttribute("href"):null}();return null==e?null:function CB(t){md=md||document.createElement("a"),md.setAttribute("href",t);const n=md.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){Uu=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return jC(document.cookie,n)}}let md,Uu=null;const oD=new fe("TRANSITION_ID"),EB=[{provide:Ql,useFactory:function DB(t,n,e){return()=>{e.get(Yl).donePromise.then(()=>{const r=Zi(),o=n.querySelectorAll(`style[ng-transition="${t}"]`);for(let i=0;i<o.length;i++)r.remove(o[i])})}},deps:[oD,Mn,Xr],multi:!0}];let IB=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const vd=new fe("EventManagerPlugins");let yd=(()=>{class t{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o){return this._findPluginFor(r).addEventListener(e,r,o)}addGlobalEventListener(e,r,o){return this._findPluginFor(r).addGlobalEventListener(e,r,o)}getZone(){return this._zone}_findPluginFor(e){const r=this._eventNameToPlugin.get(e);if(r)return r;const o=this._plugins;for(let i=0;i<o.length;i++){const a=o[i];if(a.supports(e))return this._eventNameToPlugin.set(e,a),a}throw new Error(`No event manager plugin found for event ${e}`)}}return t.\u0275fac=function(e){return new(e||t)(ce(vd),ce(It))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();class iD{constructor(n){this._doc=n}addGlobalEventListener(n,e,r){const o=Zi().getGlobalEventTarget(this._doc,n);if(!o)throw new Error(`Unsupported event target ${o} for event ${e}`);return this.addEventListener(o,e,r)}}let aD=(()=>{class t{constructor(){this.usageCount=new Map}addStyles(e){for(const r of e)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(e){for(const r of e)0===this.changeUsageCount(r,-1)&&this.onStyleRemoved(r)}onStyleRemoved(e){}onStyleAdded(e){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(e,r){const o=this.usageCount;let i=o.get(e)??0;return i+=r,i>0?o.set(e,i):o.delete(e),i}ngOnDestroy(){for(const e of this.getAllStyles())this.onStyleRemoved(e);this.usageCount.clear()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),Vu=(()=>{class t extends aD{constructor(e){super(),this.doc=e,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(e){for(const r of this.hostNodes)this.addStyleToHost(r,e)}onStyleRemoved(e){const r=this.styleRef;r.get(e)?.forEach(i=>i.remove()),r.delete(e)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const r of this.getAllStyles())this.addStyleToHost(e,r)}removeHost(e){this.hostNodes.delete(e)}addStyleToHost(e,r){const o=this.doc.createElement("style");o.textContent=r,e.appendChild(o);const i=this.styleRef.get(r);i?i.push(o):this.styleRef.set(r,[o])}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}}return t.\u0275fac=function(e){return new(e||t)(ce(Mn))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const rm={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},om=/%COMP%/g,cD=new fe("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function lD(t,n){return n.flat(100).map(e=>e.replace(om,t))}function dD(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&(n.preventDefault(),n.returnValue=!1)}}let im=(()=>{class t{constructor(e,r,o,i){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestory=i,this.rendererByCompId=new Map,this.defaultRenderer=new am(e)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;const o=this.getOrCreateRenderer(e,r);return o instanceof pD?o.applyToHost(e):o instanceof sm&&o.applyStyles(),o}getOrCreateRenderer(e,r){const o=this.rendererByCompId;let i=o.get(r.id);if(!i){const a=this.eventManager,s=this.sharedStylesHost,u=this.removeStylesOnCompDestory;switch(r.encapsulation){case zr.Emulated:i=new pD(a,s,r,this.appId,u);break;case zr.ShadowDom:return new OB(a,s,e,r);default:i=new sm(a,s,r,u)}i.onDestroy=()=>o.delete(r.id),o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(ce(yd),ce(Vu),ce(Ou),ce(cD))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();class am{constructor(n){this.eventManager=n,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,e){return e?document.createElementNS(rm[e]||e,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,e){(hD(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(hD(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let r="string"==typeof n?document.querySelector(n):n;if(!r)throw new Error(`The selector "${n}" did not match any elements`);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;const i=rm[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){const o=rm[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(On.DashCase|On.Important)?n.style.setProperty(e,r,o&On.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&On.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n[e]=r}setValue(n,e){n.nodeValue=e}listen(n,e,r){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,e,dD(r)):this.eventManager.addEventListener(n,e,dD(r))}}function hD(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class OB extends am{constructor(n,e,r,o){super(n),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=lD(o.id,o.styles);for(const a of i){const s=document.createElement("style");s.textContent=a,this.shadowRoot.appendChild(s)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class sm extends am{constructor(n,e,r,o,i=r.id){super(n),this.sharedStylesHost=e,this.removeStylesOnCompDestory=o,this.rendererUsageCount=0,this.styles=lD(i,r.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class pD extends sm{constructor(n,e,r,o,i){const a=o+"-"+r.id;super(n,e,r,i,a),this.contentAttr=function AB(t){return"_ngcontent-%COMP%".replace(om,t)}(a),this.hostAttr=function PB(t){return"_nghost-%COMP%".replace(om,t)}(a)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){const r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}}let NB=(()=>{class t extends iD{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o){return e.addEventListener(r,o,!1),()=>this.removeEventListener(e,r,o)}removeEventListener(e,r,o){return e.removeEventListener(r,o)}}return t.\u0275fac=function(e){return new(e||t)(ce(Mn))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const gD=["alt","control","meta","shift"],FB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},LB={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let BB=(()=>{class t extends iD{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,r,o){const i=t.parseEventName(r),a=t.eventCallback(i.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Zi().onAndCancel(e,i.domEventName,a))}static parseEventName(e){const r=e.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const i=t._normalizeKey(r.pop());let a="",s=r.indexOf("code");if(s>-1&&(r.splice(s,1),a="code."),gD.forEach(c=>{const l=r.indexOf(c);l>-1&&(r.splice(l,1),a+=c+".")}),a+=i,0!=r.length||0===i.length)return null;const u={};return u.domEventName=o,u.fullKey=a,u}static matchEventFullKeyCode(e,r){let o=FB[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),gD.forEach(a=>{a!==o&&(0,LB[a])(e)&&(i+=a+".")}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return t.\u0275fac=function(e){return new(e||t)(ce(Mn))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const vD=[{provide:xg,useValue:"browser"},{provide:Z_,useValue:function UB(){nm.makeCurrent()},multi:!0},{provide:Mn,useFactory:function jB(){return function bP(t){cp=t}(document),document},deps:[]}],HB=lC(wL,"browser",vD),yD=new fe(""),bD=[{provide:Jl,useClass:class SB{addToWindow(n){dt.getAngularTestability=(r,o=!0)=>{const i=n.findTestabilityInTree(r,o);if(null==i)throw new Error("Could not find testability for element.");return i},dt.getAllAngularTestabilities=()=>n.getAllTestabilities(),dt.getAllAngularRootElements=()=>n.getAllRootElements(),dt.frameworkStabilizers||(dt.frameworkStabilizers=[]),dt.frameworkStabilizers.push(r=>{const o=dt.getAllAngularTestabilities();let i=o.length,a=!1;const s=function(u){a=a||u,i--,0==i&&r(a)};o.forEach(function(u){u.whenStable(s)})})}findTestabilityInTree(n,e,r){return null==e?null:n.getTestability(e)??(r?Zi().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null)}},deps:[]},{provide:iC,useClass:Eg,deps:[It,Sg,Jl]},{provide:Eg,useClass:Eg,deps:[It,Sg,Jl]}],wD=[{provide:yp,useValue:"root"},{provide:za,useFactory:function VB(){return new za},deps:[]},{provide:vd,useClass:NB,multi:!0,deps:[Mn,It,xg]},{provide:vd,useClass:BB,multi:!0,deps:[Mn]},{provide:im,useClass:im,deps:[yd,Vu,Ou,cD]},{provide:$w,useExisting:im},{provide:aD,useExisting:Vu},{provide:Vu,useClass:Vu,deps:[Mn]},{provide:yd,useClass:yd,deps:[vd,It]},{provide:ZC,useClass:IB,deps:[]},[]];let WB=(()=>{class t{constructor(e){}static withServerTransition(e){return{ngModule:t,providers:[{provide:Ou,useValue:e.appId},{provide:oD,useExisting:Ou},EB]}}}return t.\u0275fac=function(e){return new(e||t)(ce(yD,12))},t.\u0275mod=So({type:t}),t.\u0275inj=Hr({providers:[...wD,...bD],imports:[H4,xL]}),t})(),xD=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return t.\u0275fac=function(e){return new(e||t)(ce(Mn))},t.\u0275prov=de({token:t,factory:function(e){let r=null;return r=e?new e:function $B(){return new xD(ce(Mn))}(),r},providedIn:"root"}),t})();function bd(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}typeof window<"u"&&window;class to extends Vr{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(n){const{hasError:e,_hasValue:r,_value:o,thrownError:i,isStopped:a,_isComplete:s}=this;e?n.error(i):(a||s)&&(r&&n.next(o),n.complete())}next(n){this.isStopped||(this._value=n,this._hasValue=!0)}complete(){const{_hasValue:n,_value:e,_isComplete:r}=this;r||(this._isComplete=!0,n&&super.next(e),super.complete())}}class Qn extends Vr{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){const{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}const JB=["video"],ZB=["canvas"],eU=["resultsPanel"],SD={audio:!1,video:!0},Uo={src:"",fps:30,vibrate:300,decode:"utf-8",isBeep:!0,deviceActive:0,constraints:SD},st=(t,n,e=null)=>{e?t.error(e):t.next(n),t.complete()},ID=(t=!1)=>{if(!1===t)return;const n=new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"+Array(300).join("101"));n.oncanplaythrough=()=>{const e=n.play();e&&e.catch(r=>{})}},pr=(t,n)=>{const e=n.split(".");for(let r=0;r<e.length;r++){let o=e[r];if(!t.hasOwnProperty(o))return!1;t=t[o]}return!0},MD=(t,n,e)=>{let r,o,i=n.width,a=n.height,s=i/a,u=parseInt(getComputedStyle(n).width),c=parseInt(getComputedStyle(n).height),l=u/c;e.innerHTML="",s>l?(r=u/i,o=u/s/a):(o=c/a,r=c*s/i);for(let d=0;d<t.length;d++){const f=t[d];let h=document.createElement("canvas"),p=h.getContext("2d",{willReadFrequently:!0}),g={},m=[],v=[];const b=f.points;for(let F=0;F<b.length;F++){const W=pr(b,`${F}.x`)?b[F].x:0,H=pr(b,`${F}.y`)?b[F].y:0;g[`x${F+1}`]=W,g[`y${F+1}`]=H,m.push(W),v.push(H)}let y=Math.max(...m),w=Math.min(...m),x=Math.max(...v),_=Math.min(...v);h.setAttribute("class","qrcode-polygon"),s>l?(h.style.top=_*o+.5*(c-u/s)+"px",h.style.left=w*r+"px",h.width=(y-w)*r,h.height=(x-_)*r):(h.style.top=_*o+"px",h.style.left=w*r+.5*(u-c*s)+"px",h.width=(y-w)*o,h.height=(x-_)*o),p.lineWidth=1,p.strokeStyle="green",p.fillStyle="#55f02880";const M=[];for(let F=0;F<m.length;F++)M.push((g[`x${F+1}`]-w)*o),M.push((g[`y${F+1}`]-_)*r);const I=M.slice(0);for(p.beginPath(),p.moveTo(I.shift(),I.shift());I.length;)p.lineTo(I.shift(),I.shift());p.closePath(),p.fill(),p.stroke();const E=document.createElement("div");E.setAttribute("class","qrcode-tooltip-temp"),E.innerText=f.value;const S=`<?xml version="1.0" encoding="utf-8"?><svg version="1.1" class="qrcode-tooltip-clipboard" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${15*r}" x="0px" y="0px" title="Copy value to clipboard" viewBox="0 0 115.77 122.88" xml:space="preserve"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path></g></svg> `,P=(new DOMParser).parseFromString(S,"application/xml"),A=E.ownerDocument.importNode(P.documentElement,!0);E.appendChild(A),A.addEventListener("click",()=>window.navigator.clipboard.writeText(f.value));const V=document.createElement("div");V.setAttribute("class","qrcode-tooltip"),V.appendChild(E),o=c/a,r=c*s/i,V.style.fontSize=15*r+"px",V.style.top=_*o+"px",V.style.left=w*r+.5*(u-c*s)+"px",V.style.width=(y-w)*o+"px",V.style.height=(x-_)*o+"px";const U=document.createElement("span");U.innerText=f.value,U.style.fontSize=13*r+"px",U.style.top=_*o+-20*o+"px",U.style.left=w*r+.5*(u-c*s)+"px",e&&(e.appendChild(V),e.appendChild(U),e.appendChild(h))}},RD=(t,n)=>new Promise((e,r)=>t.toBlob(o=>e(o),n)),TD=(t=[],n,e=new to)=>(Promise.all(Object.assign([],t).map(r=>((t,n)=>{let e=pr(n,"decode")?n.decode:Uo.decode;return new Promise((r,o)=>{const i=new FileReader;i.onload=()=>{const a={name:t.name,file:t,url:URL.createObjectURL(t)},s=new Image;s.setAttribute("crossOrigin","anonymous"),s.onload=()=>bd(void 0,void 0,void 0,function*(){const u=document.createElement("canvas");u.width=s.naturalWidth||s.width,u.height=s.naturalHeight||s.height;const c=u.getContext("2d");c.drawImage(s,0,0,u.width,u.height);const l=c.getImageData(0,0,u.width,u.height),d=yield zbarWasm.scanImageData(l);if(d&&d.length){d.forEach(g=>g.value=g.decode(e&&e.toLocaleLowerCase())),((t,n)=>{let e=n.getContext("2d",{willReadFrequently:!0});for(let r=0;r<t.length;r++){const o=t[r];let i={},a=[],s=[];const u=o.points;for(let h=0;h<u.length;h++){const p=pr(u,`${h}.x`)?u[h].x:0,g=pr(u,`${h}.y`)?u[h].y:0;i[`x${h+1}`]=p,i[`y${h+1}`]=g,a.push(p),s.push(g)}let c=Math.min(...a),l=Math.min(...s);e.lineWidth=1,e.strokeStyle="green",e.fillStyle="#55f02880",e.font="15px serif",iU(e,o.value,c,l-5);const d=[];for(let h=0;h<a.length;h++)d.push(i[`x${h+1}`]),d.push(i[`y${h+1}`]);const f=d.slice(0);for(e.beginPath(),e.moveTo(f.shift(),f.shift());f.length;)e.lineTo(f.shift(),f.shift());e.closePath(),e.fill(),e.stroke()}})(d,u);const f=yield RD(u),h=URL.createObjectURL(f);r(Object.assign({},a,{data:d,url:h,canvas:u,file:(g=f,m=a.name,new File([g],m,{lastModified:(new Date).getTime(),type:g.type}))}))}else r(Object.assign({},a,{data:d,canvas:u}));var g,m}),s.src=a.url},i.onerror=a=>o(a),i.readAsDataURL(t)})})(r,n))).then(r=>st(e,r)).catch(r=>st(e,null,r)),e),iU=(t,n,e,r)=>{let o=1.2*t.measureText("M").width,i=n.split("\n");for(var a=0;a<i.length;++a)t.fillText(i[a],e,r),t.strokeText(i[a],e,r),r+=o},AD=t=>{t&&aU()&&window&&window.navigator&&window.navigator.vibrate(t)},aU=()=>{const t=navigator.userAgent||navigator.vendor||window.opera;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4))||/^((?!chrome|android).)*safari/i.test(t))};class Vo{loadFiles(n=[]){const e=new to;return Promise.all(Object.assign([],n).map(r=>this.readAsDataURL(r))).then(r=>st(e,r)).catch(r=>st(e,null,r)),e}loadFilesToScan(n=[],e){return TD(n,e)}readAsDataURL(n){return new Promise((e,r)=>{const o=new FileReader;o.onload=()=>{const i={name:n.name,file:n,url:URL.createObjectURL(n)};e(i)},o.onerror=i=>r(i),o.readAsDataURL(n)})}}Vo.\u0275fac=function(n){return new(n||Vo)},Vo.\u0275prov=de({token:Vo,factory:Vo.\u0275fac,providedIn:"root"}),Vo.ngInjectableDef=hT({factory:function(){return new Vo},token:Vo,providedIn:"root"});let sU=(()=>{class t{constructor(e){this.renderer=e,this.event=new mn,this.src=Uo.src,this.fps=Uo.fps,this.vibrate=Uo.vibrate,this.decode=Uo.decode,this.isBeep=Uo.isBeep,this.deviceActive=Uo.deviceActive,this.config=Uo,this.constraints=Uo.constraints,this.isStart=!1,this.isLoading=!1,this.isTorch=!1,this.isReady=!1,this.data=new Qn([]),this.devices=new Qn([]),this.dataForResize=[],this.wasmRemote="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@latest/wasm/index.js",this.wasmProject="assets/wasm/index.js"}ngOnInit(){this.overrideConfig(),this.addJsToElement().then(()=>{this.src&&this.loadImage(this.src),this.resize(),this.isReady=!0}).catch(()=>{this.isReady=!1})}addJsToElement(){return new Promise((e,r)=>{if(document.querySelectorAll(`script[src="${this.wasmRemote}"]`).length)return e(!0);{document.querySelectorAll(`script[src="${this.wasmProject}"]`).forEach(s=>s.remove());const a=this.renderer.createElement("script");this.renderer.setAttribute(a,"type","text/javascript"),this.renderer.setAttribute(a,"src",this.wasmProject),this.renderer.appendChild(document.body,a),a.onload=()=>e(!0),a.onerror=()=>r(!1)}})}start(){const e=new to;return this.isStart?st(e,!1):this.safariWebRTC(e),e}playDevice(e,r=new to){const o=!this.isStart||this.getConstraints().deviceId!=e;switch(!0){case"null"==e||null==e:stop(),this.stop(),st(r,!1);break;case e&&o:stop(),this.stop(!1,!1),clearInterval(this.rAF_ID),this.status(!1,!0);const i={audio:!1,video:"boolean"==typeof(this.constraints&&this.constraints.video)?{deviceId:e}:Object.assign({deviceId:e},this.constraints&&this.constraints.video)};this.deviceActive=this.devices.value.findIndex(a=>a.deviceId==e),navigator.mediaDevices.getUserMedia(i).then(a=>{this.video.nativeElement.srcObject=a,this.video.nativeElement.onloadedmetadata=()=>{this.video.nativeElement.play(),this.requestAnimationFrame(),this.status(!0,!1),st(r,!0)}}).catch(a=>{this.status(!1,!1),this.eventEmit(!1),st(r,!1,a)});break;default:this.status(this.isStart,!1),st(r,!1)}return r}stop(e=!0,r=!0){e&&this.eventEmit(null),r&&this.status(!1,!1);const o=new to;try{this.removeCanvas(),clearInterval(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(i=>{i.stop(),st(o,!0)})}catch(i){st(o,!1,i)}return o}play(){const e=new to;return this.isPause?(this.video.nativeElement.play(),this.requestAnimationFrame(),st(e,!0)):st(e,!1),e}pause(){const e=new to;return this.isStart?(clearInterval(this.rAF_ID),this.video.nativeElement.pause(),st(e,!0)):st(e,!1),e}loadImage(e){const r=new to;this.status(!1,!0);const o=new Image;return o.setAttribute("crossOrigin","anonymous"),o.onload=()=>{this.drawImage(o,i=>{this.status(!1,!1),st(r,i)})},o.src=e,r}torcher(){const e=this.applyConstraints({torch:this.isTorch});return e.subscribe(()=>!1,()=>this.isTorch=!this.isTorch),e}applyConstraints(e){const r=new to,i=this.video.nativeElement.srcObject.getVideoTracks()[0];return new window.ImageCapture(i).getPhotoCapabilities().then(()=>bd(this,void 0,void 0,function*(){yield i.applyConstraints({advanced:[e]}),st(r,!0)})).catch(s=>{switch(s&&s.name){case"NotFoundError":case"DevicesNotFoundError":st(r,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":st(r,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":st(r,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":st(r,!1,"Permission denied in browser");break;case"TypeError":st(r,!1,"Empty constraints object");break;default:st(r,!1,s)}}),r}getConstraints(){const e=this.video.nativeElement.srcObject,r=e&&e.getVideoTracks()[0];return r&&r.getConstraints()}download(e=`ngx-scanner-qrcode-${Date.now()}.png`){const r=new to;return(()=>{bd(this,void 0,void 0,function*(){const a=((t,n)=>new File([t],n,{lastModified:(new Date).getTime(),type:t.type}))(yield RD(this.canvas.nativeElement),e);TD([a],this.config,r).subscribe(s=>{s.forEach(u=>{const c=document.createElement("a");c.href=u.url,c.download=u.name,c.click(),c.remove()})})})})(),r}resize(){window.addEventListener("resize",()=>{this.dataForResize&&this.dataForResize.length&&MD(this.dataForResize,this.canvas.nativeElement,this.resultsPanel.nativeElement)})}overrideConfig(){pr(this.config,"src")&&(this.src=this.config.src),pr(this.config,"fps")&&(this.fps=this.config.fps),pr(this.config,"vibrate")&&(this.vibrate=this.config.vibrate),pr(this.config,"decode")&&(this.decode=this.config.decode),pr(this.config,"isBeep")&&(this.isBeep=this.config.isBeep),pr(this.config,"deviceActive")&&(this.deviceActive=this.config.deviceActive),pr(this.config,"constraints")&&(this.constraints=((t,n,e)=>{if(n&&Object.keys(n[t]).length){for(const r in e){const o=JSON.parse(JSON.stringify(Object.assign({},n[t],{[r]:e[r]})));n[t]=n[t].hasOwnProperty(r)?n[t]:o}return n[t]}return e})("constraints",this.config,SD))}safariWebRTC(e){this.status(!1,!0),navigator.mediaDevices.getUserMedia(this.constraints).then(r=>{r.getTracks().forEach(o=>o.stop()),this.loadAllDevices(e)}).catch(r=>{this.status(!1,!1),st(e,!1,r)})}loadAllDevices(e){navigator.mediaDevices.enumerateDevices().then(r=>{let o=[];if(r.forEach(i=>"videoinput"==i.kind&&o.push(i)),this.devices.next(o),o.length>0){const i=Math.max(0,o.length>this.deviceActive?this.deviceActive:0);this.playDevice(o[i].deviceId,e)}else this.status(!1,!1),st(e,!1,"No camera detected.")}).catch(r=>{this.status(!1,!1),st(e,!1,r)})}drawImage(e,r=(()=>{})){return bd(this,void 0,void 0,function*(){const o=this.canvas.nativeElement,i=o.getContext("2d",{willReadFrequently:!0});e instanceof HTMLImageElement&&(o.width=e.naturalWidth,o.height=e.naturalHeight,e.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.video.nativeElement.style.height=o.offsetHeight+"px"),e instanceof HTMLVideoElement&&(o.width=e.videoWidth,o.height=e.videoHeight,e.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),i.clearRect(0,0,o.width,o.height),i.drawImage(e,0,0,o.width,o.height);const a=i.getImageData(0,0,o.width,o.height),s=yield zbarWasm.scanImageData(a);if(s&&s.length){s.forEach(c=>c.value=c.decode(this.decode&&this.decode.toLocaleLowerCase())),MD(s,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement);const u=()=>{this.eventEmit(s),this.dataForResize=s};e instanceof HTMLImageElement&&(r(!0),u(),AD(this.vibrate),ID(this.isBeep)),e instanceof HTMLVideoElement&&(u(),AD(this.vibrate),ID(this.isBeep))}else r(!1),this.removeCanvas(),this.dataForResize=s})}removeCanvas(){Object.assign([],this.resultsPanel.nativeElement.childNodes).forEach(e=>this.resultsPanel.nativeElement.removeChild(e))}status(e,r){this.isStart=e,this.isLoading=r}eventEmit(e=!1){!1!==e&&this.data.next(e||{data:null}),!1!==e&&this.event.emit(e||{data:null})}requestAnimationFrame(){this.rAF_ID=setInterval(()=>{this.video.nativeElement.readyState===this.video.nativeElement.HAVE_ENOUGH_DATA&&this.drawImage(this.video.nativeElement)},this.fps)}get isPause(){return this.isStart&&this.video.nativeElement.paused}ngOnDestroy(){this.pause()}}return t.\u0275fac=function(e){return new(e||t)(he(Wa))},t.\u0275cmp=ui({type:t,selectors:[["ngx-scanner-qrcode"]],viewQuery:function(e,r){if(1&e&&(eo(JB,5),eo(ZB,5),eo(eU,5)),2&e){let o;Sr(o=Ir())&&(r.video=o.first),Sr(o=Ir())&&(r.canvas=o.first),Sr(o=Ir())&&(r.resultsPanel=o.first)}},hostAttrs:[1,"ngx-scanner-qrcode"],inputs:{src:"src",fps:"fps",vibrate:"vibrate",decode:"decode",isBeep:"isBeep",deviceActive:"deviceActive",config:"config",constraints:"constraints"},outputs:{event:"event"},exportAs:["scanner"],decls:6,vars:0,consts:[[1,"origin-overlay"],["resultsPanel",""],[1,"origin-canvas"],["canvas",""],["playsinline","",1,"origin-video"],["video",""]],template:function(e,r){1&e&&Z(0,"div",0,1)(2,"canvas",2,3)(4,"video",4,5)},styles:[".ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;color:red;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute}.qrcode-tooltip-temp{bottom:0;left:50%;padding:5px;color:#fff;text-align:left;display:none;max-width:450px;border-radius:5px;width:-moz-max-content;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip-temp .qrcode-tooltip-clipboard{cursor:pointer;margin-left:5px;fill:#fff}.qrcode-tooltip-temp .qrcode-tooltip-clipboard:active{fill:#afafaf}"],encapsulation:2}),t})();const ve={ScannerQRCode_NONE:0,ScannerQRCode_PARTIAL:1,ScannerQRCode_EAN2:2,ScannerQRCode_EAN5:5,ScannerQRCode_EAN8:8,ScannerQRCode_UPCE:9,ScannerQRCode_ISBN10:10,ScannerQRCode_UPCA:12,ScannerQRCode_EAN13:13,ScannerQRCode_ISBN13:14,ScannerQRCode_COMPOSITE:15,ScannerQRCode_I25:25,ScannerQRCode_DATABAR:34,ScannerQRCode_DATABAR_EXP:35,ScannerQRCode_CODABAR:38,ScannerQRCode_CODE39:39,ScannerQRCode_PDF417:57,ScannerQRCode_QRCODE:64,ScannerQRCode_SQCODE:80,ScannerQRCode_CODE93:93,ScannerQRCode_CODE128:128,ScannerQRCode_SYMBOL:255,ScannerQRCode_ADDON2:512,ScannerQRCode_ADDON5:1280,ScannerQRCode_ADDON:1792};ve[ve.ScannerQRCode_NONE]="ScannerQRCode_NONE",ve[ve.ScannerQRCode_PARTIAL]="ScannerQRCode_PARTIAL",ve[ve.ScannerQRCode_EAN2]="ScannerQRCode_EAN2",ve[ve.ScannerQRCode_EAN5]="ScannerQRCode_EAN5",ve[ve.ScannerQRCode_EAN8]="ScannerQRCode_EAN8",ve[ve.ScannerQRCode_UPCE]="ScannerQRCode_UPCE",ve[ve.ScannerQRCode_ISBN10]="ScannerQRCode_ISBN10",ve[ve.ScannerQRCode_UPCA]="ScannerQRCode_UPCA",ve[ve.ScannerQRCode_EAN13]="ScannerQRCode_EAN13",ve[ve.ScannerQRCode_ISBN13]="ScannerQRCode_ISBN13",ve[ve.ScannerQRCode_COMPOSITE]="ScannerQRCode_COMPOSITE",ve[ve.ScannerQRCode_I25]="ScannerQRCode_I25",ve[ve.ScannerQRCode_DATABAR]="ScannerQRCode_DATABAR",ve[ve.ScannerQRCode_DATABAR_EXP]="ScannerQRCode_DATABAR_EXP",ve[ve.ScannerQRCode_CODABAR]="ScannerQRCode_CODABAR",ve[ve.ScannerQRCode_CODE39]="ScannerQRCode_CODE39",ve[ve.ScannerQRCode_PDF417]="ScannerQRCode_PDF417",ve[ve.ScannerQRCode_QRCODE]="ScannerQRCode_QRCODE",ve[ve.ScannerQRCode_SQCODE]="ScannerQRCode_SQCODE",ve[ve.ScannerQRCode_CODE93]="ScannerQRCode_CODE93",ve[ve.ScannerQRCode_CODE128]="ScannerQRCode_CODE128",ve[ve.ScannerQRCode_SYMBOL]="ScannerQRCode_SYMBOL",ve[ve.ScannerQRCode_ADDON2]="ScannerQRCode_ADDON2",ve[ve.ScannerQRCode_ADDON5]="ScannerQRCode_ADDON5",ve[ve.ScannerQRCode_ADDON]="ScannerQRCode_ADDON";const ut={ScannerQRCode_CFG_ENABLE:0,ScannerQRCode_CFG_ADD_CHECK:1,ScannerQRCode_CFG_EMIT_CHECK:2,ScannerQRCode_CFG_ASCII:3,ScannerQRCode_CFG_BINARY:4,ScannerQRCode_CFG_NUM:5,ScannerQRCode_CFG_MIN_LEN:32,ScannerQRCode_CFG_MAX_LEN:33,ScannerQRCode_CFG_UNCERTAINTY:64,ScannerQRCode_CFG_POSITION:128,ScannerQRCode_CFG_TEST_INVERTED:129,ScannerQRCode_CFG_X_DENSITY:256,ScannerQRCode_CFG_Y_DENSITY:257};ut[ut.ScannerQRCode_CFG_ENABLE]="ScannerQRCode_CFG_ENABLE",ut[ut.ScannerQRCode_CFG_ADD_CHECK]="ScannerQRCode_CFG_ADD_CHECK",ut[ut.ScannerQRCode_CFG_EMIT_CHECK]="ScannerQRCode_CFG_EMIT_CHECK",ut[ut.ScannerQRCode_CFG_ASCII]="ScannerQRCode_CFG_ASCII",ut[ut.ScannerQRCode_CFG_BINARY]="ScannerQRCode_CFG_BINARY",ut[ut.ScannerQRCode_CFG_NUM]="ScannerQRCode_CFG_NUM",ut[ut.ScannerQRCode_CFG_MIN_LEN]="ScannerQRCode_CFG_MIN_LEN",ut[ut.ScannerQRCode_CFG_MAX_LEN]="ScannerQRCode_CFG_MAX_LEN",ut[ut.ScannerQRCode_CFG_UNCERTAINTY]="ScannerQRCode_CFG_UNCERTAINTY",ut[ut.ScannerQRCode_CFG_POSITION]="ScannerQRCode_CFG_POSITION",ut[ut.ScannerQRCode_CFG_TEST_INVERTED]="ScannerQRCode_CFG_TEST_INVERTED",ut[ut.ScannerQRCode_CFG_X_DENSITY]="ScannerQRCode_CFG_X_DENSITY",ut[ut.ScannerQRCode_CFG_Y_DENSITY]="ScannerQRCode_CFG_Y_DENSITY";const no={ScannerQRCode_ORIENT_UNKNOWN:-1,ScannerQRCode_ORIENT_UP:0,ScannerQRCode_ORIENT_RIGHT:1,ScannerQRCode_ORIENT_DOWN:2,ScannerQRCode_ORIENT_LEFT:3};no[no.ScannerQRCode_ORIENT_UNKNOWN]="ScannerQRCode_ORIENT_UNKNOWN",no[no.ScannerQRCode_ORIENT_UP]="ScannerQRCode_ORIENT_UP",no[no.ScannerQRCode_ORIENT_RIGHT]="ScannerQRCode_ORIENT_RIGHT",no[no.ScannerQRCode_ORIENT_DOWN]="ScannerQRCode_ORIENT_DOWN",no[no.ScannerQRCode_ORIENT_LEFT]="ScannerQRCode_ORIENT_LEFT";let cU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=So({type:t}),t.\u0275inj=Hr({providers:[Vo]}),t})();function ge(...t){return Ht(t,Ks(t))}function vi(t,n){return lt(n)?Zt(t,n,1):Zt(t,1)}function jo(t,n){return jt((e,r)=>{let o=0;e.subscribe(Pt(r,i=>t.call(n,i,o++)&&r.next(i)))})}class xd{}class fm{}class Ho{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(e=>{const r=e.indexOf(":");if(r>0){const o=e.slice(0,r),i=o.toLowerCase(),a=e.slice(r+1).trim();this.maybeSetNormalizedName(o,i),this.headers.has(i)?this.headers.get(i).push(a):this.headers.set(i,[a])}})}:()=>{this.headers=new Map,Object.keys(n).forEach(e=>{let r=n[e];const o=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(o,r),this.maybeSetNormalizedName(e,o))})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof Ho?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){const e=new Ho;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Ho?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){const e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,e);const o=("a"===n.op?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":const i=n.value;if(i){let a=this.headers.get(e);if(!a)return;a=a.filter(s=>-1===i.indexOf(s)),0===a.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,a)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}}class lU{encodeKey(n){return kD(n)}encodeValue(n){return kD(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const fU=/%(\d[a-f0-9])/gi,hU={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function kD(t){return encodeURIComponent(t).replace(fU,(n,e)=>hU[e]??n)}function _d(t){return`${t}`}class yi{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new lU,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function dU(t,n){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{const i=o.indexOf("="),[a,s]=-1==i?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],u=e.get(a)||[];u.push(s),e.set(a,u)}),e}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{const r=n.fromObject[e],o=Array.isArray(r)?r.map(_d):[_d(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){const e=[];return Object.keys(n).forEach(r=>{const o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const e=new yi({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const e=("a"===n.op?this.map.get(n.param):void 0)||[];e.push(_d(n.value)),this.map.set(n.param,e);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const o=r.indexOf(_d(n.value));-1!==o&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class pU{constructor(){this.map=new Map}set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function OD(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function ND(t){return typeof Blob<"u"&&t instanceof Blob}function FD(t){return typeof FormData<"u"&&t instanceof FormData}class ju{constructor(n,e,r,o){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function gU(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Ho),this.context||(this.context=new pU),this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=e;else{const s=e.indexOf("?");this.urlWithParams=e+(-1===s?"?":s<e.length-1?"&":"")+a}}else this.params=new yi,this.urlWithParams=e}serializeBody(){return null===this.body?null:OD(this.body)||ND(this.body)||FD(this.body)||function mU(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof yi?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||FD(this.body)?null:ND(this.body)?this.body.type||null:OD(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof yi?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=void 0!==n.body?n.body:this.body,a=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,s=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let u=n.headers||this.headers,c=n.params||this.params;const l=n.context??this.context;return void 0!==n.setHeaders&&(u=Object.keys(n.setHeaders).reduce((d,f)=>d.set(f,n.setHeaders[f]),u)),n.setParams&&(c=Object.keys(n.setParams).reduce((d,f)=>d.set(f,n.setParams[f]),c)),new ju(e,r,i,{params:c,headers:u,context:l,reportProgress:s,responseType:o,withCredentials:a})}}var Ft=(()=>((Ft=Ft||{})[Ft.Sent=0]="Sent",Ft[Ft.UploadProgress=1]="UploadProgress",Ft[Ft.ResponseHeader=2]="ResponseHeader",Ft[Ft.DownloadProgress=3]="DownloadProgress",Ft[Ft.Response=4]="Response",Ft[Ft.User=5]="User",Ft))();class hm{constructor(n,e=200,r="OK"){this.headers=n.headers||new Ho,this.status=void 0!==n.status?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class pm extends hm{constructor(n={}){super(n),this.type=Ft.ResponseHeader}clone(n={}){return new pm({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class Cd extends hm{constructor(n={}){super(n),this.type=Ft.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new Cd({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class LD extends hm{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function gm(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let mm=(()=>{class t{constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof ju)i=e;else{let u,c;u=o.headers instanceof Ho?o.headers:new Ho(o.headers),o.params&&(c=o.params instanceof yi?o.params:new yi({fromObject:o.params})),i=new ju(e,r,void 0!==o.body?o.body:null,{headers:u,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const a=ge(i).pipe(vi(u=>this.handler.handle(u)));if(e instanceof ju||"events"===o.observe)return a;const s=a.pipe(jo(u=>u instanceof Cd));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return s.pipe(Pe(u=>{if(null!==u.body&&!(u.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return u.body}));case"blob":return s.pipe(Pe(u=>{if(null!==u.body&&!(u.body instanceof Blob))throw new Error("Response is not a Blob.");return u.body}));case"text":return s.pipe(Pe(u=>{if(null!==u.body&&"string"!=typeof u.body)throw new Error("Response is not a string.");return u.body}));default:return s.pipe(Pe(u=>u.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:(new yi).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,gm(o,r))}post(e,r,o={}){return this.request("POST",e,gm(o,r))}put(e,r,o={}){return this.request("PUT",e,gm(o,r))}}return t.\u0275fac=function(e){return new(e||t)(ce(xd))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();function BD(t,n){return n(t)}function vU(t,n){return(e,r)=>n.intercept(e,{handle:o=>t(o,r)})}const bU=new fe("HTTP_INTERCEPTORS"),Hu=new fe("HTTP_INTERCEPTOR_FNS");function wU(){let t=null;return(n,e)=>(null===t&&(t=(Ne(bU,{optional:!0})??[]).reduceRight(vU,BD)),t(n,e))}let UD=(()=>{class t extends xd{constructor(e,r){super(),this.backend=e,this.injector=r,this.chain=null}handle(e){if(null===this.chain){const r=Array.from(new Set(this.injector.get(Hu)));this.chain=r.reduceRight((o,i)=>function yU(t,n,e){return(r,o)=>e.runInContext(()=>n(r,i=>t(i,o)))}(o,i,this.injector),BD)}return this.chain(e,r=>this.backend.handle(r))}}return t.\u0275fac=function(e){return new(e||t)(ce(fm),ce(Kr))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const DU=/^\)\]\}',?\n/;let jD=(()=>{class t{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Et(r=>{const o=this.xhrFactory.build();if(o.open(e.method,e.urlWithParams),e.withCredentials&&(o.withCredentials=!0),e.headers.forEach((h,p)=>o.setRequestHeader(h,p.join(","))),e.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const h=e.detectContentTypeHeader();null!==h&&o.setRequestHeader("Content-Type",h)}if(e.responseType){const h=e.responseType.toLowerCase();o.responseType="json"!==h?h:"text"}const i=e.serializeBody();let a=null;const s=()=>{if(null!==a)return a;const h=o.statusText||"OK",p=new Ho(o.getAllResponseHeaders()),g=function EU(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(o)||e.url;return a=new pm({headers:p,status:o.status,statusText:h,url:g}),a},u=()=>{let{headers:h,status:p,statusText:g,url:m}=s(),v=null;204!==p&&(v=typeof o.response>"u"?o.responseText:o.response),0===p&&(p=v?200:0);let b=p>=200&&p<300;if("json"===e.responseType&&"string"==typeof v){const y=v;v=v.replace(DU,"");try{v=""!==v?JSON.parse(v):null}catch(w){v=y,b&&(b=!1,v={error:w,text:v})}}b?(r.next(new Cd({body:v,headers:h,status:p,statusText:g,url:m||void 0})),r.complete()):r.error(new LD({error:v,headers:h,status:p,statusText:g,url:m||void 0}))},c=h=>{const{url:p}=s(),g=new LD({error:h,status:o.status||0,statusText:o.statusText||"Unknown Error",url:p||void 0});r.error(g)};let l=!1;const d=h=>{l||(r.next(s()),l=!0);let p={type:Ft.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),"text"===e.responseType&&o.responseText&&(p.partialText=o.responseText),r.next(p)},f=h=>{let p={type:Ft.UploadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),r.next(p)};return o.addEventListener("load",u),o.addEventListener("error",c),o.addEventListener("timeout",c),o.addEventListener("abort",c),e.reportProgress&&(o.addEventListener("progress",d),null!==i&&o.upload&&o.upload.addEventListener("progress",f)),o.send(i),r.next({type:Ft.Sent}),()=>{o.removeEventListener("error",c),o.removeEventListener("abort",c),o.removeEventListener("load",u),o.removeEventListener("timeout",c),e.reportProgress&&(o.removeEventListener("progress",d),null!==i&&o.upload&&o.upload.removeEventListener("progress",f)),o.readyState!==o.DONE&&o.abort()}})}}return t.\u0275fac=function(e){return new(e||t)(ce(ZC))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const vm=new fe("XSRF_ENABLED"),HD=new fe("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),WD=new fe("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class zD{}let MU=(()=>{class t{constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=jC(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return t.\u0275fac=function(e){return new(e||t)(ce(Mn),ce(xg),ce(HD))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();function RU(t,n){const e=t.url.toLowerCase();if(!Ne(vm)||"GET"===t.method||"HEAD"===t.method||e.startsWith("http://")||e.startsWith("https://"))return n(t);const r=Ne(zD).getToken(),o=Ne(WD);return null!=r&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var Tt=(()=>((Tt=Tt||{})[Tt.Interceptors=0]="Interceptors",Tt[Tt.LegacyInterceptors=1]="LegacyInterceptors",Tt[Tt.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Tt[Tt.NoXsrfProtection=3]="NoXsrfProtection",Tt[Tt.JsonpSupport=4]="JsonpSupport",Tt[Tt.RequestsMadeViaParent=5]="RequestsMadeViaParent",Tt))();function cs(t,n){return{\u0275kind:t,\u0275providers:n}}function TU(...t){const n=[mm,jD,UD,{provide:xd,useExisting:UD},{provide:fm,useExisting:jD},{provide:Hu,useValue:RU,multi:!0},{provide:vm,useValue:!0},{provide:zD,useClass:MU}];for(const e of t)n.push(...e.\u0275providers);return function HP(t){return{\u0275providers:t}}(n)}const $D=new fe("LEGACY_INTERCEPTOR_FN");let PU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=So({type:t}),t.\u0275inj=Hr({providers:[TU(cs(Tt.LegacyInterceptors,[{provide:$D,useFactory:wU},{provide:Hu,useExisting:$D,multi:!0}]))]}),t})();const Dd=Jf(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:kU}=Array,{getPrototypeOf:OU,prototype:NU,keys:FU}=Object;const{isArray:UU}=Array;function GD(...t){const n=Ks(t),e=function YR(t){return lt(ah(t))?t.pop():void 0}(t),{args:r,keys:o}=function LU(t){if(1===t.length){const n=t[0];if(kU(n))return{args:n,keys:null};if(function BU(t){return t&&"object"==typeof t&&OU(t)===NU}(n)){const e=FU(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}(t);if(0===r.length)return Ht([],n);const i=new Et(function WU(t,n,e=ai){return r=>{qD(n,()=>{const{length:o}=t,i=new Array(o);let a=o,s=o;for(let u=0;u<o;u++)qD(n,()=>{const c=Ht(t[u],n);let l=!1;c.subscribe(Pt(r,d=>{i[u]=d,l||(l=!0,s--),s||r.next(e(i.slice()))},()=>{--a||r.complete()}))},r)},r)}}(r,n,o?a=>function HU(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}(o,a):ai));return e?i.pipe(function jU(t){return Pe(n=>function VU(t,n){return UU(n)?t(...n):t(n)}(t,n))}(e)):i}function qD(t,n,e){t?_o(e,t,n):n()}function ym(...t){return function zU(){return xa(1)}()(Ht(t,Ks(t)))}function KD(t){return new Et(n=>{ar(t()).subscribe(n)})}function ls(t,n){const e=lt(t)?t:()=>t,r=o=>o.error(e());return new Et(n?o=>n.schedule(r,0,o):r)}function bm(){return jt((t,n)=>{let e=null;t._refCount++;const r=Pt(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}class XD extends Et{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,w0(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new jn;const e=this.getSubject();n.add(this.source.subscribe(Pt(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=jn.EMPTY)}return n}refCount(){return bm()(this)}}function ro(t,n){return jt((e,r)=>{let o=null,i=0,a=!1;const s=()=>a&&!o&&r.complete();e.subscribe(Pt(r,u=>{o?.unsubscribe();let c=0;const l=i++;ar(t(u,l)).subscribe(o=Pt(r,d=>r.next(n?n(u,d,l,c++):d),()=>{o=null,s()}))},()=>{a=!0,s()}))})}function Wu(t){return t<=0?()=>jr:jt((n,e)=>{let r=0;n.subscribe(Pt(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function Ed(t){return jt((n,e)=>{let r=!1;n.subscribe(Pt(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function QD(t=GU){return jt((n,e)=>{let r=!1;n.subscribe(Pt(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function GU(){return new Dd}function bi(t,n){const e=arguments.length>=2;return r=>r.pipe(t?jo((o,i)=>t(o,i,r)):ai,Wu(1),e?Ed(n):QD(()=>new Dd))}function vn(t,n,e){const r=lt(t)||n||e?{next:t,error:n,complete:e}:t;return r?jt((o,i)=>{var a;null===(a=r.subscribe)||void 0===a||a.call(r);let s=!0;o.subscribe(Pt(i,u=>{var c;null===(c=r.next)||void 0===c||c.call(r,u),i.next(u)},()=>{var u;s=!1,null===(u=r.complete)||void 0===u||u.call(r),i.complete()},u=>{var c;s=!1,null===(c=r.error)||void 0===c||c.call(r,u),i.error(u)},()=>{var u,c;s&&(null===(u=r.unsubscribe)||void 0===u||u.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):ai}function oo(t){return jt((n,e)=>{let i,r=null,o=!1;r=n.subscribe(Pt(e,void 0,void 0,a=>{i=ar(t(a,oo(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function YD(t,n){return jt(function qU(t,n,e,r,o){return(i,a)=>{let s=e,u=n,c=0;i.subscribe(Pt(a,l=>{const d=c++;u=s?t(u,l,d):(s=!0,l),r&&a.next(u)},o&&(()=>{s&&a.next(u),a.complete()})))}}(t,n,arguments.length>=2,!0))}function wm(t){return t<=0?()=>jr:jt((n,e)=>{let r=[];n.subscribe(Pt(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(const o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function JD(t,n){const e=arguments.length>=2;return r=>r.pipe(t?jo((o,i)=>t(o,i,r)):ai,wm(1),e?Ed(n):QD(()=>new Dd))}function xm(t){return jt((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}const Ie="primary",zu=Symbol("RouteTitle");class QU{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function ds(t){return new QU(t)}function YU(t,n,e){const r=e.path.split("/");if(r.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||r.length<t.length))return null;const o={};for(let i=0;i<r.length;i++){const a=r[i],s=t[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function io(t,n){const e=t?Object.keys(t):void 0,r=n?Object.keys(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!ZD(t[o],n[o]))return!1;return!0}function ZD(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}return t===n}function eE(t){return Array.prototype.concat.apply([],t)}function tE(t){return t.length>0?t[t.length-1]:null}function rn(t,n){for(const e in t)t.hasOwnProperty(e)&&n(t[e],e)}function wi(t){return z1(t)?t:Ul(t)?Ht(Promise.resolve(t)):ge(t)}const Sd=!1,ZU={exact:function oE(t,n,e){if(!ta(t.segments,n.segments)||!Id(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!t.children[r]||!oE(t.children[r],n.children[r],e))return!1;return!0},subset:iE},nE={exact:function eV(t,n){return io(t,n)},subset:function tV(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>ZD(t[e],n[e]))},ignored:()=>!0};function rE(t,n,e){return ZU[e.paths](t.root,n.root,e.matrixParams)&&nE[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function iE(t,n,e){return aE(t,n,n.segments,e)}function aE(t,n,e,r){if(t.segments.length>e.length){const o=t.segments.slice(0,e.length);return!(!ta(o,e)||n.hasChildren()||!Id(o,e,r))}if(t.segments.length===e.length){if(!ta(t.segments,e)||!Id(t.segments,e,r))return!1;for(const o in n.children)if(!t.children[o]||!iE(t.children[o],n.children[o],r))return!1;return!0}{const o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!!(ta(t.segments,o)&&Id(t.segments,o,r)&&t.children[Ie])&&aE(t.children[Ie],n,i,r)}}function Id(t,n,e){return n.every((r,o)=>nE[e](t[o].parameters,r.parameters))}class xi{constructor(n=new Fe([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ds(this.queryParams)),this._queryParamMap}toString(){return oV.serialize(this)}}class Fe{constructor(n,e){this.segments=n,this.children=e,this.parent=null,rn(e,(r,o)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Md(this)}}class $u{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=ds(this.parameters)),this._parameterMap}toString(){return cE(this)}}function ta(t,n){return t.length===n.length&&t.every((e,r)=>e.path===n[r].path)}let Gu=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return new _m},providedIn:"root"}),t})();class _m{parse(n){const e=new hV(n);return new xi(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){const e=`/${qu(n.root,!0)}`,r=function sV(t){const n=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(o=>`${Rd(e)}=${Rd(o)}`).join("&"):`${Rd(e)}=${Rd(r)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${e}${r}${"string"==typeof n.fragment?`#${function iV(t){return encodeURI(t)}(n.fragment)}`:""}`}}const oV=new _m;function Md(t){return t.segments.map(n=>cE(n)).join("/")}function qu(t,n){if(!t.hasChildren())return Md(t);if(n){const e=t.children[Ie]?qu(t.children[Ie],!1):"",r=[];return rn(t.children,(o,i)=>{i!==Ie&&r.push(`${i}:${qu(o,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}{const e=function rV(t,n){let e=[];return rn(t.children,(r,o)=>{o===Ie&&(e=e.concat(n(r,o)))}),rn(t.children,(r,o)=>{o!==Ie&&(e=e.concat(n(r,o)))}),e}(t,(r,o)=>o===Ie?[qu(t.children[Ie],!1)]:[`${o}:${qu(r,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[Ie]?`${Md(t)}/${e[0]}`:`${Md(t)}/(${e.join("//")})`}}function sE(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Rd(t){return sE(t).replace(/%3B/gi,";")}function Cm(t){return sE(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Td(t){return decodeURIComponent(t)}function uE(t){return Td(t.replace(/\+/g,"%20"))}function cE(t){return`${Cm(t.path)}${function aV(t){return Object.keys(t).map(n=>`;${Cm(n)}=${Cm(t[n])}`).join("")}(t.parameters)}`}const uV=/^[^\/()?;=#]+/;function Ad(t){const n=t.match(uV);return n?n[0]:""}const cV=/^[^=?&#]+/,dV=/^[^&#]+/;class hV{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Fe([],{}):new Fe([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[Ie]=new Fe(n,e)),r}parseSegment(){const n=Ad(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Q(4009,Sd);return this.capture(n),new $u(Td(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=Ad(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const o=Ad(this.remaining);o&&(r=o,this.capture(r))}n[Td(e)]=Td(r)}parseQueryParam(n){const e=function lV(t){const n=t.match(cV);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const a=function fV(t){const n=t.match(dV);return n?n[0]:""}(this.remaining);a&&(r=a,this.capture(r))}const o=uE(e),i=uE(r);if(n.hasOwnProperty(o)){let a=n[o];Array.isArray(a)||(a=[a],n[o]=a),a.push(i)}else n[o]=i}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Ad(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new Q(4010,Sd);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=Ie);const a=this.parseChildren();e[i]=1===Object.keys(a).length?a[Ie]:new Fe([],a),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Q(4011,Sd)}}function Dm(t){return t.segments.length>0?new Fe([],{[Ie]:t}):t}function Pd(t){const n={};for(const r of Object.keys(t.children)){const i=Pd(t.children[r]);(i.segments.length>0||i.hasChildren())&&(n[r]=i)}return function pV(t){if(1===t.numberOfChildren&&t.children[Ie]){const n=t.children[Ie];return new Fe(t.segments.concat(n.segments),n.children)}return t}(new Fe(t.segments,n))}function na(t){return t instanceof xi}const Em=!1;function gV(t,n,e,r,o){if(0===e.length)return fs(n.root,n.root,n.root,r,o);const i=function pE(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new hE(!0,0,t);let n=0,e=!1;const r=t.reduce((o,i,a)=>{if("object"==typeof i&&null!=i){if(i.outlets){const s={};return rn(i.outlets,(u,c)=>{s[c]="string"==typeof u?u.split("/"):u}),[...o,{outlets:s}]}if(i.segmentPath)return[...o,i.segmentPath]}return"string"!=typeof i?[...o,i]:0===a?(i.split("/").forEach((s,u)=>{0==u&&"."===s||(0==u&&""===s?e=!0:".."===s?n++:""!=s&&o.push(s))}),o):[...o,i]},[]);return new hE(e,n,r)}(e);return i.toRoot()?fs(n.root,n.root,new Fe([],{}),r,o):function a(u){const c=function vV(t,n,e,r){if(t.isAbsolute)return new hs(n.root,!0,0);if(-1===r)return new hs(e,e===n.root,0);return function gE(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new Q(4005,Em&&"Invalid number of '../'");o=r.segments.length}return new hs(r,!1,o-i)}(e,r+(Ku(t.commands[0])?0:1),t.numberOfDoubleDots)}(i,n,t.snapshot?._urlSegment,u),l=c.processChildren?ps(c.segmentGroup,c.index,i.commands):Sm(c.segmentGroup,c.index,i.commands);return fs(n.root,c.segmentGroup,l,r,o)}(t.snapshot?._lastPathIndex)}function Ku(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Xu(t){return"object"==typeof t&&null!=t&&t.outlets}function fs(t,n,e,r,o){let a,i={};r&&rn(r,(u,c)=>{i[c]=Array.isArray(u)?u.map(l=>`${l}`):`${u}`}),a=t===n?e:fE(t,n,e);const s=Dm(Pd(a));return new xi(s,i,o)}function fE(t,n,e){const r={};return rn(t.children,(o,i)=>{r[i]=o===n?e:fE(o,n,e)}),new Fe(t.segments,r)}class hE{constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Ku(r[0]))throw new Q(4003,Em&&"Root segment cannot have matrix parameters");const o=r.find(Xu);if(o&&o!==tE(r))throw new Q(4004,Em&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class hs{constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}}function Sm(t,n,e){if(t||(t=new Fe([],{})),0===t.segments.length&&t.hasChildren())return ps(t,n,e);const r=function bV(t,n,e){let r=0,o=n;const i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;const a=t.segments[o],s=e[r];if(Xu(s))break;const u=`${s}`,c=r<e.length-1?e[r+1]:null;if(o>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!vE(u,c,a))return i;r+=2}else{if(!vE(u,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const i=new Fe(t.segments.slice(0,r.pathIndex),{});return i.children[Ie]=new Fe(t.segments.slice(r.pathIndex),t.children),ps(i,0,o)}return r.match&&0===o.length?new Fe(t.segments,{}):r.match&&!t.hasChildren()?Im(t,n,e):r.match?ps(t,0,o):Im(t,n,e)}function ps(t,n,e){if(0===e.length)return new Fe(t.segments,{});{const r=function yV(t){return Xu(t[0])?t[0].outlets:{[Ie]:t}}(e),o={};return!r[Ie]&&t.children[Ie]&&1===t.numberOfChildren&&0===t.children[Ie].segments.length?ps(t.children[Ie],n,e):(rn(r,(i,a)=>{"string"==typeof i&&(i=[i]),null!==i&&(o[a]=Sm(t.children[a],n,i))}),rn(t.children,(i,a)=>{void 0===r[a]&&(o[a]=i)}),new Fe(t.segments,o))}}function Im(t,n,e){const r=t.segments.slice(0,n);let o=0;for(;o<e.length;){const i=e[o];if(Xu(i)){const u=wV(i.outlets);return new Fe(r,u)}if(0===o&&Ku(e[0])){r.push(new $u(t.segments[n].path,mE(e[0]))),o++;continue}const a=Xu(i)?i.outlets[Ie]:`${i}`,s=o<e.length-1?e[o+1]:null;a&&s&&Ku(s)?(r.push(new $u(a,mE(s))),o+=2):(r.push(new $u(a,{})),o++)}return new Fe(r,{})}function wV(t){const n={};return rn(t,(e,r)=>{"string"==typeof e&&(e=[e]),null!==e&&(n[r]=Im(new Fe([],{}),0,e))}),n}function mE(t){const n={};return rn(t,(e,r)=>n[r]=`${e}`),n}function vE(t,n,e){return t==e.path&&io(n,e.parameters)}const Qu="imperative";class ao{constructor(n,e){this.id=n,this.url=e}}class Mm extends ao{constructor(n,e,r="imperative",o=null){super(n,e),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ra extends ao{constructor(n,e,r){super(n,e),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class kd extends ao{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Od extends ao{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=16}}class Rm extends ao{constructor(n,e,r,o){super(n,e),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class xV extends ao{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _V extends ao{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class CV extends ao{constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class DV extends ao{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class EV extends ao{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class SV{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class IV{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class MV{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class RV{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class TV{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class AV{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class yE{constructor(n,e,r){this.routerEvent=n,this.position=e,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let OV=(()=>{class t{createUrlTree(e,r,o,i,a,s){return gV(e||r.root,o,i,a,s)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),FV=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(n){return OV.\u0275fac(n)},providedIn:"root"}),t})();class bE{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=Tm(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){const e=Tm(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=Am(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return Am(n,this._root).map(e=>e.value)}}function Tm(t,n){if(t===n.value)return n;for(const e of n.children){const r=Tm(t,e);if(r)return r}return null}function Am(t,n){if(t===n.value)return[n];for(const e of n.children){const r=Am(t,e);if(r.length)return r.unshift(n),r}return[]}class Wo{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function gs(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class wE extends bE{constructor(n,e){super(n),this.snapshot=e,Pm(this,n)}toString(){return this.snapshot.toString()}}function xE(t,n){const e=function LV(t,n){const a=new Nd([],{},{},"",{},Ie,n,null,t.root,-1,{});return new CE("",new Wo(a,[]))}(t,n),r=new Qn([new $u("",{})]),o=new Qn({}),i=new Qn({}),a=new Qn({}),s=new Qn(""),u=new ms(r,o,a,s,i,Ie,n,e.root);return u.snapshot=e.root,new wE(new Wo(u,[]),e)}class ms{constructor(n,e,r,o,i,a,s,u){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.title=this.data?.pipe(Pe(c=>c[zu]))??ge(void 0),this._futureSnapshot=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Pe(n=>ds(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Pe(n=>ds(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function _E(t,n="emptyOnly"){const e=t.pathFromRoot;let r=0;if("always"!==n)for(r=e.length-1;r>=1;){const o=e[r],i=e[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(i.component)break;r--}}return function BV(t){return t.reduce((n,e)=>({params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.resolve,...e.routeConfig?.data,...e._resolvedData}}),{params:{},data:{},resolve:{}})}(e.slice(r))}class Nd{get title(){return this.data?.[zu]}constructor(n,e,r,o,i,a,s,u,c,l,d){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ds(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ds(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class CE extends bE{constructor(n,e){super(e),this.url=n,Pm(this,e)}toString(){return DE(this._root)}}function Pm(t,n){n.value._routerState=t,n.children.forEach(e=>Pm(t,e))}function DE(t){const n=t.children.length>0?` { ${t.children.map(DE).join(", ")} } `:"";return`${t.value}${n}`}function km(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,io(n.queryParams,e.queryParams)||t.queryParams.next(e.queryParams),n.fragment!==e.fragment&&t.fragment.next(e.fragment),io(n.params,e.params)||t.params.next(e.params),function JU(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!io(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.url.next(e.url),io(n.data,e.data)||t.data.next(e.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Om(t,n){const e=io(t.params,n.params)&&function nV(t,n){return ta(t,n)&&t.every((e,r)=>io(e.parameters,n[r].parameters))}(t.url,n.url);return e&&!(!t.parent!=!n.parent)&&(!t.parent||Om(t.parent,n.parent))}function Yu(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const r=e.value;r._futureSnapshot=n.value;const o=function VV(t,n,e){return n.children.map(r=>{for(const o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return Yu(t,r,o);return Yu(t,r)})}(t,n,e);return new Wo(r,o)}{if(t.shouldAttach(n.value)){const i=t.retrieve(n.value);if(null!==i){const a=i.route;return a.value._futureSnapshot=n.value,a.children=n.children.map(s=>Yu(t,s)),a}}const r=function jV(t){return new ms(new Qn(t.url),new Qn(t.params),new Qn(t.queryParams),new Qn(t.fragment),new Qn(t.data),t.outlet,t.component,t)}(n.value),o=n.children.map(i=>Yu(t,i));return new Wo(r,o)}}const Nm="ngNavigationCancelingError";function EE(t,n){const{redirectTo:e,navigationBehaviorOptions:r}=na(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=SE(!1,0,n);return o.url=e,o.navigationBehaviorOptions=r,o}function SE(t,n,e){const r=new Error("NavigationCancelingError: "+(t||""));return r[Nm]=!0,r.cancellationCode=n,e&&(r.url=e),r}function IE(t){return ME(t)&&na(t.url)}function ME(t){return t&&t[Nm]}class HV{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Ju,this.attachRef=null}}let Ju=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(e,r){const o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){const r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new HV,this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Fd=!1;let Fm=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ie,this.activateEvents=new mn,this.deactivateEvents=new mn,this.attachEvents=new mn,this.detachEvents=new mn,this.parentContexts=Ne(Ju),this.location=Ne(Er),this.changeDetector=Ne(Tg),this.environmentInjector=Ne(Kr)}ngOnChanges(e){if(e.name){const{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Q(4012,Fd);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Q(4012,Fd);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Q(4012,Fd);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new Q(4013,Fd);this._activatedRoute=e;const o=this.location,a=e.snapshot.component,s=this.parentContexts.getOrCreateContext(this.name).children,u=new WV(e,s,o.injector);if(r&&function zV(t){return!!t.resolveComponentFactory}(r)){const c=r.resolveComponentFactory(a);this.activated=o.createComponent(c,o.length,u)}else this.activated=o.createComponent(a,{index:o.length,injector:u,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=_n({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Wi]}),t})();class WV{constructor(n,e,r){this.route=n,this.childContexts=e,this.parent=r}get(n,e){return n===ms?this.route:n===Ju?this.childContexts:this.parent.get(n,e)}}let Lm=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ui({type:t,selectors:[["ng-component"]],standalone:!0,features:[p_],decls:1,vars:0,template:function(e,r){1&e&&Z(0,"router-outlet")},dependencies:[Fm],encapsulation:2}),t})();function RE(t,n){return t.providers&&!t._injector&&(t._injector=Gl(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Um(t){const n=t.children&&t.children.map(Um),e=n?{...t,children:n}:{...t};return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Ie&&(e.component=Lm),e}function gr(t){return t.outlet||Ie}function TE(t,n){const e=t.filter(r=>gr(r)===n);return e.push(...t.filter(r=>gr(r)!==n)),e}function Zu(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class XV{constructor(n,e,r,o){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o}activate(n){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),km(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){const o=gs(e);n.children.forEach(i=>{const a=i.value.outlet;this.deactivateRoutes(i,o[a],r),delete o[a]}),rn(o,(i,a)=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){const o=n.value,i=e?e.value:null;if(o===i)if(o.component){const a=r.getContext(o.outlet);a&&this.deactivateChildRoutes(n,e,a.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=gs(n);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);if(r&&r.outlet){const a=r.outlet.detach(),s=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:a,route:n,contexts:s})}}deactivateRouteAndOutlet(n,e){const r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=gs(n);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(n,e,r){const o=gs(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new AV(i.value.snapshot))}),n.children.length&&this.forwardEvent(new RV(n.value.snapshot))}activateRoutes(n,e,r){const o=n.value,i=e?e.value:null;if(km(o),o===i)if(o.component){const a=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,a.children)}else this.activateChildRoutes(n,e,r);else if(o.component){const a=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const s=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),a.children.onOutletReAttached(s.contexts),a.attachRef=s.componentRef,a.route=s.route.value,a.outlet&&a.outlet.attach(s.componentRef,s.route.value),km(s.route.value),this.activateChildRoutes(n,null,a.children)}else{const s=Zu(o.snapshot),u=s?.get(bu)??null;a.attachRef=null,a.route=o,a.resolver=u,a.injector=s,a.outlet&&a.outlet.activateWith(o,a.injector),this.activateChildRoutes(n,null,a.children)}}else this.activateChildRoutes(n,null,r)}}class AE{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class Ld{constructor(n,e){this.component=n,this.route=e}}function QV(t,n,e){const r=t._root;return ec(r,n?n._root:null,e,[r.value])}function vs(t,n){const e=Symbol(),r=n.get(t,e);return r===e?"function"!=typeof t||function pT(t){return null!==Gc(t)}(t)?n.get(t):t:r}function ec(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=gs(n);return t.children.forEach(a=>{(function JV(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=t.value,a=n?n.value:null,s=e?e.getContext(t.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){const u=function ZV(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!ta(t.url,n.url);case"pathParamsOrQueryParamsChange":return!ta(t.url,n.url)||!io(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Om(t,n)||!io(t.queryParams,n.queryParams);default:return!Om(t,n)}}(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new AE(r)):(i.data=a.data,i._resolvedData=a._resolvedData),ec(t,n,i.component?s?s.children:null:e,r,o),u&&s&&s.outlet&&s.outlet.isActivated&&o.canDeactivateChecks.push(new Ld(s.outlet.component,a))}else a&&tc(n,s,o),o.canActivateChecks.push(new AE(r)),ec(t,null,i.component?s?s.children:null:e,r,o)})(a,i[a.value.outlet],e,r.concat([a.value]),o),delete i[a.value.outlet]}),rn(i,(a,s)=>tc(a,e.getContext(s),o)),o}function tc(t,n,e){const r=gs(t),o=t.value;rn(r,(i,a)=>{tc(i,o.component?n?n.children.getContext(a):null:n,e)}),e.canDeactivateChecks.push(new Ld(o.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,o))}function nc(t){return"function"==typeof t}function Vm(t){return t instanceof Dd||"EmptyError"===t?.name}const Bd=Symbol("INITIAL_VALUE");function ys(){return ro(t=>GD(t.map(n=>n.pipe(Wu(1),function $U(...t){const n=Ks(t);return jt((e,r)=>{(n?ym(t,e,n):ym(t,e)).subscribe(r)})}(Bd)))).pipe(Pe(n=>{for(const e of n)if(!0!==e){if(e===Bd)return Bd;if(!1===e||e instanceof xi)return e}return!0}),jo(n=>n!==Bd),Wu(1)))}function PE(t){return function PR(...t){return v0(t)}(vn(n=>{if(na(n))throw EE(0,n)}),Pe(n=>!0===n))}const jm={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function kE(t,n,e,r,o){const i=Hm(t,n,e);return i.matched?function m5(t,n,e,r){const o=n.canMatch;return o&&0!==o.length?ge(o.map(a=>{const s=vs(a,t);return wi(function i5(t){return t&&nc(t.canMatch)}(s)?s.canMatch(n,e):t.runInContext(()=>s(n,e)))})).pipe(ys(),PE()):ge(!0)}(r=RE(n,r),n,e).pipe(Pe(a=>!0===a?i:{...jm})):ge(i)}function Hm(t,n,e){if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?{...jm}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const o=(n.matcher||YU)(e,t,n);if(!o)return{...jm};const i={};rn(o.posParams,(s,u)=>{i[u]=s.path});const a=o.consumed.length>0?{...i,...o.consumed[o.consumed.length-1].parameters}:i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:a,positionalParamSegments:o.posParams??{}}}function Ud(t,n,e,r){if(e.length>0&&function b5(t,n,e){return e.some(r=>Vd(t,n,r)&&gr(r)!==Ie)}(t,e,r)){const i=new Fe(n,function y5(t,n,e,r){const o={};o[Ie]=r,r._sourceSegment=t,r._segmentIndexShift=n.length;for(const i of e)if(""===i.path&&gr(i)!==Ie){const a=new Fe([],{});a._sourceSegment=t,a._segmentIndexShift=n.length,o[gr(i)]=a}return o}(t,n,r,new Fe(e,t.children)));return i._sourceSegment=t,i._segmentIndexShift=n.length,{segmentGroup:i,slicedSegments:[]}}if(0===e.length&&function w5(t,n,e){return e.some(r=>Vd(t,n,r))}(t,e,r)){const i=new Fe(t.segments,function v5(t,n,e,r,o){const i={};for(const a of r)if(Vd(t,e,a)&&!o[gr(a)]){const s=new Fe([],{});s._sourceSegment=t,s._segmentIndexShift=n.length,i[gr(a)]=s}return{...o,...i}}(t,n,e,r,t.children));return i._sourceSegment=t,i._segmentIndexShift=n.length,{segmentGroup:i,slicedSegments:e}}const o=new Fe(t.segments,t.children);return o._sourceSegment=t,o._segmentIndexShift=n.length,{segmentGroup:o,slicedSegments:e}}function Vd(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}function OE(t,n,e,r){return!!(gr(t)===r||r!==Ie&&Vd(n,e,t))&&("**"===t.path||Hm(n,t,e).matched)}function NE(t,n,e){return 0===n.length&&!t.children[e]}const jd=!1;class Hd{constructor(n){this.segmentGroup=n||null}}class FE{constructor(n){this.urlTree=n}}function rc(t){return ls(new Hd(t))}function LE(t){return ls(new FE(t))}class D5{constructor(n,e,r,o,i){this.injector=n,this.configLoader=e,this.urlSerializer=r,this.urlTree=o,this.config=i,this.allowRedirects=!0}apply(){const n=Ud(this.urlTree.root,[],[],this.config).segmentGroup,e=new Fe(n.segments,n.children);return this.expandSegmentGroup(this.injector,this.config,e,Ie).pipe(Pe(i=>this.createUrlTree(Pd(i),this.urlTree.queryParams,this.urlTree.fragment))).pipe(oo(i=>{if(i instanceof FE)return this.allowRedirects=!1,this.match(i.urlTree);throw i instanceof Hd?this.noMatchError(i):i}))}match(n){return this.expandSegmentGroup(this.injector,this.config,n.root,Ie).pipe(Pe(o=>this.createUrlTree(Pd(o),n.queryParams,n.fragment))).pipe(oo(o=>{throw o instanceof Hd?this.noMatchError(o):o}))}noMatchError(n){return new Q(4002,jd)}createUrlTree(n,e,r){const o=Dm(n);return new xi(o,e,r)}expandSegmentGroup(n,e,r,o){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(n,e,r).pipe(Pe(i=>new Fe([],i))):this.expandSegment(n,r,e,r.segments,o,!0)}expandChildren(n,e,r){const o=[];for(const i of Object.keys(r.children))"primary"===i?o.unshift(i):o.push(i);return Ht(o).pipe(vi(i=>{const a=r.children[i],s=TE(e,i);return this.expandSegmentGroup(n,s,a,i).pipe(Pe(u=>({segment:u,outlet:i})))}),YD((i,a)=>(i[a.outlet]=a.segment,i),{}),JD())}expandSegment(n,e,r,o,i,a){return Ht(r).pipe(vi(s=>this.expandSegmentAgainstRoute(n,e,r,s,o,i,a).pipe(oo(c=>{if(c instanceof Hd)return ge(null);throw c}))),bi(s=>!!s),oo((s,u)=>{if(Vm(s))return NE(e,o,i)?ge(new Fe([],{})):rc(e);throw s}))}expandSegmentAgainstRoute(n,e,r,o,i,a,s){return OE(o,e,i,a)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,e,o,i,a):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a):rc(e):rc(e)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,o,a):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,r,o){const i=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?LE(i):this.lineralizeSegments(r,i).pipe(Zt(a=>{const s=new Fe(a,{});return this.expandSegment(n,s,e,a,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a){const{matched:s,consumedSegments:u,remainingSegments:c,positionalParamSegments:l}=Hm(e,o,i);if(!s)return rc(e);const d=this.applyRedirectCommands(u,o.redirectTo,l);return o.redirectTo.startsWith("/")?LE(d):this.lineralizeSegments(o,d).pipe(Zt(f=>this.expandSegment(n,e,r,f.concat(c),a,!1)))}matchSegmentAgainstRoute(n,e,r,o,i){return"**"===r.path?(n=RE(r,n),r.loadChildren?(r._loadedRoutes?ge({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(n,r)).pipe(Pe(s=>(r._loadedRoutes=s.routes,r._loadedInjector=s.injector,new Fe(o,{})))):ge(new Fe(o,{}))):kE(e,r,o,n).pipe(ro(({matched:a,consumedSegments:s,remainingSegments:u})=>a?this.getChildConfig(n=r._injector??n,r,o).pipe(Zt(l=>{const d=l.injector??n,f=l.routes,{segmentGroup:h,slicedSegments:p}=Ud(e,s,u,f),g=new Fe(h.segments,h.children);if(0===p.length&&g.hasChildren())return this.expandChildren(d,f,g).pipe(Pe(y=>new Fe(s,y)));if(0===f.length&&0===p.length)return ge(new Fe(s,{}));const m=gr(r)===i;return this.expandSegment(d,g,f,p,m?Ie:i,!0).pipe(Pe(b=>new Fe(s.concat(b.segments),b.children)))})):rc(e)))}getChildConfig(n,e,r){return e.children?ge({routes:e.children,injector:n}):e.loadChildren?void 0!==e._loadedRoutes?ge({routes:e._loadedRoutes,injector:e._loadedInjector}):function g5(t,n,e,r){const o=n.canLoad;return void 0===o||0===o.length?ge(!0):ge(o.map(a=>{const s=vs(a,t);return wi(function t5(t){return t&&nc(t.canLoad)}(s)?s.canLoad(n,e):t.runInContext(()=>s(n,e)))})).pipe(ys(),PE())}(n,e,r).pipe(Zt(o=>o?this.configLoader.loadChildren(n,e).pipe(vn(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):function _5(t){return ls(SE(jd,3))}())):ge({routes:[],injector:n})}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return ge(r);if(o.numberOfChildren>1||!o.children[Ie])return n.redirectTo,ls(new Q(4e3,jd));o=o.children[Ie]}}applyRedirectCommands(n,e,r){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r)}applyRedirectCreateUrlTree(n,e,r,o){const i=this.createSegmentGroup(n,e.root,r,o);return new xi(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const r={};return rn(n,(o,i)=>{if("string"==typeof o&&o.startsWith(":")){const s=o.substring(1);r[i]=e[s]}else r[i]=o}),r}createSegmentGroup(n,e,r,o){const i=this.createSegments(n,e.segments,r,o);let a={};return rn(e.children,(s,u)=>{a[u]=this.createSegmentGroup(n,s,r,o)}),new Fe(i,a)}createSegments(n,e,r,o){return e.map(i=>i.path.startsWith(":")?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){const o=r[e.path.substring(1)];if(!o)throw new Q(4001,jd);return o}findOrReturn(n,e){let r=0;for(const o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}}class S5{}class R5{constructor(n,e,r,o,i,a,s){this.injector=n,this.rootComponentType=e,this.config=r,this.urlTree=o,this.url=i,this.paramsInheritanceStrategy=a,this.urlSerializer=s}recognize(){const n=Ud(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,Ie).pipe(Pe(e=>{if(null===e)return null;const r=new Nd([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ie,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new Wo(r,e),i=new CE(this.url,o);return this.inheritParamsAndData(i._root),i}))}inheritParamsAndData(n){const e=n.value,r=_E(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),n.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(n,e,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,e,r):this.processSegment(n,e,r,r.segments,o)}processChildren(n,e,r){return Ht(Object.keys(r.children)).pipe(vi(o=>{const i=r.children[o],a=TE(e,o);return this.processSegmentGroup(n,a,i,o)}),YD((o,i)=>o&&i?(o.push(...i),o):null),function KU(t,n=!1){return jt((e,r)=>{let o=0;e.subscribe(Pt(r,i=>{const a=t(i,o++);(a||n)&&r.next(i),!a&&r.complete()}))})}(o=>null!==o),Ed(null),JD(),Pe(o=>{if(null===o)return null;const i=UE(o);return function T5(t){t.sort((n,e)=>n.value.outlet===Ie?-1:e.value.outlet===Ie?1:n.value.outlet.localeCompare(e.value.outlet))}(i),i}))}processSegment(n,e,r,o,i){return Ht(e).pipe(vi(a=>this.processSegmentAgainstRoute(a._injector??n,a,r,o,i)),bi(a=>!!a),oo(a=>{if(Vm(a))return NE(r,o,i)?ge([]):ge(null);throw a}))}processSegmentAgainstRoute(n,e,r,o,i){if(e.redirectTo||!OE(e,r,o,i))return ge(null);let a;if("**"===e.path){const s=o.length>0?tE(o).parameters:{},u=jE(r)+o.length;a=ge({snapshot:new Nd(o,s,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,HE(e),gr(e),e.component??e._loadedComponent??null,e,VE(r),u,WE(e)),consumedSegments:[],remainingSegments:[]})}else a=kE(r,e,o,n).pipe(Pe(({matched:s,consumedSegments:u,remainingSegments:c,parameters:l})=>{if(!s)return null;const d=jE(r)+u.length;return{snapshot:new Nd(u,l,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,HE(e),gr(e),e.component??e._loadedComponent??null,e,VE(r),d,WE(e)),consumedSegments:u,remainingSegments:c}}));return a.pipe(ro(s=>{if(null===s)return ge(null);const{snapshot:u,consumedSegments:c,remainingSegments:l}=s;n=e._injector??n;const d=e._loadedInjector??n,f=function A5(t){return t.children?t.children:t.loadChildren?t._loadedRoutes:[]}(e),{segmentGroup:h,slicedSegments:p}=Ud(r,c,l,f.filter(m=>void 0===m.redirectTo));if(0===p.length&&h.hasChildren())return this.processChildren(d,f,h).pipe(Pe(m=>null===m?null:[new Wo(u,m)]));if(0===f.length&&0===p.length)return ge([new Wo(u,[])]);const g=gr(e)===i;return this.processSegment(d,f,h,p,g?Ie:i).pipe(Pe(m=>null===m?null:[new Wo(u,m)]))}))}}function P5(t){const n=t.value.routeConfig;return n&&""===n.path&&void 0===n.redirectTo}function UE(t){const n=[],e=new Set;for(const r of t){if(!P5(r)){n.push(r);continue}const o=n.find(i=>r.value.routeConfig===i.value.routeConfig);void 0!==o?(o.children.push(...r.children),e.add(o)):n.push(r)}for(const r of e){const o=UE(r.children);n.push(new Wo(r.value,o))}return n.filter(r=>!e.has(r))}function VE(t){let n=t;for(;n._sourceSegment;)n=n._sourceSegment;return n}function jE(t){let n=t,e=n._segmentIndexShift??0;for(;n._sourceSegment;)n=n._sourceSegment,e+=n._segmentIndexShift??0;return e-1}function HE(t){return t.data||{}}function WE(t){return t.resolve||{}}function zE(t){return"string"==typeof t.title||null===t.title}function Wm(t){return ro(n=>{const e=t(n);return e?Ht(e).pipe(Pe(()=>n)):ge(n)})}const bs=new fe("ROUTES");let zm=(()=>{class t{constructor(e,r){this.injector=e,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return ge(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const r=wi(e.loadComponent()).pipe(Pe(GE),vn(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),xm(()=>{this.componentLoaders.delete(e)})),o=new XD(r,()=>new Vr).pipe(bm());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return ge({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const i=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(Pe(s=>{this.onLoadEndListener&&this.onLoadEndListener(r);let u,c,l=!1;Array.isArray(s)?c=s:(u=s.create(e).injector,c=eE(u.get(bs,[],be.Self|be.Optional)));return{routes:c.map(Um),injector:u}}),xm(()=>{this.childrenLoaders.delete(r)})),a=new XD(i,()=>new Vr).pipe(bm());return this.childrenLoaders.set(r,a),a}loadModuleFactoryOrRoutes(e){return wi(e()).pipe(Pe(GE),Zt(o=>o instanceof f_||Array.isArray(o)?ge(o):Ht(this.compiler.compileModuleAsync(o))))}}return t.\u0275fac=function(e){return new(e||t)(ce(Xr),ce(eC))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function GE(t){return function j5(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let zd=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Vr,this.configLoader=Ne(zm),this.environmentInjector=Ne(Kr),this.urlSerializer=Ne(Gu),this.rootContexts=Ne(Ju),this.navigationId=0,this.afterPreactivation=()=>ge(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new IV(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new SV(o))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:r})}setupNavigations(e){return this.transitions=new Qn({id:0,targetPageId:0,currentUrlTree:e.currentUrlTree,currentRawUrl:e.currentUrlTree,extractedUrl:e.urlHandlingStrategy.extract(e.currentUrlTree),urlAfterRedirects:e.urlHandlingStrategy.extract(e.currentUrlTree),rawUrl:e.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Qu,restoredState:null,currentSnapshot:e.routerState.snapshot,targetSnapshot:null,currentRouterState:e.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(jo(r=>0!==r.id),Pe(r=>({...r,extractedUrl:e.urlHandlingStrategy.extract(r.rawUrl)})),ro(r=>{let o=!1,i=!1;return ge(r).pipe(vn(a=>{this.currentNavigation={id:a.id,initialUrl:a.rawUrl,extractedUrl:a.extractedUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),ro(a=>{const s=e.browserUrlTree.toString(),u=!e.navigated||a.extractedUrl.toString()!==s||s!==e.currentUrlTree.toString();if(!u&&"reload"!==(a.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const l="";return this.events.next(new Od(a.id,e.serializeUrl(r.rawUrl),l,0)),e.rawUrlTree=a.rawUrl,a.resolve(null),jr}if(e.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return qE(a.source)&&(e.browserUrlTree=a.extractedUrl),ge(a).pipe(ro(l=>{const d=this.transitions?.getValue();return this.events.next(new Mm(l.id,this.urlSerializer.serialize(l.extractedUrl),l.source,l.restoredState)),d!==this.transitions?.getValue()?jr:Promise.resolve(l)}),function E5(t,n,e,r){return ro(o=>function C5(t,n,e,r,o){return new D5(t,n,e,r,o).apply()}(t,n,e,o.extractedUrl,r).pipe(Pe(i=>({...o,urlAfterRedirects:i}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,e.config),vn(l=>{this.currentNavigation={...this.currentNavigation,finalUrl:l.urlAfterRedirects},r.urlAfterRedirects=l.urlAfterRedirects}),function O5(t,n,e,r,o){return Zt(i=>function M5(t,n,e,r,o,i,a="emptyOnly"){return new R5(t,n,e,r,o,a,i).recognize().pipe(ro(s=>null===s?function I5(t){return new Et(n=>n.error(t))}(new S5):ge(s)))}(t,n,e,i.urlAfterRedirects,r.serialize(i.urlAfterRedirects),r,o).pipe(Pe(a=>({...i,targetSnapshot:a}))))}(this.environmentInjector,this.rootComponentType,e.config,this.urlSerializer,e.paramsInheritanceStrategy),vn(l=>{if(r.targetSnapshot=l.targetSnapshot,"eager"===e.urlUpdateStrategy){if(!l.extras.skipLocationChange){const f=e.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl);e.setBrowserUrl(f,l)}e.browserUrlTree=l.urlAfterRedirects}const d=new xV(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}));if(u&&e.urlHandlingStrategy.shouldProcessUrl(e.rawUrlTree)){const{id:l,extractedUrl:d,source:f,restoredState:h,extras:p}=a,g=new Mm(l,this.urlSerializer.serialize(d),f,h);this.events.next(g);const m=xE(d,this.rootComponentType).snapshot;return ge(r={...a,targetSnapshot:m,urlAfterRedirects:d,extras:{...p,skipLocationChange:!1,replaceUrl:!1}})}{const l="";return this.events.next(new Od(a.id,e.serializeUrl(r.extractedUrl),l,1)),e.rawUrlTree=a.rawUrl,a.resolve(null),jr}}),vn(a=>{const s=new _V(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(s)}),Pe(a=>r={...a,guards:QV(a.targetSnapshot,a.currentSnapshot,this.rootContexts)}),function s5(t,n){return Zt(e=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:a}}=e;return 0===a.length&&0===i.length?ge({...e,guardsResult:!0}):function u5(t,n,e,r){return Ht(t).pipe(Zt(o=>function p5(t,n,e,r,o){const i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return i&&0!==i.length?ge(i.map(s=>{const u=Zu(n)??o,c=vs(s,u);return wi(function o5(t){return t&&nc(t.canDeactivate)}(c)?c.canDeactivate(t,n,e,r):u.runInContext(()=>c(t,n,e,r))).pipe(bi())})).pipe(ys()):ge(!0)}(o.component,o.route,e,n,r)),bi(o=>!0!==o,!0))}(a,r,o,t).pipe(Zt(s=>s&&function e5(t){return"boolean"==typeof t}(s)?function c5(t,n,e,r){return Ht(n).pipe(vi(o=>ym(function d5(t,n){return null!==t&&n&&n(new MV(t)),ge(!0)}(o.route.parent,r),function l5(t,n){return null!==t&&n&&n(new TV(t)),ge(!0)}(o.route,r),function h5(t,n,e){const r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(a=>function YV(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(a)).filter(a=>null!==a).map(a=>KD(()=>ge(a.guards.map(u=>{const c=Zu(a.node)??e,l=vs(u,c);return wi(function r5(t){return t&&nc(t.canActivateChild)}(l)?l.canActivateChild(r,t):c.runInContext(()=>l(r,t))).pipe(bi())})).pipe(ys())));return ge(i).pipe(ys())}(t,o.path,e),function f5(t,n,e){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return ge(!0);const o=r.map(i=>KD(()=>{const a=Zu(n)??e,s=vs(i,a);return wi(function n5(t){return t&&nc(t.canActivate)}(s)?s.canActivate(n,t):a.runInContext(()=>s(n,t))).pipe(bi())}));return ge(o).pipe(ys())}(t,o.route,e))),bi(o=>!0!==o,!0))}(r,i,t,n):ge(s)),Pe(s=>({...e,guardsResult:s})))})}(this.environmentInjector,a=>this.events.next(a)),vn(a=>{if(r.guardsResult=a.guardsResult,na(a.guardsResult))throw EE(0,a.guardsResult);const s=new CV(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.events.next(s)}),jo(a=>!!a.guardsResult||(e.restoreHistory(a),this.cancelNavigationTransition(a,"",3),!1)),Wm(a=>{if(a.guards.canActivateChecks.length)return ge(a).pipe(vn(s=>{const u=new DV(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(u)}),ro(s=>{let u=!1;return ge(s).pipe(function N5(t,n){return Zt(e=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return ge(e);let i=0;return Ht(o).pipe(vi(a=>function F5(t,n,e,r){const o=t.routeConfig,i=t._resolve;return void 0!==o?.title&&!zE(o)&&(i[zu]=o.title),function L5(t,n,e,r){const o=function B5(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===o.length)return ge({});const i={};return Ht(o).pipe(Zt(a=>function U5(t,n,e,r){const o=Zu(n)??r,i=vs(t,o);return wi(i.resolve?i.resolve(n,e):o.runInContext(()=>i(n,e)))}(t[a],n,e,r).pipe(bi(),vn(s=>{i[a]=s}))),wm(1),function XU(t){return Pe(()=>t)}(i),oo(a=>Vm(a)?jr:ls(a)))}(i,t,n,r).pipe(Pe(a=>(t._resolvedData=a,t.data=_E(t,e).resolve,o&&zE(o)&&(t.data[zu]=o.title),null)))}(a.route,r,t,n)),vn(()=>i++),wm(1),Zt(a=>i===o.length?ge(e):jr))})}(e.paramsInheritanceStrategy,this.environmentInjector),vn({next:()=>u=!0,complete:()=>{u||(e.restoreHistory(s),this.cancelNavigationTransition(s,"",2))}}))}),vn(s=>{const u=new EV(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(u)}))}),Wm(a=>{const s=u=>{const c=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(u.routeConfig).pipe(vn(l=>{u.component=l}),Pe(()=>{})));for(const l of u.children)c.push(...s(l));return c};return GD(s(a.targetSnapshot.root)).pipe(Ed(),Wu(1))}),Wm(()=>this.afterPreactivation()),Pe(a=>{const s=function UV(t,n,e){const r=Yu(t,n._root,e?e._root:void 0);return new wE(r,n)}(e.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return r={...a,targetRouterState:s}}),vn(a=>{e.currentUrlTree=a.urlAfterRedirects,e.rawUrlTree=e.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),e.routerState=a.targetRouterState,"deferred"===e.urlUpdateStrategy&&(a.extras.skipLocationChange||e.setBrowserUrl(e.rawUrlTree,a),e.browserUrlTree=a.urlAfterRedirects)}),((t,n,e)=>Pe(r=>(new XV(n,r.targetRouterState,r.currentRouterState,e).activate(t),r)))(this.rootContexts,e.routeReuseStrategy,a=>this.events.next(a)),vn({next:a=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,e.navigated=!0,this.events.next(new ra(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(e.currentUrlTree))),e.titleStrategy?.updateTitle(a.targetRouterState.snapshot),a.resolve(!0)},complete:()=>{o=!0}}),xm(()=>{o||i||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),oo(a=>{if(i=!0,ME(a)){IE(a)||(e.navigated=!0,e.restoreHistory(r,!0));const s=new kd(r.id,this.urlSerializer.serialize(r.extractedUrl),a.message,a.cancellationCode);if(this.events.next(s),IE(a)){const u=e.urlHandlingStrategy.merge(a.url,e.rawUrlTree),c={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===e.urlUpdateStrategy||qE(r.source)};e.scheduleNavigation(u,Qu,null,c,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{e.restoreHistory(r,!0);const s=new Rm(r.id,this.urlSerializer.serialize(r.extractedUrl),a,r.targetSnapshot??void 0);this.events.next(s);try{r.resolve(e.errorHandler(a))}catch(u){r.reject(u)}}return jr}))}))}cancelNavigationTransition(e,r,o){const i=new kd(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function qE(t){return t!==Qu}let KE=(()=>{class t{buildTitle(e){let r,o=e.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===Ie);return r}getResolvedTitleForRoute(e){return e.data[zu]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne(H5)},providedIn:"root"}),t})(),H5=(()=>{class t extends KE{constructor(e){super(),this.title=e}updateTitle(e){const r=this.buildTitle(e);void 0!==r&&this.title.setTitle(r)}}return t.\u0275fac=function(e){return new(e||t)(ce(xD))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),W5=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne($5)},providedIn:"root"}),t})();class z5{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}let $5=(()=>{class t extends z5{}return t.\u0275fac=function(){let n;return function(r){return(n||(n=function Nb(t){return Co(()=>{const n=t.prototype.constructor,e=n[Eo]||Bh(n),r=Object.prototype;let o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){const i=o[Eo]||Bh(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}(t)))(r||t)}}(),t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const $d=new fe("",{providedIn:"root",factory:()=>({})});let q5=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne(K5)},providedIn:"root"}),t})(),K5=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function X5(t){throw t}function Q5(t,n,e){return n.parse("/")}const Y5={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},J5={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Yn=(()=>{class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Ne(j3),this.isNgZoneEnabled=!1,this.options=Ne($d,{optional:!0})||{},this.errorHandler=this.options.errorHandler||X5,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Q5,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Ne(q5),this.routeReuseStrategy=Ne(W5),this.urlCreationStrategy=Ne(FV),this.titleStrategy=Ne(KE),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=eE(Ne(bs,{optional:!0})??[]),this.navigationTransitions=Ne(zd),this.urlSerializer=Ne(Gu),this.location=Ne(Ug),this.isNgZoneEnabled=Ne(It)instanceof It&&It.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new xi,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=xE(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(e=>{this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const e=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Qu,e)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const r="popstate"===e.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(e.url,r,e.state)},0)}))}navigateToSyncWithBrowser(e,r,o){const i={replaceUrl:!0},a=o?.navigationId?o:null;if(o){const u={...o};delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(i.state=u)}const s=this.parseUrl(e);this.scheduleNavigation(s,r,a,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(e){this.config=e.map(Um),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,r={}){const{relativeTo:o,queryParams:i,fragment:a,queryParamsHandling:s,preserveFragment:u}=r,c=u?this.currentUrlTree.fragment:a;let l=null;switch(s){case"merge":l={...this.currentUrlTree.queryParams,...i};break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=i||null}return null!==l&&(l=this.removeEmptyProps(l)),this.urlCreationStrategy.createUrlTree(o,this.routerState,this.currentUrlTree,e,l,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){const o=na(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,Qu,null,r)}navigate(e,r={skipLocationChange:!1}){return function Z5(t){for(let n=0;n<t.length;n++){const e=t[n];if(null==e)throw new Q(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let r;try{r=this.urlSerializer.parse(e)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,e)}return r}isActive(e,r){let o;if(o=!0===r?{...Y5}:!1===r?{...J5}:r,na(e))return rE(this.currentUrlTree,e,o);const i=this.parseUrl(e);return rE(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.keys(e).reduce((r,o)=>{const i=e[o];return null!=i&&(r[o]=i),r},{})}scheduleNavigation(e,r,o,i,a){if(this.disposed)return Promise.resolve(!1);let s,u,c,l;return a?(s=a.resolve,u=a.reject,c=a.promise):c=new Promise((d,f)=>{s=d,u=f}),l="computed"===this.canceledNavigationResolution?o&&o.\u0275routerPageId?o.\u0275routerPageId:i.replaceUrl||i.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:l,source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}setBrowserUrl(e,r){const o=this.urlSerializer.serialize(e),i={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl?this.location.replaceState(o,"",i):this.location.go(o,"",i)}restoreHistory(e,r=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===o?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===o&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(o)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Gd=(()=>{class t{constructor(e,r,o,i,a,s){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=a,this.locationStrategy=s,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new Vr;const u=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===u||"area"===u,this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof ra&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(e){this._preserveFragment=Ng(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=Ng(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=Ng(e)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(e){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(e,r,o,i,a){return!!(null===this.urlTree||this.isAnchorElement&&(0!==e||r||o||i||a||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const e=null===this.href?null:function kw(t,n,e){return function jP(t,n){return"src"===n&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===n&&("base"===t||"link"===t)?Pw:Va}(n,e)(t)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",e)}applyAttributeValue(e,r){const o=this.renderer,i=this.el.nativeElement;null!==r?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return t.\u0275fac=function(e){return new(e||t)(he(Yn),he(ms),function hl(t){return function fA(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const e=t.attrs;if(e){const r=e.length;let o=0;for(;o<r;){const i=e[o];if(_b(i))break;if(0===i)o+=2;else if("number"==typeof i)for(o++;o<r&&"string"==typeof e[o];)o++;else{if(i===n)return e[o+1];o+=2}}}return null}(tn(),t)}("tabindex"),he(Wa),he(Ao),he(ea))},t.\u0275dir=_n({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(e,r){1&e&&fi("click",function(i){return r.onClick(i.button,i.ctrlKey,i.shiftKey,i.altKey,i.metaKey)}),2&e&&zp("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Wi]}),t})(),XE=(()=>{class t{get isActive(){return this._isActive}constructor(e,r,o,i,a){this.router=e,this.element=r,this.renderer=o,this.cdr=i,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new mn,this.routerEventsSubscription=e.events.subscribe(s=>{s instanceof ra&&this.update()})}ngAfterContentInit(){ge(this.links.changes,ge(null)).pipe(xa()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const e=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=Ht(e).pipe(xa()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(e){const r=Array.isArray(e)?e:e.split(" ");this.classes=r.filter(o=>!!o)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||Promise.resolve().then(()=>{const e=this.hasActiveLinks();this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.classes.forEach(r=>{e?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(e))})}isLinkActive(e){const r=function ej(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return o=>!!o.urlTree&&e.isActive(o.urlTree,r)}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}}return t.\u0275fac=function(e){return new(e||t)(he(Yn),he(Ao),he(Wa),he(Tg),he(Gd,8))},t.\u0275dir=_n({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(e,r,o){if(1&e&&function A_(t,n,e,r){const o=We();if(o.firstCreatePass){const i=tn();k_(o,new R_(n,e,r),i.index),function w3(t,n){const e=t.contentQueries||(t.contentQueries=[]);n!==(e.length?e[e.length-1]:-1)&&e.push(t.queries.length-1,n)}(o,t),2==(2&e)&&(o.staticContentQueries=!0)}P_(o,G(),e)}(o,Gd,5),2&e){let i;Sr(i=Ir())&&(r.links=i)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[Wi]}),t})();class QE{}let tj=(()=>{class t{constructor(e,r,o,i,a){this.router=e,this.injector=o,this.preloadingStrategy=i,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(jo(e=>e instanceof ra),vi(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){const o=[];for(const i of r){i.providers&&!i._injector&&(i._injector=Gl(i.providers,e,`Route: ${i.path}`));const a=i._injector??e,s=i._loadedInjector??a;i.loadChildren&&!i._loadedRoutes&&void 0===i.canLoad||i.loadComponent&&!i._loadedComponent?o.push(this.preloadConfig(a,i)):(i.children||i._loadedRoutes)&&o.push(this.processRoutes(s,i.children??i._loadedRoutes))}return Ht(o).pipe(xa())}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(e,r):ge(null);const i=o.pipe(Zt(a=>null===a?ge(void 0):(r._loadedRoutes=a.routes,r._loadedInjector=a.injector,this.processRoutes(a.injector??e,a.routes))));return r.loadComponent&&!r._loadedComponent?Ht([i,this.loader.loadComponent(r)]).pipe(xa()):i})}}return t.\u0275fac=function(e){return new(e||t)(ce(Yn),ce(eC),ce(Kr),ce(QE),ce(zm))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Gm=new fe("");let YE=(()=>{class t{constructor(e,r,o,i,a={}){this.urlSerializer=e,this.transitions=r,this.viewportScroller=o,this.zone=i,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Mm?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof ra&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof yE&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new yE(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return t.\u0275fac=function(e){!function l1(){throw new Error("invalid")}()},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();var Jn=(()=>((Jn=Jn||{})[Jn.COMPLETE=0]="COMPLETE",Jn[Jn.FAILED=1]="FAILED",Jn[Jn.REDIRECTING=2]="REDIRECTING",Jn))();const ws=!1;function _i(t,n){return{\u0275kind:t,\u0275providers:n}}const qm=new fe("",{providedIn:"root",factory:()=>!1});function ZE(){const t=Ne(Xr);return n=>{const e=t.get(Zl);if(n!==e.components[0])return;const r=t.get(Yn),o=t.get(e2);1===t.get(Km)&&r.initialNavigation(),t.get(t2,null,be.Optional)?.setUpPreloading(),t.get(Gm,null,be.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.unsubscribe())}}const e2=new fe(ws?"bootstrap done indicator":"",{factory:()=>new Vr}),Km=new fe(ws?"initial navigation":"",{providedIn:"root",factory:()=>1});function aj(){let t=[];return t=ws?[{provide:Dl,multi:!0,useFactory:()=>{const n=Ne(Yn);return()=>n.events.subscribe(e=>{console.group?.(`Router Event: ${e.constructor.name}`),console.log(function PV(t){if(!("type"in t))return`Unknown Router Event: ${t.constructor.name}`;switch(t.type){case 14:return`ActivationEnd(path: '${t.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${t.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${t.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${t.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state}, shouldActivate: ${t.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 2:return`NavigationCancel(id: ${t.id}, url: '${t.url}')`;case 16:return`NavigationSkipped(id: ${t.id}, url: '${t.url}')`;case 1:return`NavigationEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${t.id}, url: '${t.url}', error: ${t.error})`;case 0:return`NavigationStart(id: ${t.id}, url: '${t.url}')`;case 6:return`ResolveEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 5:return`ResolveStart(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 10:return`RouteConfigLoadEnd(path: ${t.route.path})`;case 9:return`RouteConfigLoadStart(path: ${t.route.path})`;case 4:return`RoutesRecognized(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 15:return`Scroll(anchor: '${t.anchor}', position: '${t.position?`${t.position[0]}, ${t.position[1]}`:null}')`}}(e)),console.log(e),console.groupEnd?.()})}}]:[],_i(1,t)}const t2=new fe(ws?"router preloader":"");function sj(t){return _i(0,[{provide:t2,useExisting:tj},{provide:QE,useExisting:t}])}const oc=!1,n2=new fe(oc?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),uj=[Ug,{provide:Gu,useClass:_m},Yn,Ju,{provide:ms,useFactory:function JE(t){return t.routerState.root},deps:[Yn]},zm,oc?{provide:qm,useValue:!0}:[]];function cj(){return new uC("Router",Yn)}let r2=(()=>{class t{constructor(e){}static forRoot(e,r){return{ngModule:t,providers:[uj,oc&&r?.enableTracing?aj().\u0275providers:[],{provide:bs,multi:!0,useValue:e},{provide:n2,useFactory:hj,deps:[[Yn,new cu,new lu]]},{provide:$d,useValue:r||{}},r?.useHash?{provide:ea,useClass:ML}:{provide:ea,useClass:AC},{provide:Gm,useFactory:()=>{const t=Ne(G4),n=Ne(It),e=Ne($d),r=Ne(zd),o=Ne(Gu);return e.scrollOffset&&t.setOffset(e.scrollOffset),new YE(o,r,t,n,e)}},r?.preloadingStrategy?sj(r.preloadingStrategy).\u0275providers:[],{provide:uC,multi:!0,useFactory:cj},r?.initialNavigation?pj(r):[],[{provide:o2,useFactory:ZE},{provide:sC,multi:!0,useExisting:o2}]]}}static forChild(e){return{ngModule:t,providers:[{provide:bs,multi:!0,useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)(ce(n2,8))},t.\u0275mod=So({type:t}),t.\u0275inj=Hr({imports:[Lm]}),t})();function hj(t){if(oc&&t)throw new Q(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function pj(t){return["disabled"===t.initialNavigation?_i(3,[{provide:Ql,multi:!0,useFactory:()=>{const n=Ne(Yn);return()=>{n.setUpLocationChangeListener()}}},{provide:Km,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?_i(2,[{provide:Km,useValue:0},{provide:Ql,multi:!0,deps:[Xr],useFactory:n=>{const e=n.get(SL,Promise.resolve());return()=>e.then(()=>new Promise(r=>{const o=n.get(Yn),i=n.get(e2);(function nj(t,n){t.events.pipe(jo(e=>e instanceof ra||e instanceof kd||e instanceof Rm||e instanceof Od),Pe(e=>e instanceof ra||e instanceof Od?Jn.COMPLETE:e instanceof kd&&(0===e.code||1===e.code)?Jn.REDIRECTING:Jn.FAILED),jo(e=>e!==Jn.REDIRECTING),Wu(1)).subscribe(()=>{n()})})(o,()=>{r(!0)}),n.get(zd).afterPreactivation=()=>(r(!0),i.closed?ge(void 0):i),o.initialNavigation()}))}}]).\u0275providers:[]]}const o2=new fe(oc?"Router Initializer":"");function i2(t,n,e,r,o,i,a){try{var s=t[i](a),u=s.value}catch(c){return void e(c)}s.done?n(u):Promise.resolve(u).then(r,o)}function oa(t){return function(){var n=this,e=arguments;return new Promise(function(r,o){var i=t.apply(n,e);function a(u){i2(i,r,o,a,s,"next",u)}function s(u){i2(i,r,o,a,s,"throw",u)}a(void 0)})}}var a2=function(t,n){return(a2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(t,n)};function Ar(t,n){function e(){this.constructor=t}a2(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function oe(t,n,e,r){return new(e||(e=Promise))(function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new e(function(l){l(c.value)}).then(a,s)}u((r=r.apply(t,n||[])).next())})}function ie(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(t,a)}catch(d){l=[6,d],r=0}finally{e=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var mj=function(){function t(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(n,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=n,this.platform=e},t.prototype.registerFlag=function(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},null!=this.urlFlags[n]){var o=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+o+"."),this.set(n,o)}},t.prototype.get=function(n){return n in this.flags||(this.flags[n]=this.evaluateFlag(n)),this.flags[n]},t.prototype.getNumber=function(n){return this.get(n)},t.prototype.getBool=function(n){return this.get(n)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(n,e){if(null==this.flagRegistry[n])throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=e,null!=this.flagRegistry[n].setHook&&this.flagRegistry[n].setHook(e)},t.prototype.evaluateFlag=function(n){if(null==this.flagRegistry[n])throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},t.prototype.setFlags=function(n){this.flags=Object.assign({},n)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var n=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,o=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return function vj(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0];n.urlFlags[s]=function(c,l){if("true"===(l=l.toLowerCase())||"false"===l)return"true"===l;if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,a[1])})}},t}();function L(){return s2}var s2=null,xs=new Map,ic=new Map;function u2(t,n){var e=Xm(t,n);return xs.get(e)}function c2(t){for(var n=xs.entries(),e=[];;){var r=n.next(),i=r.value;if(r.done)break;var s=i[1];i[0].split("_")[0]===t&&e.push(s)}return e}function l2(t){var n=t.kernelName,e=t.backendName,r=Xm(n,e);if(xs.has(r))throw new Error("The kernel '"+n+"' for backend '"+e+"' is already registered");xs.set(r,t)}function bj(t){var n=t.kernelName;ic.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),ic.set(n,t)}function Xm(t,n){return n+"_"+t}function d2(t){for(var n=t.length,e=0,r=0;n>0;)r=Math.random()*n|0,e=t[--n],t[n]=t[r],t[r]=e}function qd(t,n,e){return Math.max(t,Math.min(n,e))}function Qm(t){return t%2==0?t:t+1}function f2(t){for(var n=0,e=0;e<t.length;e++)n+=t[e];return n}function D(t,n){if(!t)throw new Error("string"==typeof n?n:n())}function ze(t,n,e){void 0===e&&(e=""),D(Lt(t,n),function(){return e+" Shapes "+t+" and "+n+" must match"})}function ia(t){D(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function zo(t,n,e){if(void 0===n&&(n=[]),void 0===e&&(e=!1),null==n&&(n=[]),Array.isArray(t)||on(t)&&!e)for(var r=0;r<t.length;++r)zo(t[r],n,e);else n.push(t);return n}function ae(t){if(0===t.length)return 1;for(var n=t[0],e=1;e<t.length;e++)n*=t[e];return n}function Lt(t,n){if(t===n)return!0;if(null==t||null==n||t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function vt(t){return t%1==0}function h2(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var n=Math.exp(2*t);return(n-1)/(n+1)}function Kd(t){var n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function aa(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function Ym(t,n,e){return void 0===n&&(n=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{i++;var s=n(i);null!=e&&i>=e?o():setTimeout(a,s)}};a()})}function p2(t,n){for(var e=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)e*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(n>0&&n!==e)throw Error("Size("+n+") must match the product of shape "+t);return t}if(0===e)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(n%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+e);var i=t.slice();return i[r]=n/e,i}function Bt(t,n){var e=n.length;return D((t=null==t?n.map(function(r,o){return o}):[].concat(t)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+t}),D(t.every(function(r){return vt(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?e+r:r})}function Ci(t,n){for(var e=[],r=[],o=null!=n&&Array.isArray(n)&&0===n.length,i=null==n||o?null:Bt(n,t).sort(),a=0,s=0;s<t.length;++s){if(null!=i){if(i[a]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===t[s]&&(e.push(t[s]),r.push(s)),i[a]<=s&&a++}1!==t[s]&&(e.push(t[s]),r.push(s))}return{newShape:e,keptDims:r}}function _s(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else{if("bool"!==t)throw new Error("Unknown data type "+t);e=new Uint8Array(n)}return e}function ac(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else if("bool"===t)e=new Uint8Array(n);else{if("string"!==t)throw new Error("Unknown data type "+t);e=new Array(n)}return e}function g2(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function m2(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function v2(t,n){return!("complex64"===n||"float32"===n&&"complex64"!==t||"int32"===n&&"float32"!==t&&"complex64"!==t||"bool"===n&&"bool"===t)}function on(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Jm(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function y2(t){if(null==t)return 0;var n=0;return t.forEach(function(e){return n+=e.length}),n}function Di(t){return"string"==typeof t||t instanceof String}function b2(t){return"boolean"==typeof t}function w2(t){return"number"==typeof t}function Cs(t){return Array.isArray(t)?Cs(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":w2(t)?"float32":Di(t)?"string":b2(t)?"bool":"float32"}function Ei(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Xd(t,n){for(var e=n;e<t;++e)if(t%e==0)return e;return t}function Pr(t){var n=t.length;if(n<2)return[];var e=new Array(n-1);e[n-2]=t[n-1];for(var r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function Zm(t,n,e){if("string"===n)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=zo(t)),e&&g2(t,n),a=n,(i=t)instanceof Float32Array&&"float32"===a||i instanceof Int32Array&&"int32"===a||i instanceof Uint8Array&&"bool"===a)return t;var i,a;if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+n)}function ev(t,n){if(0===t.length)return n[0];var e=t.reduce(function(r,o){return r*o});if(0===e)return[];if(e!==n.length)throw new Error("["+t+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(1===i.length)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),d=l.reduce(function(f,h){return f*h});for(c=0;c<u;c++)s[c]=r(o+c*d,l,a)}return s}(0,t,n)}function tv(t,n){for(var e=Ds(t,n),r=0;r<e.length;r++)e[r]=1;return e}function Ds(t,n){if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n)return new Uint8Array(t);throw new Error("Unknown data type "+n)}function kr(){return L().platform.now()}function nv(t){t.forEach(function(n){D(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function x2(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",L().platform.encode(t,n)}function sc(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",L().platform.decode(t,n)}function rv(t,n,e){if(0===n)return 0;if(1===n)return t[0];for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function _2(t,n,e){if(0===n)return[];if(1===n)return[t];for(var r=new Array(n),o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}Object.freeze({shuffle:d2,clamp:qd,nearestLargerEven:Qm,sum:f2,randUniform:function(t,n){var e=Math.random();return n*e+(1-e)*t},distSquared:function(t,n){for(var e=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(n[r]);e+=o*o}return e},assert:D,assertShapesMatch:ze,assertNonNull:ia,flatten:zo,sizeFromShape:ae,isScalarShape:function(t){return 0===t.length},arraysEqual:Lt,isInt:vt,tanh:h2,sizeToSquarishShape:Kd,createShuffledIndices:function(t){for(var n=new Uint32Array(t),e=0;e<t;++e)n[e]=e;return d2(n),n},rightPad:aa,repeatedTry:Ym,inferFromImplicitShape:p2,parseAxisParam:Bt,squeezeShape:Ci,getTypedArrayFromDType:_s,getArrayFromDType:ac,checkConversionForErrors:g2,isValidDtype:m2,hasEncodingLoss:v2,isTypedArray:on,bytesPerElement:Jm,bytesFromStringArray:y2,isString:Di,isBoolean:b2,isNumber:w2,inferDtype:Cs,isFunction:Ei,nearestDivisor:Xd,computeStrides:Pr,toTypedArray:Zm,toNestedArray:ev,makeOnesTypedArray:tv,makeZerosTypedArray:Ds,now:kr,assertNonNegativeIntegerDimensions:nv,fetch:function(t,n){return L().platform.fetch(t,n)},encodeString:x2,decodeString:sc,locToIndex:rv,indexToLoc:_2});var wj=function(){function t(n,e){this.backendTimer=n,this.logger=e,null==e&&(this.logger=new xj)}return t.prototype.profileKernel=function(n,e,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(c,l,d){if("float32"!==l)return!1;for(var f=0;f<c.length;f++){var h=c[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,n),a.then(function(c){var l="";null!=c.getExtraProfileInfo&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(n,s,u,c.kernelMs,e,l)})})}),o},t}(),xj=function(){function t(){}return t.prototype.logKernelProfile=function(n,e,r,o,i,a){var s="number"==typeof o?aa(o+"ms",9):o.error,u=aa(n,25),c=e.rank,l=e.size,d=aa(e.shape.toString(),14),f="";for(var h in i){var p=i[h].shape||e.shape,g=p.length;f+=h+": "+g+"D "+(g>0?p:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+d+"\t%c"+l+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),ov=7;function cc(t,n,e){return aa(Array.isArray(t)?parseFloat(t[0].toFixed(ov))+" + "+parseFloat(t[1].toFixed(ov))+"j":Di(t)?"'"+t+"'":"bool"===e?D2(t):parseFloat(t.toFixed(ov)).toString(),n)}function D2(t){return 0===t?"false":"true"}function lc(t){for(var n=[],e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var dc=function(){function t(n,e,r){var o=this;if(this.dtype=e,this.shape=n.slice(),this.size=ae(n),null!=r){var i=r.length;D(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ac(e,this.size),this.strides=Pr(n)}return t.prototype.set=function(n){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];0===r.length&&(r=[0]),D(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(r);this.values[i]=n},t.prototype.get=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];0===n.length&&(n=[0]);for(var r=0,o=0,i=n;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r])throw new Error("Requested out of range element at "+n+".   Buffer shape="+this.shape);r++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},t.prototype.locToIndex=function(n){if(0===this.rank)return 0;if(1===this.rank)return n[0];for(var e=n[n.length-1],r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e},t.prototype.indexToLoc=function(n){if(0===this.rank)return[];if(1===this.rank)return[n];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return so().makeTensor(this.values,this.shape,this.dtype)},t}(),so=null,N=null,E2=null,ot=function(){function t(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=ae(n),this.strides=Pr(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),D(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(n,e){return this.throwIfDisposed(),this.reshape([n,e])},t.prototype.as3D=function(n,e,r){return this.throwIfDisposed(),this.reshape([n,e,r])},t.prototype.as4D=function(n,e,r,o){return this.throwIfDisposed(),this.reshape([n,e,r,o])},t.prototype.as5D=function(n,e,r,o,i){return this.throwIfDisposed(),this.reshape([n,e,r,o,i])},t.prototype.asType=function(n){return this.throwIfDisposed(),N.cast(this,n)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,N.buffer(this.shape,this.dtype,n)]}})})},t.prototype.bufferSync=function(){return N.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,ev(this.shape,n)]}})})},t.prototype.arraySync=function(){return ev(this.shape,this.dataSync())},t.prototype.data=function(){return oe(this,void 0,void 0,function(){var n,e;return ie(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=so().read(this.dataId),"string"!==this.dtype?[3,2]:[4,n];case 1:e=r.sent();try{return[2,e.map(function(o){return sc(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var n=so().readSync(this.dataId);if("string"===this.dtype)try{return n.map(function(e){return sc(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},t.prototype.bytes=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,so().read(this.dataId)];case 1:return n=e.sent(),"string"===this.dtype?[2,n]:[2,new Uint8Array(n.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(so().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(n){return void 0===n&&(n=!1),N.print(this,n)},t.prototype.reshape=function(n){return this.throwIfDisposed(),N.reshape(this,n)},t.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},t.prototype.expandDims=function(n){return void 0===n&&(n=0),N.expandDims(this,n)},t.prototype.cumsum=function(n,e,r){return void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1),N.cumsum(this,n,e,r)},t.prototype.squeeze=function(n){return this.throwIfDisposed(),N.squeeze(this,n)},t.prototype.clone=function(){return this.throwIfDisposed(),N.clone(this)},t.prototype.oneHot=function(n,e,r){return this.throwIfDisposed(),N.oneHot(this,n,e,r)},t.prototype.toString=function(n){return void 0===n&&(n=!1),function _j(t,n,e,r){var o=Pr(n),i=function(c,l,d,f){var h=ae(l),p=f[f.length-1],g=new Array(p).fill(0),m=l.length,v="complex64"===d?lc(c):c;if(m>1)for(var b=0;b<h/p;b++)for(var y=b*p,w=0;w<p;w++)g[w]=Math.max(g[w],cc(v[y+w],0,d).length);return g}(t,n,e,o),a=n.length,s=function c(l,d,f,h,p,g){void 0===g&&(g=!0);var m="complex64"===f?2:1,v=d[0],b=d.length;if(0===b)return"complex64"===f?[cc(lc(l)[0],0,f)]:"bool"===f?[D2(l[0])]:[l[0].toString()];if(1===b){if(v>20){var w=Array.from(l.slice(0,3*m)),x=Array.from(l.slice((v-3)*m,v*m));return"complex64"===f&&(w=lc(w),x=lc(x)),["["+w.map(function(F,W){return cc(F,p[W],f)}).join(", ")+", ..., "+x.map(function(F,W){return cc(F,p[v-3+W],f)}).join(", ")+"]"]}return["["+("complex64"===f?lc(l):Array.from(l)).map(function(F,W){return cc(F,p[W],f)}).join(", ")+"]"]}var _=d.slice(1),M=h.slice(1),I=h[0]*m,E=[];if(v>20){for(var S=0;S<3;S++){var P=(A=S*I)+I;E.push.apply(E,c(l.slice(A,P),_,f,M,p,!1))}for(E.push("..."),S=v-3;S<v;S++)P=(A=S*I)+I,E.push.apply(E,c(l.slice(A,P),_,f,M,p,S===v-1))}else for(S=0;S<v;S++){var A;P=(A=S*I)+I,E.push.apply(E,c(l.slice(A,P),_,f,M,p,S===v-1))}var V=2===b?",":"";for(E[0]="["+E[0]+V,S=1;S<E.length-1;S++)E[S]=" "+E[S]+V;var U=",\n";for(S=2;S<b;S++)U+="\n";return E[E.length-1]=" "+E[E.length-1]+"]"+(g?"":U),E}(t,n,e,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+a),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,n)},t.prototype.tile=function(n){return this.throwIfDisposed(),N.tile(this,n)},t.prototype.gather=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),N.gather(this,n,e)},t.prototype.matMul=function(n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.throwIfDisposed(),N.matMul(this,n,e,r)},t.prototype.dot=function(n){return this.throwIfDisposed(),N.dot(this,n)},t.prototype.norm=function(n,e,r){return void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1),this.throwIfDisposed(),N.norm(this,n,e,r)},t.prototype.slice=function(n,e){return this.throwIfDisposed(),N.slice(this,n,e)},t.prototype.reverse=function(n){return this.throwIfDisposed(),N.reverse(this,n)},t.prototype.concat=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),n instanceof t&&(n=[n]),N.concat([this].concat(n),e)},t.prototype.split=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),N.split(this,n,e)},t.prototype.stack=function(n,e){return void 0===e&&(e=0),N.stack([this,n],e)},t.prototype.unstack=function(n){return void 0===n&&(n=0),N.unstack(this,n)},t.prototype.pad=function(n,e){return void 0===e&&(e=0),N.pad(this,n,e)},t.prototype.batchNormalization=function(n,e,r,o,i){return void 0===r&&(r=.001),E2("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,e,i,o,r)},t.prototype.batchNorm=function(n,e,r,o,i){return void 0===i&&(i=.001),this.throwIfDisposed(),N.batchNorm(this,n,e,r,o,i)},t.prototype.all=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.all(this,n,e)},t.prototype.any=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.any(this,n,e)},t.prototype.logSumExp=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.logSumExp(this,n,e)},t.prototype.sum=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.sum(this,n,e)},t.prototype.prod=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.prod(this,n,e)},t.prototype.mean=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.mean(this,n,e)},t.prototype.min=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.min(this,n,e)},t.prototype.max=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),N.max(this,n,e)},t.prototype.argMin=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),N.argMin(this,n)},t.prototype.argMax=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),N.argMax(this,n)},t.prototype.cast=function(n){return this.throwIfDisposed(),N.cast(this,n)},t.prototype.add=function(n){return this.throwIfDisposed(),N.add(this,n)},t.prototype.addStrict=function(n){return this.throwIfDisposed(),N.addStrict(this,n)},t.prototype.atan2=function(n){return this.throwIfDisposed(),N.atan2(this,n)},t.prototype.sub=function(n){return this.throwIfDisposed(),N.sub(this,n)},t.prototype.subStrict=function(n){return this.throwIfDisposed(),N.subStrict(this,n)},t.prototype.pow=function(n){return this.throwIfDisposed(),N.pow(this,n)},t.prototype.powStrict=function(n){return this.throwIfDisposed(),N.powStrict(this,n)},t.prototype.mul=function(n){return this.throwIfDisposed(),N.mul(this,n)},t.prototype.mulStrict=function(n){return this.throwIfDisposed(),N.mulStrict(this,n)},t.prototype.div=function(n){return this.throwIfDisposed(),N.div(this,n)},t.prototype.divNoNan=function(n){return this.throwIfDisposed(),N.divNoNan(this,n)},t.prototype.floorDiv=function(n){return this.throwIfDisposed(),N.floorDiv(this,n)},t.prototype.divStrict=function(n){return this.throwIfDisposed(),N.divStrict(this,n)},t.prototype.minimum=function(n){return this.throwIfDisposed(),N.minimum(this,n)},t.prototype.minimumStrict=function(n){return this.throwIfDisposed(),N.minimumStrict(this,n)},t.prototype.maximum=function(n){return this.throwIfDisposed(),N.maximum(this,n)},t.prototype.maximumStrict=function(n){return this.throwIfDisposed(),N.maximumStrict(this,n)},t.prototype.mod=function(n){return this.throwIfDisposed(),N.mod(this,n)},t.prototype.modStrict=function(n){return this.throwIfDisposed(),N.modStrict(this,n)},t.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),N.squaredDifferenceStrict(this,n)},t.prototype.transpose=function(n){return this.throwIfDisposed(),N.transpose(this,n)},t.prototype.notEqual=function(n){return this.throwIfDisposed(),N.notEqual(this,n)},t.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),N.notEqualStrict(this,n)},t.prototype.less=function(n){return this.throwIfDisposed(),N.less(this,n)},t.prototype.lessStrict=function(n){return this.throwIfDisposed(),N.lessStrict(this,n)},t.prototype.equal=function(n){return this.throwIfDisposed(),N.equal(this,n)},t.prototype.equalStrict=function(n){return this.throwIfDisposed(),N.equalStrict(this,n)},t.prototype.lessEqual=function(n){return this.throwIfDisposed(),N.lessEqual(this,n)},t.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),N.lessEqualStrict(this,n)},t.prototype.greater=function(n){return this.throwIfDisposed(),N.greater(this,n)},t.prototype.greaterStrict=function(n){return this.throwIfDisposed(),N.greaterStrict(this,n)},t.prototype.greaterEqual=function(n){return this.throwIfDisposed(),N.greaterEqual(this,n)},t.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),N.greaterEqualStrict(this,n)},t.prototype.logicalAnd=function(n){return this.throwIfDisposed(),N.logicalAnd(this,n)},t.prototype.logicalOr=function(n){return this.throwIfDisposed(),N.logicalOr(this,n)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),N.logicalNot(this)},t.prototype.logicalXor=function(n){return this.throwIfDisposed(),N.logicalXor(this,n)},t.prototype.where=function(n,e){return this.throwIfDisposed(),N.where(n,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),N.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),N.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),N.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),N.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),N.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),N.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),N.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),N.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),N.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),N.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),N.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),N.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),N.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),N.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),N.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),N.abs(this)},t.prototype.clipByValue=function(n,e){return this.throwIfDisposed(),N.clipByValue(this,n,e)},t.prototype.relu=function(){return this.throwIfDisposed(),N.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),N.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),N.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),N.selu(this)},t.prototype.leakyRelu=function(n){return void 0===n&&(n=.2),this.throwIfDisposed(),N.leakyRelu(this,n)},t.prototype.prelu=function(n){return this.throwIfDisposed(),N.prelu(this,n)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),N.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),N.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),N.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),N.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),N.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),N.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),N.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),N.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),N.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),N.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),N.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),N.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),N.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),N.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),N.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),N.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),N.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),N.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),N.round(this)},t.prototype.step=function(n){return void 0===n&&(n=0),this.throwIfDisposed(),N.step(this,n)},t.prototype.softmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),N.softmax(this,n)},t.prototype.logSoftmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),N.logSoftmax(this,n)},t.prototype.resizeBilinear=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),N.image.resizeBilinear(this,n,e)},t.prototype.resizeNearestNeighbor=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),N.image.resizeNearestNeighbor(this,n,e)},t.prototype.conv1d=function(n,e,r,o,i,a){return void 0===o&&(o="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),N.conv1d(this,n,e,r,o,i,a)},t.prototype.conv2d=function(n,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),N.conv2d(this,n,e,r,o,i,a)},t.prototype.conv2dTranspose=function(n,e,r,o,i){return this.throwIfDisposed(),N.conv2dTranspose(this,n,e,r,o,i)},t.prototype.depthwiseConv2D=function(n,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),N.depthwiseConv2d(this,n,e,r,o,i,a)},t.prototype.separableConv2d=function(n,e,r,o,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),N.separableConv2d(this,n,e,r,o,i,a)},t.prototype.avgPool=function(n,e,r,o){return this.throwIfDisposed(),N.avgPool(this,n,e,r,o)},t.prototype.maxPool=function(n,e,r,o){return this.throwIfDisposed(),N.maxPool(this,n,e,r,o)},t.prototype.localResponseNormalization=function(n,e,r,o){return void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5),N.localResponseNormalization(this,n,e,r,o)},t.prototype.pool=function(n,e,r,o,i){return this.throwIfDisposed(),N.pool(this,n,e,r,o,i)},t.prototype.variable=function(n,e,r){return void 0===n&&(n=!0),this.throwIfDisposed(),so().makeVariable(this,n,e,r)},t.prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),N.unsortedSegmentSum(this,n,e)},t.prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),N.batchToSpaceND(this,n,e)},t.prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),N.spaceToBatchND(this,n,e)},t.prototype.topk=function(n,e){return void 0===n&&(n=1),void 0===e&&(e=!0),this.throwIfDisposed(),N.topk(this,n,e)},t.prototype.stridedSlice=function(n,e,r,o,i,a,s,u){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.throwIfDisposed(),N.stridedSlice(this,n,e,r,o,i,a,s,u)},t.prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),N.depthToSpace(this,n,e)},t.prototype.fft=function(){return this.throwIfDisposed(),N.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),N.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),N.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),N.spectral.irfft(this)},t}();Object.defineProperty(ot,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var S2,iv,av,sv,uv,t,Es=function(t){function n(e,r,o,i){var a=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return a.trainable=r,a.name=o,a}return Ar(n,t),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Lt(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");so().disposeTensor(this),this.dataId=e.dataId,so().incRef(this,null)},n.prototype.dispose=function(){so().disposeVariable(this),this.isDisposedInternal=!0},n}(ot);Object.defineProperty(Es,Symbol.hasInstance,{value:function(t){return t instanceof ot&&null!=t.assign&&t.assign instanceof Function}}),(t=S2||(S2={})).R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(iv||(iv={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(av||(av={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(sv||(sv={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(uv||(uv={}));var Cj={float32:sv,int32:iv,bool:av,complex64:uv};function Qt(t,n){if("string"===t||"string"===n){if("string"===t&&"string"===n)return"string";throw new Error("Can not upcast "+t+" with "+n)}return Cj[t][n]}function cv(t){return Qt(t,"int32")}function pt(t,n){if(t.dtype===n.dtype)return[t,n];var e=Qt(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function I2(t,n){D(t.dtype===n.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+n.dtype+") input must match"})}function lv(t){var n=[];return function e(r,o,i){if(null!=r){if(r instanceof ot)return void o.push(r);if(a=r,Array.isArray(a)||"object"==typeof a){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),e(c,o,i))}}}}(t,n,new Set),n}Object.freeze({makeTypesMatch:pt,assertTypesMatch:I2,isTensorInList:function(t,n){return n.some(function(e){return e.id===t.id})},getTensorsInContainer:lv});var dv,M2=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},t}(),Dj=function(){function t(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new M2}return t.prototype.ready=function(){return oe(this,void 0,void 0,function(){var n,e,r;return ie(this,function(o){switch(o.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];n=this.getSortedBackends(),e=0,o.label=1;case 1:return e<n.length?[4,this.initializeBackend(r=n[e]).success]:[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var n=this.initializeBackendsAndReturnBest(),e=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(n){return n in this.registry||n in this.registryFactory&&!this.initializeBackend(n).asyncInit?this.registry[n]:null},t.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},t.prototype.registerBackend=function(n,e,r){return void 0===r&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:e,priority:r},!0)},t.prototype.setBackend=function(n){return oe(this,void 0,void 0,function(){var e,r,o;return ie(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[n])throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,null!=this.registry[n]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(n),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new wj(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var n=this;c2(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(n.backendInstance)})},t.prototype.disposeRegisteredKernels=function(n){var e=this;c2(n).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(e.registry[n])})},t.prototype.initializeBackend=function(n){var e=this,r=this.registryFactory[n];if(null==r)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<e.pendingBackendInitId||(e.registry[n]=s,e.pendingBackendInit=null,0))}).catch(function(s){return!(i<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),1))});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[n]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var n=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return n.registryFactory[r].priority-n.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),e=0;e<n.length;e++){var r=n[e],o=this.initializeBackend(r),a=o.asyncInit;if(a||o.success)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(n,e){var r=this.state.tensorInfo.get(e),o=r.backend,i=this.readSync(e);o.disposeData(e),r.backend=n,n.move(e,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(n,e){var r,o=this,i=null;if(null==e){if("function"!=typeof n)throw new Error("Please provide a function to tidy()");e=n}else{if("string"!=typeof n&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(n,e,r){n();try{var o=r();return e(),o}catch(i){throw e(),i}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(n){var e=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype);return this.addTapeNode(this.state.activeScope.name,{x:n},[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},t.prototype.runKernel=function(n,e,r,o,i){return this.runKernelFunc(null,e,null,n,r,o,i)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(n,e,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+="complex64"===u.dtype?3:1});var s=o-e-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},t.prototype.runKernelFunc=function(n,e,r,o,i,a,s){var u,c=this;void 0===a&&(a=[]),void 0===s&&(s=[]);var l=[],d=this.isTapeOn();null==o&&(o=null!=this.state.activeScope?this.state.activeScope.name:"");var f,h=function(b){d&&(l=b.map(function(y){return c.keep(c.clone(y))}))},p=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=u2(o,this.backendName);return f=null!=v?function(){var b=c.backend.numDataIds();m=v.kernelFunc({inputs:e,attrs:i,backend:c.backend});var y=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,y);var w=y.map(function(_){return c.makeTensorFromDataId(_.dataId,_.shape,_.dtype)}),x=w.filter(function(_,M){return s[M]});return h((a||[]).slice().concat(x)),w}:function(){var b=c.backend.numDataIds();m=c.tidy(function(){return n(c.backend,h)});var y=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,y),y},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,e,function(){return f()}):f()}),d&&this.addTapeNode(o,e,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(b){return e[b].shape}),outputShapes:u.map(function(b){return b.shape})}),Array.isArray(m)?u:u[0]},t.prototype.makeTensor=function(n,e,r,o){if(null==n)throw new Error("Values passed to engine.makeTensor() are null");o=o||this.backend;var i=n;"string"===(r=r||"float32")&&Di(n[0])&&(i=n.map(function(l){return x2(l)}));var a=o.write(i,e,r),s=new ot(e,r,a,this.nextTensorId());if(this.incRef(s,o),"string"===r){var u=this.state.tensorInfo.get(a),c=y2(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},t.prototype.makeTensorFromDataId=function(n,e,r,o){var i=new ot(e,r=r||"float32",n,this.nextTensorId());return this.incRef(i,o),i},t.prototype.makeVariable=function(n,e,r,o){void 0===e&&(e=!0),r=r||this.nextVariableId().toString(),null!=o&&o!==n.dtype&&(n=n.asType(o));var i=new Es(n,e,r,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.incRef=function(n,e){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,"string"===n.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var o=0;"complex64"!==n.dtype&&"string"!==n.dtype&&(o=n.size*Jm(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:e||this.backend,dtype:n.dtype,shape:n.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Es||this.track(n)},t.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,"string"===n.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(n.dataId);e.refCount<=1?("complex64"!==n.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[n])},t.prototype.disposeVariable=function(n){this.disposeTensor(n),null!=this.state.registeredVariables[n.name]&&delete this.state.registeredVariables[n.name]},t.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,null==n.reasons&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},t.prototype.profile=function(n){return oe(this,void 0,void 0,function(){var e,r;return ie(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(n,e,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:e,outputs:r,saved:i},u=function yj(t){return ic.get(t)}(n);null!=u&&(o=u.gradFunc),null!=o&&(s.gradient=function(c){return c=c.map(function(l,d){if(null==l){var f=r[d],h=Ds(f.size,f.dtype);return a.makeTensor(h,f.shape,f.dtype)}return l}),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},t.prototype.keep=function(n){return n.kept=!0,n},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(n){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(e.name=n),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(n){for(var e=this,r=lv(n),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},t.prototype.gradients=function(n,e,r,o){var i=this;if(void 0===o&&(o=!1),D(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",n)});D(a instanceof ot,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var d={},f={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(_=u[h]).inputs;for(var g in p){for(var m=p[g],v=!1,b=0;b<c.length;b++)if(d[m.id]){_.outputs.forEach(function(S){return d[S.id]=!0}),v=!0,f[_.id]=!0;break}if(v)break}}var y={};y[l.id]=!0;var w={};for(h=u.length-1;h>=0;h--)for(p=(_=u[h]).inputs,b=0;b<_.outputs.length;b++)if(y[_.outputs[b].id]){for(var g in p)y[p[g].id]=!0,w[_.id]=!0;break}var x=[];for(h=0;h<u.length;h++){var _;if(f[(_=u[h]).id]&&w[_.id]){var M={};for(var g in _.inputs){var I=_.inputs[g];d[I.id]&&(M[g]=I)}var E=Object.assign({},_);E.inputs=M,E.outputs=_.outputs,x.push(E)}}return x}(this.state.activeTape,e,a);if(!o&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=r??(c=tv(ae(u=a.shape),"float32"),R.makeTensor(c,u,"float32")),function(f,h,p){for(var g=function(v){var b=h[v],y=[];if(b.outputs.forEach(function(M){var I=f[M.id];y.push(null!=I?I:null)}),null==b.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var w=b.gradient(y),x=function(M){if(!(M in w))throw new Error("Cannot backprop through input "+M+". Available gradients found: "+Object.keys(w)+".");var I=i.tidy(function(){return w[M]()});if("float32"!==I.dtype)throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+M+" must have 'float32' dtype, but has '"+I.dtype+"'");var E=b.inputs[M];if(!Lt(I.shape,E.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+M+"' has shape '"+I.shape+"', which does not match the shape of the input '"+E.shape+"'");if(null==f[E.id])f[E.id]=I;else{var S=f[E.id];f[E.id]=S.add(I),S.dispose()}};for(var _ in b.inputs)x(_)},m=h.length-1;m>=0;m--)g(m)}(l,s);var d=e.map(function(f){return l[f.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:d}})},t.prototype.customGrad=function(n){var e=this;return D(Ei(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];D(o.every(function(s){return s instanceof ot}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),e.runKernelFunc(function(s,u){return D((r=n.apply(void 0,o.concat([u]))).value instanceof ot,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),D(Ei(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];D(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),D(l.every(function(f){return f instanceof ot}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(f,h){d[h]=function(){return f}}),d})}},t.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},t.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},t.prototype.time=function(n){return oe(this,void 0,void 0,function(){var e,r;return ie(this,function(o){switch(o.label){case 0:return e=kr(),[4,this.backend.time(n)];case 1:return(r=o.sent()).wallMs=kr()-e,[2,r]}})})},t.prototype.track=function(n){return null!=this.state.activeScope&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new M2,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),R=function(){var t=function(){if(null==dv){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}dv=e}return dv}();if(null==t._tfengine){var n=new mj(t);t._tfengine=new Dj(n)}return s2=t._tfengine.ENV,so=function(){return t._tfengine},t._tfengine}();function R2(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var $o=L();$o.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),$o.registerFlag("IS_BROWSER",function(){return R2()}),$o.registerFlag("IS_NODE",function(){return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node}),$o.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),$o.registerFlag("PROD",function(){return!1}),$o.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return $o.getBool("DEBUG")}),$o.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),$o.registerFlag("IS_TEST",function(){return!1});var fc,Zn,er,sa={},fv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function T2(t,n){sa[t]=n}function uo(t){t in sa||(sa[t]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&2===o)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete sa[e]},!1),1===e?r.getContext("webgl",fv)||r.getContext("experimental-webgl",fv):r.getContext("webgl2",fv)}(t));var n=sa[t];return n.isContextLost()?(delete sa[t],uo(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),sa[t])}function Qd(t,n){return[n,t]}function hc(t){var n=ae(t);return Kd(Math.ceil(n/4))}function pc(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function hv(t,n){var e,r,o,i,a,s,u,c,l,d=t;return 2===L().getNumber("WEBGL_VERSION")?(e=d.R32F,r=d.R16F,o=d.RGBA16F,i=d.RGBA32F,a=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(e=t.RGBA,r=t.RGBA,o=t.RGBA,i=d.RGBA,a=t.RGBA,s=4,u=4,c=null!=n?n.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function re(t,n,e){var r=e();return n&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+P2(o,i))}(t),r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(fc||(fc={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Zn||(Zn={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(er||(er={}));var Ej=5.96e-8,Sj=65504;function A2(t){return!!(L().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||Ej<Math.abs(t)&&Math.abs(t)<Sj)}function P2(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function gc(t,n,e){return Go(t,n,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function k2(t,n,e){var r=Go(t,n,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(re(t,n,function(){return t.shaderSource(r,e)}),re(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function O2(t,n,e){var r=Go(t,n,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(re(t,n,function(){return t.shaderSource(r,e)}),re(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(o,i){var a=Ij.exec(i);if(null==a)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split("\n"),c=u.length.toString().length+2,l=u.map(function(m,v){return aa((v+1).toString(),c)+m}),d=0,f=0;f<l.length;f++)d=Math.max(l[f].length,d);var h=l.slice(0,s-1),p=l.slice(s-1,s),g=l.slice(s);console.log(h.join("\n")),console.log(i.split("\n")[0]),console.log("%c "+aa(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join("\n"))}(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Yd,Jd,Ij=/ERROR: [0-9]+:([0-9]+):/g;function N2(t,n){return Go(t,n,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function F2(t,n,e){if(re(t,n,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Zd(t,n,e){if(re(t,n,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function L2(t,n,e){var r=Go(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return re(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),re(t,n,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function B2(t,n,e){var r=Go(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return re(t,n,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),re(t,n,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function U2(t,n){return Go(t,n,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function V2(t,n){var e=L().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){var r="["+t+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e)throw r="["+t+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+e+"x"+e+"].")}function j2(t,n){return Go(t,n,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function pv(t,n,e,r,o,i,a,s){var u=t.getAttribLocation(e,r);return-1!==u&&(re(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),re(t,n,function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)}),re(t,n,function(){return t.enableVertexAttribArray(u)}),!0)}function H2(t,n,e,r){q2(t,r),re(t,n,function(){return t.activeTexture(t.TEXTURE0+r)}),re(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function W2(t,n,e,r){return Go(t,n,function(){return t.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function z2(t,n,e){return t.getUniformLocation(n,e)}function $2(t,n,e,r,o,i){re(t,n,function(){return H2(t,n,r,i)}),re(t,n,function(){return t.uniform1i(o,i)})}function ef(t,n,e,r){re(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),re(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function gv(t,n,e){re(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),re(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function mc(t){var n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+G2(t,n))}function G2(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function Go(t,n,e,r){var o=re(t,n,function(){return e()});if(null==o)throw new Error(r);return o}function q2(t,n){var e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+e+"].")}function vc(t,n){return void 0===n&&(n=2),ae(t.slice(0,t.length-n))}function yc(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function tf(t){var n=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(n=[vc(t)].concat(yc(t))),n}function K2(t,n){var e;void 0===n&&(n=!1);var r=L().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,1===(t=t.map(function(c,l){return l>=t.length-2?Qm(t[l]):t[l]})).length&&(t=[2,t[0]])),2!==t.length){var o=Ci(t);t=o.newShape}var i=ae(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(n){var a=vc(t),s=2,u=2;return t.length&&(s=(e=yc(t))[0],u=e[1]),Kd(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return Kd(i)}function nf(t){return t%2==0}function bc(t,n){if(Lt(t=t.slice(-2),n=n.slice(-2))||!t.length||!n.length||0===t[0]||0===t[1]||0===n[0]||0===n[1])return!0;if(t.length!==n.length){var e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||nf(e)&&nf(r)&&(1===t[0]||1===n[0]))return!0}return t[1]===n[1]&&nf(t[0])&&nf(n[0])}function X2(t){if(null==Yd){var n=uo(t);Yd=n.getParameter(n.MAX_TEXTURE_SIZE)}return Yd}function Q2(t){if(null==Jd){var n=uo(t);Jd=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Jd)}function Y2(t){if(0===t)return 0;var n=uo(t);return tr(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:tr(n,"EXT_disjoint_timer_query")?1:0}function tr(t,n){return null!=t.getExtension(n)}function mv(t){try{if(null!=uo(t))return!0}catch{return!1}return!1}function J2(t){if(0===t)return!1;var n=uo(t);if(1===t){if(!tr(n,"OES_texture_float"))return!1}else if(!tr(n,"EXT_color_buffer_float"))return!1;return vv(n)}function Z2(t){if(0===t)return!1;var n=uo(t);if(1!==t){if(tr(n,"EXT_color_buffer_float"))return vv(n);if(tr(n,"EXT_color_buffer_half_float")){var e=n.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=hv(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(n,e)}return!1}return!!tr(n,"OES_texture_float")&&!!tr(n,"WEBGL_color_buffer_float")&&vv(n)}function vv(t){var n=hv(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(r),o}function eS(t){return 2===t&&null!=uo(t).fenceSync}var Mj=Object.freeze({callAndCheck:re,canBeRepresented:A2,getWebGLErrorMessage:P2,getExtensionOrThrow:gc,createVertexShader:k2,createFragmentShader:O2,createProgram:N2,linkProgram:F2,validateProgram:Zd,createStaticVertexBuffer:L2,createStaticIndexBuffer:B2,getNumChannels:function(){return 2===L().getNumber("WEBGL_VERSION")?1:4},createTexture:U2,validateTextureSize:V2,createFramebuffer:j2,bindVertexBufferToProgramAttribute:pv,bindTextureUnit:H2,unbindTextureUnit:function(t,n,e){q2(t,e),re(t,n,function(){return t.activeTexture(t.TEXTURE0+e)}),re(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:W2,getProgramUniformLocation:z2,bindTextureToProgramUniformSampler:$2,bindCanvasToFramebuffer:function(t,n){re(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),re(t,n,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),re(t,n,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:ef,unbindColorTextureFromFramebuffer:gv,validateFramebuffer:mc,getFramebufferErrorMessage:G2,getBatchDim:vc,getRowsCols:yc,getShapeAs3D:tf,getTextureShapeFromLogicalShape:K2,isReshapeFree:bc,getWebGLMaxTextureSize:X2,resetMaxTextureSize:function(){Yd=null},resetMaxTexturesInShader:function(){Jd=null},getMaxTexturesInShader:Q2,getWebGLDisjointQueryTimerVersion:Y2,hasExtension:tr,isWebGLVersionEnabled:mv,isCapableOfRenderingToFloatTexture:J2,isDownloadFloatTextureEnabled:Z2,isWebGLFenceEnabled:eS}),xe=L();function tS(t){L().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ne(t,n){return R.tidy(t,n)}function Ln(t){lv(t).forEach(function(n){return n.dispose()})}function rf(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];L().getBool("IS_TEST")||console.warn.apply(console,t)}function co(t,n){var e=t;if(on(t))return"string"===n?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(e)||on(e)&&"string"!==n;)r.push(e.length),e=e[0];return Array.isArray(t)&&L().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],Array.isArray(i)||on(i)){D(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),D(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))}else D(0===a.length,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"})}(t,r,[]),r}function nS(t,n,e,r){if(null!=t&&("numeric"!==t&&t!==n||"numeric"===t&&"string"===n))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+t+" tensor, but got "+n+" tensor")}function C(t,n,e,r){if(void 0===r&&(r="numeric"),t instanceof ot)return nS(r,t.dtype,n,e),t;var o=Cs(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),nS(r,o,n,e),null==t||!on(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+n+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+(null==t?"null":t.constructor.name)+"'");var a=co(t,o);on(t)||Array.isArray(t)||(t=[t]);var s="string"!==o?Zm(t,o,L().getBool("DEBUG")):zo(t,[],!0);return R.makeTensor(s,a,o)}function wc(t,n,e,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+n+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(o,i){return C(o,n+"["+i+"]",e)},r)}function yv(t,n){for(var e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function rS(t,n,e){for(var r=t.length+n.length,o=[],i=0,a=0,s=0;s<r;s++)-1===e.indexOf(s)?o.push(t[i++]):o.push(n[a++]);return o}function an(t,n){for(var e=[],r=t.length,o=0;o<r;o++)-1===n.indexOf(o)&&e.push(t[o]);return[e,n.map(function(i){return t[i]})]}function Rn(t,n){return rS(t,n.map(function(e){return 1}),n)}function Bn(t,n,e){D(yv(n,e),function(){return t+" supports only inner-most axes for now. Got axes "+n+" and rank-"+e+" input."})}function Or(t,n){if(yv(t,n))return null;for(var e=[],r=0;r<n;++r)-1===t.indexOf(r)&&e.push(r);return t.forEach(function(o){return e.push(o)}),e}function af(t){return t.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function Nr(t,n){for(var e=[],r=n-t;r<n;++r)e.push(r);return e}function oS(t,n){var e=t[0].length;t.forEach(function(o,i){D(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),D(n>=0&&n<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=t[0];t.forEach(function(o,i){for(var a=0;a<e;a++)D(a===n||o[a]===r[a],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function ua(t,n){for(var e=t[0].slice(),r=1;r<t.length;r++)e[n]+=t[r][n];return e}function T(t){var n=Object.keys(t);if(1!==n.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];R.startScope(e);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),R.endScope(s),s}catch(u){throw R.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}xe.registerFlag("HAS_WEBGL",function(){return xe.getNumber("WEBGL_VERSION")>0}),xe.registerFlag("WEBGL_VERSION",function(){return mv(2)?2:mv(1)?1:0}),xe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===xe.get("WEBGL_VERSION")}),xe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),xe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),xe.registerFlag("WEBGL_PACK",function(){return xe.getBool("HAS_WEBGL")}),xe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_CLIP",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),xe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_REDUCE",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_CONV_IM2COL",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return X2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Q2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=xe.getNumber("WEBGL_VERSION");return 0===t?0:Y2(t)}),xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return xe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),xe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return J2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!xe.getBool("WEBGL_FORCE_F16_TEXTURES")&&xe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),xe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Z2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return eS(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return xe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),E2=tS;var sn=T({complex_:function(t,n){var e=C(t,"real","complex"),r=C(n,"imag","complex");return ze(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),R.runKernelFunc(function(o){return o.complex(e,r)},{$real:e,$imag:r})}}),mr=T({real_:function(t){var n=C(t,"input","real");return R.runKernelFunc(function(e){return e.real(n)},{$input:n})}}),lo=T({imag_:function(t){var n=C(t,"input","imag");return R.runKernelFunc(function(e){return e.imag(n)},{$input:n})}});function un(t,n,e){return Si(t,n,co(t,e),e)}function Si(t,n,e,r){if(null==r&&(r=Cs(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!on(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=n){nv(n);var o=ae(n),i=ae(e);D(o===i,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<e.length;++a){var u=a!==e.length-1||e[a]!==ae(n.slice(a));D(e[a]===n[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+n+"). "})}}return on(t)||Array.isArray(t)||(t=[t]),n=n||e,t="string"!==r?Zm(t,r,L().getBool("DEBUG")):zo(t,[],!0),R.makeTensor(t,n,r)}function Y(t,n){if((on(t)&&"string"!==n||Array.isArray(t))&&"complex64"!==n)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===n&&on(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Si(t,[],[],n)}function Ut(t,n){ia(t);var e=co(t,n);if(1!==e.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Si(t,null,e,n)}function Ii(t,n,e){if(ia(t),null!=n&&2!==n.length)throw new Error("tensor2d() requires shape to have two numbers");var r=co(t,e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Si(t,n,r,e)}function bv(t,n,e){if(ia(t),null!=n&&3!==n.length)throw new Error("tensor3d() requires shape to have three numbers");var r=co(t,e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Si(t,n,r,e)}function Un(t,n,e){if(ia(t),null!=n&&4!==n.length)throw new Error("tensor4d() requires shape to have four numbers");var r=co(t,e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Si(t,n,r,e)}function Ss(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=Ss(t,"float32"),r=ht(t,"float32");return sn(e,r)}var o=tv(ae(t),n);return R.makeTensor(o,t,n)}function ht(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=ht(t,"float32"),r=ht(t,"float32");return sn(e,r)}var o=Ds(ae(t),n);return R.makeTensor(o,t,n)}function fo(t,n,e){return R.runKernelFunc(function(r){return r.fill(t,n,e)},{})}function sf(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r="float32"),0===e)throw new Error("Cannot have a step of zero");if(t===n||t<n&&e<0||n<t&&e>1)return ht([0],r);var o=Ds(Math.abs(Math.ceil((n-t)/e)),r);n<t&&1===e&&(e=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+e;return Ut(o,r)}var iS=T({onesLike_:function(t){var n=C(t,"x","onesLike");if("complex64"===n.dtype){var e=iS(mr(n)),r=$e(lo(n));return sn(e,r)}return R.runKernelFunc(function(o){return o.onesLike(n)},{$x:n},function(o,i){return{$x:function(){return $e(o)}}})}}),$e=T({zerosLike_:function(t){var n=C(t,"x","zerosLike");return R.runKernelFunc(function(e){return e.zerosLike(n)},{$x:n},function(e,r){return{$x:function(){return $e(e)}}})}}),Gt=T({concat_:function(t,n){void 0===n&&(n=0),D(t.length>=1,function(){return"Pass at least one tensor to concat"});var e=wc(t,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(s){if("complex64"!==s.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+s.dtype+". ")}),n=Bt(n,e[0].shape)[0];var r=ua(e.map(function(s){return s.shape}),n);if(0===ae(r))return un([],r);if(1===(e=e.filter(function(s){return s.size>0})).length)return e[0];var o=e.map(function(s){return s.shape});return oS(o,n),R.runKernelFunc(function(s){return s.concat(e,n)},e,function(s){var u=o.map(function(c){return c[n]});return wv(s,u,n).map(function(c){return function(){return c}})},"Concat",{axis:n})}}),Oj=T({concat1d_:function(t){return Gt(t,0)}}),Nj=T({concat2d_:function(t,n){return Gt(t,n)}}),Fj=T({concat3d_:function(t,n){return Gt(t,n)}}),Lj=T({concat4d_:function(t,n){return Gt(t,n)}}),wv=T({split_:function(t,n,e){void 0===e&&(e=0);var r,o=C(t,"x","split");return e=Bt(e,o.shape)[0],"number"==typeof n?(D(o.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(n).fill(o.shape[e]/n)):(D(o.shape[e]===n.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=n),R.runKernelFunc(function(i){return i.split(o,r,e)},{$x:o},function(i){return{$x:function(){return Gt(i,e)}}})}});function ca(t,n){return t(n={exports:{}},n.exports),n.exports}typeof globalThis<"u"||typeof window<"u"||typeof global<"u"&&global;var Bj=ca(function(t){!function(n,e,r){function o(s){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var d=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.alea=a}(0,t)}),Uj=ca(function(t){!function(n,e,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor128=a}(0,t)}),Vj=ca(function(t){!function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorwow=a}(0,t)}),jj=ca(function(t){!function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.x,f=u.i;return c=d[f],l=(c^=c>>>7)^c<<24,l^=(c=d[f+1&7])^c>>>10,l^=(c=d[f+3&7])^c>>>3,l^=(c=d[f+4&7])^c<<7,c=d[f+7&7],l^=(c^=c<<13)^c<<9,d[f]=l,u.i=f+1&7,l},function(c,l){var d,f=[];if(l===(0|l))f[0]=l;else for(l=""+l,d=0;d<l.length;++d)f[7&d]=f[7&d]<<15^l.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&0===f[d];++d);for(8==d&&(f[7]=-1),c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.x&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorshift7=a}(0,t)}),Hj=ca(function(t){!function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,l=f[h+34&127],c=f[h=h+1&127],l^=l<<13,c^=c<<17,l=f[h]=(l^=l>>>15)^(c^=c>>>12),u.i=h,l+(d^d>>>16)|0},function(c,l){var d,f,h,p,g,m=[],v=128;for(l===(0|l)?(f=l,l=null):(l+="\0",f=0,v=Math.max(v,l.length)),h=0,p=-32;p<v;++p)l&&(f^=l.charCodeAt((p+32)%l.length)),0===p&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(h=0==(d=m[127&p]^=f+(g=g+1640531527|0))?h+1:0);for(h>=128&&(m[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)f=m[h+34&127],d=m[h=h+1&127],f^=f<<13,d^=d<<17,m[h]=(f^=f>>>15)^(d^=d>>>12);c.w=g,c.X=m,c.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.X&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor4096=a}(0,t)}),Wj=ca(function(t){!function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.tychei=a}(0,t)}),la=ca(function(t){!function(n,e){var r,o=this,i=256,a=6,s="random",u=e.pow(i,a),c=e.pow(2,52),l=2*c,d=i-1;function f(v,b,y){var w=[],x=g(function I(E,S){var P,A=[],V=typeof E;if(S&&"object"==V)for(P in E)try{A.push(I(E[P],S-1))}catch{}return A.length?A:"string"==V?E:E+"\0"}((b=1==b?{entropy:!0}:b||{}).entropy?[v,m(n)]:v??function(){try{var I;return r&&(I=r.randomBytes)?I=I(i):(I=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(I)),m(I)}catch{var E=o.navigator,S=E&&E.plugins;return[+new Date,o,S,o.screen,m(n)]}}(),3),w),_=new h(w),M=function(){for(var I=_.g(a),E=u,S=0;I<c;)I=(I+S)*i,E*=i,S=_.g(1);for(;I>=l;)I/=2,E/=2,S>>>=1;return(I+S)/E};return M.int32=function(){return 0|_.g(4)},M.quick=function(){return _.g(4)/4294967296},M.double=M,g(m(_.S),n),(b.pass||y||function(I,E,S,P){return P&&(P.S&&p(P,_),I.state=function(){return p(_,{})}),S?(e[s]=I,E):I})(M,x,"global"in b?b.global:this==e,b.state)}function h(v){var b,y=v.length,w=this,x=0,_=w.i=w.j=0,M=w.S=[];for(y||(v=[y++]);x<i;)M[x]=x++;for(x=0;x<i;x++)M[x]=M[_=d&_+v[x%y]+(b=M[x])],M[_]=b;(w.g=function(I){for(var E,S=0,P=w.i,A=w.j,V=w.S;I--;)E=V[P=d&P+1],S=S*i+V[d&(V[P]=V[A=d&A+E])+(V[A]=E)];return w.i=P,w.j=A,S})(i)}function p(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function g(v,b){for(var y,w=v+"",x=0;x<w.length;)b[d&x]=d&(y^=19*b[d&x])+w.charCodeAt(x++);return m(b)}function m(v){return String.fromCharCode.apply(0,v)}if(e["seed"+s]=f,g(e.random(),n),t.exports){t.exports=f;try{r=Gs(369)}catch{}}}([],Math)});la.alea=Bj,la.xor128=Uj,la.xorwow=Vj,la.xorshift7=jj,la.xor4096=Hj,la.tychei=Wj;var uf=la.alea,xv=function(){function t(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=uf(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var e,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do{s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(s>=1||0===s);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},t.prototype.convertValue=function(n){return null==this.dtype||"float32"===this.dtype?n:Math.round(n)},t.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},t}(),zj=function(){function t(n,e,r,o){this.alpha=n,this.beta=1/e,this.dtype=r;var i=o||Math.random();this.randu=uf(i.toString()),this.randn=new xv(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var n,e,r,o,i,a;;){do{o=this.randn.nextValue(),a=1+this.c*o}while(a<=0);if(e=1-.331*(n=o*o)*n,r=.5*n+this.d*(1-(a*=a*a)+Math.log(a)),(i=this.randu())<e||Math.log(i)<r)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(n){return"float32"===this.dtype?n:Math.round(n)},t}(),$j=function(){function t(n,e,r,o){var i=this;if(void 0===n&&(n=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=n,this.range=e-n,this.dtype=r,null==o&&(o=Math.random()),"number"==typeof o&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+e+" <= 1 and dtype is not float");this.random=uf(o)}return t.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Se(t,n,e){return void 0===n&&(n="float32"),n=n||"float32",nv(t),new dc(t,n,e)}var aS=T({batchToSpaceND_:function(t,n,e){var r=C(t,"x","batchToSpaceND"),o=n.reduce(function(i,a){return i*a});return D(r.rank>=1+n.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length}),D(e.length===n.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+n.length}),D(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o}),R.runKernelFunc(function(i){return i.batchToSpaceND(r,n,e)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(n,e)}}})}}),qj=T({broadcastTo_:function(t,n){var e=C(t,"broadcastTo","x"),r=e.shape;if(n.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<e.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+e.rank+".");if(n.length>e.rank){for(var o=e.shape.slice();o.length<n.length;)o.unshift(1);e=e.reshape(o)}for(var i=Array.from(n),a=n.length-1;a>=0;a--)if(e.shape[a]===n[a])i[a]=1;else if(1!==e.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var s=i.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return 0===s.length?e.clone():R.runKernelFunc(function(u){return u.tile(e,i)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),Kj=T({cast_:function(t,n){var e=C(t,"x","cast");if(!m2(n))throw new Error("Failed to cast to unknown dtype "+n);if("string"===n&&"string"!==e.dtype||"string"!==n&&"string"===e.dtype)throw new Error("Only strings can be casted to strings");return R.runKernelFunc(function(o){return o.cast(e,n)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",{dtype:n})}}),Xj=T({clone_:function(t){var n=C(t,"x","clone",null);return R.runKernelFunc(function(){return R.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(e){return{$x:function(){return e.toFloat()}}})}}),Qj=T({cumsum_:function(t,n,e,r){void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1);var o=C(t,"x","cumsum"),i=Or([n|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Nr(1,o.rank)[0],u=R.runKernelFunc(function(c){return c.cumsum(a,s,e,r)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(n,e,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),Yj=T({depthToSpace_:function(t,n,e){void 0===e&&(e="NHWC");var r=C(t,"x","depthToSpace"),o="NHWC"===e?r.shape[1]:r.shape[2],i="NHWC"===e?r.shape[2]:r.shape[3],a="NHWC"===e?r.shape[3]:r.shape[1];return D(o*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+n+"  for depthToSpace with input shape\n      "+r.shape}),D(i*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+n+" for depthToSpace with input shape\n          "+r.shape}),D(a%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape}),R.runKernelFunc(function(s){return s.depthToSpace(r,n,e)},{$x:r})}}),vr=T({expandDims_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","expandDims",null);D(n<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return n<0&&(D(-(e.rank+1)<=n,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),n=e.rank+n+1),r.splice(n,0,1),Fr(e,r)}}),sS=T({eye_:function(t,n,e,r){void 0===r&&(r="float32"),null==n&&(n=t);for(var o=Se([t,n],r),i=t<=n?t:n,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,n);if(null==e)return s;if(1===e.length)return Is(vr(s,0),[e[0],1,1]);if(2===e.length)return Is(vr(vr(s,0),0),[e[0],e[1],1,1]);if(3===e.length)return Is(vr(vr(vr(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),Jj=T({multinomial_:function(t,n,e,r){void 0===r&&(r=!1);var o=C(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);e=e||Math.random();var s=1===a?o.as2D(1,-1):o,u=R.runKernelFunc(function(c){return c.multinomial(s,r,n,e)},{logits2D:s});return 1===a?u.as1D():u}}),_v=T({oneHot_:function(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var o=C(t,"indices","oneHot","int32"),i=o.shape.concat([n]);return o=o.flatten(),R.runKernelFunc(function(a){return a.oneHot(o,n,e,r)},{$indices:o},function(a){return{$indices:function(){return ht(o.shape,"float32")}}}).reshape(i)}}),da=T({pad_:function(t,n,e){void 0===e&&(e=0);var r=C(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return R.runKernelFunc(function(i){return i.pad(r,n,e)},{x:r},function(i){var a=n.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",{paddings:n,constantValue:e})}}),Zj=T({pad1d_:function(t,n,e){return void 0===e&&(e=0),D(2===n.length,function(){return"Invalid number of paddings. Must be length of 2."}),da(t,[n],e)}}),eH=T({pad2d_:function(t,n,e){return void 0===e&&(e=0),D(2===n.length&&2===n[0].length&&2===n[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),da(t,n,e)}}),tH=T({pad3d_:function(t,n,e){return void 0===e&&(e=0),D(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),da(t,n,e)}}),nH=T({pad4d_:function(t,n,e){return void 0===e&&(e=0),D(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),da(t,n,e)}}),rH=T({rand_:function(t,n,e){var r=ae(t),o=null;if(null==e||"float32"===e)o=new Float32Array(r);else if("int32"===e)o=new Int32Array(r);else{if("bool"!==e)throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=n();return R.makeTensor(o,t,e)}}),oH=T({randomNormal_:function(t,n,e,r,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new xv(n,e,r,!1,o),a=Se(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),iH=T({randomGamma_:function(t,n,e,r,o){if(void 0===e&&(e=1),void 0===r&&(r="float32"),null==e&&(e=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new zj(n,e,r,o),a=Se(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),uS=T({randomUniform_:function(t,n,e,r,o){void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r="float32");for(var i=Se(t,r),a=new $j(n,e,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Fr=T({reshape_:function(t,n){var e=C(t,"x","reshape",null);return n=p2(n,e.size),D(e.size===ae(n),function(){return"new shape and old shape must have the same number of elements."}),R.runKernelFunc(function(o){return o.reshape(e,n)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",{shape:n})}}),cS=T({spaceToBatchND_:function(t,n,e){var r=C(t,"x","spaceToBatchND");return D(r.rank>=1+n.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length}),D(e.length===n.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+n.length}),D(r.shape.reduce(function(o,i,a){return a>0&&a<=n.length?o&&(i+e[a-1][0]+e[a-1][1])%n[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+n.toString()}),R.runKernelFunc(function(o){return o.spaceToBatchND(r,n,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(n,e)}}})}}),lS=T({squeeze_:function(t,n){var e=C(t,"x","squeeze");return Fr(e,Ci(e.shape,n).newShape)}}),nr=T({stack_:function(t,n){void 0===n&&(n=0);var e=wc(t,"tensors","stack");if(D(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(n);var o=e[0].shape,i=e[0].dtype;D(n<=e[0].rank,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){ze(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){D(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(s){return s.expandDims(n)});return Gt(a,n)}}),Is=T({tile_:function(t,n){var e=C(t,"x","tile",null);return D(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."}),R.runKernelFunc(function(i,a){var s=i.tile(e,n);return a([e]),s},{x:e},function(i,a){var s=a[0];return{x:function(){var u=$e(s);if(1===s.rank)for(var c=0;c<n[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(2===s.rank)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(3===s.rank)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var d=0;d<n[2];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(4!==s.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(d=0;d<n[2];++d)for(var f=0;f<n[3];++f)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",{reps:n},[e])}}),aH=T({truncatedNormal_:function(t,n,e,r,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new xv(n,e,r,!0,o),a=Se(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),qt=T({unstack_:function(t,n){void 0===n&&(n=0),n=n||0;var e=C(t,"x","unstack");return D(n>=-e.shape.length&&n<e.shape.length,function(){return"Axis = "+n+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),n<0&&(n+=e.shape.length),R.runKernelFunc(function(o){return o.unstack(e,n)},{x:e},function(o){return{x:function(){return nr(o,n)}}},"Unpack",{axis:n})}});function cf(t,n,e,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(n.slice(0))).push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=n.length,a=0;a<i;++a)o=o.concat([t[a+1]/n[a],n[a]]);o=o.concat(t.slice(i+1))}return o}function lf(t,n,e){void 0===e&&(e=!0);var r=[];if(e){r.push(n);for(var o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*n+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function df(t,n,e,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/e:t[0]*e);for(var i=1;i<t.length;++i)o.push(i<=n.length?r?n[i-1]*t[i]:t[i]/n[i-1]:t[i]);return o}function dS(t,n){for(var e=[0],r=0;r<n;++r)e.push(t[r][0]);return e}function fS(t,n,e){for(var r=t.slice(0,1),o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}function Cv(t,n){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==n.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var e=n.shape,r=e[e.length-1],o=1,i=0;i<e.length-1;++i)o*=e[i];var a=t.shape,s=e.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var c=Pr(t.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[s,o,u,c]}Object.freeze({prepareAndValidate:Cv});var Dv=30;function ff(t){return t<=Dv?t:Xd(t,Math.floor(Math.sqrt(t)))}function hS(t,n,e){var r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+n.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(e.rank-o))throw new Error(i+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(e.shape[a]!==n.shape[a])throw new Error(i+" updates.shape["+a+"] ("+e.shape[a]+") != indices.shape["+a+"] ("+n.shape[a]+").");for(a=0;a<e.rank-o;++a)if(e.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+e.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}function pS(t,n,e){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==n.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(0===e.length){if(0===n.size)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}hS(e,n,t)}function xc(t,n,e){for(var r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,a=1,s=o;s<i;++s)a*=e[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ae(n.shape)/u,sliceSize:a,strides:Pr(e.slice(0,o)).concat([1]),outputSize:ae(e)}}function gS(t,n,e){D(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+n+" must match the rank of the array ("+t.rank+")."}),D(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of size "+e+" must match the rank of the array ("+t.rank+")."});for(var r=function(i){D(n[i]+e[i]<=t.shape[i],function(){return"Error in slice"+t.rank+"D: begin["+i+"] + size["+i+"] ("+(n[i]+e[i])+") would overflow input.shape["+i+"] ("+t.shape[i]+")"})},o=0;o<t.rank;++o)r(o)}function Ev(t){for(var n=[],e=0;t>0;)1&t&&n.push(e),t/=2,e++;return n}function hf(t,n,e){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function mS(t,n,e,r,o){var i=n[o];(t&1<<o||null==i)&&(i=(e[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),qd(0,i,s-1)}function vS(t,n,e,r,o){var i=n[o],a=e[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?qd(0,i,s):qd(-1,i,s-1)}function Sv(t,n,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function Iv(t,n){for(var e=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function pf(t){return R.customGrad(t)}Object.freeze({validateUpdateShape:hS,validateInput:pS,calculateShapes:xc}),Object.freeze({assertParamsValid:gS,maskToAxes:Ev,computeOutShape:hf,startForAxis:mS,stopForAxis:vS,isSliceContinous:Sv,computeFlatOffset:Iv});var qo=T({softmax_:function(t,n){void 0===n&&(n=-1);var e=C(t,"logits","softmax","float32");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+n);return R.runKernelFunc(function(r,o){var i=r.softmax(e,n);return o([i]),i},{logits:e},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([n],!0).mul(i))}}},"Softmax",{dim:n},[],[!0])}}),cH=T({logSoftmax_:function(t,n){void 0===n&&(n=-1);var e=C(t,"logits","logSoftmax");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+n);return pf(function(r,o){var i=r.max(n,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(n,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}})(e)}}),yS=function(){function t(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},t.prototype.set=function(n,e){this.dataIdsCount++,this.data.set(n,e)},t.prototype.has=function(n){return this.data.has(n)},t.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),bS=function(){function t(){}return t.prototype.time=function(n){return k("time")},t.prototype.read=function(n){return k("read")},t.prototype.readSync=function(n){return k("readSync")},t.prototype.numDataIds=function(){return k("numDataIds")},t.prototype.disposeData=function(n){return k("disposeData")},t.prototype.write=function(n,e,r){return k("write")},t.prototype.move=function(n,e,r,o){return k("move")},t.prototype.memory=function(){return k("memory")},t.prototype.floatPrecision=function(){return k("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(n,e,r,o){return k("batchMatMul")},t.prototype.fusedBatchMatMul=function(n){return k("fusedBatchMatMul")},t.prototype.slice=function(n,e,r){return k("slice")},t.prototype.stridedSlice=function(n,e,r,o){return k("stridedSlice")},t.prototype.unstack=function(n,e){return k("unstack")},t.prototype.reverse=function(n,e){return k("reverse")},t.prototype.concat=function(n,e){return k("concat")},t.prototype.neg=function(n){return k("neg")},t.prototype.add=function(n,e){return k("add")},t.prototype.addN=function(n){return k("addN")},t.prototype.subtract=function(n,e){return k("subtract")},t.prototype.multiply=function(n,e){return k("multiply")},t.prototype.realDivide=function(n,e){return k("realDivide")},t.prototype.floorDiv=function(n,e){return k("floorDiv")},t.prototype.sum=function(n,e){return k("sum")},t.prototype.prod=function(n,e){return k("prod")},t.prototype.unsortedSegmentSum=function(n,e,r){return k("unsortedSegmentSum")},t.prototype.argMin=function(n,e){return k("argMin")},t.prototype.argMax=function(n,e){return k("argMax")},t.prototype.equal=function(n,e){return k("equal")},t.prototype.notEqual=function(n,e){return k("notEqual")},t.prototype.less=function(n,e){return k("less")},t.prototype.lessEqual=function(n,e){return k("lessEqual")},t.prototype.greater=function(n,e){return k("greater")},t.prototype.greaterEqual=function(n,e){return k("greaterEqual")},t.prototype.logicalNot=function(n){return k("logicalNot")},t.prototype.logicalAnd=function(n,e){return k("logicalAnd")},t.prototype.logicalOr=function(n,e){return k("logicalOr")},t.prototype.where=function(n){return k("where")},t.prototype.select=function(n,e,r){return k("select")},t.prototype.topk=function(n,e,r){return k("topk")},t.prototype.min=function(n,e){return k("min")},t.prototype.minimum=function(n,e){return k("minimum")},t.prototype.mod=function(n,e){return k("mod")},t.prototype.max=function(n,e){return k("max")},t.prototype.maximum=function(n,e){return k("maximum")},t.prototype.all=function(n,e){return k("all")},t.prototype.any=function(n,e){return k("any")},t.prototype.squaredDifference=function(n,e){return k("squaredDifference")},t.prototype.ceil=function(n){return k("ceil")},t.prototype.floor=function(n){return k("floor")},t.prototype.round=function(n){return k("round")},t.prototype.sign=function(n){return k("sign")},t.prototype.isNaN=function(n){return k("isNaN")},t.prototype.isInf=function(n){return k("isInf")},t.prototype.isFinite=function(n){return k("isFinite")},t.prototype.pow=function(n,e){return k("pow")},t.prototype.exp=function(n){return k("exp")},t.prototype.expm1=function(n){return k("expm1")},t.prototype.softmax=function(n,e){return k("softmax")},t.prototype.log=function(n){return k("log")},t.prototype.log1p=function(n){return k("log1p")},t.prototype.sqrt=function(n){return k("sqrt")},t.prototype.rsqrt=function(n){return k("rsqrt")},t.prototype.square=function(n){return k("square")},t.prototype.reciprocal=function(n){return k("reciprocal")},t.prototype.relu=function(n){return k("relu")},t.prototype.relu6=function(n){return k("relu6")},t.prototype.prelu=function(n,e){return k("prelu")},t.prototype.elu=function(n){return k("elu")},t.prototype.eluDer=function(n,e){return k("eluDer")},t.prototype.selu=function(n){return k("selu")},t.prototype.int=function(n){return k("int")},t.prototype.clip=function(n,e,r){return k("clip")},t.prototype.abs=function(n){return k("abs")},t.prototype.complexAbs=function(n){return k("complexAbs")},t.prototype.sigmoid=function(n){return k("sigmoid")},t.prototype.softplus=function(n){return k("softplus")},t.prototype.sin=function(n){return k("sin")},t.prototype.cos=function(n){return k("cos")},t.prototype.tan=function(n){return k("tan")},t.prototype.asin=function(n){return k("asin")},t.prototype.acos=function(n){return k("acos")},t.prototype.atan=function(n){return k("atan")},t.prototype.atan2=function(n,e){return k("atan2")},t.prototype.sinh=function(n){return k("sinh")},t.prototype.cosh=function(n){return k("cosh")},t.prototype.tanh=function(n){return k("tanh")},t.prototype.asinh=function(n){return k("asinh")},t.prototype.acosh=function(n){return k("acosh")},t.prototype.atanh=function(n){return k("atanh")},t.prototype.erf=function(n){return k("erf")},t.prototype.step=function(n,e){return k("step")},t.prototype.fusedConv2d=function(n){return k("fusedConv2d")},t.prototype.conv2d=function(n,e,r){return k("conv2d")},t.prototype.conv2dDerInput=function(n,e,r){return k("conv2dDerInput")},t.prototype.conv2dDerFilter=function(n,e,r){return k("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(n){return k("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(n,e,r){return k("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(n,e,r){return k("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(n,e,r){return k("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(n,e,r){return k("conv3d")},t.prototype.conv3dDerInput=function(n,e,r){return k("conv3dDerInput")},t.prototype.conv3dDerFilter=function(n,e,r){return k("conv3dDerFilter")},t.prototype.maxPool=function(n,e){return k("maxPool")},t.prototype.maxPoolBackprop=function(n,e,r,o){return k("maxPoolBackprop")},t.prototype.avgPool=function(n,e){return k("avgPool")},t.prototype.avgPoolBackprop=function(n,e,r){return k("avgPoolBackprop")},t.prototype.avgPool3d=function(n,e){return k("avgPool3d")},t.prototype.avgPool3dBackprop=function(n,e,r){return k("avgPool3dBackprop")},t.prototype.maxPool3d=function(n,e){return k("maxPool3d")},t.prototype.maxPool3dBackprop=function(n,e,r,o){return k("maxPool3dBackprop")},t.prototype.reshape=function(n,e){return k("reshape")},t.prototype.cast=function(n,e){return k("cast")},t.prototype.tile=function(n,e){return k("tile")},t.prototype.pad=function(n,e,r){return k("pad")},t.prototype.transpose=function(n,e){return k("transpose")},t.prototype.gather=function(n,e,r){return k("gather")},t.prototype.gatherND=function(n,e){return k("gatherND")},t.prototype.scatterND=function(n,e,r){return k("scatterND")},t.prototype.batchToSpaceND=function(n,e,r){return k("batchToSpaceND")},t.prototype.spaceToBatchND=function(n,e,r){return k("spaceToBatchND")},t.prototype.resizeBilinear=function(n,e,r,o){return k("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(n,e,r){return k("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(n,e,r,o){return k("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(n,e,r){return k("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(n,e,r,o,i,a){return k("batchNormalization")},t.prototype.localResponseNormalization4D=function(n,e,r,o,i){return k("localResponseNormalization4D")},t.prototype.LRNGrad=function(n,e,r,o,i,a,s){return k("LRNGrad")},t.prototype.multinomial=function(n,e,r,o){return k("multinomial")},t.prototype.oneHot=function(n,e,r,o){return k("oneHot")},t.prototype.cumsum=function(n,e,r,o){return k("cumsum")},t.prototype.nonMaxSuppression=function(n,e,r,o,i){return k("nonMaxSuppression")},t.prototype.fft=function(n){return k("fft")},t.prototype.ifft=function(n){return k("ifft")},t.prototype.complex=function(n,e){return k("complex")},t.prototype.real=function(n){return k("real")},t.prototype.imag=function(n){return k("imag")},t.prototype.cropAndResize=function(n,e,r,o,i,a){return k("cropAndResize")},t.prototype.depthToSpace=function(n,e,r){return k("depthToSpace")},t.prototype.split=function(n,e,r){return k("split")},t.prototype.sparseToDense=function(n,e,r,o){return k("sparseToDense")},t.prototype.diag=function(n){return k("diag")},t.prototype.fill=function(n,e,r){return k("fill")},t.prototype.onesLike=function(n){return k("onesLike")},t.prototype.zerosLike=function(n){return k("zerosLike")},t.prototype.linspace=function(n,e,r){return k("linspace")},t.prototype.dispose=function(){return k("dispose")},t}();function k(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ko(t,n){for(var e=t.length,r=[],o=0;o<e;o++){var i=e-1-o;(n[n.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function Vt(t,n){for(var e=[],r=0;r<n.length;r++){var o=t[t.length-r-1],i=n.length-r-1;(null==o||1===o&&n[i]>1)&&e.unshift(i)}return e}function Le(t,n){for(var e=[],r=Math.max(t.length,n.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=n[n.length-o-1];if(null==a&&(a=1),1===i)e.unshift(a);else if(1===a)e.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+n+".");e.unshift(i)}}return e}function Ms(t,n,e,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=mf(n),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return Mi(t,s,e,r,o,i,!1,a)}function _c(t,n,e,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=Rv(n),l=c[0],d=c[1],f=c[2];if("NDHWC"===a)u="channelsLast",s=[l,d,f,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,d,f,t[1],t[1]]}return Cc(t,s,e,r,o,!1,u,i)}function Mi(t,n,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3];if("channelsLast"===s)c=t[0],l=t[1],d=t[2],f=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],f=t[1],l=t[2],d=t[3]}var h,p=n[0],g=n[1],m=n[3],v=mf(e),b=v[0],y=v[1],w=mf(r),x=w[0],_=w[1],M=Rs(p,x),I=Rs(g,_),E=function(U,F,W,H,j,q,K,ee){var le,pe,ke;if("number"==typeof U){le={top:U,bottom:U,left:U,right:U,type:0===U?"VALID":"NUMBER"};var Oe=function(He,nt,Qe,Dt,bt){null==Dt&&(Dt=Mv(He,nt,Qe));var bo=He[1],wo=Dc((He[0]-nt+2*Dt)/Qe+1,bt);D(vt(wo),function(){return"The output # of rows ("+wo+") must be an integer. Change the stride and/or zero pad parameters"});var ir=Dc((bo-nt+2*Dt)/Qe+1,bt);return D(vt(ir),function(){return"The output # of columns ("+ir+") must be an integer. Change the stride and/or zero pad parameters"}),[wo,ir]}([F,W],q,H,U,ee);pe=Oe[0],ke=Oe[1]}else if("same"===U){pe=Math.ceil(F/H),ke=Math.ceil(W/j);var Ve=Math.max(0,(pe-1)*H+q-F),Ge=Math.max(0,(ke-1)*j+K-W),je=Math.floor(Ve/2),qe=Ve-je,At=Math.floor(Ge/2);le={top:je,bottom:qe,left:At,right:Ge-At,type:"SAME"}}else{if("valid"!==U)throw Error("Unknown padding parameter: "+U);le={top:0,bottom:0,left:0,right:0,type:"VALID"},pe=Math.ceil((F-q+1)/H),ke=Math.ceil((W-K+1)/j)}return{padInfo:le,outHeight:pe,outWidth:ke}}(o,l,d,b,y,M,I,i),P=E.outHeight,A=E.outWidth,V=a?m*f:m;return"channelsFirst"===s?h=[c,V,P,A]:"channelsLast"===s&&(h=[c,P,A,V]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:d,inChannels:f,outHeight:P,outWidth:A,outChannels:V,padInfo:E.padInfo,strideHeight:b,strideWidth:y,filterHeight:p,filterWidth:g,effectiveFilterHeight:M,effectiveFilterWidth:I,dilationHeight:x,dilationWidth:_,inShape:t,outShape:h,filterShape:n}}function Cc(t,n,e,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3],h=u[4];if("channelsLast"===a)c=t[0],l=t[1],d=t[2],f=t[3],h=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],h=t[1],l=t[2],d=t[3],f=t[4]}var p,g=n[0],m=n[1],v=n[2],b=n[4],y=Rv(e),w=y[0],x=y[1],_=y[2],M=Rv(r),I=M[0],E=M[1],S=M[2],P=Rs(g,I),A=Rs(m,E),V=Rs(v,S),U=function(K,ee,le,pe,ke,Oe,Ve,Ge,je,qe,At){var He,nt,Qe,Dt;if("number"==typeof K){He={top:K,bottom:K,left:K,right:K,front:K,back:K,type:0===K?"VALID":"NUMBER"};var bt=function(zs,ii,a0,$s,xo,s0){null==xo&&(xo=Mv(zs,ii,$s));var c7=zs[1],l7=zs[2],u0=Dc((zs[0]-ii+2*xo)/$s+1,s0);D(vt(u0),function(){return"The output # of depths ("+u0+") must be an integer. Change the stride and/or zero pad parameters"});var c0=Dc((c7-ii+2*xo)/$s+1,s0);D(vt(c0),function(){return"The output # of rows ("+c0+") must be an integer. Change the stride and/or zero pad parameters"});var l0=Dc((l7-ii+2*xo)/$s+1,s0);return D(vt(l0),function(){return"The output # of columns ("+l0+") must be an integer. Change the stride and/or zero pad parameters"}),[u0,c0,l0,1]}([ee,le,pe,1],Ge,0,ke,K,At);nt=bt[0],Qe=bt[1],Dt=bt[2]}else if("same"===K){var wt=((nt=Math.ceil(ee/ke))-1)*ke+Ge-ee,bo=((Qe=Math.ceil(le/Oe))-1)*Oe+je-le,wo=((Dt=Math.ceil(pe/Ve))-1)*Ve+qe-pe,ir=Math.floor(wt/2),Ws=wt-ir,ri=Math.floor(bo/2),Li=bo-ri,oi=Math.floor(wo/2);He={top:ri,bottom:Li,left:oi,right:wo-oi,front:ir,back:Ws,type:"SAME"}}else{if("valid"!==K)throw Error("Unknown padding parameter: "+K);He={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},nt=Math.ceil((ee-Ge+1)/ke),Qe=Math.ceil((le-je+1)/Oe),Dt=Math.ceil((pe-qe+1)/Ve)}return{padInfo:He,outDepth:nt,outHeight:Qe,outWidth:Dt}}(o,l,d,f,w,x,_,P,A,V,s),W=U.outDepth,H=U.outHeight,j=U.outWidth,q=i?b*h:b;return"channelsFirst"===a?p=[c,q,W,H,j]:"channelsLast"===a&&(p=[c,W,H,j,q]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:W,outHeight:H,outWidth:j,outChannels:q,padInfo:U.padInfo,strideDepth:w,strideHeight:x,strideWidth:_,filterDepth:g,filterHeight:m,filterWidth:v,effectiveFilterDepth:P,effectiveFilterHeight:A,effectiveFilterWidth:V,dilationDepth:I,dilationHeight:E,dilationWidth:S,inShape:t,outShape:p,filterShape:n}}function Mv(t,n,e,r){void 0===r&&(r=1);var o=Rs(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function mf(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Rv(t){return"number"==typeof t?[t,t,t]:t}function Rs(t,n){return n<=1?t:t+(t-1)*(n-1)}function Dc(t,n){if(!n)return t;switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+n)}}function fa(t){var n=mf(t);return 1===n[0]&&1===n[1]&&1===n[2]}function Tn(t,n){return fa(t)||fa(n)}function vf(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function Tv(t,n,e){if("complex64"===n){if("complex64"===t.dtype)return t.clone();var r=ht(t.shape),o=t.toFloat(),i=e.complex(o,r);return r.dispose(),o.dispose(),i}if(!v2(t.dtype,n))return R.makeTensorFromDataId(t.dataId,t.shape,n);if("complex64"===t.dtype){var a=e.real(t);return i=a.cast(n),a.dispose(),i}if("int32"===n)return e.int(t);if("bool"===n){var s=Y(0,t.dtype);return i=e.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+n)}function yf(t,n){return R.makeTensorFromDataId(t.dataId,n,t.dtype)}function Av(t,n,e){var r=(n-t)/(e-1),o=Ds(e,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return Ut(o,"float32")}function Pv(t,n){if(t.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+n.length+".");for(var e=new Float32Array(2*t.length),r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function wS(t,n){return{real:t[2*n],imag:t[2*n+1]}}function lH(t,n,e,r){t[2*r]=n,t[2*r+1]=e}function dH(t,n,e){var r=(e?2:-2)*Math.PI*(t/n);return{real:Math.cos(r),imag:Math.sin(r)}}function fH(t,n,e){var r=function(u,c,l){for(var d=0,f=u.length,h=0,p=!1;d<f;){var g=l(c,u[h=d+(f-d>>>1)]);g>0?d=h+1:(f=h,p=!g)}return p?d:-d-1}(t,n,e||hH);t.splice(r<0?-(r+1):r,0,n)}function hH(t,n){return t>n?1:t<n?-1:0}function kv(t,n,e,r,o){return xS(t,n,e,r,o,0).selectedIndices}function Ov(t,n,e,r,o,i){var a=xS(t,n,e,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function xS(t,n,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(n).map(function(w,x){return{score:w,boxIndex:x,suppressBeginIndex:0}}).filter(function(w){return w.score>o}).sort(_S),c=i>0?-.5/i:0,l=[],d=[];l.length<e&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,g=f.suppressBeginIndex;if(h<o)break;for(var m=!1,v=l.length-1;v>=g;--v){var b=pH(t,p,l[v]);if(b>=r){m=!0;break}if(f.score=f.score*gH(r,c,b),f.score<=o)break}f.suppressBeginIndex=l.length,m||(f.score===h?(l.push(p),d.push(f.score)):f.score>o&&fH(u,f,_S))}var y=l.length;return s&&(l.fill(0,y),d.fill(0,y)),{selectedIndices:Ut(l,"int32"),selectedScores:Ut(d,"float32"),numValidOutputs:Y(y,"int32")}}function pH(t,n,e){var r=t.subarray(4*n,4*n+4),o=t.subarray(4*e,4*e+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;var g=Math.max(i,c),m=Math.max(a,l),v=Math.min(s,d),b=Math.min(u,f),y=Math.max(v-g,0)*Math.max(b-m,0);return y/(h+p-y)}function gH(t,n,e){var r=Math.exp(n*e*e);return e<=t?r:0}function _S(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function CS(t,n,e){var r=new Array(t.rank).fill(0),o=t.shape.slice();return n.map(function(i){o[e]=i;var a=t.slice(r,o);return r[e]+=i,a})}function DS(t,n){for(var e=new Array(t.rank),r=0;r<e.length;r++)e[r]=t.shape[r]*n[r];var o=Se(e,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function ES(t,n,e,r,o){for(var i=n[n.length-1],a=[t.length/i,i],s=a[0],u=a[1],c=_s(e,s*r),l=_s("int32",s*r),d=0;d<s;d++){for(var f=d*u,h=t.subarray(f,f+u),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort(function(w,x){return x.value-w.value});var m=d*r,v=c.subarray(m,m+r),b=l.subarray(m,m+r);for(g=0;g<r;g++)v[g]=p[g].value,b[g]=p[g].index}var y=n.slice();return y[y.length-1]=r,[un(c,y,e),un(l,y,"int32")]}function Nv(t,n){for(var e=[],r=0;r<n.length;r++)n[r]&&e.push(r);var o=Se(t,"int32"),i=Se([e.length,t.length],"int32");for(r=0;r<e.length;r++){var a=o.indexToLoc(e[r]);i.values.set(a,r*t.length)}return i.toTensor()}Object.freeze({castTensor:Tv,reshapeTensor:yf,linspaceImpl:Av,upcastType:Qt,axesAreInnerMostDims:yv,combineLocations:rS,computeOutAndReduceShapes:an,expandShapeToKeepDim:Rn,assertAxesAreInnerMostDims:Bn,getAxesPermutation:Or,getUndoAxesPermutation:af,getInnerMostAxes:Nr,getBroadcastDims:Ko,getReductionAxes:Vt,assertAndGetBroadcastShape:Le,assertParamsConsistent:oS,computeOutShape:ua,computePool2DInfo:Ms,computePool3DInfo:_c,computeConv2DInfo:Mi,computeConv3DInfo:Cc,computeDefaultPad:Mv,tupleValuesAreOne:fa,eitherStridesOrDilationsAreOne:Tn,convertConv2DDataFormat:vf,PARALLELIZE_THRESHOLD:Dv,computeOptimalWindowSize:ff});var mH=function(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},vH=function(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},yH=function(t,n,e){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,a=Math.ceil(t.inSize/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===n?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function SS(t,n){return["x","y","z","w","u","v"].slice(0,n).map(function(e){return t+"."+e})}function Vn(t,n){return 1===n?[t]:SS(t,n)}function yn(){var t,n,e,r,o,i,a,s,u,c;return 2===L().getNumber("WEBGL_VERSION")?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function ha(t,n,e){void 0===e&&(e="index");var r=Pr(n);return r.map(function(o,i){return"int "+t[i]+" = "+e+" / "+o+"; "+(i===r.length-1?"int "+t[i+1]+" = "+e+" - "+t[i]+" * "+o:"index -= "+t[i]+" * "+o)+";"}).join("")}function Fv(t){var n=Pr(t).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+n[0]+" + coords.y * "+n[1]+" + coords.z;\n  }\n"}var IS="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function bH(t,n,e,r){var o=[];t.forEach(function(h){var p=ae(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,h,s=o.join("\n"),u=t.map(function(h){return function(p,g,m){void 0===m&&(m=!1);var v="";return v+=m?MS(p):Ts(p),p.shapeInfo.logicalShape.length<=g.logicalShape.length&&(v+=m?function(w,x){var _,W,M=w.name,I=M.charAt(0).toUpperCase()+M.slice(1),E="get"+I+"AtOutCoords",S=w.shapeInfo.logicalShape.length,P=x.logicalShape.length,A=Ko(w.shapeInfo.logicalShape,x.logicalShape),V=ct(P),U=P-S,F=["x","y","z","w","u","v"];_=0===S?"":P<2&&A.length>=1?"coords = 0;":A.map(function(le){return"coords."+F[le+U]+" = 0;"}).join("\n"),W=P<2&&S>0?"coords":w.shapeInfo.logicalShape.map(function(le,pe){return"coords."+F[pe+U]}).join(", ");var H="return outputValue;",j=1===ae(w.shapeInfo.logicalShape),q=1===ae(x.logicalShape);if(1!==S||j||q){if(j&&!q)H=1===P?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(A.length){var K=S-2,ee=S-1;A.indexOf(K)>-1&&A.indexOf(ee)>-1?H="return vec4(outputValue.x);":A.indexOf(K)>-1?H="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":A.indexOf(ee)>-1&&(H="return vec4(outputValue.xx, outputValue.zz);")}}else H="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+E+"() {\n      "+V+" coords = getOutputCoords();\n      "+_+"\n      vec4 outputValue = get"+I+"("+W+");\n      "+H+"\n    }\n  "}(p,g):function(w,x){var _=w.name,M=_.charAt(0).toUpperCase()+_.slice(1),I="get"+M+"AtOutCoords",P=w.shapeInfo.logicalShape.length,A=x.logicalShape.length;if(!w.shapeInfo.isUniform&&P===A&&null==w.shapeInfo.flatOffset&&Lt(w.shapeInfo.texShape,x.texShape))return"\n      float "+I+"() {\n        return sampleTexture("+_+", resultUV);\n      }\n    ";var U=ct(A),F=Ko(w.shapeInfo.logicalShape,x.logicalShape),W=A-P,H=["x","y","z","w","u","v"];return"\n    float "+I+"() {\n      "+U+" coords = getOutputCoords();\n      "+(0===P?"":A<2&&F.length>=1?"coords = 0;":F.map(function(q){return"coords."+H[q+W]+" = 0;"}).join("\n"))+"\n      return get"+M+"("+(A<2&&P>0?"coords":w.shapeInfo.logicalShape.map(function(q,K){return"coords."+H[K+W]}).join(", "))+");\n    }\n  "}(p,g)),v}(h,n,r)}).join("\n"),c=n.texShape,l=yn(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",f=(h=l).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+h.varyingFs+" vec2 resultUV;\n    "+h.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+h.defineSpecialNaN+"\n    "+h.defineSpecialInf+"\n    "+h.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+wH+"\n    "+xH+"\n    "+_H+"\n  ";return n.isPacked?(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return x=p,1===(_=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+_[1]+".0);\n      }\n    ":1===_[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+_[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      return 2 * (resTexRC.x * "+_[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(w,x){var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(Lt(w,x))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+_[0]+", "+_[1]+"));\n      }\n    ";var M=Math.ceil(w[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n      int r = 2 * (index / "+M+");\n      int c = imod(index, "+M+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=h,m=p,v=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],y=(b=Math.ceil(g[2]/2))*Math.ceil(g[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n\n      int b = index / "+y+";\n      index -= b * "+y+";\n\n      int r = 2 * (index / "+b+");\n      int c = imod(index, "+b+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(w,x){for(var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],M=Math.ceil(w[w.length-1]/2),I=M*Math.ceil(w[w.length-2]/2),E=I,S="",P="b, r, c",A=2;A<w.length-1;A++)S="\n      int b"+A+" = index / "+(E*=w[w.length-A-1])+";\n      index -= b"+A+" * "+E+";\n    "+S,P="b"+A+", "+P;return"\n    ivec"+w.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n\n      "+S+"\n\n      int b = index / "+I+";\n      index -= b * "+I+";\n\n      int r = 2 * (index / "+M+");\n      int c = imod(index, "+M+") * 2;\n\n      return ivec"+w.length+"("+P+");\n    }\n  "}(h,p)}var x,_,g,m,v,b,y}(n.logicalShape,c),a=function(h){return"\n    void setOutput(vec4 val) {\n      "+h.output+" = val;\n    }\n  "}(l)):(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(b=p)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+b[1]+".0);\n      }\n    ":1===b[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+b[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      return resTexRC.x * "+b[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(v,b){return Lt(v,b)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+b[0]+", "+b[1]+"));\n      }\n    ":1===v[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===v[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      int r = index / "+v[1]+";\n      int c = index - r * "+v[1]+";\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=p,m=ha(["r","c","d"],h),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+g[0]+", "+g[1]+"));\n      int index = resTexRC.x * "+g[1]+" + resTexRC.y;\n      "+m+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(v,b){var y=ha(["r","c","d","d2"],v);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      "+y+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(h,p);case 5:return function(v,b){var y=ha(["r","c","d","d2","d3"],v);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+b[0]+",\n                             "+b[1]+"));\n\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+y+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(h,p);case 6:return function(v,b){var y=ha(["r","c","d","d2","d3","d4"],v);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+y+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var b,g,m}(n.logicalShape,c),a=function(h){return"\n    void setOutput(float val) {\n      "+h.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=CH),[f,d,a,s,i,u,e].join("\n")}function Ts(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=e.shapeInfo.texShape;if(1===i[0]&&1===i[1])return"\n      float "+o+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=e.shapeInfo.texShape;return"\n    float "+o+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+pa(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 1:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+o+"(int index) {\n        "+As(e)+"\n      }\n    ";var i=e.shapeInfo.texShape,a=i[0],s=i[1];if(1===s&&1===a)return"\n      float "+o+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=pa(r);return 1===s?"\n      float "+o+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+a+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===a?"\n      float "+o+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+s+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+s+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 2:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=e.shapeInfo.texShape;if(null!=a&&Lt(r,a))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+a[0]+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ";var c=Ci(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+Ts(Ps(e,l))+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+ks(["row","col"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+As(e)+"\n      }\n    ";var p=a[0],g=a[1],m=pa(o);return 1===g?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":1===p?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+g+".0, 0.5);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+m+";\n    vec2 uv = uvFromFlat("+p+", "+g+", index);\n    return sampleTexture("+o+", uv);\n  }\n"}(t);case 3:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=Ci(r),c=u.newShape,l=u.keptDims;if(c.length<r.length)return"\n        "+Ts(Ps(e,c))+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+ks(["row","col","depth"],l)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+s+", 1)));\n        "+As(e)+"\n      }\n    ";var h=e.shapeInfo.texShape,p=h[0],g=h[1],m=e.shapeInfo.flatOffset;return g===a&&null==m?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+s+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+g+".0, "+p+".0);\n          return sampleTexture("+o+", uv);\n        }\n      ":g===s&&null==m?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+g+".0, "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+s+" + depth + "+pa(o)+";\n        vec2 uv = uvFromFlat("+p+", "+g+", index);\n        return sampleTexture("+o+", uv);\n      }\n  "}(t);case 4:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=Ci(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+Ts(Ps(e,l))+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+ks(["row","col","depth","depth2"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+s+", "+a+", 1)));\n        "+As(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,g=p[0],m=p[1];return m===u&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":m===a&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+g+", "+m+", index + "+pa(o)+");\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);case 5:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=Ci(r),d=l.newShape,f=l.keptDims;if(d.length<r.length)return"\n      "+Ts(Ps(e,d))+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+ks(["row","col","depth","depth2","depth3"],f)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+s+", "+a+")) +\n          depth3;\n        "+As(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,m=g[0],v=g[1];return v===c&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":v===a&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+s+" +\n          depth2 * "+a+" + depth3 + "+pa(o)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);case 6:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=Ci(r),s=a.newShape,u=a.keptDims;if(s.length<r.length)return"\n      "+Ts(Ps(e,s))+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+ks(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var l=r[5],d=r[4]*l,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+p+", "+h+", "+f+", "+d+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+As(e)+"\n      }\n    ";var g=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],b=m[1];return b===p&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+f+", "+d+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+b+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":b===l&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+b+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+p+" + col * "+h+" + depth * "+f+" +\n          depth2 * "+d+" + depth3 * "+l+" + depth4 + "+pa(o)+";\n      vec2 uv = uvFromFlat("+v+", "+b+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function MS(t){var n,o,i,a,s,u,c;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+yn().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return a="get"+(i=(o=t).name).charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=yn(),"\n    vec4 "+a+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+i+", uv);\n    }\n  ";case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],d=yn();if(null!=u&&Lt(i,u))return"\n      vec4 "+s+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+l+".0, "+c+".0);\n\n        return "+d.texture2D+"("+a+", uv);\n      }\n    ";var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+s+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(i[1]/2)+", "+f[0]+", "+f[1]+", row, col);\n      return "+d.texture2D+"("+a+", uv);\n    }\n  "}(t);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===i[0])return"\n        "+MS(Ps(o,i.slice(1)))+"\n        vec4 "+s+"(int b, int row, int col) {\n          return "+s+"("+ks(["b","row","col"],[1,2])+");\n        }\n      ";var f=c[0],h=c[1],p=Math.ceil(i[2]/2);return"\n    vec4 "+s+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+f+", "+h+", "+p*Math.ceil(i[1]/2)+", "+p+", b, row, col);\n      return "+yn().texture2D+"("+a+", uv);\n    }\n  "}(t);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],f=l[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),g="int b, int row, int col",m="b * "+p+" + (row / 2) * "+h+" + (col / 2)",v=2;v<a-1;v++)g="int b"+v+", "+g,m="b"+v+" * "+(p*=i[a-v-1])+" + "+m;return"\n    vec4 "+u+"("+g+") {\n      int index = "+m+";\n      int texR = index / "+f+";\n      int texC = index - texR * "+f+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+", "+d+");\n      return "+yn().texture2D+"("+s+", uv);\n    }\n  "}(t)}}var wH="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",xH="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",_H="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",CH="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function pa(t){return"offset"+t}function As(t){var n=t.name,e=ae(t.shapeInfo.logicalShape);return e<2?"return "+n+";":"\n    for (int i = 0; i < "+e+"; i++) {\n      if (i == index) {\n        return "+n+"[i];\n      }\n    }\n  "}function ct(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Ps(t,n){var e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function ks(t,n){return n.map(function(e){return t[e]}).join(", ")}var DH=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,D(t.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var i=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=ct(c),d=Vn("coords",c);if(1===i){var f=ct(s=c+1);a="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[c-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[c-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[c-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+d[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],g=h.map(function(I){return"int "+I}),m=Vn("sourceLocR",s-1).concat("inIdx.r"),v=Vn("sourceLocG",s-1).concat("inIdx.g"),b=Vn("sourceLocB",s-1).concat("inIdx.b"),y=Vn("sourceLocA",s-1).concat("inIdx.a"),w="max"===e?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+b.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",_="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+b.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",M=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+M+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+d[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+n+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+n+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+w+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},EH=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var s=t.effectiveFilterHeight,u=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(s-1-t.padInfo.top)+", "+(u-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},SH=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(l-1-t.padInfo.front)+", "+(d-1-t.padInfo.top)+", "+(f-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterDepth*t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},IH=function(t,n,e,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Le(t,n),Le(t,e);var a="0.0";null!=r&&(Le(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Le(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},MH=function(t,n,e,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Le(t,n),Le(t,e);var a="vec4(0.0)";null!=r&&(Le(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Le(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},RS=function(t,n,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Le(n,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Lv="return a + b;",Bv="return a - b;",TS="return a * b;",AS="return (a < 0.) ? b * a : a;",Ct=function(t,n,e){this.variableNames=["A","B"],this.outputShape=Le(n,e),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},PS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Xo=function(t,n,e,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Le(n,e);var o=this.outputShape.length,i="";if(r)if(0===o||1===ae(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+ct(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=Vn("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},AH=function(){function t(n){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),PH=function(){function t(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),kH=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},OH=function(t){this.outputShape=[],this.outputShape=ua(t,1),this.variableNames=t.map(function(s,u){return"T"+u});var n=new Array(t.length-1);n[0]=t[0][1];for(var e=1;e<n.length;e++)n[e]=n[e-1]+t[e][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<n.length;e++)r.push("else if (yC < "+n[e]+") setOutput(getT"+e+"(yR, yC-"+n[e-1]+"));");r.push("else setOutput(getT"+n.length+"(yR, yC-"+n[n.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},NH=function(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ua(t,n);var e=this.outputShape,r=e.length,o=ct(r),i=Vn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(m,v){return"T"+v});var s=new Array(t.length-1);s[0]=t[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][n];var c=a[n],l=a.slice(-2),d=a.join(),f="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];f+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+bf(a,c,h)+"),\n            vec2("+bf(l,c,h)+"));\n        }"}var g=s[s.length-1];f+="\n        return getChannel(\n          getT"+s.length+"("+bf(a,c,g)+"),\n          vec2("+bf(l,c,g)+"));",this.userCode="\n      float getValue("+a.map(function(m){return"int "+m})+") {\n        "+f+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+e[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+e[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+e[r-2]+" &&\n            "+i[r-1]+" < "+e[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function bf(t,n,e){var r=t.indexOf(n);return t.map(function(o,i){return i===r?o+" - "+e:o}).join()}var FH=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===t.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},LH=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,i="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(i?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(i?1:2)+"], coords["+(i?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},BH=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},UH=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,e=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(n-1-t.padInfo.front)+", "+(e-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+n+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+n+" - 1 - wF;\n\n          for (int wR = 0; wR < "+e+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+e+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},VH=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jH=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},kS=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),h=t.inChannels%4,p="channelsLast"===t.dataFormat,g=p?1:2,m=p?2:3,v=p?3:1,b="",y="";e&&(b=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",y="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+g+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+y+"\n        setOutput(result);\n      }\n    "},HH=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,e=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+n+", "+e+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},OS=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=t.outChannels/t.inChannels,g="",m="";e&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",m="result = activation(result);");var v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+m+"\n        setOutput(result);\n      }\n    "},NS=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=h,g="int xR; int xC; int xCOffset;",m=0;m<f;m++)for(var v=0;v<h;v++)g+="\n          vec4 xTexelR"+m+"C"+2*v+" = vec4(0.);\n          vec4 wR"+m+"C"+v+" = vec4(0.);\n          vec4 xR"+m+"C"+v+" = vec4(0.);";for(m=0;m<f;m++)for(var b=0;b<p;b++){if(g+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(v=2*b)*d+";\n        ",1===c){if(v<h&&(g+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+m+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+v+" = vec4(previous.zw, xTexelR"+m+"C"+v+".xy);\n                } else {\n                  xR"+m+"C"+v+" = vec4(0, 0, xTexelR"+m+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = xTexelR"+m+"C"+v+";\n              ",v+1<h)){var y=s%2==0?Qm(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(g+="\n                  xCOffset = xC + "+s%2+" + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+v+" = vec4(0.);\n                    }\n                  "),g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".xy);\n                "):g+="\n                  xCOffset = xC + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(v+1)+" = xTexelR"+m+"C"+(v+2)+";\n                "}}else v<h&&(g+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(g+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n              ",v+1<h&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(v+1)+" = vec4(xTexelR"+m+"C"+(v+2)+".xy, final.xy);\n                ")):(g+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".xy, xTexelR"+m+"C"+(v+2)+".xy);\n              ",v+1<h&&(g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n                ")),g+="}");v<h&&(g+="\n            vec4 wTexelR"+m+"C"+v+" = getW("+m+", "+v+", d1, q);\n            wR"+m+"C"+v+" = vec4(wTexelR"+m+"C"+v+".xz, wTexelR"+m+"C"+v+".xz);\n          ",v+1<h&&(g+="\n              vec4 wTexelR"+m+"C"+(v+1)+" = getW("+m+", "+(v+1)+", d1, q);\n              wR"+m+"C"+(v+1)+" =\n                vec4(wTexelR"+m+"C"+(v+1)+".xz, wTexelR"+m+"C"+(v+1)+".xz);"))}for(m=0;m<f;m++)for(v=0;v<h;v++)g+="dotProd += xR"+m+"C"+v+" * wR"+m+"C"+v+";";var w="",x="";e&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"vec4 activation(vec4 x) {\n          "+e+"\n        }",x="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+g+"\n\n        vec4 result = dotProd;\n        "+_+"\n        "+x+"\n        setOutput(result);\n      }\n    "},WH=function(t,n,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],l=e[0],d=e[1];this.outputShape=[n[0],l,d,t[3]];var h=[a-1+".0",s-1+".0"],p=h[0],g=h[1],m=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],w=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g];this.userCode="\n      const float height_ratio = float("+m[0]+");\n      const float width_ratio = float("+w[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+m[1]+";\n        float width_scale = "+w[1]+";\n\n        float in_y = "+m[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+w[2]+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},zH=function(t,n,e){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=e?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(e?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ct(r)+" coords = getOutputCoords();\n        int end = "+FS(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+n+") {\n            continue;\n          }\n          "+FS(r,"coords")+" = idx;\n          val += getX("+function(a,s){if(1===a)return""+s;if(2===a)return s+".x, "+s+".y";if(3===a)return s+".x, "+s+".y, "+s+".z";if(4===a)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function FS(t,n){if(1===t)return""+n;if(2===t)return n+".y";if(3===t)return n+".z";if(4===t)return n+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var $H=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=fc.DENSE;var n=hc(t),e=yn();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ha(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+e.output+" = result;\n      }\n    "},GH=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=fc.DENSE;var n=hc(t),e=yn();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ha(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+e.output+" = result;\n      }\n    "},qH=function(){function t(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),KH=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},XH=function(t){this.variableNames=["A"],this.outTexUsage=Zn.DOWNLOAD;var n=yn();this.outputShape=t,this.userCode="\n      "+IS+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+n.output+" = encode_float(x);\n      }\n    "},QH=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Zn.DOWNLOAD;var n=yn();this.outputShape=t,this.userCode="\n      "+IS+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+n.output+" = encode_float(x);\n      }\n    "},YH=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"];var r=yn(),o=n[0],i=n[1];this.outputShape=t;var a="result";e&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+Fv(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},JH=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=yn(),o=n[0],i=n[1];this.outputShape=t;var a="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Fv(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},LS=function(t,n,e){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(e?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},tW=function(){function t(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){null==e.valueLoc&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,n)}},t}(),nW=function(t,n,e){this.variableNames=["A","indices"];var r=t.slice();r[e]=n,this.outputShape=r,this.rank=r.length;var o=ct(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<a.length;d++)l.push(d===s?"int(getIndices("+c[d]+"))":""+c[d]);return l.join()}(t,e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},rW=function(t,n,e){this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=e;var r=ct(n.length),o=ct(e.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function BS(t,n){var e=yn();return k2(t,n,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function US(t,n){return L2(t,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function VS(t,n){return B2(t,n,new Uint16Array([0,1,2,2,1,3]))}function Ec(t,n,e,r,o,i,a){V2(e,r);var s=U2(t,n),u=t.TEXTURE_2D;return re(t,n,function(){return t.bindTexture(u,s)}),re(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),re(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),re(t,n,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),re(t,n,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),re(t,n,function(){return t.texImage2D(u,0,o,e,r,0,i,a,null)}),re(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function jS(t,n,e,r,o){var i=Qd(e,r);return Ec(t,n,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function HS(t,n,e,r,o){var i=Qd(e,r);return Ec(t,n,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function WS(t,n,e,r,o){var i=Qd(e,r);return Ec(t,n,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function zS(t,n,e,r,o){var i=pc(e,r);return Ec(t,n,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function $S(t,n,e,r,o){var i=pc(e,r);return Ec(t,n,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function GS(t,n,e,r){return re(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),pv(t,n,e,"clipSpacePos",r,3,20,0)&&pv(t,n,e,"uv",r,2,20,12)}function qS(t,n,e,r,o,i,a){var s,u,c;re(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=a.internalFormatPackedFloat),s.set(i),re(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)}),re(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function KS(t,n,e,r){re(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),r.data instanceof Uint8Array?re(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):re(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),re(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function XS(t,n,e,r,o){var i=t.createBuffer();re(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var a=16*e*r;return re(t,n,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),re(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,0)}),re(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}function QS(t,n,e){var r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function YS(t,n,e,r,o){var i=Qd(e,r),a=i[0],s=i[1],u=new Uint8Array(e*r*4);return re(t,n,function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function JS(t,n,e,r,o,i,a,s){var f,u=t,c=new Float32Array((f=pc(i,a))[0]*f[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function ZS(t,n,e,r){var o=new Float32Array(e*r*4);return re(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,o)}),o}var oW=Object.freeze({createVertexShader:BS,createVertexBuffer:US,createIndexBuffer:VS,createFloat32MatrixTexture:jS,createFloat16MatrixTexture:HS,createUnsignedBytesMatrixTexture:WS,createPackedMatrixTexture:zS,createFloat16PackedMatrixTexture:$S,bindVertexProgramAttributeStreams:GS,uploadDenseMatrixToTexture:qS,uploadPixelDataToTexture:KS,createBufferFromOutputTexture:XS,downloadFloat32MatrixFromBuffer:QS,downloadByteEncodedFloatMatrixFromOutputTexture:YS,downloadPackedMatrixFromBuffer:JS,downloadMatrixFromPackedOutputTexture:ZS}),eI=function(){function t(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=L().getNumber("WEBGL_VERSION");null!=n?(this.gl=n,T2(e,n)):this.gl=uo(e);var r="WEBGL_color_buffer_float";if(1===L().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=gc(this.gl,this.debug,"OES_texture_float"),tr(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=gc(this.gl,this.debug,"OES_texture_half_float");else if(L().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),tr(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=gc(this.gl,this.debug,"EXT_color_buffer_half_float");else if(L().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(tr(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!tr(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=US(this.gl,this.debug),this.indexBuffer=VS(this.gl,this.debug),this.framebuffer=j2(this.gl,this.debug),this.textureConfig=hv(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return L().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var n=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;re(e,this.debug,function(){return e.finish()}),re(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),re(e,this.debug,function(){return e.deleteFramebuffer(n.framebuffer)}),re(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),re(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),re(e,this.debug,function(){return e.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(n,e){return this.throwIfDisposed(),jS(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(n,e){return this.throwIfDisposed(),HS(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(n,e){return this.throwIfDisposed(),WS(this.gl,this.debug,n,e)},t.prototype.uploadPixelDataToTexture=function(n,e){this.throwIfDisposed(),KS(this.gl,this.debug,n,e)},t.prototype.uploadDenseMatrixToTexture=function(n,e,r,o){this.throwIfDisposed(),qS(this.gl,this.debug,n,e,r,o,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(n,e){return this.throwIfDisposed(),$S(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(n,e){return this.throwIfDisposed(),zS(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(n){var e=this;this.throwIfDisposed(),this.outputTexture===n&&(gv(this.gl,this.debug,this.framebuffer),this.outputTexture=null),re(this.gl,this.debug,function(){return e.gl.deleteTexture(n)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return YS(o.gl,o.debug,e,r,o.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(n,e,r,o,i,a){return JS(this.gl,n,0,0,0,i,a)},t.prototype.downloadFloat32MatrixFromBuffer=function(n,e){return QS(this.gl,n,e)},t.prototype.createBufferFromTexture=function(n,e,r){this.bindTextureToFrameBuffer(n);var o=XS(this.gl,this.debug,e,r);return this.unbindTextureToFrameBuffer(),o},t.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},t.prototype.createFence=function(n){var e,r,o=this;if(L().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},e=a}else L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return ZS(o.gl,o.debug,e,r)})},t.prototype.createProgram=function(n){this.throwIfDisposed();var e=this.gl,r=O2(e,this.debug,n),o=BS(e,this.debug),i=N2(e,this.debug);return re(e,this.debug,function(){return e.attachShader(i,o)}),re(e,this.debug,function(){return e.attachShader(i,r)}),F2(e,this.debug,i),this.debug&&Zd(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=GS(e,this.debug,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(n){var e=this;this.throwIfDisposed(),n===this.program&&(this.program=null),null!=n&&re(this.gl,this.debug,function(){return e.gl.deleteProgram(n)})},t.prototype.setProgram=function(n){var e=this;this.throwIfDisposed(),this.program=n,null!=this.program&&this.debug&&Zd(this.gl,this.debug,this.program),re(this.gl,this.debug,function(){return e.gl.useProgram(n)})},t.prototype.getUniformLocation=function(n,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?W2(this.gl,this.debug,n,e):z2(this.gl,n,e)},t.prototype.getAttributeLocation=function(n,e){var r=this;return this.throwIfDisposed(),re(this.gl,this.debug,function(){return r.gl.getAttribLocation(n,e)})},t.prototype.getUniformLocationNoThrow=function(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)},t.prototype.setInputMatrixTexture=function(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),$2(this.gl,this.debug,0,n,e,r)},t.prototype.setOutputMatrixTexture=function(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)},t.prototype.setOutputPackedMatrixTexture=function(n,e,r){this.throwIfDisposed();var o=pc(e,r);this.setOutputMatrixTextureDriver(n,o[0],o[1])},t.prototype.setOutputMatrixWriteRegion=function(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Zd(this.gl,this.debug,this.program),mc(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),re(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),re(this.gl,this.debug,function(){return n.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=gc(this.gl,this.debug,2===L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2!==L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(n){return oe(this,void 0,void 0,function(){var e=this;return ie(this,function(r){switch(r.label){case 0:return[4,Ym(function(){return e.disposed||e.isQueryAvailable(n,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(n,L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(n,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(n,e){if(0===e)return!0;if(2===e){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,o.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollFence=function(n){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return n.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var n=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=n;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},t.prototype.addItemToPoll=function(n,e){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1||Ym(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),ef(this.gl,this.debug,n,this.framebuffer),this.debug&&mc(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(ef(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&mc(this.gl)):gv(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(n,e){this.bindTextureToFrameBuffer(n);var r=e();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(n,e,r){this.throwIfDisposed();var o=this.gl;ef(o,this.debug,n,this.framebuffer),this.debug&&mc(o),this.outputTexture=n,re(o,this.debug,function(){return o.viewport(0,0,e,r)}),re(o,this.debug,function(){return o.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(n,e,r,o){var i=this;this.throwIfDisposed(),re(this.gl,this.debug,function(){return i.gl.scissor(n,e,r,o)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function tI(t,n){if(t.length!==n.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+n.length+" inputs");t.forEach(function(e,r){var o=e.logicalShape,i=n[r],a=i.shape;if(!Lt(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!Lt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var iW=function(t,n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var o=e.inChannels,i=e.strideWidth,a=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,l=e.dilationHeight,d=e.dataFormat,f=s.left,h=s.top,p=o*e.filterWidth,g=yn(),m="channelsLast"===d,v=m?0:1,b=m?1:2,y="",w=0;w<=1;w++)for(var x=0;x<=1;x++)y+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+w+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+n[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+f+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+n[b]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+g.output+" = result;\n      }\n    "},aW=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[];var a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},sW=function(t,n,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=e,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+n+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+n+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},uW=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},cW=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var o=t.effectiveFilterHeight,i=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(o-1-t.padInfo.top)+", "+(i-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(o*i-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},lW=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(s-1-t.padInfo.front)+", "+(u-1-t.padInfo.top)+", "+(c-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(s*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Uv=function(t,n,e,r,o,i,a){void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var u=Math.ceil((e?t[1]:t[2])/2),c=e?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+f[0]+");\n          result += ("+d[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+g+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},dW=function(){function t(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,n)}},t}(),fW=function(t,n,e,r){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+e+"),\n                      float(index == coords.y)));\n      }\n    "},hW=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var s,c,l,n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var e=Vn("rc",n),r=ct(n),o=function(s,u,c){if(1===s)return"rc > "+u[0];for(var l="",d=s-2;d<s;d++)l+=c[d]+" >= "+u[d],d<s-1&&(l+="||");return l}(n,t,e),i=function(s,u,c,l){if(1===s)return"";var d=l.slice(-2);return"\n    int r = "+d[0]+";\n    int c = "+d[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(n,t[t.length-1],t[t.length-2],e),a=(l=function(d,f){for(var h=[],p=0;p<=1;p++)for(var g=0;g<=1;g++){for(var m=(0===p?"r":"rp1")+", "+(0===g?"c":"cp1"),v=2;v<d;v++)m=f[f.length-1-v]+","+m;h.push(m)}return h}(c=(s=t).length,e),1===c?"getA(rc),\n            rc + 1 >= "+s[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+l[0]+"),\n          cEdge ? 0. : getA("+l[1]+"),\n          rEdge ? 0. : getA("+l[2]+"),\n          rEdge || cEdge ? 0. : getA("+l[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},pW=function(t,n,e){this.variableNames=["x"],this.outputShape=n.map(function(u,c){return u[0]+t[c]+u[1]});var r=t.length,o=ct(r),i=n.map(function(u){return u[0]}).join(","),a=n.map(function(u,c){return u[0]+t[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},gW=function(t,n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(m,v){return m[0]+t[v]+m[1]});for(var r=t.length,o=ct(r),i=n.map(function(m){return m[0]}).join(","),a=n.map(function(m,v){return m[0]+t[v]}).join(","),s=Vn("rc",r),u=Vn("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=1===r?2:4;p<g;p++)h+="\n        "+d[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+e+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Vv=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var f="avg"===n,h="0.0";if(f||(h="-1.0 / 1e-20"),e)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(p="avgValue / count");var g=4*Math.floor(r/4),m=r%4,v="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+d+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},jv=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="0.0";if(m||(v="-1.0 / 1e-20"),e)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(b="avgValue / count");var y=4*Math.floor(r/4),w=r%4,x="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+y+";\n            if ("+(1===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},mW=function(t,n){this.variableNames=["x"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/e);this.outputShape=[r,i];var a="0.0",s="";"prod"===n?a="1.0":"min"===n?(a="1.0 / 1e-20",s="min"):"max"===n&&(a="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?u="sumValue":"prod"===n?u="prodValue":"all"===n?u="allValue":"any"===n&&(u="anyValue");var c=4*Math.floor(e/4),l=e%4,d="\n      if ("+("sum"===n)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===n)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===n?(a="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(a="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";o%e>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},vW=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+ha(["r","c","d"],n)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Fv(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+e+"\n\n        setOutput(result);\n      }\n    "},yW=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},bW=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var i=t[1],a=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},wW=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[1],a=t[2],s=t[3];this.outputShape=[t[0],n,e,s];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(e-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},xW=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+e+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+e+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},_W=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var i=t[1],a=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},CW=function(t,n){this.variableNames=["x"];var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=t,1!==e){var r=t.map(function(i,a){return-1!==n.indexOf(s=a)&&1!==t[s]?t[s]+" - coords["+s+"] - 1":"coords["+s+"]";var s}).join(","),o=ct(e);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},DW=function(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=t;var u,r=Vn("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],i=r[e-2]+" + 1 < "+this.outputShape[e-2],a=ct(e);function s(u){var c=t.map(function(l,d){return h=u,-1!==n.indexOf(f=d)&&1!==t[f]?t[f]+" - "+h[f]+" - 1":""+h[f];var f,h});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===e?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+((u=r.slice())[e-1]="("+u[e-1]+" + 1)",s(u)+";\n          }\n          if(")+i+") {\n            result.b = "+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},nI=function(t,n,e,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=ct(o.length),u=ct(i.length),c="";1===e?c="i":2===e&&(c="i, j");var d="";1===r?d="i":2===r&&(d="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+n+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(n>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+d+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},EW=function(t,n){this.variableNames=["x","segmentIds"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/e);this.outputShape=[r,a];var s=4*Math.floor(e/4),u=e%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%e>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var d="";o%e>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},SW=function(t,n,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=n,e>4)throw Error("Where for rank "+e+" is not yet supported");if(1===e)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<n.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=ct(e);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},IW=function(){function t(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var e,r=ct(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(1===a)return"sourceLoc";if(a<=6)return Hv.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);e="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+n.map(function(a,s){return"sourceLoc."+Hv[s]+" = start["+s+"] + coords."+Hv[s]+";"}).join("\n")+"\n      ",this.userCode="\n      "+o+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+i+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),Hv=["x","y","z","w","u","v"],MW=function(){function t(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var e=ct(this.rank),r=Vn("coords",this.rank),o=Vn("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s="\n      result.x = "+a+";\n      if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n        ++"+o[this.rank-1]+";\n        result.y = "+a+";\n        --"+o[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+n[this.rank-2]+") {\n        ++"+o[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n          ++"+o[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+n.map(function(l,d){return"start["+d+"]"}).join()+");":n.map(function(l,d){return o[d]+" = "+r[d]+" + start["+d+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+s+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),RW=function(t,n,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=ct(e.length),i=ct(e.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=e.map(function(u,c){return s++,1===e.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+n+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},TW=function(){function t(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(n,e,r){var o,i=rI(e,r),a=oI(n,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===er.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===er.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===er.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===er.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===er.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[a].push(o),o},t.prototype.releaseTexture=function(n,e,r,o){if(null!=this.freeTextures){var i=oI(e,rI(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var n=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){n.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){n.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function rI(t,n){if(t===Zn.UPLOAD)return er.PACKED_2X2_FLOAT32;if(t===Zn.RENDER||null==t)return e=n,L().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?er.PACKED_2X2_FLOAT32:er.UNPACKED_FLOAT32:e?er.PACKED_2X2_FLOAT16:er.UNPACKED_FLOAT16;var e;if(t===Zn.DOWNLOAD||t===Zn.PIXELS)return er.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function oI(t,n,e){return t[0]+"_"+t[1]+"_"+n+"_"+e}var AW=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[r]*n[r];this.outputShape=e,this.rank=e.length;var o=ct(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(1===s)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},PW=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];this.outputShape=e,this.rank=e.length;var o=ct(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(n);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},kW=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=ct(this.rank),i=SS("rc",this.rank),a=new Array(this.rank);for(r=0;r<n.length;r++)a[n[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+e[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Wv=1.7580993408473768,zv=1.0507009873554805,Te=function(t,n){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+n+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Lr="if (isnan(x)) return x;",OW="return x;",iI="return abs(x);",aI=Lr+"\n  return (x < 0.0) ? 0.0 : x;\n",sI=Lr+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",uI="return (x >= 0.0) ? x : (exp(x) - 1.0);",NW="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+Wv+";\n  float scale = "+zv+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",cI="return -x;",lI="return ceil(x);",dI="return floor(x);",fI="return exp(x);",hI="return exp(x) - 1.0;",FW=Lr+"\n  return sin(x);\n",LW=Lr+"\n  return cos(x);\n",BW=Lr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",UW=Lr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",VW=Lr+"\n  return atan(x);\n",jW=Lr+"return log(x + sqrt(x * x + 1.0));",HW=Lr+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",WW=Lr+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",wf="return x;",zW="return x;",pI="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",gI="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",mI="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Sc=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},$W=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,e=Vn("rc",n),r=ct(n),o=function(s,u){if(1===s)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(n,e),i=e.slice(-2),a=n<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},xf={};function _f(t,n){if(void 0===n&&(n=!1),"linear"===t)return n?zW:OW;if("relu"===t)return n?pI:aI;if("elu"===t)return n?mI:uI;if("relu6"===t)return n?gI:sI;if("prelu"===t)return n?PS:AS;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var GW=600,vI=function(t){function n(e){var r,o=t.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!L().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=uo(L().getNumber("WEBGL_VERSION"));o.binaryCache=((r=L().getNumber("WEBGL_VERSION"))in xf||(xf[r]={}),xf[r]),o.gpgpu=new eI(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new TW(o.gpgpu),o.numMBBeforeWarning=null==L().global.screen?1024:L().global.screen.height*L().global.screen.width*window.devicePixelRatio*GW/1024/1024,o.texData=new yS(o,R),o}return Ar(n,t),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(e,r,o){if(L().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===o&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:Zn.UPLOAD}),i},n.prototype.move=function(e,r,o,i){if(L().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:Zn.UPLOAD})},n.prototype.readSync=function(e){var r=this.texData.get(e),o=r.values,i=r.dtype,a=r.complexTensors,u=r.shape;if(null!=r.slice){var l;l=r.isPacked?new Sc(u,wf):new Te(u,wf);var d=this.runWebGLProgram(l,[{dataId:e,shape:u,dtype:i}],i),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(null!=o)return this.convertAndCacheOnCPU(e);if("string"===i)return o;var h,p,g=null!=this.activeTimers;return g&&(h=kr()),p="complex64"===i?Pv(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),g&&(this.downloadWaitMs+=kr()-h),this.convertAndCacheOnCPU(e,p)},n.prototype.read=function(e){return oe(this,void 0,void 0,function(){var r,o,i,a,u,c,l,d,f,h,p,g,m,v,b,x,_,M,I;return ie(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(S){return r.push(S)})];if(o=this.texData.get(e),i=o.values,a=o.shape,u=o.dtype,c=o.complexTensors,l=o.isPacked,null!=o.slice)return d=l?new Sc(a,wf):new Te(a,wf),f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(null!=i)return[2,this.convertAndCacheOnCPU(e)];if(!L().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===L().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&L().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(e),m=this.texData.get(g.dataId),p=(I=this.gpgpu).createBufferFromTexture.apply(I,[m.texture].concat(hc(a)))),this.pendingRead.set(e,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return b=E.sent(),v=Pv(b[0],b[1]),[3,5];case 4:null==p?v=this.getValuesFromTexture(e):(x=ae(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),E.label=5;case 5:return null!=g&&this.disposeData(g.dataId),_=this.convertAndCacheOnCPU(e,v),M=this.pendingRead.get(e),this.pendingRead.delete(e),M.forEach(function(S){return S(_)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,_]}})})},n.prototype.checkNumericalProblems=function(e){if(null!=e)for(var r=0;r<e.length;r++){var o=e[r];if(!A2(o))throw L().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.isPacked,u=ae(i);if(L().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),l=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(hc(i))).subarray(0,u);return this.disposeData(c.dataId),d}var f=L().getBool("WEBGL_PACK")&&!0===s,h=f?tf(i):i,p=f?new QH(h):new XH(h),g=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:e}],"float32"),m=this.texData.get(g.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),v},n.prototype.time=function(e){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c;return ie(this,function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,null==this.programTimersStack?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e(),a=zo(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),s=zo(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=f2(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:kr(),endMs:null}},n.prototype.endTimer=function(e){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=kr(),e)},n.prototype.getQueryTime=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){return L().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var r=this.texData.get(e),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||e,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),null!=o&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getDataInfo=function(e){return this.texData.get(e)},n.prototype.getCPUBackend=function(){return L().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=R.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,r){var o=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&e.every(function(i){return null==o.texData.get(i.dataId).texture&&i.size<r})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,r){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(r.clone())},o},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,o);if(0===ae(o))return un([],o,e.dtype);var i=this.texData.get(e.dataId).isPacked,a=Sv(e.shape,r,o);if(i||!a){var s=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MW(o):new IW(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,o)},n.prototype.shallowSlice=function(e,r,o){var i=this.texData.get(e.dataId),a=this.makeOutput(o,e.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=e.dtype;var u=Iv(r,e.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},n.prototype.stridedSlice=function(e,r,o,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,o,i);var a=hf(r,o,i);if(a.some(function(u){return 0===u}))return un([],a);var s=new RW(r,i,a);return this.compileAndRun(s,[e])},n.prototype.reverse=function(e,r){var o=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DW(e.shape,r):new CW(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.concat=function(e,r){if("complex64"===e[0].dtype){var o=e.map(function(h){return mr(h)}),i=e.map(function(h){return lo(h)});return sn(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(1===e.length)return e[0];if(e.length>L().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),s=this.concat(e.slice(0,a),r),u=this.concat(e.slice(a),r);return this.concat([s,u],r)}if(L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new NH(e.map(function(h){return h.shape}),r);return this.compileAndRun(c,e)}var l=ua(e.map(function(h){return h.shape}),r),d=e.map(function(h){return h.as2D(-1,ae(h.shape.slice(r)))}),f=new OH(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(l)},n.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,cI,e.dtype);var r=new Te(e.shape,cI);return this.compileAndRun(r,[e])},n.prototype.batchMatMul=function(e,r,o,i){var a=o?e.shape[2]:e.shape[1],s=i?r.shape[1]:r.shape[2],u=o?e.shape[1]:e.shape[2],c=e.shape[0];if((1===a||1===s)&&u>1e3){o&&(e=e.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var l=1===s?e:e.as3D(c,u,1),d=1===s?2:1,f=1===s?r.as3D(c,1,u):r;return this.multiply(l,f).sum(d,!0)}var h=Qt(e.dtype,r.dtype),p=new Uv(e.shape,[c,a,s],o,i);return this.compileAndRun(p,[e,r],h)},n.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=i?r.shape[2]:r.shape[1],d=a?o.shape[1]:o.shape[2],f=r.shape[0],h=Qt(r.dtype,o.dtype),p=null!=s,g=null!=c,m=u?_f(u,!0):null,v=new Uv(r.shape,[f,l,d],i,a,p,m,g),b=[r,o];return s&&b.push(s),c&&b.push(c),this.compileAndRun(v,b,h)},n.prototype.multiply=function(e,r){if("complex64"===e.dtype){var o=this.texData.get(e.dataId),i=this.texData.get(r.dataId),a=new RS("return areal * breal - aimag * bimag;",e.shape,r.shape),s=new RS("return areal * bimag + aimag * breal;",e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,TS,e.dtype);var f=new Ct(TS,e.shape,r.shape);return this.compileAndRun(f,[e,r],e.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){var u=[e,r,o],c=null;null!=s&&(c=s.shape,u.push(s));var l=null;if(null!=a&&(l=a.shape,u.push(a)),L().getBool("WEBGL_PACK_NORMALIZATION")){var d=new MH(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(d,u)}var f=new IH(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){var s=L().getBool("WEBGL_PACK_NORMALIZATION")?new uW(e.shape,r,o,i,a):new aW(e.shape,r,o,i,a);return this.compileAndRun(s,[e])},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){var c=new sW(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,e])},n.prototype.tile=function(e,r){if("string"===e.dtype){var o=this.readSync(e.dataId).map(function(a){return sc(a)});return DS(Se(e.shape,e.dtype,o),r)}var i=new AW(e.shape,r);return this.compileAndRun(i,[e])},n.prototype.pad=function(e,r,o){var i=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gW(e.shape,r,o):new pW(e.shape,r,o);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var o=L().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kW(e.shape,r):new PW(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.gather=function(e,r,o){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,o);var i=new nW(e.shape,r.size,o);return this.compileAndRun(i,[e,r])},n.prototype.batchToSpaceND=function(e,r,o){D(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,f){return d*f}),a=cf(e.shape,r,i),s=lf(a.length,r.length),u=df(e.shape,r,i),c=dS(o,r.length),l=fS(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){D(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=cf(u.shape,r,i,!1),l=lf(c.length,r.length,!1),d=df(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.reduce=function(e,r,o){var i=e.shape[0],a=e.shape[1],s=ff(a),u=new mW({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[e],o);return 1===c.shape[1]?c:this.reduce(c,r,o)},n.prototype.argReduce=function(e,r,o){void 0===o&&(o=null);var i=e.shape[0],a=e.shape[1];null!=o&&(i=o.shape[0],a=o.shape[1]);var s=ff(a),u=new yH({windowSize:s,inSize:a,batchSize:i},r,null==o),c=[e];null!=o&&c.push(o);var l=this.compileAndRun(u,c,"int32");return 1===l.shape[1]?l:this.argReduce(e,r,l)},n.prototype.argReducePacked=function(e,r,o){void 0===o&&(o=null);var i=null!=o?o.shape:e.shape,a=ff(i[i.length-1]),s=new DH(i,a,r,null==o),c=this.compileAndRun(s,null==o?[e]:[e,o],"int32");return c.rank===e.rank?this.argReducePacked(e,r,c):c},n.prototype.sum=function(e,r){Bn("sum",r,e.rank);var o=an(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a),u=cv(e.dtype);return this.reduce(s,"sum",u).reshape(i)},n.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var o=an(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a),u=cv(e.dtype);return this.reduce(s,"prod",u).reshape(i)},n.prototype.unsortedSegmentSum=function(e,r,o){var i=0,a=Or([i],e.rank),s=e;null!=a&&(s=e.transpose(a),i=Nr(1,e.rank)[0]);var u=function(h,p,g){for(var m=[],v=h.length,b=0;b<v;b++)m.push(b!==p?h[b]:g);return m}(s.shape,i,o),c=ae([s.shape[i]]),l=s.as2D(-1,c),d=cv(e.dtype),f=this.segOpCompute(l,"unsortedSegmentSum",r,d,o).reshape(u);return null!=a&&(f=f.transpose(af(a))),f},n.prototype.segOpCompute=function(e,r,o,i,a){var s=e.shape[0],u=e.shape[1],c=function(f,h){var p,g=!1;for(f<=Dv?(p=f,g=!0):p=Xd(f,Math.floor(Math.sqrt(f)));!g;)p>h||p===f?g=!0:p=Xd(f,p+1);return p}(u,a),l=new EW({windowSize:c,inSize:u,batchSize:s,numSegments:a},r),d=this.compileAndRun(l,[e,o],i);return d.shape[1]===a?d:(o=sf(0,a).tile([u/c]),this.segOpCompute(d,r,o,i,a))},n.prototype.argMinMaxReduce=function(e,r,o){var i=[r];if(Bn("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,e.rank),!L().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=an(e.shape,i),s=a[0],u=ae(a[1]),c=e.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(e,o)},n.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},n.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},n.prototype.cumsum=function(e,r,o,i){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var a=new zH(e.shape,o,i);return this.compileAndRun(a,[e])},n.prototype.equal=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(equal(a, b));\n","bool");var o=new Ct("return float(a == b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.notEqual=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(notEqual(a, b));\n","bool");var o=new Ct("return float(a != b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThan(a, b));\n","bool");var o=new Ct("return float(a < b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.lessEqual=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var o=new Ct("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThan(a, b));\n","bool");var o=new Ct("return float(a > b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greaterEqual=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var o=new Ct("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalNot=function(e){var r=new Te(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},n.prototype.logicalAnd=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var o=new Ct("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalOr=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var o=new Ct("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.select=function(e,r,o){var i=new SW(e.rank,r.shape,r.rank);return this.compileAndRun(i,[e,r,o],Qt(r.dtype,o.dtype))},n.prototype.where=function(e){rf("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return Nv(e.shape,r)},n.prototype.topk=function(e,r,o){return ES(e.dataSync(),e.shape,e.dtype,r)},n.prototype.min=function(e,r){Bn("min",r,e.rank);var o=an(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var o=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.mod=function(e,r){var o=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);Bn("max",r,e.rank);var o=an(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var o=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.all=function(e,r){Bn("all",r,e.rank);var o=an(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(e,r){Bn("any",r,e.rank);var o=an(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.realDivide=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var o=new Ct("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,r.shape);return this.compileAndRun(o,[e,r],"float32")},n.prototype.floorDiv=function(e,r){if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var o=new Ct("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,r.shape);return this.compileAndRun(o,[e,r],"int32")},n.prototype.add=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,Lv);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var o=Qt(e.dtype,r.dtype);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,Lv,o);var i=new Ct(Lv,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.packedUnaryOp=function(e,r,o){var i=new Sc(e.shape,r);return this.compileAndRun(i,[e],o)},n.prototype.packedBinaryOp=function(e,r,o,i,a){void 0===a&&(a=!1);var s=new Xo(o,e.shape,r.shape,a);return this.compileAndRun(s,[e,r],i)},n.prototype.complexSeparableBinaryOp=function(e,r,o){var i=this,a=this.texData.get(e.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],g=i.makeComplexComponentTensorInfo(e,h),m=i.makeComplexComponentTensorInfo(r,p),v=new Ct(o,e.shape,r.shape);return i.compileAndRun(v,[g,m],Qt(h.dtype,p.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},n.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>L().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.addN(e.slice(0,r)),i=this.addN(e.slice(r));return this.addN([o,i])}var a=e.map(function(c){return c.dtype}).reduce(function(c,l){return Qt(c,l)}),s=e.map(function(c){return c.shape}),u=L().getBool("WEBGL_PACK")?new vH(e[0].shape,s):new mH(e[0].shape,s);return this.compileAndRun(u,e,a)},n.prototype.subtract=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,Bv);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var o=Qt(e.dtype,r.dtype);if(L().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,Bv,e.dtype);var i=new Ct(Bv,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.pow=function(e,r){var o=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,r.shape),i=Qt(e.dtype,r.dtype);return this.compileAndRun(o,[e,r],i)},n.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,lI,e.dtype);var r=new Te(e.shape,lI);return this.compileAndRun(r,[e])},n.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dI,e.dtype);var r=new Te(e.shape,dI);return this.compileAndRun(r,[e])},n.prototype.sign=function(e){var r=new Te(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[e])},n.prototype.isNaN=function(e){var r=new Te(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isInf=function(e){var r=new Te(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isFinite=function(e){var r=new Te(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.round=function(e){var r=new Te(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[e])},n.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,fI,e.dtype);var r=new Te(e.shape,fI);return this.compileAndRun(r,[e])},n.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,hI,e.dtype);var r=new Te(e.shape,hI);return this.compileAndRun(r,[e])},n.prototype.softmax=function(e,r){var o=Bt([r],e.shape),i=this.max(e,o),a=Rn(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var r=new Te(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[e])},n.prototype.log1p=function(e){var r=new Te(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},n.prototype.sqrt=function(e){var r=new Te(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new Te(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},n.prototype.reciprocal=function(e){var r=new Te(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},n.prototype.relu=function(e){var r;return r=L().getBool("WEBGL_PACK")?new Sc(e.shape,pI):new Te(e.shape,aI),this.compileAndRun(r,[e])},n.prototype.relu6=function(e){var r;return r=L().getBool("WEBGL_PACK")?new Sc(e.shape,gI):new Te(e.shape,sI),this.compileAndRun(r,[e])},n.prototype.prelu=function(e,r){var o=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo(PS,e.shape,r.shape):new Ct(AS,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.elu=function(e){if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,mI,e.dtype);var r=new Te(e.shape,uI);return this.compileAndRun(r,[e])},n.prototype.eluDer=function(e,r){var o=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,r.shape):new Ct("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.selu=function(e){var r=new Te(e.shape,NW);return this.compileAndRun(r,[e])},n.prototype.int=function(e){var r=new Te(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},n.prototype.clip=function(e,r,o){var i,a=(i=L().getBool("WEBGL_PACK_CLIP")?new PH(e.shape):new AH(e.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[e],null,a)},n.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(L().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,iI,e.dtype);var r=new Te(e.shape,iI);return this.compileAndRun(r,[e])},n.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),o=new kH(e.shape),i=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(o,i)},n.prototype.sigmoid=function(e){var r=new Te(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},n.prototype.softplus=function(e){var r=new Te(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[e])},n.prototype.sin=function(e){var r=new Te(e.shape,FW);return this.compileAndRun(r,[e])},n.prototype.cos=function(e){var r=new Te(e.shape,LW);return this.compileAndRun(r,[e])},n.prototype.tan=function(e){var r=new Te(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},n.prototype.asin=function(e){var r=new Te(e.shape,BW);return this.compileAndRun(r,[e])},n.prototype.acos=function(e){var r=new Te(e.shape,UW);return this.compileAndRun(r,[e])},n.prototype.atan=function(e){var r=new Te(e.shape,VW);return this.compileAndRun(r,[e])},n.prototype.atan2=function(e,r){var o=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.sinh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.cosh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.tanh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[e])},n.prototype.asinh=function(e){var r=new Te(e.shape,jW);return this.compileAndRun(r,[e])},n.prototype.acosh=function(e){var r=new Te(e.shape,HW);return this.compileAndRun(r,[e])},n.prototype.atanh=function(e){var r=new Te(e.shape,WW);return this.compileAndRun(r,[e])},n.prototype.erf=function(e){var r=new Te(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[e])},n.prototype.step=function(e,r){var i,o=new Te(e.shape,(void 0===(i=r)&&(i=0),Lr+"\n    return x > 0.0 ? 1.0 : float("+i+");\n  "));return this.compileAndRun(o,[e])},n.prototype.conv2dByMatMul=function(e,r,o,i,a,s){var u=e.shape,c=this.texData.get(e.dataId),h="channelsLast"===o.dataFormat,g=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===o.outChannels)&&o.inChannels>1e3||!L().getBool("WEBGL_LAZILY_UNPACK")||!L().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var v=this.reshape(e,[1,h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],o.inChannels]),b=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var w={dataId:e.dataId,shape:[1,h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),o.inChannels],dtype:e.dtype},x=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,D(bc(c.shape,w.shape),function(){return"packed reshape "+c.shape+" to "+w.shape+" isn't free"});var _=this.reshape(r,[1,o.inChannels,o.outChannels]),M=this.fusedBatchMatMul({a:w,b:_,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),I=this.texData.get(M.dataId);return D(I.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=x,I.shape=o.outShape,R.makeTensorFromDataId(M.dataId,o.outShape,M.dtype)},n.prototype.conv2dWithIm2Row=function(e,r,o,i,a,s){var d=o.outWidth,f=o.outHeight,h="channelsLast"===o.dataFormat,p=o.filterWidth*o.filterHeight*o.inChannels,g=f*d,m=[p,g],v=e.squeeze([0]),b=r.reshape([1,p,-1]),y=new iW(m,v.shape,o),w=this.compileAndRun(y,[v]).reshape([1,m[0],m[1]]),x=null!=i,_=null!=s,M=a?_f(a,!0):null,I=new Uv(w.shape,[1,g,o.outChannels],!0,!1,x,M,_),E=[w,b];return i&&E.push(i),_&&E.push(s),this.compileAndRun(I,E).reshape(h?[1,f,d,o.outChannels]:[1,o.outChannels,f,d])},n.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights;if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(r,o,i,a,s,u);if(L().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=null!=a,l=null!=u,d=s?_f(s,!1):null,f=new kS(i,c,d,l),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(f,h)},n.prototype.conv2d=function(e,r,o){if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(e,r,o);if(L().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,r,o);var i=new kS(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerInput=function(e,r,o){var i=new LH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerFilter=function(e,r,o){var i=new FH(o);return this.compileAndRun(i,[e,r])},n.prototype.fusedDepthwiseConv2D=function(e){var r,o=e.input,i=e.filter,a=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=L().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=u?_f(u,l):null,f=[o,i],h=null!=s,p=null!=c;return h&&f.push(s),p&&f.push(c),l?(r=new NS(a,h,d,p),this.compileAndRun(r,f)):(r=new OS(a,h,d,p),this.compileAndRun(r,f))},n.prototype.depthwiseConv2D=function(e,r,o){var i;return L().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new NS(o),this.compileAndRun(i,[e,r])):(i=new OS(o),this.compileAndRun(i,[e,r]))},n.prototype.depthwiseConv2DDerInput=function(e,r,o){var i=new jH(o);return this.compileAndRun(i,[e,r])},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){var i=new VH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3d=function(e,r,o){var i=new HH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerInput=function(e,r,o){var i=new UH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerFilter=function(e,r,o){var i=new BH(o);return this.compileAndRun(i,[e,r])},n.prototype.maxPool=function(e,r){var o=new Vv(r,"max",!1);return this.compileAndRun(o,[e])},n.prototype.avgPool=function(e,r){var o=new Vv(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPoolBackprop=function(e,r,o,i){var a=new Vv(i,"max",!0),s=this.compileAndRun(a,[r]),u=new cW(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(e,r,o){var i=new EH(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.cast=function(e,r){return Tv(e,r,this)},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.avgPool3d=function(e,r){var o=new jv(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.avgPool3dBackprop=function(e,r,o){var i=new SH(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.maxPool3d=function(e,r){var o=new jv(r,"max",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPool3dBackprop=function(e,r,o,i){var a=new jv(i,"max",!0),s=this.compileAndRun(a,[r]),u=new lW(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.reshape=function(e,r){var o=this.texData.get(e.dataId);if(o.isPacked&&!bc(e.shape,r)&&(null===o.texture||!bc(o.shape,r))){var i=this.packedReshape(e,r);return R.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return yf(e,r)},n.prototype.resizeBilinear=function(e,r,o,i){var a=L().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new wW(e.shape,r,o,i):new bW(e.shape,r,o,i);return this.compileAndRun(a,[e],"float32")},n.prototype.resizeBilinearBackprop=function(e,r,o){var i=new yW(e,r,o);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,r,o,i){var a=new _W(e.shape,r,o,i);return this.compileAndRun(a,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){var i=new xW(e,r,o);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,r,o,i){var a=r?e:qo(e),c=new dW(a.shape[0],a.shape[1],o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},n.prototype.oneHot=function(e,r,o,i){var a=new fW(e.size,r,o,i);return this.compileAndRun(a,[e])},n.prototype.diag=function(e){var r=new KH(e.size);return this.compileAndRun(r,[e])},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return rf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),kv(e.dataSync(),r.dataSync(),o,i,a)},n.prototype.cropAndResize=function(e,r,o,i,a,s){var u=new WH(e.shape,r.shape,i,a,s);return this.compileAndRun(u,[e,r,o],"float32")},n.prototype.depthToSpace=function(e,r,o){D(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=e.shape[0],c=("NHWC"===o?e.shape[1]:e.shape[2])*r,l=("NHWC"===o?e.shape[2]:e.shape[3])*r,d=("NHWC"===o?e.shape[3]:e.shape[1])/(r*r),f=new qH("NHWC"===o?[i,c,l,d]:[i,d,c,l],r,o);return this.compileAndRun(f,[e])},n.prototype.split=function(e,r,o){return CS(e,r,o)},n.prototype.scatterND=function(e,r,o){var i=xc(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=[l/u,u],f=e.reshape([s,a]),h=r.reshape([s,u]);if(0===l)return yf(un([]),o);var p=Y(0),g=new nI(s,a,f.rank,h.rank,c,d);return this.compileAndRun(g,[h,f,p]).reshape(o)},n.prototype.sparseToDense=function(e,r,o,i){var a=xc(0,e,o),d=new nI(a.numUpdates,a.sliceRank,e.rank,r.rank,a.strides,[a.outputSize,1],!1);return this.compileAndRun(d,[r,e,i]).reshape(o)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,r){var o=this.texData.get(e.dataId),i=new LS("return real * expR - imag * expI;",e.shape,r),a=new LS("return real * expI + imag * expR;",e.shape,r),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=Cv(e,r),s=a[0],u=a[1],c=a[2],l=a[3],d=r.reshape([u,i]),f=e.reshape([e.size/c,c]),h=new rW(i,l,[u,c]);return this.compileAndRun(h,[f,d]).reshape(s)},n.prototype.fill=function(e,r,o){if("string"===(o=o||Cs(r))){var i=ac(o,ae(e));return i.fill(r),R.makeTensor(i,e,o,this)}var a=new tW(e,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},n.prototype.linspace=function(e,r,o){return Av(e,r,o)},n.prototype.makeTensorInfo=function(e,r){var o=this.write(null,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}},n.prototype.makeOutput=function(e,r){var o=this.makeTensorInfo(e,r).dataId;return R.makeTensorFromDataId(o,e,r,this)},n.prototype.unpackTensor=function(e){var r=new $W(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},n.prototype.packTensor=function(e){var r=new hW(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},n.prototype.packedReshape=function(e,r){var o=[vc(e.shape)].concat(yc(e.shape)),i={dtype:e.dtype,shape:o,dataId:e.dataId},a=[vc(r)].concat(yc(r)),s=new vW(a,o),u=this.runWebGLProgram(s,[i],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},n.prototype.decode=function(e){var r,o=this.texData.get(e),i=o.isPacked,a=o.shape,s=o.dtype,u=tf(a);return r=i?new GH(u):new $H(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(e,r,o,i,a){var s=this;void 0===a&&(a=!1);var u=this.makeTensorInfo(e.outputShape,o),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===fc.DENSE){var l=hc(e.outputShape);c.texShape=l.map(function(y){return 2*y})}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===ae(u.shape))return c.values=_s(u.dtype,0),u;var d=[],f=r.map(function(y){if("complex64"===y.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(y.dataId);if(null==w.texture){if(!e.packedInputs&&ae(y.shape)<=L().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=y.shape)}else if(!!w.isPacked!=!!e.packedInputs)y=w.isPacked?s.unpackTensor(y):s.packTensor(y),d.push(y),w=s.texData.get(y.dataId);else if(w.isPacked&&!bc(w.shape,y.shape)){var x=y,_=y.shape;y.shape=w.shape,y=s.packedReshape(y,_),d.push(y),w=s.texData.get(y.dataId),x.shape=_}return s.uploadToGPU(y.dataId),{shape:y.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var h,y,_,p={shape:u.shape,texData:c,isUniform:!1},g=(y=e,_="",f.concat(p).forEach(function(E){_+=E.shape+"_"+(E.isUniform?"uniform":E.texData.texShape)+"_"+(null!=E.texData&&null!=E.texData.slice&&E.texData.slice.flatOffset>0)}),y.constructor.name+"_"+_+"_"+y.userCode),m=this.getAndSaveBinary(g,function(){return function(y,w,x,_){var M=w.userCode,I=x.map(function(j,q){var K={logicalShape:j.shape,texShape:j.isUniform?null:j.texData.texShape,isUniform:j.isUniform,isPacked:!j.isUniform&&j.texData.isPacked,flatOffset:null};return null!=j.texData&&null!=j.texData.slice&&j.texData.slice.flatOffset>0&&(K.flatOffset=j.texData.slice.flatOffset),{name:w.variableNames[q],shapeInfo:K}}),E=I.map(function(j){return j.shapeInfo}),S={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},P=bH(I,S,M,w.packedInputs),A=y.createProgram(P),V=null,U=y.getUniformLocation(A,"NAN",!1);1===L().getNumber("WEBGL_VERSION")&&(V=y.getUniformLocation(A,"INFINITY",!1));for(var F={},W=0;W<w.variableNames.length;W++){var H=w.variableNames[W];F[H]=y.getUniformLocation(A,H,!1),F["offset"+H]=y.getUniformLocation(A,"offset"+H,!1)}return{program:w,source:P,webGLProgram:A,uniformLocations:F,inShapeInfos:E,outShapeInfo:S,infLoc:V,nanLoc:U}}(s.gpgpu,e,f,p)}),v=null!=this.activeTimers;if(v&&(h=this.startTimer()),function(y,w,x,_,M){tI(w.inShapeInfos,x),tI([w.outShapeInfo],[_]);var I=_.texData.texture,E=_.texData.texShape;_.texData.isPacked?y.setOutputPackedMatrixTexture(I,E[0],E[1]):y.setOutputMatrixTexture(I,E[0],E[1]),y.setProgram(w.webGLProgram),1===L().getNumber("WEBGL_VERSION")&&null!==w.infLoc&&y.gl.uniform1f(w.infLoc,1/0),null!==w.nanLoc&&y.gl.uniform1f(w.nanLoc,NaN),x.forEach(function(S,P){var A=w.program.variableNames[P],V=w.uniformLocations[A],U=w.uniformLocations["offset"+A];if(null!=V)if(S.isUniform)if(ae(S.shape)<2)y.gl.uniform1f(V,S.uniformValues[0]);else{var F=S.uniformValues;F instanceof Float32Array||(F=new Float32Array(F)),y.gl.uniform1fv(V,F)}else null!=S.texData.slice&&null!=U&&y.gl.uniform1i(U,S.texData.slice.flatOffset),y.setInputMatrixTexture(S.texData.texture,V,P)}),M?.(y,w.webGLProgram),y.executeProgram()}(this.gpgpu,m,f,p,i),d.forEach(function(y){return s.disposeData(y.dataId)}),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!L().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===a){var b=this.unpackTensor(u);return this.disposeData(u.dataId),b}return u},n.prototype.compileAndRun=function(e,r,o,i,a){void 0===a&&(a=!1);var s=this.runWebGLProgram(e,r,o=o||r[0].dtype,i,a);return R.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var e=this;this.disposed||(L().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=ne(function(){if(!L().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=L().getBool("DEBUG");L().set("DEBUG",!1);var o=e.abs(Y(1e-8)).dataSync()[0];if(L().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.values,c=o.usage,l=o.isPacked;if(null==o.texture){var d,f=null!=this.activeTimers;f&&(d=kr());var h=o.texShape;if(null==h&&(h=K2(i,l),o.texShape=h),null!=s){var p=tf(i),g=void 0,m=h[1],v=h[0],b=s instanceof Uint8Array;l?(m=(r=pc(h[0],h[1]))[0],g=new JH(p,[v=r[1],m],b)):g=new YH(p,[v,m],b);var y=this.makeTensorInfo([v,m],a);this.texData.get(y.dataId).usage=b?Zn.PIXELS:Zn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),m,v,s);var w=this.runWebGLProgram(g,[y],a,null,!0),x=this.texData.get(w.dataId);o.texture=x.texture,o.texShape=x.texShape,o.isPacked=x.isPacked,o.usage=x.usage,this.disposeData(y.dataId),this.texData.delete(w.dataId),o.values=null,f&&(this.uploadWaitMs+=kr()-d)}else{var _=this.acquireTexture(h,c,a,l);o.texture=_}}},n.prototype.convertAndCacheOnCPU=function(e,r){var o=this.texData.get(e),i=o.dtype;return this.releaseGPUData(e),null!=r&&(o.values=function(a,s){if("float32"===s||"complex64"===s)return a;if("int32"===s||"bool"===s){for(var u="int32"===s?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},n.prototype.acquireTexture=function(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,i)},n.prototype.computeBytes=function(e,r){return e[0]*e[1]*Jm(r)},n}(bS);R2()&&R.registerBackend("webgl",function(){return new vI},2);var qW=T({square_:function(t){var n=C(t,"x","square");return R.runKernelFunc(function(r,o){return o([n]),r.square(n)},{x:n},null,"Square",{},[n],[])}}),Ic="SquaredDifference",yI=T({squaredDifference_:function(t,n){var e,r=C(t,"a","squaredDifference"),o=C(n,"b","squaredDifference");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=Y(2);return{a:function(){return s.mul(c.sub(l).mul(d))},b:function(){return s.mul(l.sub(c).mul(d))}}},Ic,{},[r,o],[])}}),KW=T({abs_:function(t){var n=C(t,"x","abs");return"complex64"===n.dtype?R.runKernelFunc(function(e){return e.complexAbs(n)},{$x:n}):R.runKernelFunc(function(e,r){var o=e.abs(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),XW=T({acos_:function(t){var n=C(t,"x","acos");return R.runKernelFunc(function(e,r){var o=e.acos(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Y(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),QW=T({acosh_:function(t){var n=C(t,"x","acosh");return R.runKernelFunc(function(e,r){var o=e.acosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),YW=T({asin_:function(t){var n=C(t,"x","asin");return R.runKernelFunc(function(e,r){var o=e.asin(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Y(1).sub(o.toFloat().square()).sqrt())}}})}}),JW=T({asinh_:function(t){var n=C(t,"x","asinh");return R.runKernelFunc(function(e,r){var o=e.asinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Y(1).add(o.toFloat().square()).sqrt())}}})}}),ZW=T({atan_:function(t){var n=C(t,"x","atan");return R.runKernelFunc(function(e,r){var o=e.atan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),ez=T({atanh_:function(t){var n=C(t,"x","atanh");return R.runKernelFunc(function(e,r){var o=e.atanh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(Y(1).sub(o.toFloat().square()))}}})}}),tz=T({ceil_:function(t){var n=C(t,"x","ceil");return R.runKernelFunc(function(e){return e.ceil(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),$v=T({clipByValue_:function(t,n,e){var r=C(t,"x","clipByValue");return D(n<=e,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+e+")."}),R.runKernelFunc(function(a,s){var u=a.clip(r,n,e);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(n).logicalAnd(u.lessEqual(e)),$e(a))}}},"ClipByValue",{min:n,max:e},[r])}}),nz=T({cos_:function(t){var n=C(t,"x","cos");return R.runKernelFunc(function(r,o){var i=r.cos(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},[n])}}),rz=T({cosh_:function(t){var n=C(t,"x","cosh");return R.runKernelFunc(function(e,r){var o=e.cosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),oz=T({erf_:function(t){var n=C(t,"x","erf");return D("int32"===n.dtype||"float32"===n.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===n.dtype&&(n=n.toFloat()),R.runKernelFunc(function(e,r){var o=e.erf(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Gv=T({exp_:function(t){var n=C(t,"x","exp");return R.runKernelFunc(function(e,r){var o=e.exp(n);return r([o]),o},{x:n},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),iz=T({expm1_:function(t){var n=C(t,"x","expm1");return R.runKernelFunc(function(e,r){var o=e.expm1(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}}),az=T({floor_:function(t){var n=C(t,"x","floor");return R.runKernelFunc(function(e){return e.floor(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),sz=T({log_:function(t){var n=C(t,"x","log");return R.runKernelFunc(function(r,o){var i=r.log(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},[n])}}),uz=T({log1p_:function(t){var n=C(t,"x","log1p");return R.runKernelFunc(function(e,r){var o=e.log1p(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}}),cz=T({logSigmoid_:function(t){var n=C(t,"x","logSigmoid");return R.runKernelFunc(function(e,r){var o=e.softplus(n.neg()).neg();return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),Cf=T({neg_:function(t){var n=C(t,"x","neg");return R.runKernelFunc(function(r){return r.neg(n)},{x:n},function(r){return{x:function(){return r.neg()}}},"Neg",{},[n])}}),lz=T({reciprocal_:function(t){var n=C(t,"x","reciprocal");return R.runKernelFunc(function(e,r){var o=e.reciprocal(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}}),dz=T({round_:function(t){var n=C(t,"x","round");return R.runKernelFunc(function(e){return e.round(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),bI=T({rsqrt_:function(t){var n=C(t,"x","rsqrt");return R.runKernelFunc(function(r,o){var i=r.rsqrt(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[n])}}),wI=T({sigmoid_:function(t){var n=C(t,"x","sigmoid");return R.runKernelFunc(function(e,r){var o=e.sigmoid(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.mul(Y(1).sub(o)))}}},"Sigmoid")}}),fz=T({sign_:function(t){var n=C(t,"x","sign");return R.runKernelFunc(function(e){return e.sign(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),hz=T({isNaN_:function(t){var n=C(t,"x","isNaN");return R.runKernelFunc(function(e){return e.isNaN(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),pz=T({isInf_:function(t){var n=C(t,"x","isInf");return R.runKernelFunc(function(e){return e.isInf(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),gz=T({isFinite_:function(t){var n=C(t,"x","isFinite");return R.runKernelFunc(function(e){return e.isFinite(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),mz=T({sin_:function(t){var n=C(t,"x","sin");return R.runKernelFunc(function(r,o){var i=r.sin(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},[n])}}),vz=T({sinh_:function(t){var n=C(t,"x","sinh");return R.runKernelFunc(function(e,r){var o=e.sinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),yz=T({softplus_:function(t){var n=C(t,"x","softplus");return R.runKernelFunc(function(e,r){var o=e.softplus(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),bz=T({sqrt_:function(t){var n=C(t,"x","sqrt");return R.runKernelFunc(function(e,r){var o=e.sqrt(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),wz=T({step_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","step");return R.runKernelFunc(function(r){return r.step(e,n)},{$x:e},function(r){return{$x:function(){return $e(r)}}})}}),xz=T({tan_:function(t){var n=C(t,"x","tan");return R.runKernelFunc(function(e,r){var o=e.tan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}}),_z=T({tanh_:function(t){var n=C(t,"x","tanh");return R.runKernelFunc(function(e,r){var o=e.tanh(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return Y(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function xI(t,n,e,r,o,i){var a,s,u=C(t,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),D(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),D(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&D(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&D(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Mc(u,c,l,s,a,i)}function _I(t,n,e,r,o,i){var a,s,u=C(t,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),D(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),D(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&D(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&D(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Mc(u,c,l,s,a,i)}function CI(t,n,e,r,o,i){var a,s,u=C(t,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),D(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),D(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&D(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&D(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Mc(u,c,l,s,a,i)}function Mc(t,n,e,r,o,i){null==i&&(i=.001);var a,s,u,c=C(t,"x","batchNorm"),l=C(n,"mean","batchNorm"),d=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),D(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),D(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,R.runKernelFunc(function(h,p){var g=h.batchNormalization(u,Df(l),Df(d),i,Df(a),Df(s));return p([c,l,d,a]),g},{x:c,mean:l,variance:d,scale:a,offset:s},function(h,p){var m=p[0],v=p[1],b=p[2],w=p[3]??Y(1),x=Vt(v.shape,u.shape),_=[];if(1===v.rank){for(var M=0;M<u.shape.length-1;++M)_.push(u.shape[M]);_.push(1)}var I=m.sub(v),E=h.mul(w),S=bI(b.add(Y(i))),P=S.mul(S).mul(S).mul(Y(-.5));return{x:function(){return 1===v.rank?h.mul(Is(S.as4D(1,1,1,v.shape[0]),_)).mul(w).reshape(m.shape):h.mul(S).mul(w).reshape(m.shape)},mean:function(){var A=S.mul(Y(-1)).mul(E);return 1===v.rank&&(A=A.sum(x)),A.reshape(v.shape)},variance:function(){var A=P.mul(I).mul(E);return 1===v.rank&&(A=A.sum(x)),A.reshape(v.shape)},scale:function(){var A=I.mul(S),V=h.mul(A);return 1===v.rank&&(V=V.sum(x)),V.reshape(v.shape)},offset:function(){var A=h;return 1===v.rank&&(A=A.sum(x)),A.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:i},[c,l,d,a]).reshape(c.shape)}function Df(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Ef(){tS("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Cz=T({batchNormalization2d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Ef(),xI(t,n,e,i,o,r)}}),Dz=T({batchNormalization3d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Ef(),_I(t,n,e,i,o,r)}}),Ez=T({batchNormalization4d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Ef(),CI(t,n,e,i,o,r)}}),Sz=T({batchNormalization_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Ef(),Mc(t,n,e,i,o,r)}}),DI=T({batchNorm_:Mc}),Iz=T({batchNorm2d_:xI}),Mz=T({batchNorm3d_:_I}),Rz=T({batchNorm4d_:CI}),Sf=T({logicalAnd_:function(t,n){var e=C(t,"a","logicalAnd","bool"),r=C(n,"b","logicalAnd","bool");return Le(e.shape,r.shape),R.runKernelFunc(function(o){return o.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),Tz=T({logicalNot_:function(t){var n=C(t,"x","logicalNot","bool");return R.runKernelFunc(function(e){return e.logicalNot(n)},{$x:n})}}),EI=T({logicalOr_:function(t,n){var e=C(t,"a","logicalOr","bool"),r=C(n,"b","logicalOr","bool");return Le(e.shape,r.shape),R.runKernelFunc(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}}),Az=T({logicalXor_:function(t,n){var e=C(t,"a","logicalXor","bool"),r=C(n,"b","logicalXor","bool");return Le(e.shape,r.shape),EI(t,n).logicalAnd(Sf(t,n).logicalNot())}}),ga=T({where_:function(t,n,e){var r=C(n,"a","where"),o=C(e,"b","where"),i=C(t,"condition","where","bool");return ze(r.shape,o.shape,"Error in where: "),1===i.rank?D(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):ze(i.shape,o.shape,"Error in where: "),R.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return $e(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),SI=function(t){return oe(this,void 0,void 0,function(){var n,e,r;return ie(this,function(o){switch(o.label){case 0:return[4,(n=C(t,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=Nv(n.shape,e),t!==n&&n.dispose(),[2,r]}})})},Be=T({add_:function(t,n){var e,r=C(t,"a","add"),o=C(n,"b","add");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=Vt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Vt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),Pz=T({addN_:function(t){D(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),D(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var n=t.map(function(o,i){return C(o,"tensors"+i,"addN")}),e=n[0];return n.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(o){if(!Lt(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),R.runKernelFunc(function(o){return o.addN(n)},n,function(o){var i={};return n.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),kz=T({addStrict_:function(t,n){var e=C(t,"a","addStrict"),r=C(n,"b","addStrict");return ze(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),Oz=T({atan2_:function(t,n){var e,r=C(t,"a","atan2"),o=C(n,"b","atan2");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Be(u.square(),c.square()),d=a.mul(c.div(l)),f=Vt(u.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var l=Be(u.square(),c.square()),d=Cf(a.mul(u.div(l))),f=Vt(c.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),Br=T({div_:function(t,n){var e,r=C(t,"a","div"),o=C(n,"b","div");if(e=pt(r,o),o=e[1],"int32"===(r=e[0]).dtype&&"int32"===o.dtype)return II(r,o);var i=Le(r.shape,o.shape);return R.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=Vt(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=Vt(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"Div")}}),Nz=T({divNoNan_:function(t,n){var e,r=C(t,"a","div"),o=C(n,"b","div");r=(e=pt(r,o))[0];var i=Br(r,o=e[1]),a=$e(i),s=o.equal(a);return ga(s,a,i)}}),Fz=T({divStrict_:function(t,n){var e=C(t,"a","div"),r=C(n,"b","div");return ze(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),II=T({floorDiv_:function(t,n){var e,r=C(t,"a","floorDiv"),o=C(n,"b","floorDiv");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=Vt(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=Vt(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"FloorDiv")}}),qv=T({maximum_:function(t,n){var e,r=C(t,"a","maximum"),o=C(n,"b","maximum");return e=pt(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Le(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),Lz=T({maximumStrict_:function(t,n){var e=C(t,"a","maximumStrict"),r=C(n,"b","maximumStrict");return ze(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),MI=T({minimum_:function(t,n){var e,r=C(t,"a","minimum"),o=C(n,"b","minimum");return e=pt(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Le(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),Bz=T({minimumStrict_:function(t,n){var e=C(t,"a","minimumStrict"),r=C(n,"b","minimumStrict");return ze(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),Uz=T({mod_:function(t,n){var e,r=C(t,"a","mod"),o=C(n,"b","mod");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Vt(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),d=Vt(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),Vz=T({modStrict_:function(t,n){var e=C(t,"a","modStrict"),r=C(n,"b","modStrict");return ze(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),bn=T({mul_:function(t,n){var e,r=C(t,"a","mul"),o=C(n,"b","mul");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),d=Vt(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=Vt(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),jz=T({mulStrict_:function(t,n){var e=C(t,"a","mul"),r=C(n,"b","mul");return ze(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),If=T({pow_:function(t,n){var e,r=C(t,"base","pow"),o=C(n,"exp","pow");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(s,u){var c=s.pow(r,o);return u([r,o,c]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var f=l.toFloat(),h=s.mul(f.mul(c.pow(f.sub(Y(1))))),p=Vt(c.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var f=c.greater(0),h=c.log().where(f,$e(c)),p=s.mul(d.mul(h)),g=Vt(l.shape,i);return g.length>0&&(p=p.sum(g)),p.reshape(l.shape)}}},"Pow",{},[r,o],[!0])}}),Hz=T({powStrict_:function(t,n){return ze(t.shape,n.shape,"Error in powStrict: "),t.pow(n)}}),Wz=T({squaredDifferenceStrict_:function(t,n){var e=C(t,"a","squaredDifferenceStrict"),r=C(n,"b","squaredDifferenceStrict");return ze(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),Kt=T({sub_:function(t,n){var e,r=C(t,"a","sub"),o=C(n,"b","sub");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=Vt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Vt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),zz=T({subStrict_:function(t,n){var e=C(t,"a","subStrict"),r=C(n,"b","subStrict");return ze(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),RI=T({equal_:function(t,n){var e,r=C(t,"a","equal"),o=C(n,"b","equal");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),$z=T({equalStrict_:function(t,n){var e=C(t,"a","equalStrict"),r=C(n,"b","equalStrict");return ze(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),Gz=T({greater_:function(t,n){var e,r=C(t,"a","greater"),o=C(n,"b","greater");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),TI=T({greaterEqual_:function(t,n){var e,r=C(t,"a","greaterEqual"),o=C(n,"b","greaterEqual");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return $e(s)},b:function(){return $e(u)}}},"GreaterEqual")}}),qz=T({greaterEqualStrict_:function(t,n){var e=C(t,"a","greaterEqualStrict"),r=C(n,"b","greaterEqualStrict");return ze(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),Kz=T({greaterStrict_:function(t,n){var e=C(t,"a","greaterStrict"),r=C(n,"b","greaterStrict");return ze(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),Xz=T({less_:function(t,n){var e,r=C(t,"a","less"),o=C(n,"b","less");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),Qz=T({lessEqual_:function(t,n){var e,r=C(t,"a","lessEqual"),o=C(n,"b","lessEqual");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),Yz=T({lessEqualStrict_:function(t,n){var e=C(t,"a","lessEqualStrict"),r=C(n,"b","lessEqualStrict");return ze(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),Jz=T({lessStrict_:function(t,n){var e=C(t,"a","lessStrict"),r=C(n,"b","lessStrict");return ze(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),Zz=T({notEqual_:function(t,n){var e,r=C(t,"a","notEqual"),o=C(n,"b","notEqual");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),e6=T({notEqualStrict_:function(t,n){var e=C(t,"a","notEqualStrict"),r=C(n,"b","notEqualStrict");return ze(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function AI(t,n){for(var e=[],r=t;r<n;++r)e.push(r);return e}function PI(t){for(var n=[],e=0;e<t.length;++e)for(var r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var Kv=T({gather_:function(t,n,e){void 0===e&&(e=0);var r=C(t,"x","gather"),o=C(n,"indices","gather","int32");e=Bt(e,r.shape)[0];var i=function(a,s,u){for(var c=a.shape[u],l=[],d=1,f=1,h=0;h<u;h++)l.push(a.shape[h]),d*=a.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<a.rank;h++)l.push(a.shape[h]),f*=a.shape[h];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:l}}(r,o,e);return R.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),e);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,d=c.slice(0,e),f=d.length,h=c.slice(e,c.length).slice(1),p=h.length,g=AI(0,f),m=AI(f+1,f+1+p),v=PI([d,[l],h]),b=a.reshape(v),y=u.reshape([l]),w=PI([[f],g,m]),x=b.transpose(w),_=kI(x,y,r.shape[e]),M=af(w);return _.transpose(M)},indices:function(){return u}}},"Gather",{axis:e}).reshape(i.outputShape)}}),kI=T({unsortedSegmentSum_:function(t,n,e){var r=C(t,"x","unsortedSegmentSum"),o=C(n,"segmentIds","unsortedSegmentSum","int32");return D(vt(e),function(){return"numSegments must be of dtype int"}),R.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,e);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=qv(c,$e(c)),d=Kv(u,l),f=TI(c,Y(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=vr(f,p+1);f=Sf(f,Ss(d.shape,"bool"));var g=$e(d);return ga(f,d,g)}(i,s)}}})}});function OI(t,n,e,r,o,i,a){void 0===i&&(i="NHWC"),D(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var s=t,u=n,c=!1;3===n.rank&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,t[0],t[1],t[2]]),D(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),D(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),D(4===e.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var l="NHWC"===i?s[3]:s[1],d="NHWC"===i?u.shape[3]:u.shape[1];D(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),D(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),null!=a&&D(vt(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=vf(i),h=Mi(s,e.shape,r,1,o,a,!1,f),p=R.runKernelFunc(function(g,m){var v=g.conv2dDerInput(u,e,h);return m([e,u]),v},{dy4D:u,filter:e},function(g,m){var v=m[0],b=m[1];return{dy4D:function(){return yr(g,v,r,o,i,1,a)},filter:function(){return Qv(g,b,v.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Xv(t){var i,n="number"==typeof(i=t)?[i,i,i]:2===i.length?[i[0],i[1],1]:i;return 1===n[0]&&1===n[1]&&1===n[2]}function NI(t,n,e,r,o){D(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var i=t,a=n,s=!1;4===n.rank&&(s=!0,a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],c=a.shape[4];D(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),D(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),D(5===e.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),D(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),D(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var l=Cc(i,e.shape,r,1,o),d=R.runKernelFunc(function(f){return f.conv3dDerInput(a,e,l)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var n6=T({conv1d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=C(t,"x","conv1d"),u=C(n,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),D(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),D(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&D(vt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),D(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),D(Tn(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),D("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=yr(f,d,[1,e],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),yr=T({conv2d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=C(t,"x","conv2d"),u=C(n,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),D(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),D(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&D(vt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d="NHWC"===o?c.shape[3]:c.shape[1];D(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),D(Tn(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"});var f=vf(o),h=Mi(c.shape,u.shape,e,i,r,a,!1,f),g=R.runKernelFunc(function(m,v){var b=m.conv2d(c,u,h);return v([u,c]),b},{x:c,filter:u},function(m,v){var y=v[0],w=v[1];return D(fa(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return FI(w.shape,m,y,e,r,o)},filter:function(){return Qv(w,m,y.shape,e,r,o)}}},"Conv2D",h,[u,c]);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),r6=T({conv3d_:function(t,n,e,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var h,a=C(t,"x","conv3d"),s=C(n,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),D(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),D(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),D(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),D((h=i,Xv(e)||Xv(h)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),D("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=Cc(u.shape,s.shape,e,i,r),d=R.runKernelFunc(function(f,h){var p=f.conv3d(u,s,l);return h([u,s]),p},{x:u,$filter:s},function(f,h){D(Xv(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],g=h[1];return{x:function(){return NI(p.shape,f,g,e,r)},$filter:function(){return function(m,v,b,y,w){var x=m;4===m.rank&&(x=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var _=v;4===_.rank&&(_=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),D(5===x.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."}),D(5===_.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),D(5===b.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),D(x.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+b[3]+"."}),D(_.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+b[4]+")."});var M=Cc(x.shape,b,y,1,w);return R.runKernelFunc(function(I){return I.conv3dDerFilter(x,_,M)},{x5D:x,dy5D:_})}(p,f,g.shape,e,r)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Qv=T({conv2dDerFilter_:function(t,n,e,r,o,i,a){void 0===i&&(i="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=n;3===u.rank&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),D(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),D(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),D(4===e.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];D(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),D(l===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+e[3]+")."}),null!=a&&D(vt(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=vf(i),f=Mi(s.shape,e,r,1,o,a,!1,d);return R.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),FI=T({conv2dDerInput_:OI}),Mf=T({depthwiseConv2d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=C(t,"x","depthwiseConv2d"),u=C(n,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),D(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),D(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),D(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),D(Tn(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),null!=a&&D(vt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=Mi(c.shape,u.shape,e,i,r,a,!0),h=R.runKernelFunc(function(p,g){var m=p.depthwiseConv2D(c,u,d);return g([c,u]),m},{x:c,filter:u},function(p,g){D(fa(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var m=g[0],v=g[1];return{x:function(){return LI(m.shape,p,v,d)},filter:function(){return BI(m,p,v.shape,d)}}},"DepthwiseConv2dNative",d,[c,u]);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),LI=T({depthwiseConv2dDerInput_:function(t,n,e,r){var o=n,i=!1;3===n.rank&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=R.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),BI=T({depthwiseConv2dDerFilter_:function(t,n,e,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=n;return 3===i.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),R.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),Yv=T({separableConv2d_:function(t,n,e,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=C(t,"x","separableConv2d"),u=C(n,"depthwiseFilter","separableConv2d"),c=C(e,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),D(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),D(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),D(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),D(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],h=u.shape[3];D(c.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+c.shape[2]+"."});var p=Mf(l,u,r,o,a,i),g=yr(p,c,1,"valid",a);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),o6=T({conv2dTranspose_:function(t,n,e,r,o,i){return OI(e,C(t,"x","conv2dTranspose"),C(n,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),i6=T({conv3dTranspose_:function(t,n,e,r,o){return NI(e,C(t,"x","conv3dTranspose"),C(n,"filter","conv3dTranspose"),r,o)}}),Rf=T({matMul_:function(t,n,e,r){var o;void 0===e&&(e=!1),void 0===r&&(r=!1);var i=C(t,"a","matMul"),a=C(n,"b","matMul");o=pt(i,a),i=o[0],a=o[1];var s=e?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=e?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=i.shape.slice(0,-2),f=a.shape.slice(0,-2),h=ae(d),p=ae(f);D(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),D(Lt(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),D(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var g=i.shape.slice(0,-2).concat([c,l]),m=e?i.as3D(h,s,c):i.as3D(h,c,s),v=r?a.as3D(p,l,u):a.as3D(p,u,l);return R.runKernelFunc(function(y,w){var x=y.batchMatMul(m,v,e,r);return w([m,v]),x},{a:m,b:v},function(y,w){var _=w[0],M=w[1];return e||r?!e&&r?{a:function(){return y.matMul(M,!1,!1)},b:function(){return y.matMul(_,!0,!1)}}:e&&!r?{a:function(){return M.matMul(y,!1,!0)},b:function(){return _.matMul(y,!1,!1)}}:{a:function(){return M.matMul(y,!0,!0)},b:function(){return y.matMul(_,!0,!0)}}:{a:function(){return y.matMul(M,!1,!0)},b:function(){return _.matMul(y,!0,!1)}}},"BatchMatMul",{transposeA:e,transposeB:r}).reshape(g)}}),a6=T({dot_:function(t,n){var e=C(t,"t1","dot"),r=C(n,"t2","dot");D(!(1!==e.rank&&2!==e.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=1===e.rank?e.size:e.shape[1],i=1===r.rank?r.size:r.shape[0];return D(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===e.rank&&1===r.rank?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===e.rank&&2===r.rank?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===e.rank&&1===r.rank?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),s6=T({outerProduct_:function(t,n){var e=C(t,"v1","outerProduct"),r=C(n,"v2","outerProduct");return D(1===e.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),Rc=T({reverse_:function(t,n){var e=C(t,"x","reverse");if(0===e.rank)return e.clone();var r=Bt(n,e.shape);return R.runKernelFunc(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}}),u6=T({reverse1d_:function(t){var n=C(t,"x","reverse");return D(1===n.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),Rc(n,0)}}),c6=T({reverse2d_:function(t,n){var e=C(t,"x","reverse");return D(2===e.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Rc(e,n)}}),l6=T({reverse3d_:function(t,n){var e=C(t,"x","reverse");return D(3===e.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Rc(e,n)}}),d6=T({reverse4d_:function(t,n){var e=C(t,"x","reverse");return D(4===e.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Rc(e,n)}});function UI(t,n,e,r,o,i){var a=C(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),D(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),D(Tn(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),null!=i&&D(vt(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Ms(s.shape,n,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&Lt(c.inShape,c.outShape))return a.clone();var d=R.runKernelFunc(function(f,h){var p=f.maxPool(s,c);return h([s,p]),p},{x:s},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,b,y,w,x,_,M){var I=C(m,"dy","maxPoolBackprop"),E=C(v,"input","maxPoolBackprop"),S=C(b,"output","maxPoolBackprop");D(E.rank===I.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+I.rank+")"}),null==x&&(x=[1,1]),D(Tn(w,x),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+x+"'"}),D(4===I.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+I.rank+"."}),D(4===E.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+E.rank+"."});var P=Ms(E.shape,y,w,x,_,void 0);return R.runKernelFunc(function(A){return A.maxPoolBackprop(I,E,S,P)},{$dy:I,$input:E})}(f,p,g,n,e,r,o)}}},"MaxPool",c,[s]);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function VI(t,n,e,r,o,i){var a=C(t,"x","avgPool","float32");null==r&&(r=[1,1]),D(Tn(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),D(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&D(vt(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Ms(s.shape,n,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&Lt(c.inShape,c.outShape))return a.clone();var l=R.runKernelFunc(function(d){return d.avgPool(s,c)},{x:s},function(d){return{x:function(){return function(f,h,p,g,m,v){var b=C(f,"dy","avgPoolBackprop"),y=C(h,"input","avgPoolBackprop");D(y.rank===b.rank,function(){return"Rank of input ("+y.rank+") does not match rank of dy ("+b.rank+")"}),null==m&&(m=[1,1]),D(Tn(g,m),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"});var w=y,x=b,_=!1;3===y.rank&&(_=!0,w=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]),x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),D(4===x.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."}),D(4===w.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var M=Ms(w.shape,p,g,m,v),I=R.runKernelFunc(function(E){return E.avgPoolBackprop(x,w,M)},{dy4D:x,input4D:w});return _?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}(d,s,n,e,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Yt=T({maxPool_:function(t,n,e,r,o){return UI(t,n,e,1,r,o)}}),Tc=T({avgPool_:function(t,n,e,r,o){return VI(t,n,e,1,r,o)}}),f6=T({pool_:function(t,n,e,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=C(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),D(Tn(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,x,_,M,I,l=Ms(s.shape,n,i,o,r),d=[l.dilationHeight,l.dilationWidth];c="same"===r?(x=d,_=[l.filterHeight,l.filterWidth].map(function(E,S){return E+(E-1)*(x[S]-1)}).map(function(E){return E-1}),M=_.map(function(E){return Math.floor(E/2)}),I=_.map(function(E,S){return E-M[S]}),_.map(function(E,S){return[M[S],I[S]]})):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(w,x,_){var M=_.map(function(U){return U[0]}),I=_.map(function(U){return U[1]}),E=w.concat(M,I),S=x.map(function(U,F){return(U-E[F]%U)%U}),P=I.map(function(U,F){return U+S[F]});return[x.map(function(U,F){return[M[F],P[F]]}),x.map(function(U,F){return[0,S[F]]})]}([l.inHeight,l.inWidth],d,c),g=h[1],m=f?r:"valid",v=f?s:cS(s,d,h[0]),b=("avg"===e?function(){return VI(v,n,i,1,m)}:function(){return UI(v,n,i,1,m)})(),y=f?b:aS(b,d,g);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),h6=T({maxPool3d_:function(t,n,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=C(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),D(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),D("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),D(Tn(e,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&D(vt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=_c(u.shape,n,e,a,r,o,i),d=R.runKernelFunc(function(f,h){var p=f.maxPool3d(u,l);return h([u,p]),p},{x:u},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,b,y,w,x,_,M){var I=C(m,"dy","maxPool3dBackprop"),E=C(v,"input","maxPool3dBackprop"),S=C(b,"output","maxPool3dBackprop"),P=I,A=E,V=S,U=!1;4===E.rank&&(U=!0,P=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),A=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),V=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),D(5===P.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+P.rank+"."}),D(5===A.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),D(5===V.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+V.rank+"."}),null==x&&(x=[1,1,1]),D(Tn(w,x),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+x+"'"}),null!=M&&D(vt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+M+" but got pad "+_+"."});var F=_c(A.shape,y,w,x,_,M),W=R.runKernelFunc(function(H){return H.maxPool3dBackprop(P,A,V,F)},{dy5D:P,input5D:A});return U?W.as4D(W.shape[1],W.shape[2],W.shape[3],W.shape[4]):W}(f,p,g,n,e,a,r,o)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),p6=T({avgPool3d_:function(t,n,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=C(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),D(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),D("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),D(Tn(e,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&D(vt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=_c(u.shape,n,e,a,r,o,i),d=R.runKernelFunc(function(f){return f.avgPool3d(u,l)},{x:u},function(f){return{x:function(){return function(h,p,g,m,v,b,y){var w=C(h,"dy","avgPool3dBackprop"),x=C(p,"input","avgPool3dBackprop"),_=w,M=x,I=!1;4===x.rank&&(I=!0,_=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),M=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),D(5===_.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),D(5===M.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),null==v&&(v=[1,1,1]),D(Tn(m,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+v+"'"}),null!=y&&D(vt(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+b+"."});var E=_c(M.shape,g,m,v,b,y),S=R.runKernelFunc(function(P){return P.avgPool3dBackprop(_,M,E)},{dy5D:_,input5D:M});return I?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(f,u,n,e,a,r,o)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),ho=T({slice_:function(t,n,e){var r,o,i=C(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof n?[n].concat(new Array(i.rank-1).fill(0)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(0)):n.slice()).forEach(function(u){D(-1!==u,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==e?new Array(i.rank).fill(-1):"number"==typeof e?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(D(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-r[c])}),gS(i,r,o);var a=i.shape;return R.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return u.pad(c)}}},"Slice",{begin:r,size:o})}}),g6=T({slice1d_:function(t,n,e){var r=C(t,"x","slice1d");return D(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),ho(r,[n],[e])}}),m6=T({slice2d_:function(t,n,e){var r=C(t,"x","slice2d");return D(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),ho(r,n,e)}}),jI=T({slice3d_:function(t,n,e){var r=C(t,"x","slice3d");return D(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),ho(r,n,e)}}),v6=T({slice4d_:function(t,n,e){var r=C(t,"x","slice4d");return D(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),ho(r,n,e)}});function HI(t,n,e,r,o){return n.rank<e.rank&&(n=n.reshape(Rn(n.shape,r))),t.rank<e.rank&&(t=t.reshape(Rn(t.shape,r))),{x:function(){var i=t.mul(e.equal(n).cast(t.dtype));return null==o?i:i.transpose(o)}}}var y6=T({all_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","all","bool"),o=Bt(n,r.shape),i=o,a=Or(i,r.rank);null!=a&&(r=r.transpose(a),i=Nr(i.length,r.rank));var s=R.runKernelFunc(function(c){return c.all(r,i)},{$x:r});if(e){var u=Rn(s.shape,o);return s.reshape(u)}return s}}),b6=T({any_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","any","bool"),o=Bt(n,r.shape),i=o,a=Or(i,r.rank);null!=a&&(r=r.transpose(a),i=Nr(i.length,r.rank));var s=R.runKernelFunc(function(c){return c.any(r,i)},{$x:r});if(e){var u=Rn(s.shape,o);return s.reshape(u)}return s}}),w6=T({argMax_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","argMax");null==n&&(n=0);var r=Bt(n,e.shape),o=Or(r,e.rank);return null!=o&&(e=e.transpose(o),r=Nr(r.length,e.rank)),R.runKernelFunc(function(s,u){var c=s.argMax(e,r[0]);return u([e]),c},{x:e},function(s,u){var c=u[0];return{x:function(){return $e(c)}}},"ArgMax",{axis:r[0]},[e])}}),x6=T({argMin_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","argMin");null==n&&(n=0);var r=Bt(n,e.shape),o=Or(r,e.rank);return null!=o&&(e=e.transpose(o),r=Nr(r.length,e.rank)),R.runKernelFunc(function(i,a){var s=i.argMin(e,r[0]);return a([e]),s},{$x:e},function(i,a){var s=a[0];return{$x:function(){return $e(s)}}})}}),_6=T({logSumExp_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","logSumExp"),o=Bt(n,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(e){var u=Rn(s.shape,o);return s.reshape(u)}return s}}),Tf=T({max_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","max"),o=r,i=Bt(n,r.shape),a=i,s=Or(a,r.rank);null!=s&&(r=r.transpose(s),a=Nr(a.length,r.rank));var c=R.runKernelFunc(function(d,f){var h=d.max(r,a);return f([o,h]),h},{x:r},function(d,f){return HI(d,f[1],f[0],i,s)},"Max",{axes:a},[r],[!0]);if(e){var l=Rn(c.shape,i);c=c.reshape(l)}return c}}),C6=T({mean_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","mean"),o=Bt(n,r.shape),i=ae(an(r.shape,o)[1]);return pf(function(a){var s=Y(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(n,e),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(Ss(a.shape,"float32")).div(i)}}})(r)}}),D6=T({min_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","min"),o=r,i=Bt(n,r.shape),a=i,s=Or(a,r.rank);null!=s&&(r=r.transpose(s),a=Nr(a.length,r.rank));var c=R.runKernelFunc(function(d,f){var h=d.min(r,a);return f([o,h]),h},{x:r},function(d,f){return HI(d,f[1],f[0],i,s)},"Min",{axes:a},[r],[!0]);if(e){var l=Rn(c.shape,i);c=c.reshape(l)}return c}}),E6=T({moments_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=Bt(n,(t=C(t,"x","moments")).shape),o=t.mean(r,e),i=o.shape;e||(i=Rn(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,e)}}}),WI=T({sum_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=Bt(n,r.shape);return pf(function(i){var a=Or(o,i.rank),s=o,u=i;null!=a&&(u=i.transpose(a),s=Nr(s.length,i.rank));var c=function(h){var p=i.shape.slice();return o.forEach(function(g){p[g]=1}),h.reshape(p).mul(Ss(i.shape,"float32"))},d=R.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",{axes:s});if(e){var f=Rn(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:c}})(r)}}),S6=T({prod_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=Bt(n,r.shape),i=Or(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Nr(a.length,r.rank));var u=R.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(e){var c=Rn(u.shape,o);u=u.reshape(c)}return u}}),zI=T({elu_:function(t){var n=C(t,"x","elu");return R.runKernelFunc(function(e,r){var o=e.elu(n);return r([o]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return R.runKernelFunc(function(i){return i.eluDer(e,o)},{dy:e,y:o})}}})}}),I6=T({leakyRelu_:function(t,n){void 0===n&&(n=.2);var e=C(t,"x","leakyRelu");return qv(Y(n).mul(e),e)}}),$I=T({prelu_:function(t,n){var e=C(t,"x","prelu"),r=C(n,"alpha","prelu");return R.runKernelFunc(function(o,i){var a=o.prelu(e,r);return i([e,r]),a},{x:e,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return ga(u,o,o.mul(s))},alpha:function(){var c=ga(u,$e(o),o.mul(a)),l=Vt(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),yt=T({relu_:function(t){var n=C(t,"x","relu");return"bool"===n.dtype?n.toInt():R.runKernelFunc(function(e,r){var o=e.relu(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),GI=T({relu6_:function(t){var n=C(t,"x","relu6");return"bool"===n.dtype?n.toInt():R.runKernelFunc(function(e,r){var o=e.relu6(n);return r([n]),o},{x:n},function(e,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(i.toFloat())}}},"Relu6")}}),M6=T({selu_:function(t){var n=C(t,"x","selu");return R.runKernelFunc(function(e,r){var o=e.selu(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){var i=o.greater(Y(0)),a=Y(Wv),s=Y(zv),u=e.mul(s),c=e.mul(a).mul(o.toFloat().exp());return ga(i,u,c)}}})}}),Ri=T({transpose_:function(t,n){var e=C(t,"x","transpose");return null==n&&(n=e.shape.map(function(o,i){return i}).reverse()),D(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+n+"."}),n.forEach(function(o){D(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+n})}),e.rank<=1?e.clone():R.runKernelFunc(function(o){return o.transpose(e,n)},{x:e},function(o){var i=af(n);return{x:function(){return o.transpose(i)}}},"Transpose",{perm:n})}}),R6=T({localResponseNormalization_:function(t,n,e,r,o){void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=C(t,"x","localResponseNormalization");D(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),D(vt(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=R.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(a,n,e,r,o);return l([a,d]),d},{x4D:a},function(c,l){var d=l[0],f=l[1];return{x4D:function(){return R.runKernelFunc(function(h){return h.LRNGrad(c,d,f,n,e,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),qI=T({norm_:function(t,n,e,r){void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1);var o=function s(u,c,l){if(void 0===l&&(l=null),0===u.rank)return u.abs();if(1!==u.rank&&null===l)return s(u.reshape([-1]),c,l);if(1===u.rank||"number"==typeof l||Array.isArray(l)&&1===l.length){if(1===c)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if("euclidean"===c||2===c)return u.abs().pow(Y(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&2===l.length){if(1===c)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if("fro"===c||"euclidean"===c)return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(t=C(t,"x","norm"),n,e),i=o.shape;if(r){var a=Bt(e,t.shape);i=Rn(o.shape,a)}return o.reshape(i)}}),T6=T({basicLSTMCell_:function(t,n,e,r,o,i){var a=C(t,"forgetBias","basicLSTMCell"),s=C(n,"lstmKernel","basicLSTMCell"),u=C(e,"lstmBias","basicLSTMCell"),c=C(r,"data","basicLSTMCell"),l=C(o,"c","basicLSTMCell"),d=C(i,"h","basicLSTMCell"),f=c.concat(d,1).matMul(s).add(u),p=f.shape[1]/4,g=[f.shape[0],p],m=f.slice([0,0],g),v=f.slice([0,p],g),b=f.slice([0,2*p],g),y=f.slice([0,3*p],g),w=m.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(a.add(b).sigmoid())),x=w.tanh().mulStrict(y.sigmoid());return[w,x]}}),A6=T({multiRNNCell_:function(t,n,e,r){for(var o=C(n,"data","multiRNNCell"),i=wc(e,"c","multiRNNCell"),a=wc(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),P6=T({movingAverage_:function(t,n,e,r,o){void 0===o&&(o=!0);var i=C(t,"v","movingAverage"),a=C(n,"x","movingAverage"),s=C(e,"decay","movingAverage");I2(i,a),D(Lt(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Y(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){D(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=C(r,"step","movingAverage");l=l.div(u.sub(If(s,d)))}return i.add(l)}}),k6=T({stridedSlice_:function(t,n,e,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(n.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=C(t,"x","stridedSlice"),l=Ev(s),d=c.shape.slice();l.forEach(function(m){n[m]=0,e[m]=1,d.splice(m,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)n[f]=mS(o,n,r,c.shape,f),e[f]=vS(i,e,r,c.shape,f),r[f]=r[f]||1;var h=Ev(u);h.forEach(function(m){e[m]=n[m]+1,r[m]=1});var p=hf(n,e,r),g=p.filter(function(m,v){return-1===h.indexOf(v)});return r.every(function(m){return 1===m})?ho(c,n,p).reshape(g):R.runKernelFunc(function(m){return m.stridedSlice(c,n,e,r)},{$x:c}).reshape(g)}}),O6=T({topk_:function(t,n,e){void 0===n&&(n=1),void 0===e&&(e=!0);var r=C(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(n>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+n);var i=R.runKernelFunc(function(a){return a.topk(r,n,e)},{$x:r});return{values:i[0],indices:i[1]}}}),N6=T({scatterND_:function(t,n,e){var r=C(t,"indices","scatterND","int32"),o=C(n,"updates","scatterND");return pS(o,r,e),R.runKernelFunc(function(i){return i.scatterND(r,o,e)},{indices:r,updates:o},null,"ScatterNd",{shape:e})}}),Jv=T({fft_:function(t){D("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return R.runKernelFunc(function(o){return o.fft(r)},{input:t}).reshape(t.shape)}}),Af=T({ifft_:function(t){D("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return R.runKernelFunc(function(o){return o.ifft(r)},{input:t}).reshape(t.shape)}}),Zv=T({rfft_:function(t,n){D("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var e,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=n&&n<r){var i=t.shape.map(function(v){return 0}),a=t.shape.map(function(v){return v});a[t.shape.length-1]=n,e=t.slice(i,a),r=n}else if(null!=n&&n>r){var s=t.shape.map(function(v){return v});s[t.shape.length-1]=n-r,e=t.concat(ht(s),t.shape.length-1),r=n}else e=t;var u=e.zerosLike(),c=sn(e,u).as2D(o,r),l=Jv(c),d=Math.floor(r/2)+1,f=mr(l),h=lo(l),p=f.split([d,r-d],f.shape.length-1),g=h.split([d,r-d],h.shape.length-1),m=e.shape.slice();return m[e.shape.length-1]=d,sn(p[0],g[0]).reshape(m)}}),KI=T({irfft_:function(t){var n=t.shape[t.shape.length-1],e=t.size/n;if(n<=2){var r=t.as2D(e,n),o=Af(r);return mr(o)}var i=[e,2*(n-1)],a=mr(t).as2D(e,n),s=lo(t).as2D(e,n),u=a.slice([0,1],[e,n-2]).reverse(1),c=s.slice([0,1],[e,n-2]).reverse(1).mul(Y(-1)),l=a.concat(u,1),d=s.concat(c,1);return r=sn(l,d).as2D(i[0],i[1]),o=Af(r),mr(o)}}),F6=Object.freeze({fft:Jv,ifft:Af,rfft:Zv,irfft:KI}),L6=T({sparseToDense_:function(t,n,e,r){void 0===r&&(r=0);var o=C(t,"sparseIndices","sparseToDense","int32"),i=C(n,"sparseValues","sparseToDense"),a=C(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");if(0!==u.rank&&(1!==u.rank||u.size!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,e,a),R.runKernelFunc(function(s){return s.sparseToDense(o,i,e,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),B6=T({gatherND_:function(t,n){var e=C(n,"indices","gatherND","int32"),r=C(t,"x","gatherND");return R.runKernelFunc(function(o){return o.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),U6=T({diag_:function(t){var n=C(t,"x","diag").flatten(),e=t.shape.concat(t.shape);return R.runKernelFunc(function(r){return r.diag(n)},{$x:n}).reshape(e)}}),V6=T({dropout_:function(t,n,e,r){var o=C(t,"x","dropout");if(D("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),D(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),0===n)return t instanceof ot?o.clone():o;var i=function(u,c){if(null==c)return u.shape.slice();if(Lt(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)l.push(null==c[d]&&null!=u.shape[d]?u.shape[d]:c[d]);return l}return c}(o,e),a=1-n,s=uS(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function XI(t,n,e){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=n-e*Math.cos(a)}return Ut(o,"float32")}var wn,ey=T({hannWindow_:function(t){return XI(t,.5,.5)}}),QI=T({hammingWindow_:function(t){return XI(t,.54,.46)}}),ty=T({frame_:function(t,n,e,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+n<=t.size;)a.push(ho(t,i,n)),i+=e;if(r)for(;i<t.size;){var s=i+n-t.size,u=Gt([ho(t,i,n-s),fo([s],o)]);a.push(u),i+=e}return 0===a.length?Ii([],[0,n]):Gt(a).as2D(a.length,n)}}),YI=T({stft_:function(t,n,e,r,o){void 0===o&&(o=ey),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))));for(var a=ty(t,n,e),s=bn(a,o(n)),u=[],c=0;c<a.shape[0];c++)u.push(Zv(s.slice([c,0],[1,n]),r));return Gt(u)}}),j6=Object.freeze({hannWindow:ey,hammingWindow:QI,frame:ty,stft:YI});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(wn||(wn={}));var W6=T({absoluteDifference_:function(t,n,e,r){void 0===r&&(r=wn.SUM_BY_NONZERO_WEIGHTS);var o=C(t,"labels","absoluteDifference"),i=C(n,"predictions","absoluteDifference"),a=null;null!=e&&(a=C(e,"weights","absoluteDifference")),ze(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Qo(s,a,r)}}),Qo=T({computeWeightedLoss_:function(t,n,e){void 0===e&&(e=wn.SUM_BY_NONZERO_WEIGHTS);var r=C(t,"losses","computeWeightedLoss"),o=null;null!=n&&(o=C(n,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(e===wn.NONE)return i;if(e===wn.SUM)return i.sum();if(e===wn.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(Y(a)):s}if(e===wn.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(Y(r.size));var u=o.mul(Ss(r.shape)).notEqual(Y(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+e)}}),z6=T({cosineDistance_:function(t,n,e,r,o){void 0===o&&(o=wn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"labels","cosineDistance"),a=C(n,"predictions","cosineDistance"),s=null;null!=r&&(s=C(r,"weights","cosineDistance")),ze(i.shape,a.shape,"Error in cosineDistance: ");var u=Y(1).sub(i.mul(a).sum(e,!0));return Qo(u,s,o)}}),$6=T({hingeLoss_:function(t,n,e,r){void 0===r&&(r=wn.SUM_BY_NONZERO_WEIGHTS);var o=C(t,"labels","hingeLoss"),i=C(n,"predictions","hingeLoss"),a=null;null!=e&&(a=C(e,"weights","hingeLoss")),ze(o.shape,i.shape,"Error in hingeLoss: ");var s=Y(1);o=Y(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Qo(u,a,r)}}),G6=T({huberLoss_:function(t,n,e,r,o){void 0===r&&(r=1),void 0===o&&(o=wn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"labels","huberLoss"),a=C(n,"predictions","huberLoss"),s=null;null!=e&&(s=C(e,"weights","huberLoss")),ze(i.shape,a.shape,"Error in huberLoss: ");var u=Y(r),c=a.sub(i).abs(),l=MI(c,u),d=c.sub(l),f=Y(.5).mul(l.square()).add(u.mul(d));return Qo(f,s,o)}}),q6=T({logLoss_:function(t,n,e,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=wn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"labels","logLoss"),a=C(n,"predictions","logLoss"),s=null;null!=e&&(s=C(e,"weights","logLoss")),ze(i.shape,a.shape,"Error in logLoss: ");var u=Y(1),c=Y(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return Qo(l,s,o)}}),K6=T({meanSquaredError_:function(t,n,e,r){void 0===r&&(r=wn.SUM_BY_NONZERO_WEIGHTS);var o=C(t,"labels","meanSquaredError"),i=C(n,"predictions","meanSquaredError"),a=null;null!=e&&(a=C(e,"weights","meanSquaredError")),ze(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Qo(s,a,r)}}),X6=T({sigmoidCrossEntropy_:function(t,n,e,r,o){void 0===r&&(r=0),void 0===o&&(o=wn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"multiClassLabels","sigmoidCrossEntropy"),a=C(n,"logits","sigmoidCrossEntropy"),s=null;if(null!=e&&(s=C(e,"weights","sigmoidCrossEntropy")),ze(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Y(r),c=Y(1),l=Y(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var d=function(f,h){var p=C(f,"labels","sigmoidCrossEntropyWithLogits"),g=C(h,"logits","sigmoidCrossEntropyWithLogits");ze(p.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=g.relu(),v=g.mul(p),b=g.abs().neg().exp().log1p();return m.sub(v).add(b)}(i,a);return Qo(d,s,o)}}),Q6=T({softmaxCrossEntropy_:function(t,n,e,r,o){void 0===r&&(r=0),void 0===o&&(o=wn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"onehotLabels","softmaxCrossEntropy"),a=C(n,"logits","softmaxCrossEntropy"),s=null;if(null!=e&&(s=C(e,"weights","softmaxCrossEntropy")),ze(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Y(r),c=Y(1),l=Y(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var d=function(f,h,p){if(void 0===p&&(p=-1),-1===p&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return pf(function(g,m,v){var b=m.logSumExp([p],!0),y=m.toFloat().sub(b);return v([g,y]),{value:y.mul(g).neg().sum([p]),gradFunc:function(w,x){var _=x[0],M=x[1],I=Rn(w.shape,[p]);return[w.reshape(I).mul(_.toFloat().sub(M.exp())),w.reshape(I).mul(M.exp().sub(_.toFloat()))]}}})(f,h)}(i,a);return Qo(d,s,o)}}),Y6=Object.freeze({get Reduction(){return wn},absoluteDifference:W6,computeWeightedLoss:Qo,cosineDistance:z6,hingeLoss:$6,huberLoss:G6,logLoss:q6,meanSquaredError:K6,sigmoidCrossEntropy:X6,softmaxCrossEntropy:Q6});function JI(t,n){return void 0===n&&(n=!1),R.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var e=t.shape[0],r=t.shape[1],o=sS(e),i=t.clone(),a=Ii([[1]],[1,1]),s=a.clone(),u=e>=r?r:e,c=function(d){var f,h=i,p=s,g=o;f=R.tidy(function(){var m=i.slice([d,d],[e-d,1]),v=m.norm(),b=i.slice([d,d],[1,1]),y=Ii([[-1]]).where(b.greater(0),Ii([[1]])),w=b.sub(y.mul(v)),x=m.div(w);s=1===x.shape[0]?a.clone():a.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var _=y.matMul(w).div(v).neg(),M=i.slice([d,0],[e-d,r]),I=_.mul(s);if(0===d)i=M.sub(I.matMul(s.transpose().matMul(M)));else{var E=M.sub(I.matMul(s.transpose().matMul(M)));i=i.slice([0,0],[d,r]).concat(E,0)}var S=o.slice([0,d],[e,o.shape[1]-d]);if(0===d)o=S.sub(S.matMul(s).matMul(I.transpose()));else{var P=S.sub(S.matMul(s).matMul(I.transpose()));o=o.slice([0,0],[e,d]).concat(P,1)}return[s,i,o]}),s=f[0],i=f[1],o=f[2],Ln([h,p,g])},l=0;l<u;++l)c(l);return!n&&e>r&&(o=o.slice([0,0],[e,r]),i=i.slice([0,0],[r,r])),[o,i]})}var J6=T({bandPart_:function(t,n,e){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=C(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(n<=a))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+a+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");n<0&&(n=a),e<0&&(e=s);var u=sf(0,a,1,"int32").reshape([-1,1]),c=sf(0,s,1,"int32"),l=Kt(u,c),d=Sf(l.lessEqual(Y(+n,"int32")),l.greaterEqual(Y(-e,"int32"))),f=ht([a,s],r.dtype);return nr(qt(r.reshape([-1,a,s])).map(function(h){return ga(d,h,f)})).reshape(o)}}),Z6=T({gramSchmidt_:function(t){var n;if(Array.isArray(t)){n=!1,D(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=t[0].shape[0],r=function(u){D(t[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+e+")"})},o=1;o<t.length;++o)r(o)}else n=!0,t=wv(t,t.shape[0],0).map(function(u){return lS(u,[0])});D(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(u){i.push(R.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var d=WI(i[l].mulStrict(c)).mul(i[l]);c=c.sub(d)}return c.div(qI(c,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return n?nr(i,0):i}}),e8=T({qr_:function(t,n){if(void 0===n&&(n=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return JI(t,n);var e=t.shape.slice(0,t.shape.length-2).reduce(function(a,s){return a*s}),r=qt(t.reshape([e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=JI(a,n),c=s[1];o.push(s[0]),i.push(c)}),[nr(o,0).reshape(t.shape),nr(i,0).reshape(t.shape)]}}),t8=Object.freeze({bandPart:J6,gramSchmidt:Z6,qr:e8});function Pf(t,n,e,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=t.shape[0];return e=Math.min(e,a),D(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),D(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),D(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),D(1===n.rank,function(){return"scores must be a 1D tensor"}),D(n.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+n.shape[0]}),D(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var n8=T({resizeBilinear_:function(t,n,e){void 0===e&&(e=!1);var r=C(t,"images","resizeBilinear");D(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),D(2===n.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([o]),c.resizeBilinear(o,a,s,e)},{x:o},function(c,l){return{x:function(){return R.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),r8=T({resizeNearestNeighbor_:function(t,n,e){void 0===e&&(e=!1);var r=C(t,"images","resizeNearestNeighbor");D(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),D(2===n.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),D("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,e)},{batchImages:o},function(c,l){return{batchImages:function(){return R.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],e)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),o8=T({nonMaxSuppression_:function(t,n,e,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=C(t,"boxes","nonMaxSuppression"),a=C(n,"scores","nonMaxSuppression"),s=Pf(i,a,e,r,o);return R.runKernelFunc(function(c){return c.nonMaxSuppression(i,a,e,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:e=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:o=s.scoreThreshold})}}),a8=T({nonMaxSuppressionWithScore_:function(t,n,e,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=C(t,"boxes","nonMaxSuppression"),s=C(n,"scores","nonMaxSuppression"),u=Pf(a,s,e,r,o,i),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=R.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),u8=T({cropAndResize_:function(t,n,e,r,o,i){var a=C(t,"image","cropAndResize"),s=C(n,"boxes","cropAndResize","float32"),u=C(e,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return D(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),D(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),D(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),D(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),D(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),D("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),R.runKernelFunc(function(l,d){return l.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),ny=Object.freeze({resizeBilinear:n8,resizeNearestNeighbor:r8,nonMaxSuppression:o8,nonMaxSuppressionAsync:function(t,n,e,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),oe(this,void 0,void 0,function(){var i,a,s,u,d;return ie(this,function(f){switch(f.label){case 0:return i=C(t,"boxes","nonMaxSuppressionAsync"),a=C(n,"scores","nonMaxSuppressionAsync"),s=Pf(i,a,e,r,o),e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=f.sent(),d=kv(u[0],u[1],e,r,o),i!==t&&i.dispose(),a!==n&&a.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:a8,nonMaxSuppressionWithScoreAsync:function(t,n,e,r,o,i){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),oe(this,void 0,void 0,function(){var a,s,u,c,f;return ie(this,function(h){switch(h.label){case 0:return a=C(t,"boxes","nonMaxSuppressionAsync"),s=C(n,"scores","nonMaxSuppressionAsync"),u=Pf(a,s,e,r,o,i),e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),f=Ov(c[0],c[1],e,r,o,i),a!==t&&a.dispose(),s!==n&&s.dispose(),[2,f]}})})},cropAndResize:u8}),ry=function(t,n){return!(t>0)||"linear"===n},oy=function(t,n,e){if(null==e||"linear"===e)return t;if("relu"===e)return t.mul(n.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},iy=function(t,n){var e=n,r=Vt(t.shape,n.shape);return r.length>0&&(e=e.sum(r)),e.reshape(t.shape)},ay=function(t,n,e){if("linear"===n)return t;if("relu"===n)return yt(t);if("elu"===n)return zI(t);if("relu6"===n)return GI(t);if("prelu"===n)return $I(t,e);throw new Error("Unknown fused activation "+n+".")},c8=T({fusedMatMul_:function(t){var n,e=t.a,r=t.b,o=t.transposeA,i=void 0!==o&&o,a=t.transposeB,s=void 0!==a&&a,u=t.bias,c=t.activation,l=void 0===c?"linear":c,d=t.preluActivationWeights;if(!1===ry(R.state.gradientDepth,l)){var f=Rf(e,r,i,s);return null!=u&&(f=Be(f,u)),ay(f,l,d)}var h=C(e,"a","fused matMul"),p=C(r,"b","fused matMul");n=pt(h,p),h=n[0],p=n[1];var g=i?h.shape[h.rank-2]:h.shape[h.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=h.shape.slice(0,-2),w=p.shape.slice(0,-2),x=ae(y),_=ae(w);D(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),D(Lt(y,w),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+w+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),D(g===m,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+m+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var M,I,E=h.shape.slice(0,-2).concat([v,b]),S=i?h.as3D(x,g,v):h.as3D(x,v,g),P=s?p.as3D(_,b,m):p.as3D(_,m,b);null!=u&&Le(E,(M=pt(M=C(u,"bias","fused matMul"),h)[0]).shape),null!=d&&(I=C(d,"prelu weights","fused matMul"));var A={a:S,b:P};return null!=u&&(A.bias=M),null!=d&&(A.preluActivationWeights=I),R.runKernelFunc(function(U,F){var W=U.fusedBatchMatMul({a:S,b:P,transposeA:i,transposeB:s,bias:M,activation:l,preluActivationWeights:I});return F([S,P,W]),W},A,function(U,F){var W=F[0],H=F[1],q=oy(U,F[2],l),K={};return null!=u&&(K={bias:function(){return iy(M,q)}}),Object.assign(i||s?!i&&s?{a:function(){return q.matMul(H,!1,!1)},b:function(){return q.matMul(W,!0,!1)}}:i&&!s?{a:function(){return H.matMul(q,!1,!0)},b:function(){return W.matMul(q,!1,!1)}}:{a:function(){return H.matMul(q,!0,!0)},b:function(){return q.matMul(W,!0,!0)}}:{a:function(){return q.matMul(H,!1,!0)},b:function(){return W.matMul(q,!0,!1)}},K)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},[S,P],[!0]).reshape(E)}}),l8=T({fusedConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===ry(R.state.gradientDepth,f=f||"linear")){var p=yr(n,e,r,o,a,u,c);return null!=l&&(p=Be(p,l)),ay(p,f,h)}var g=C(n,"x","conv2d"),m=C(e,"filter","conv2d"),v=g,b=!1;3===g.rank&&(b=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),D(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),D(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=c&&D(vt(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),D(v.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),D(Tn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),D("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var y,w,x=Mi(v.shape,m.shape,r,u,o,c);null!=l&&(y=pt(y=C(l,"bias","fused conv2d"),g)[0],Le(x.outShape,y.shape)),null!=h&&(w=C(h,"prelu weights","fused conv2d"));var _={x:v,filter:m};null!=l&&(_.bias=y),null!=h&&(_.preluActivationWeights=w);var I=R.runKernelFunc(function(E,S){var P=E.fusedConv2d({input:v,filter:m,convInfo:x,bias:y,activation:f,preluActivationWeights:w});return S([m,v,P]),P},_,function(E,S){var A=S[0],V=S[1],F=oy(E,S[2],f);D(fa(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var W={};return null!=l&&(W={bias:function(){return iy(y,F)}}),Object.assign({x:function(){return FI(V.shape,F,A,r,o)},filter:function(){return Qv(V,F,A.shape,r,o)}},W)},"FusedConv2D",{convInfo:x,activation:f},[m,v],[!0]);return b?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),d8=T({fusedDepthwiseConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===ry(R.state.gradientDepth,f)){var p=Mf(n,e,r,o,a,u,c);return null!=l&&(p=Be(p,l)),ay(p,f,h)}var g=C(n,"x","depthwiseConv2d"),m=C(e,"filter","depthwiseConv2d"),v=g,b=!1;3===g.rank&&(b=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),D(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),D(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),D(v.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==u&&(u=[1,1]),D(Tn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&D(vt(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var y,w,x=Mi(v.shape,m.shape,r,u,o,c,!0);null!=l&&(y=pt(y=C(l,"bias","fused conv2d"),g)[0],Le(x.outShape,y.shape)),null!=h&&(w=C(h,"prelu weights","fused depthwiseConv2d"));var _={x:v,filter:m};null!=l&&(_.bias=y),null!=h&&(_.preluActivationWeights=w);var I=R.runKernelFunc(function(E,S){var P=E.fusedDepthwiseConv2D({input:v,filter:m,convInfo:x,bias:y,activation:f,preluActivationWeights:w});return S([m,v,P]),P},_,function(E,S){D(fa(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var P=S[0],A=S[1],U=oy(E,S[2],f),F={};return null!=l&&(F={bias:function(){return iy(y,U)}}),Object.assign({x:function(){return LI(A.shape,U,P,x)},filter:function(){return BI(A,U,P.shape,x)}},F)},"FusedDepthwiseConv2D",{convInfo:x,activation:f},[m,v],[!0]);return b?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),f8=Object.freeze({matMul:c8,conv2d:l8,depthwiseConv2d:d8}),h8=Object.freeze({image:ny,linalg:t8,losses:Y6,spectral:F6,fused:f8,signal:j6,square:qW,squaredDifference:yI,conv1d:n6,conv2d:yr,conv3d:r6,depthwiseConv2d:Mf,separableConv2d:Yv,conv2dTranspose:o6,conv3dTranspose:i6,op:T,batchNormalization2d:Cz,batchNormalization3d:Dz,batchNormalization4d:Ez,batchNormalization:Sz,batchNorm:DI,batchNorm2d:Iz,batchNorm3d:Mz,batchNorm4d:Rz,booleanMaskAsync:function(t,n,e){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,g;return ie(this,function(m){switch(m.label){case 0:for(r=C(t,"tensor","boolMask"),o=C(n,"mask","boolMask","bool"),i=e??0,s=r.shape,D((a=o.rank)>0,function(){return"mask cannot be scalar"}),ze(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),d=r.reshape(l),f=o.reshape([-1]),[4,SI(f)];case 1:return h=m.sent(),p=h.squeeze([1]),g=Kv(d,p,i),t!==r&&r.dispose(),n!==o&&o.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,g]}})})},complex:sn,real:mr,imag:lo,concat:Gt,concat1d:Oj,concat2d:Nj,concat3d:Fj,concat4d:Lj,split:wv,matMul:Rf,dot:a6,outerProduct:s6,reverse:Rc,reverse1d:u6,reverse2d:c6,reverse3d:l6,reverse4d:d6,maxPool:Yt,avgPool:Tc,pool:f6,maxPool3d:h6,avgPool3d:p6,slice:ho,slice1d:g6,slice2d:m6,slice3d:jI,slice4d:v6,abs:KW,acos:XW,acosh:QW,asin:YW,asinh:JW,atan:ZW,atanh:ez,ceil:tz,clipByValue:$v,cos:nz,cosh:rz,erf:oz,exp:Gv,expm1:iz,floor:az,log:sz,log1p:uz,logSigmoid:cz,neg:Cf,reciprocal:lz,round:dz,rsqrt:bI,sigmoid:wI,sign:fz,isNaN:hz,isInf:pz,isFinite:gz,sin:mz,sinh:vz,softplus:yz,sqrt:bz,step:wz,tan:xz,tanh:_z,all:y6,any:b6,argMax:w6,argMin:x6,logSumExp:_6,max:Tf,mean:C6,min:D6,moments:E6,sum:WI,prod:S6,equal:RI,equalStrict:$z,greater:Gz,greaterEqual:TI,greaterEqualStrict:qz,greaterStrict:Kz,less:Xz,lessEqual:Qz,lessEqualStrict:Yz,lessStrict:Jz,notEqual:Zz,notEqualStrict:e6,add:Be,addN:Pz,addStrict:kz,atan2:Oz,div:Br,divNoNan:Nz,divStrict:Fz,floorDiv:II,maximum:qv,maximumStrict:Lz,minimum:MI,minimumStrict:Bz,mod:Uz,modStrict:Vz,mul:bn,mulStrict:jz,pow:If,powStrict:Hz,squaredDifferenceStrict:Wz,sub:Kt,subStrict:zz,elu:zI,leakyRelu:I6,prelu:$I,relu:yt,relu6:GI,selu:M6,logicalAnd:Sf,logicalNot:Tz,logicalOr:EI,logicalXor:Az,where:ga,whereAsync:SI,buffer:Se,print:function Gj(t,n){void 0===n&&(n=!1),console.log(t.toString(n))},batchToSpaceND:aS,broadcastTo:qj,cast:Kj,clone:Xj,cumsum:Qj,depthToSpace:Yj,expandDims:vr,eye:sS,multinomial:Jj,oneHot:_v,pad:da,pad1d:Zj,pad2d:eH,pad3d:tH,pad4d:nH,rand:rH,randomNormal:oH,randomGamma:iH,randomUniform:uS,reshape:Fr,spaceToBatchND:cS,squeeze:lS,stack:nr,tile:Is,truncatedNormal:aH,unstack:qt,setdiff1dAsync:function(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d;return ie(this,function(f){switch(f.label){case 0:return e=C(t,"x","setdiff1d"),r=C(n,"y","setdiff1d"),D(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),D(1===e.rank,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),D(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(i=f.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new dc([s],e.dtype),c=new dc([s],"int32"),l=0,d=0;l<o.length;l++)a.has(o[l])||(u.values[d]=o[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:fo,linspace:function kj(t,n,e){if(e<=0)throw new Error("The number of values should be positive.");return R.runKernelFunc(function(r){return r.linspace(t,n,e)},{})},ones:Ss,range:sf,scalar:Y,tensor:un,tensor1d:Ut,tensor2d:Ii,tensor3d:bv,tensor4d:Un,tensor5d:function Tj(t,n,e){if(ia(t),null!=n&&5!==n.length)throw new Error("tensor5d() requires shape to have five numbers");var r=co(t,e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Si(t,n,r,e)},tensor6d:function Aj(t,n,e){if(ia(t),null!=n&&6!==n.length)throw new Error("tensor6d() requires shape to have six numbers");var r=co(t,e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Si(t,n=n||r,r,e)},variable:function Pj(t,n,e,r){return void 0===n&&(n=!0),R.makeVariable(t,n,e,r)},zeros:ht,onesLike:iS,zerosLike:$e,transpose:Ri,softmax:qo,logSoftmax:cH,localResponseNormalization:R6,norm:qI,gather:Kv,unsortedSegmentSum:kI,basicLSTMCell:T6,multiRNNCell:A6,movingAverage:P6,stridedSlice:k6,topk:O6,scatterND:N6,fft:Jv,ifft:Af,rfft:Zv,irfft:KI,sparseToDense:L6,gatherND:B6,diag:U6,dropout:V6,hannWindow:ey,hammingWindow:QI,frame:ty,stft:YI,inTopKAsync:function(t,n,e){return void 0===e&&(e=1),oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,g,m;return ie(this,function(v){switch(v.label){case 0:return r=C(t,"predictions","inTopK"),o=C(n,"targets","inTopK"),D(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),D(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),ze(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],D(e>0&&e<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),l=(u=[a.length/i,i])[1],d=_s("bool",c=u[0]),f=0;f<c;f++){for(p=a.subarray(h=f*l,h+l),g=[],m=0;m<p.length;m++)g.push({value:p[m],index:m});for(g.sort(function(b,y){return y.value-b.value}),d[f]=0,m=0;m<e;m++)if(g[m].index===s[f]){d[f]=1;break}}return t!==r&&r.dispose(),n!==o&&o.dispose(),[2,un(d,o.shape,"bool")]}})})}});function z(t,n){Array.isArray(t)||(t=[t]),t.forEach(function(e){null!=e&&D("complex64"!==e.dtype,function(){return n+" does not support complex64 tensors."})})}function sy(t,n,e,r){if("linear"===e)return t.linear(n);if("relu"===e)return t.relu(n);if("elu"===e)return t.elu(n);if("relu6"===e)return t.relu6(n);if("prelu"===e)return t.prelu(n,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var p8=function(t){function n(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new yS(e,R),e}return Ar(n,t),n.prototype.write=function(e,r,o){this.firstUse&&(this.firstUse=!1,L().get("IS_NODE")&&rf("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var i={};return this.data.set(i,{values:e,dtype:o}),i},n.prototype.move=function(e,r,o,i){this.data.set(e,{values:r,dtype:i})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var r=this.data.get(e),i=r.complexTensors;return"complex64"===r.dtype?Pv(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),o=r;if("string"===e.dtype)try{o=r.map(function(i){return sc(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Se(e.shape,e.dtype,o)},n.prototype.makeOutput=function(e,r,o){var i=this.write(e,r,o);return R.makeTensorFromDataId(i,r,o,this)},n.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){return r=kr(),e(),[2,{kernelMs:kr()-r}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,r){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(r.clone())},o},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(z(e,"slice"),Sv(e.shape,r,o)){var i=Iv(r,e.strides),a=ae(o);return un(this.readSync(e.dataId).subarray(i,i+a),o,e.dtype)}for(var s=Se(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(d,f){return d+r[f]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},n.prototype.stridedSlice=function(e,r,o,i){z(e,"stridedSlice");var a=hf(r,o,i);if(a.some(function(h){return 0===h}))return un([],a);for(var s=Se(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),d=new Array(l.length),f=0;f<d.length;f++)d[f]=l[f]*i[f]+r[f];s.set.apply(s,[u.get.apply(u,d)].concat(l))}return s.toTensor()},n.prototype.diag=function(e){for(var r=this.readSync(e.dataId),o=Se([e.size,e.size],e.dtype),i=o.values,a=0;a<r.length;a++)i[a*e.size+a]=r[a];return o.toTensor()},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.reverse=function(e,r){z(e,"reverse");for(var o=Se(e.shape,e.dtype),i=this.bufferSync(e),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach(function(d){return l[d]=e.shape[d]-1-l[d]}),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},n.prototype.concat=function(e,r){var o=this;if("complex64"===e[0].dtype){var i=e.map(function(h){return mr(h)}),a=e.map(function(h){return lo(h)});return sn(this.concat(i,r),this.concat(a,r))}var s=e.map(function(h){var p=ae(h.shape.slice(r));return h.as2D(-1,p)}),u=ua(s.map(function(h){return h.shape}),1),c=Se(u,e[0].dtype).values;if(1===s[0].shape[0]){var l=0;s.forEach(function(h){c.set(o.readSync(h.dataId),l),l+=h.size})}else{var d=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),g=0,m=0;m<h.shape[0];++m)for(var v=m*u[1]+d,b=0;b<h.shape[1];++b)c[v+b]=p[g++];d+=h.shape[1]})}var f=ua(e.map(function(h){return h.shape}),r);return un(c,f,e[0].dtype)},n.prototype.neg=function(e){return z(e,"neg"),this.multiply(Y(-1),e)},n.prototype.add=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(e,r,Qt(e.dtype,r.dtype),function(o,i){return o+i})},n.prototype.addN=function(e){var r=this;z(e,"addN");for(var o=e.map(function(l){return r.readSync(l.dataId)}),i=Se(e[0].shape,e[0].dtype),a=i.values,s=0;s<e.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},n.prototype.softmax=function(e,r){var o=Bt([r],e.shape),i=this.max(e,o),a=Rn(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.subtract=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(e,r,Qt(e.dtype,r.dtype),function(o,i){return o-i})},n.prototype.pow=function(e,r){return z([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.pow(o,i)})},n.prototype.batchMatMul=function(e,r,o,i){z([e,r],"matMul");for(var a=o?e.shape[1]:e.shape[2],s=o?e.shape[2]:e.shape[1],u=i?r.shape[1]:r.shape[2],c=e.shape[0],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=f[0],p=f[1],g=f[2],m=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=m[0],b=m[1],y=m[2],w=s*u,x=Se([c,s,u],e.dtype),_=x.values,M=this.blockSize,I=0;I<c;I++)for(var E=0;E<s;E+=M)for(var S=0;S<u;S+=M)for(var P=0;P<a;P+=M)for(var A=Math.min(E+M,s),V=Math.min(S+M,u),U=Math.min(P+M,a),F=E;F<A;F++)for(var W=S;W<V;W++){for(var H=0,j=P;j<U;j++)H+=l[I*h+F*p+j*g]*d[j*v+W*b+I*y];_[I*w+(F*u+W)]+=H}return x.toTensor()},n.prototype.fusedBatchMatMul=function(e){var s=e.bias,u=e.activation,c=e.preluActivationWeights,l=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return s&&(l=this.add(l,s)),u&&(l=sy(this,l,u,c)),l},n.prototype.multiply=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(e,r,Qt(e.dtype,r.dtype),function(o,i){return o*i})},n.prototype.realDivide=function(e,r){return z([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(o,i){return o/i})},n.prototype.floorDiv=function(e,r){return z([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(o,i){return Math.floor(o/i)})},n.prototype.sum=function(e,r){z(e,"sum"),Bn("sum",r,e.rank);for(var o=an(e.shape,r),a=o[1],s=ht(o[0],Qt(e.dtype,"int32")),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=l[f+p];c[d]=h}return s},n.prototype.prod=function(e,r){z(e,"sum");for(var o=an(e.shape,r),a=o[1],s=ht(o[0],Qt(e.dtype,"int32")),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=l[f+p];c[d]=h}return s},n.prototype.unsortedSegmentSum=function(e,r,o){z(e,"unsortedSegmentSum");for(var i=[],a=e.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=Y(s,"int32"),c=RI(u,r).asType("float32").mul(e).sum(0);i.push(c)}return nr(i)},n.prototype.argMin=function(e,r){z(e,"argMin");var o=[r];Bn("argMin",o,e.rank);for(var i=an(e.shape,o),s=i[1],u=ht(i[0],"int32"),c=ae(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,m=0;m<c;++m){var v=d[h+m];v<p&&(p=v,g=m)}l[f]=g}return u},n.prototype.argMax=function(e,r){z(e,"argMax");var o=[r];Bn("argMax",o,e.rank);for(var i=an(e.shape,o),s=i[1],u=ht(i[0],"int32"),c=ae(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,m=0;m<c;++m){var v=d[h+m];v>p&&(p=v,g=m)}l[f]=g}return u},n.prototype.cumsum=function(e,r,o,i){if(z(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var a=Qt(e.dtype,"int32"),s=ht(e.shape,a),u=this.readSync(s.dataId),c=this.readSync(e.dataId),l=e.shape[e.rank-1],d=i?function(m,v){return m+l-v-1}:function(m,v){return m+v},f=0;f<c.length;f+=l)for(var h=0;h<l;h++){var p=d(f,h);if(0===h)u[p]=o?0:c[p];else{var g=d(f,h-1);u[p]=o?c[g]+u[g]:c[p]+u[g]}}return s},n.prototype.equal=function(e,r){return z([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o===i?1:0})},n.prototype.notEqual=function(e,r){return z([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o!==i?1:0})},n.prototype.less=function(e,r){return z([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<i?1:0})},n.prototype.lessEqual=function(e,r){return z([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<=i?1:0})},n.prototype.greater=function(e,r){return z([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>i?1:0})},n.prototype.greaterEqual=function(e,r){return z([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>=i?1:0})},n.prototype.logicalNot=function(e){z(e,"logicalNot");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,e.shape,"bool")},n.prototype.logicalAnd=function(e,r){return z([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o&&i})},n.prototype.logicalOr=function(e,r){return z([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o||i})},n.prototype.select=function(e,r,o){z([e,r,o],"select");for(var i=this.readSync(e.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=ht(r.shape,Qt(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,d=0===e.rank||e.rank>1||1===r.rank?1:ae(r.shape.slice(1)),f=0;f<i.length;f++)for(var h=0;h<d;h++)c[l++]=1===i[f]?a[f]:s[f];return u},n.prototype.where=function(e){z([e],"where");var r=this.readSync(e.dataId);return Nv(e.shape,r)},n.prototype.topk=function(e,r,o){return z(e,"topk"),ES(this.readSync(e.dataId),e.shape,e.dtype,r)},n.prototype.min=function(e,r){z(e,"min"),Bn("min",r,e.rank);for(var o=an(e.shape,r),a=o[1],s=ht(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g<h&&(h=g)}c[d]=h}return s},n.prototype.minimum=function(e,r){return z([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.min(o,i)})},n.prototype.mod=function(e,r){return z([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},n.prototype.max=function(e,r){z(e,"max"),Bn("max",r,e.rank);for(var o=an(e.shape,r),a=o[1],s=ht(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g>h&&(h=g)}c[d]=h}return s},n.prototype.maximum=function(e,r){return z([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.max(o,i)})},n.prototype.all=function(e,r){z(e,"all"),Bn("all",r,e.rank);for(var o=an(e.shape,r),a=o[1],s=ht(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h&&l[f+p];c[d]=h}return s},n.prototype.any=function(e,r){z(e,"any"),Bn("any",r,e.rank);for(var o=an(e.shape,r),a=o[1],s=ht(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h||l[f+p];c[d]=h}return s},n.prototype.squaredDifference=function(e,r){return z([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o-i;return a*a})},n.prototype.ceil=function(e){z(e,"ceil");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.floor=function(e){z(e,"floor");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sign=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=r[i]<0?-1:r[i]>0?1:0;return this.makeOutput(o,e.shape,"float32")},n.prototype.isNaN=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isInf=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isFinite=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.round=function(e){z(e,"round");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);o[i]=r[i]-a<.5?Math.floor(r[i]):r[i]-a>.5?Math.ceil(r[i]):a%2==0?a:a+1}return this.makeOutput(o,e.shape,"float32")},n.prototype.exp=function(e){z(e,"exp");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.expm1=function(e){z(e,"expm1");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log=function(e){z(e,"log");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log1p=function(e){z(e,"log1p");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log1p(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sqrt=function(e){z(e,"sqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.rsqrt=function(e){z(e,"rsqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.reciprocal=function(e){z(e,"reciprocal");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,e.shape,"float32")},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){z(e,"relu");for(var r=ht(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},n.prototype.relu6=function(e){z(e,"relu");for(var r=ht(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},n.prototype.prelu=function(e,r){return z([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return o<0?i*o:o})},n.prototype.elu=function(e){z(e,"elu");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,e.shape,"float32")},n.prototype.eluDer=function(e,r){z([e,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},n.prototype.selu=function(e){z(e,"selu");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(i,e.shape,"float32")},n.prototype.clip=function(e,r,o){z(e,"clip");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,e.shape,"float32")},n.prototype.abs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<e.size;++i)r[i]=Math.hypot(o[2*i],o[2*i+1]);return this.makeOutput(r,e.shape,"float32")},n.prototype.int=function(e){z(e,"int");for(var r=new Int32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,e.shape,"int32")},n.prototype.sigmoid=function(e){z(e,"sigmoid");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,e.shape,"float32")},n.prototype.softplus=function(e){z(e,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var l,s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]);l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,e.shape,"float32")},n.prototype.sin=function(e){z(e,"sin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cos=function(e){z(e,"cos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tan=function(e){z(e,"tan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asin=function(e){z(e,"asin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acos=function(e){z(e,"acos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan=function(e){z(e,"atan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan2=function(e,r){return z([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.atan2(o,i)})},n.prototype.sinh=function(e){z(e,"sinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cosh=function(e){z(e,"cosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tanh=function(e){z(e,"tanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=h2(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asinh=function(e){z(e,"asinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acosh=function(e){z(e,"acosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atanh=function(e){z(e,"atanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.erf=function(e){z(e,"erf");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,e.shape,"float32")},n.prototype.step=function(e,r){void 0===r&&(r=0),z(e,"step");for(var o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a];o[a]=isNaN(s)?NaN:s>0?1:r}return this.makeOutput(o,e.shape,"float32")},n.prototype.fusedConv2d=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=sy(this,c,s,u)),c},n.prototype.conv2d=function(e,r,o){z([e,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d="channelsLast"===o.dataFormat,f=Se(o.outShape,e.dtype),h=e.strides[0],p=d?e.strides[1]:e.strides[2],g=d?e.strides[2]:1,m=d?1:e.strides[1],v=f.strides[0],b=d?f.strides[1]:f.strides[2],y=d?f.strides[2]:1,w=d?1:f.strides[1],x=this.readSync(e.dataId),_=this.readSync(r.dataId),M=f.values,I=0;I<o.batchSize;++I)for(var E=I*h,S=I*v,P=0;P<o.outHeight;++P)for(var A=S+P*b,V=P*o.strideHeight-l,U=0;U<i;U++){var F=V+U*s;if(!(F<0||F>=o.inHeight))for(var W=U*r.strides[0],H=E+F*p,j=0;j<o.outWidth;++j)for(var q=A+j*y,K=j*o.strideWidth-c,ee=0;ee<a;ee++){var le=K+ee*u;if(!(le<0||le>=o.inWidth))for(var pe=H+le*g,ke=W+ee*r.strides[1],Oe=0;Oe<o.inChannels;++Oe){for(var Ve=x[pe+Oe*m],Ge=0;Ge<o.outChannels;++Ge)M[q+Ge*w]+=Ve*_[ke+Ge];ke+=o.outChannels}}}return f.toTensor()},n.prototype.conv3d=function(e,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,h=o.padInfo.top,p=Se(o.outShape,e.dtype),g=this.readSync(e.dataId),m=this.readSync(r.dataId),v=p.values,b=0;b<o.batchSize;++b)for(var y=b*e.strides[0],w=b*p.strides[0],x=0;x<o.outDepth;++x)for(var _=w+x*p.strides[1],M=x*o.strideDepth-d,I=0;I<i;I++){var E=M+I*u;if(!(E<0||E>=o.inDepth))for(var S=I*r.strides[0],P=y+E*e.strides[1],A=0;A<o.outHeight;++A)for(var V=_+A*p.strides[2],U=A*o.strideHeight-h,F=0;F<a;F++){var W=U+F*c;if(!(W<0||W>=o.inHeight))for(var H=S+F*r.strides[1],j=P+W*e.strides[2],q=0;q<o.outWidth;++q)for(var K=V+q*o.outChannels,ee=q*o.strideWidth-f,le=0;le<s;le++){var pe=ee+le*l;if(!(pe<0||pe>=o.inWidth))for(var Oe=j+pe*o.inChannels,Ve=H+le*r.strides[2],Ge=0;Ge<o.inChannels;++Ge){for(var je=g[Oe+Ge],qe=0;qe<o.outChannels;++qe)v[K+qe]+=je*m[Ve+qe];Ve+=o.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(e,r,o){z([e,r],"conv2dDerInput");for(var i=Se(o.inShape,"float32"),a=i.values,s=this.readSync(e.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],d=c[1],f=c[2],h=o.batchSize,p=o.filterHeight,g=o.filterWidth,m=o.inChannels,v=o.inHeight,b=o.inWidth,y=o.outChannels,w=o.outHeight,x=o.outWidth,_=o.strideHeight,M=o.strideWidth,E=p-1-o.padInfo.top,S=g-1-o.padInfo.left,P="channelsLast"===o.dataFormat,A=i.strides[0],V=P?i.strides[1]:i.strides[2],U=P?i.strides[2]:1,F=P?1:i.strides[1],W=e.strides[0],H=P?e.strides[1]:e.strides[2],j=P?e.strides[2]:1,q=P?1:e.strides[1],K=0;K<h;++K)for(var ee=0;ee<m;++ee)for(var le=0;le<v;++le)for(var pe=le-E,ke=Math.max(0,Math.ceil(pe/_)),Oe=Math.min(w,(p+pe)/_),Ve=0;Ve<b;++Ve){for(var Ge=Ve-S,je=Math.max(0,Math.ceil(Ge/M)),qe=Math.min(x,(g+Ge)/M),At=0,He=ke;He<Oe;++He)for(var nt=He*_-pe,Qe=je;Qe<qe;++Qe)for(var Dt=W*K+H*He+j*Qe,bt=l*(p-1-nt)+d*(g-1-(Qe*M-Ge))+f*ee,wt=0;wt<y;++wt)At+=s[Dt+q*wt]*u[bt+wt];a[A*K+V*le+U*Ve+F*ee]=At}return i.toTensor()},n.prototype.conv3dDerInput=function(e,r,o){for(var i=Se(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=s[3],f=this.readSync(e.dataId),h=e.strides,p=h[0],g=h[1],m=h[2],v=h[3],b=this.readSync(r.dataId),y=r.strides,w=y[0],x=y[1],_=y[2],M=y[3],I=o.batchSize,E=o.filterDepth,S=o.filterHeight,P=o.filterWidth,A=o.inChannels,V=o.inDepth,U=o.inHeight,F=o.inWidth,W=o.outChannels,H=o.outDepth,j=o.outHeight,q=o.outWidth,K=o.strideDepth,ee=o.strideHeight,le=o.strideWidth,pe=E-1-o.padInfo.front,ke=S-1-o.padInfo.top,Oe=P-1-o.padInfo.left,Ve=0;Ve<I;++Ve)for(var Ge=0;Ge<A;++Ge)for(var je=0;je<V;++je)for(var qe=je-pe,At=Math.max(0,Math.ceil(qe/K)),He=Math.min(H,(E+qe)/K),nt=0;nt<U;++nt)for(var Qe=nt-ke,Dt=Math.max(0,Math.ceil(Qe/ee)),bt=Math.min(j,(S+Qe)/ee),wt=0;wt<F;++wt){for(var bo=wt-Oe,wo=Math.max(0,Math.ceil(bo/le)),ir=Math.min(q,(P+bo)/le),Ws=0,ri=At;ri<He;++ri)for(var Li=ri*K-qe,oi=Dt;oi<bt;++oi)for(var zs=oi*ee-Qe,ii=wo;ii<ir;++ii)for(var a0=p*Ve+g*ri+m*oi+v*ii,$s=w*(E-1-Li)+x*(S-1-zs)+_*(P-1-(ii*le-bo))+M*Ge,xo=0;xo<W;++xo)Ws+=f[a0+xo]*b[$s+xo];a[u*Ve+c*je+l*nt+d*wt+Ge]=Ws}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,r,o){z([e,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c="channelsLast"===o.dataFormat,l=Se(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<s;++g)for(var m=Math.max(0,Math.ceil((f-g)/i)),v=Math.min(o.outHeight,(o.inHeight+f-g)/i),b=0;b<u;++b)for(var y=Math.max(0,Math.ceil((d-b)/a)),w=Math.min(o.outWidth,(o.inWidth+d-b)/a),x=0;x<o.inChannels;++x)for(var _=0;_<o.outChannels;++_){for(var M=0,I=0;I<o.batchSize;++I)for(var E=m;E<v;++E)for(var S=g+E*i-f,P=y;P<w;++P){var A=b+P*a-d;M+=c?h.get(I,S,A,x)*p.get(I,E,P,_):h.get(I,x,S,A)*p.get(I,_,E,P)}l.set(M,g,b,x,_)}return l.toTensor()},n.prototype.conv3dDerFilter=function(e,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=Se(o.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],g=h[1],m=h[2],v=h[3],b=this.readSync(r.dataId),y=r.strides,w=y[0],x=y[1],_=y[2],M=y[3],I=this.readSync(e.dataId),E=e.strides,S=E[0],P=E[1],A=E[2],V=E[3],U=o.padInfo.front,F=o.padInfo.left,W=o.padInfo.top,H=0;H<u;++H)for(var j=Math.max(0,Math.ceil((U-H)/i)),q=Math.min(o.outDepth,(o.inDepth+U-H)/i),K=H*p,ee=0;ee<c;++ee)for(var le=Math.max(0,Math.ceil((W-ee)/a)),pe=Math.min(o.outHeight,(o.inHeight+W-ee)/a),ke=ee*g+K,Oe=0;Oe<l;++Oe)for(var Ve=Math.max(0,Math.ceil((F-Oe)/s)),Ge=Math.min(o.outWidth,(o.inWidth+F-Oe)/s),je=Oe*m+ke,qe=0;qe<o.inChannels;++qe)for(var At=qe*v+je,He=0;He<o.outChannels;++He){for(var nt=0,Qe=0;Qe<o.batchSize;++Qe)for(var Dt=Qe*S,bt=Qe*w,wt=j;wt<q;++wt)for(var bo=(H+wt*i-U)*P+Dt,wo=wt*x+bt,ir=le;ir<pe;++ir)for(var Ws=(ee+ir*a-W)*A+bo,ri=ir*_+wo,Li=Ve;Li<Ge;++Li)nt+=I[(Oe+Li*s-F)*V+Ws+qe]*b[Li*M+ri+He];f[At+He]=nt}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=sy(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(e,r,o){z([e,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d=o.outChannels/o.inChannels,f=Se(o.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(r.dataId),g=f.values,m=0;m<o.batchSize;++m)for(var v=m*e.strides[0],b=m*f.strides[0],y=0;y<o.outHeight;++y)for(var w=b+y*f.strides[1],x=y*o.strideHeight-c,_=0;_<i;++_){var M=x+_*s;if(!(M<0||M>=o.inHeight))for(var I=_*r.strides[0],E=v+M*e.strides[1],S=0;S<o.outWidth;++S)for(var P=w+S*f.strides[2],A=S*o.strideWidth-l,V=0;V<a;++V){var U=A+V*u;if(!(U<0||U>=o.inWidth))for(var W=E+U*o.inChannels,H=P,j=I+V*r.strides[1],q=0;q<o.inChannels;++q){for(var K=h[W+q],ee=0;ee<d;++ee)g[H+ee]+=K*p[j+ee];H+=d,j+=d}}}return f.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,r,o){z([e,r],"depthwiseConv2DDerInput");for(var i=Se(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=this.readSync(e.dataId),f=e.strides,h=f[0],p=f[1],g=f[2],m=this.readSync(r.dataId),v=r.strides,b=v[0],y=v[1],w=v[2],x=o.batchSize,_=o.filterHeight,M=o.filterWidth,I=o.inChannels,E=o.inHeight,S=o.inWidth,A=o.outHeight,V=o.outWidth,U=o.strideHeight,F=o.strideWidth,W=_-1-o.padInfo.top,H=M-1-o.padInfo.left,j=o.outChannels/I,q=0;q<x;++q)for(var K=0;K<I;++K)for(var ee=0;ee<E;++ee)for(var le=ee-W,pe=Math.max(0,Math.ceil(le/U)),ke=Math.min(A,(_+le)/U),Oe=0;Oe<S;++Oe){for(var Ve=Oe-H,Ge=Math.max(0,Math.ceil(Ve/F)),je=Math.min(V,(M+Ve)/F),qe=0,At=pe;At<ke;++At)for(var He=At*U-le,nt=Ge;nt<je;++nt)for(var Qe=h*q+p*At+g*nt,Dt=b*(_-1-He)+y*(M-1-(nt*F-Ve))+w*K,bt=0;bt<j;++bt)qe+=d[Qe+(K*j+bt)]*m[Dt+bt];a[u*q+c*ee+l*Oe+K]=qe}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){z([e,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=Se(o.filterShape,"float32"),l=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<s;++g)for(var m=Math.max(0,Math.ceil((d-g)/i)),v=Math.min(o.outHeight,(o.inHeight+d-g)/i),b=0;b<u;++b)for(var y=Math.max(0,Math.ceil((l-b)/a)),w=Math.min(o.outWidth,(o.inWidth+l-b)/a),x=0;x<o.outChannels;++x){for(var _=Math.trunc(x/f),M=x%f,I=0,E=0;E<o.batchSize;++E)for(var S=m;S<v;++S)for(var P=g+S*i-d,A=y;A<w;++A)I+=h.get(E,P,b+A*a-l,_)*p.get(E,S,A,x);c.set(I,g,b,_,M)}return c.toTensor()},n.prototype.tile=function(e,r){return z(e,"tile"),DS(this.bufferSync(e),r)},n.prototype.pad=function(e,r,o){z(e,"pad");var i=r.map(function(f,h){return f[0]+e.shape[h]+f[1]}),a=r.map(function(f){return f[0]}),s=this.bufferSync(e),u=Se(i,e.dtype);0!==o&&u.values.fill(o);for(var c=0;c<e.size;c++){var l=s.indexToLoc(c),d=l.map(function(f,h){return f+a[h]});u.set.apply(u,[s.get.apply(s,l)].concat(d))}return u.toTensor()},n.prototype.transpose=function(e,r){z(e,"transpose");for(var o=new Array(e.rank),i=0;i<o.length;i++)o[i]=e.shape[r[i]];var a=this.readSync(e.dataId),s=Se(o,e.dtype),u=this.bufferSync(e);for(i=0;i<e.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[r[d]];var f=s.locToIndex(l);s.values[f]=a[i]}return s.toTensor()},n.prototype.gather=function(e,r,o){z([e,r],"gather");var i=e.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=Se(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c),d=l.slice();d[o]=a[l[o]];var f=u.locToIndex(d);s.values[c]=u.values[f]}return s.toTensor()},n.prototype.batchToSpaceND=function(e,r,o){z([e],"batchToSpaceND");var i=r.reduce(function(d,f){return d*f}),a=cf(e.shape,r,i),s=lf(a.length,r.length),u=df(e.shape,r,i),c=dS(o,r.length),l=fS(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){z([e],"spaceToBatchND");var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=cf(u.shape,r,i,!1),l=lf(c.length,r.length,!1),d=df(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.pool=function(e,r,o){z(e,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),g=Se(r.outShape,e.dtype),m=g.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],y=r.outShape[3],w=0;w<r.batchSize;++w)for(var x=w*v,_=w*e.strides[0],M=0;M<r.inChannels;++M)for(var I=0;I<r.outHeight;++I)for(var E=I*i-d,S=Math.max(0,E),P=Math.min(r.inHeight,c+E),A=x+I*b,V=0;V<r.outWidth;++V){for(var U=V*a-f,F=Math.max(0,U),W=Math.min(r.inWidth,l+U),H=h,j=0,q=0,K=S;K<P;K+=s){for(var ee=_+K*e.strides[1],le=F;le<W;le+=u){var pe=p[ee+le*e.strides[2]+M];"max"===o&&pe>H?H=pe:"avg"===o&&(j+=pe,q++)}if(isNaN(H))break}m[A+V*y+M]="avg"===o?j/q:H}return g.toTensor()},n.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},n.prototype.maxPoolPositions=function(e,r){for(var o=Se(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(e),p=0;p<r.batchSize;++p)for(var g=0;g<r.inChannels;++g)for(var m=0;m<r.outHeight;++m){for(var v=m*i-d,b=v;b<0;)b+=s;for(var y=Math.min(r.inHeight,c+v),w=0;w<r.outWidth;++w){for(var x=w*a-f,_=x;_<0;)_+=u;for(var M=Math.min(r.inWidth,l+x),I=Number.NEGATIVE_INFINITY,E=-1,S=b;S<y;S+=s)for(var P=S-v,A=_;A<M;A+=u){var V=A-x,U=h.get(p,S,A,g);U>I&&(I=U,E=P*l+V)}o.set(E,p,m,w,g)}}return o.toTensor()},n.prototype.maxPoolBackprop=function(e,r,o,i){z([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,g=Se(r.shape,"float32"),m=this.bufferSync(a),v=this.bufferSync(e),b=0;b<i.batchSize;++b)for(var y=0;y<i.inChannels;++y)for(var w=0;w<i.inHeight;++w)for(var x=0;x<i.inWidth;++x){for(var _=w-p,M=x-h,I=0,E=0;E<d;E+=c){var S=(_+E)/s;if(!(S<0||S>=i.outHeight||Math.floor(S)!==S))for(var P=0;P<f;P+=l){var A=(M+P)/u;if(!(A<0||A>=i.outWidth||Math.floor(A)!==A)){var V=d*f-1-m.get(b,S,A,y)===E*f+P?1:0;0!==V&&(I+=v.get(b,S,A,y)*V)}}}g.set(I,b,w,x,y)}return g.toTensor()},n.prototype.avgPoolBackprop=function(e,r,o){z([e,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,g=Se(r.shape,"float32"),m=1/(s*u),v=this.bufferSync(e),b=0;b<o.batchSize;++b)for(var y=0;y<o.inChannels;++y)for(var w=0;w<o.inHeight;++w)for(var x=0;x<o.inWidth;++x){for(var _=w-p,M=x-h,I=0,E=0;E<d;E+=c){var S=(_+E)/i;if(!(S<0||S>=o.outHeight||Math.floor(S)!==S))for(var P=0;P<f;P+=l){var A=(M+P)/a;A<0||A>=o.outWidth||Math.floor(A)!==A||(I+=v.get(b,S,A,y))}}g.set(I*m,b,w,x,y)}return g.toTensor()},n.prototype.pool3d=function(e,r,o){z(e,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(e.dataId),y=Se(r.outShape,e.dtype),w=y.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],M=r.outShape[3]*r.outShape[4],I=r.outShape[4],E=0;E<r.batchSize;++E)for(var S=E*x,P=E*e.strides[0],A=0;A<r.inChannels;++A)for(var V=0;V<r.outDepth;++V){for(var U=V*i-p,F=U;F<0;)F+=u;for(var W=Math.min(r.inDepth,d+U),H=S+V*_,j=0;j<r.outHeight;++j){for(var q=j*a-g,K=q;K<0;)K+=c;for(var ee=Math.min(r.inHeight,f+q),le=H+j*M,pe=0;pe<r.outWidth;++pe){for(var ke=pe*s-m,Oe=ke;Oe<0;)Oe+=l;for(var Ve=Math.min(r.inWidth,h+ke),Ge=le+pe*I,je=v,qe=0,At=0,He=F;He<W;He+=u){for(var nt=P+He*e.strides[1],Qe=K;Qe<ee;Qe+=c){for(var Dt=nt+Qe*e.strides[2],bt=Oe;bt<Ve;bt+=l){var wt=b[Dt+bt*e.strides[3]+A];if("max"===o&&wt>je?je=wt:"avg"===o&&(qe+=wt,At++),isNaN(je))break}if(isNaN(je))break}if(isNaN(je))break}w[Ge+A]="avg"===o?qe/At:je}}}return y.toTensor()},n.prototype.avgPool3d=function(e,r){return z(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(e,r,o){z([e,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,g=o.effectiveFilterHeight,m=o.effectiveFilterWidth,v=p-1-o.padInfo.front,b=m-1-o.padInfo.left,y=g-1-o.padInfo.top,w=Se(r.shape,"float32"),x=1/(u*c*l),_=this.bufferSync(e),M=0;M<o.batchSize;++M)for(var I=0;I<o.inChannels;++I)for(var E=0;E<o.inDepth;++E)for(var S=0;S<o.inHeight;++S)for(var P=0;P<o.inWidth;++P){for(var A=E-v,V=S-y,U=P-b,F=0,W=0;W<p;W+=d){var H=(A+W)/i;if(!(H<0||H>=o.outDepth||Math.floor(H)!==H))for(var j=0;j<g;j+=f){var q=(V+j)/a;if(!(q<0||q>=o.outHeight||Math.floor(q)!==q))for(var K=0;K<m;K+=h){var ee=(U+K)/s;ee<0||ee>=o.outWidth||Math.floor(ee)!==ee||(F+=_.get(M,H,q,ee,I))}}}w.set(F*x,M,E,S,P,I)}return w.toTensor()},n.prototype.maxPool3d=function(e,r){return z(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(e,r){for(var o=Se(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v=this.bufferSync(e),b=0;b<r.batchSize;++b)for(var y=0;y<r.inChannels;++y)for(var w=0;w<r.outDepth;++w){for(var x=w*i-p,_=x;_<0;)_+=u;for(var M=Math.min(r.inDepth,d+x),I=0;I<r.outHeight;++I){for(var E=I*a-g,S=E;S<0;)S+=c;for(var P=Math.min(r.inHeight,f+E),A=0;A<r.outWidth;++A){for(var V=A*s-m,U=V;U<0;)U+=l;for(var F=Math.min(r.inWidth,h+V),W=Number.NEGATIVE_INFINITY,H=-1,j=_;j<M;j+=u)for(var q=j-x,K=S;K<P;K+=c)for(var ee=K-E,le=U;le<F;le+=l){var pe=le-V,ke=v.get(b,j,K,le,y);ke>=W&&(W=ke,H=q*f*h+ee*f+pe)}o.set(H,b,w,I,A,y)}}}return o.toTensor()},n.prototype.maxPool3dBackprop=function(e,r,o,i){z([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,g=i.effectiveFilterWidth,m=h-1-i.padInfo.front,v=g-1-i.padInfo.left,b=p-1-i.padInfo.top,y=Se(r.shape,"float32"),w=this.bufferSync(a),x=this.bufferSync(e),_=0;_<i.batchSize;++_)for(var M=0;M<i.inChannels;++M)for(var I=0;I<i.inDepth;++I)for(var E=0;E<i.inHeight;++E)for(var S=0;S<i.inWidth;++S){for(var P=I-m,A=E-b,V=S-v,U=0,F=0;F<h;F+=l){var W=(P+F)/s;if(!(W<0||W>=i.outDepth||Math.floor(W)!==W))for(var H=0;H<p;H+=d){var j=(A+H)/u;if(!(j<0||j>=i.outHeight||Math.floor(j)!==j))for(var q=0;q<g;q+=f){var K=(V+q)/c;if(!(K<0||K>=i.outWidth||Math.floor(K)!==K)){var ee=h*p*g-1-w.get(_,W,j,K,M)===F*p*g+H*g+q?1:0;0!==ee&&(U+=x.get(_,W,j,K,M)*ee)}}}}y.set(U,_,I,E,S,M)}return y.toTensor()},n.prototype.cast=function(e,r){return Tv(e,r,this)},n.prototype.reshape=function(e,r){return yf(e,r)},n.prototype.avgPool=function(e,r){return z(e,"avgPool"),this.pool(e,r,"avg").toFloat()},n.prototype.resizeBilinear=function(e,r,o,i){z(e,"resizeBilinear");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(ae([s,r,o,l])),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=0,m=h[0]/p[0],v=h[1]/p[1],b=0;b<s;b++)for(var y=0;y<r;y++)for(var w=m*y,x=Math.floor(w),_=w-x,M=Math.min(u-1,Math.ceil(w)),I=b*e.strides[0]+x*e.strides[1],E=b*e.strides[0]+M*e.strides[1],S=0;S<o;S++)for(var P=v*S,A=Math.floor(P),V=P-A,U=Math.min(c-1,Math.ceil(P)),F=I+A*e.strides[2],W=E+A*e.strides[2],H=I+U*e.strides[2],j=E+U*e.strides[2],q=0;q<l;q++){var K=d[F+q],ee=d[W+q],le=K+(d[H+q]-K)*V;f[g++]=le+(ee+(d[j+q]-ee)*V-le)*_}return un(f,[s,r,o,l])},n.prototype.resizeBilinearBackprop=function(e,r,o){z([e,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=[o&&d>1?s-1:s,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],m=p[0]/g[0],v=p[1]/g[1],b=this.readSync(e.dataId),y=0,w=0;w<a;w++)for(var x=w*r.strides[0],_=0;_<d;_++)for(var M=_*m,I=Math.floor(M),E=Math.min(Math.ceil(M),s-1),S=x+I*r.strides[1],P=x+E*r.strides[1],A=M-I,V=1-A,U=0;U<f;U++)for(var F=U*v,W=Math.floor(F),H=Math.min(Math.ceil(F),u-1),j=F-W,q=1-j,K=S+W*r.strides[2],ee=S+H*r.strides[2],le=P+W*r.strides[2],pe=P+H*r.strides[2],ke=V*q,Oe=V*j,Ve=A*q,Ge=A*j,je=0;je<c;je++){var qe=b[y++];h[K+je]+=qe*ke,h[ee+je]+=qe*Oe,h[le+je]+=qe*Ve,h[pe+je]+=qe*Ge}return Un(h,[a,u,s,c],r.dtype)},n.prototype.resizeNearestNeighbor=function(e,r,o,i){z(e,"resizeNearestNeighbor");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(s*r*o*l),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=h[0]/p[0],m=h[1]/p[1],v=0,b=0;b<s;b++)for(var y=b*e.strides[0],w=0;w<r;w++)for(var x=g*w,_=y+Math.min(u-1,i?Math.round(x):Math.floor(x))*e.strides[1],M=0;M<o;M++)for(var I=m*M,E=_+Math.min(c-1,i?Math.round(I):Math.floor(I))*e.strides[2],S=0;S<l;S++)f[v++]=d[E+S];return un(f,[s,r,o,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){z([e,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=this.readSync(e.dataId),g=[o&&d>1?s-1:s,o&&f>1?u-1:u],m=[o&&d>1?d-1:d,o&&f>1?f-1:f],v=g[0]/m[0],b=g[1]/m[1],y=1/v,w=1/b,x=2*Math.ceil(y)+2,_=2*Math.ceil(w)+2,M=0;M<a;M++)for(var I=M*r.strides[0],E=0;E<s;E++)for(var S=I+E*r.strides[1],P=Math.floor(E*y),A=Math.floor(P-x/2),V=0;V<u;V++)for(var U=S+V*r.strides[2],F=Math.floor(V*w),W=Math.floor(F-_/2),H=0;H<c;H++){for(var j=0,q=0;q<x;q++){var K=q+A;if(!(K<0||K>=d)){var ee=I+K*e.strides[1],le=K*v;if(E===Math.min(s-1,o?Math.round(le):Math.floor(le)))for(var pe=0;pe<_;pe++){var ke=pe+W;if(!(ke<0||ke>=f)){var Oe=ee+ke*e.strides[2],Ve=ke*b;V===Math.min(u-1,o?Math.round(Ve):Math.floor(Ve))&&(j+=p[Oe+H])}}}}h[U+H]=j}return Un(h,r.shape,r.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){z([e,r,o,a,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,g=d.length,m=l.length,v=c.length,b=0,y=0,w=0,x=0,_=0;_<u.length;++_)h[_]=f[b++]+(u[_]-c[y++])*d[w++]/Math.sqrt(l[x++]+i),b>=p&&(b=0),y>=v&&(y=0),w>=g&&(w=0),x>=m&&(x=0);return Un(h,e.shape)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){z(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),l=e.size,d=new Float32Array(l);function f(m){for(var v=m%s,b=m-v+Math.max(0,v-r),y=m-v+Math.min(v+r,u),w=0;b<=y;b++){var x=c[b];w+=x*x}return w}for(var h=0;h<l;h++){var p=f(h),g=c[h]*Math.pow(o+i*p,-a);d[h]=g}return Un(d,e.shape)},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){z(e,"LRNGrad");for(var c=e.shape[3],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=this.readSync(o.dataId),h=new Float32Array(e.size),p=e.size,g=0;g<p;g++){for(var m=g%c,v=g-m+Math.max(0,m-i),b=g-m+Math.min(c,m+i+1),y=0,w=v;w<b;w++)y+=Math.pow(d[w],2);for(y=s*y+a,w=v;w<b;w++){var x=-2*s*u*d[w]*f[g]/y;g===w&&(x+=Math.pow(y,-u)),h[w]+=x*=l[g]}}return Un(h,e.shape)},n.prototype.multinomial=function(e,r,o,i){z(e,"multinomial");for(var a=r?e:qo(e),s=a.shape[0],u=a.shape[1],c=ht([s,o],"int32"),l=this.readSync(c.dataId),d=this.readSync(a.dataId),f=0;f<s;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var g=1;g<p.length;++g)p[g]=p[g-1]+d[h+g];for(var m=uf(i.toString()),v=f*o,b=0;b<o;++b){var y=m();l[v+b]=p.length;for(var w=0;w<p.length;w++)if(y<p[w]){l[v+b]=w;break}}}return c},n.prototype.oneHot=function(e,r,o,i){z(e,"oneHot");var a=new Float32Array(e.size*r);a.fill(i);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return Ii(a,[e.size,r],"int32")},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return z(e,"nonMaxSuppression"),kv(this.readSync(e.dataId),this.readSync(r.dataId),o,i,a)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,r){for(var o=e.shape[0],i=e.shape[1],a=Se(e.shape,"float32"),s=Se(e.shape,"float32"),u=mr(e).as2D(o,i),c=lo(e).as2D(o,i),l=0;l<o;l++)for(var d=u.slice([l,0],[1,i]),f=c.slice([l,0],[1,i]),h=sn(d,f),p=this.readSync(this.fftImpl(h,r).dataId),g=0;g<i;g++){var m=wS(p,g);a.values[l*i+g]=m.real,s.values[l*i+g]=m.imag}return sn(a.toTensor(),s.toTensor()).as2D(o,i)},n.prototype.fftImpl=function(e,r){var o=e.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(e.shape[0],e.shape[1]);return r&&(a=sn(mr(a).div(Y(i)),lo(a).div(Y(i)))),a}var s=this.readSync(e.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)l[f/2]=c[f],d[f/2]=c[f+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,i,r));return sn(u.real,u.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return 0==(e&e-1)},n.prototype.fftRadix2=function(e,r,o){if(1===r)return e;var i=this.readSync(e.dataId),a=r/2,s=function(v){for(var b=Math.ceil(v.length/4),y=new Float32Array(b),w=new Float32Array(b),x=0;x<v.length;x+=4)y[Math.floor(x/4)]=v[x],w[Math.floor(x/4)]=v[x+1];return{real:y,imag:w}}(i),u=sn(s.real,s.imag).as1D(),c=function(v){for(var b=Math.floor(v.length/4),y=new Float32Array(b),w=new Float32Array(b),x=2;x<v.length;x+=4)y[Math.floor(x/4)]=v[x],w[Math.floor(x/4)]=v[x+1];return{real:y,imag:w}}(i),l=sn(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var d=function(v,b){for(var y=new Float32Array(v/2),w=new Float32Array(v/2),x=0;x<Math.ceil(v/2);x++){var _=(b?2:-2)*Math.PI*(x/v);y[x]=Math.cos(_),w[x]=Math.sin(_)}return{real:y,imag:w}}(r,o),f=sn(d.real,d.imag).mul(l),h=u.add(f),p=u.sub(f),g=mr(h).concat(mr(p)),m=lo(h).concat(lo(p));return sn(g,m).as1D()},n.prototype.fourierTransformByMatmul=function(e,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=dH(a*c,r,o),d=wS(e,c);s+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}o&&(s/=r,u/=r),lH(i,s,u,a)}return i},n.prototype.depthToSpace=function(e,r,o){D("NHWC"===o,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),D(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=e.shape[0],a=e.shape[1],s=e.shape[2],u=e.shape[3],c=a*r,l=s*r,d=u/(r*r),f=this.readSync(e.dataId),h=new Float32Array(i*c*l*d),p=0,g=0;g<i;++g)for(var m=0;m<c;++m)for(var v=Math.floor(m/r),b=m%r,y=0;y<l;++y)for(var w=Math.floor(y/r),x=(b*r+y%r)*d,_=0;_<d;++_)h[p++]=f[_+x+u*(w+s*(v+a*g))];return Un(h,[i,c,l,d])},n.prototype.broadcastedBinaryOp=function(e,r,o,i){var a=Le(e.shape,r.shape),s=Se(a,o),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Ko(e.shape,a),d=Ko(r.shape,a),f=s.values;if(l.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=i(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(e),g=this.bufferSync(r),m=function(v){var b=s.indexToLoc(v),y=b.slice(-e.rank);l.forEach(function(M){return y[M]=0});var w=p.locToIndex(y),x=b.slice(-r.rank);d.forEach(function(M){return x[M]=0});var _=g.locToIndex(x);f[v]=i(u[w],c[_])};for(h=0;h<f.length;++h)m(h)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,r,o){var i=Le(e.shape,r.shape),a=Se(i,"float32"),s=Se(i,"float32"),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Ko(e.shape,i),d=Ko(r.shape,i),f=a.values,h=s.values;if(l.length+d.length===0)for(var p=0;p<f.length;p++){var g=p%u.length,m=p%c.length,v=o(u[2*g],u[2*g+1],c[2*m],c[2*m+1]);f[p]=v.real,h[p]=v.imag}else{var b=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(x){var _=a.indexToLoc(x),M=_.slice(-e.rank);l.forEach(function(A){return M[A]=0});var I=b.locToIndex(M),E=_.slice(-r.rank);d.forEach(function(A){return E[A]=0});var S=y.locToIndex(E),P=o(u[2*I],u[2*I+1],c[2*S],c[2*S+1]);f[x]=P.real,h[x]=P.imag};for(p=0;p<f.length;p++)w(p)}return this.complex(a.toTensor(),s.toTensor())},n.prototype.split=function(e,r,o){return CS(e,r,o)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,r,o,i,a,s){for(var u=e.shape,c=u[0],l=u[1],d=u[2],f=u[3],h=r.shape[0],p=i[0],g=i[1],m=Se([h,p,g,f],"float32"),v=this.readSync(r.dataId),b=this.readSync(o.dataId),y=this.readSync(e.dataId),w=e.strides,x=m.strides,_=0;_<h;_++){var M=4*_,I=v[M],E=v[M+1],S=v[M+2],P=v[M+3],A=b[_];if(!(A>=c))for(var V=p>1?(S-I)*(l-1)/(p-1):0,U=g>1?(P-E)*(d-1)/(g-1):0,F=0;F<p;F++){var W=p>1?I*(l-1)+F*V:.5*(I+S)*(l-1);if(W<0||W>l-1)for(var H=0;H<g;H++)for(var j=0;j<f;j++){var q=j+H*x[2]+F*x[1]+_*x[0];m.values[q]=s}else if("bilinear"===a){var K=Math.floor(W),ee=Math.ceil(W),le=W-K;for(H=0;H<g;H++)if((He=g>1?E*(d-1)+H*U:.5*(E+P)*(d-1))<0||He>d-1)for(j=0;j<f;j++)m.values[q=j+H*x[2]+F*x[1]+_*x[0]]=s;else{var pe=Math.floor(He),ke=Math.ceil(He),Oe=He-pe;for(j=0;j<f;j++){var Ve=y[q=j+pe*w[2]+K*w[1]+A*w[0]],Ge=y[q=j+ke*w[2]+K*w[1]+A*w[0]],je=y[q=j+pe*w[2]+ee*w[1]+A*w[0]],qe=Ve+(Ge-Ve)*Oe,At=je+(y[q=j+ke*w[2]+ee*w[1]+A*w[0]]-je)*Oe;m.values[q=j+H*x[2]+F*x[1]+_*x[0]]=qe+(At-qe)*le}}}else for(H=0;H<g;++H){var He;if((He=g>1?E*(d-1)+H*U:.5*(E+P)*(d-1))<0||He>d-1)for(j=0;j<f;j++)m.values[q=j+H*x[2]+F*x[1]+_*x[0]]=s;else{var nt=Math.round(He),Qe=Math.round(W);for(j=0;j<f;j++)m.values[j+H*x[2]+F*x[1]+_*x[0]]=y[j+nt*w[2]+Qe*w[1]+A*w[0]]}}}}return m.toTensor()},n.prototype.sparseToDense=function(e,r,o,i){var a=xc(0,e,o);return this.scatter(e,r,o,a.outputSize,a.sliceSize,a.numUpdates,a.sliceRank,a.strides,i,!1)},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=Cv(e,r),s=a[0],u=a[1],c=a[2],l=a[3];if(0===u)return un([],s,e.dtype);for(var d=new dc([u,c],e.dtype),f=this.readSync(r.dataId),h=this.readSync(e.dataId),p=0;p<u;p++){for(var g=[],m=0,v=0;v<i;v++){var b=f[p*i+v];m+=b*l[v],g.push(b)}if(m<0||m>=e.size/c)throw new Error("Invalid indices: "+g+" does not index into "+e.shape);for(var y=0;y<c;y++)d.values[p*c+y]=h[m*c+y]}return d.toTensor().reshape(s)},n.prototype.scatterND=function(e,r,o){var i=xc(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=Y(0);return this.scatter(e,r,o,l,u,s,a,c,d,!0)},n.prototype.fill=function(e,r,o){var i=ac(o=o||Cs(r),ae(e));return i.fill(r),R.makeTensor(i,e,o,this)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var r=ac(e.dtype,ae(e.shape));return this.makeOutput(r,e.shape,e.dtype)},n.prototype.linspace=function(e,r,o){return Av(e,r,o)},n.prototype.scatter=function(e,r,o,i,a,s,u,c,l,d){var f=[i/a,a],h=this.readSync(e.dataId),p=this.readSync(r.dataId);if(0===i)return un([],o,r.dtype);var g=new dc(f,r.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var m=0;m<s;m++){for(var v=[],b=0,y=0;y<u;y++){var w=h[m*u+y];v.push(w),b+=w*c[y]}if(b<0||b>=i/a)throw new Error("Invalid indices: "+v+" does not index into "+o);for(var x=0;x<a;x++)d?g.values[b*a+x]+=p[m*a+x]:g.values[b*a+x]=0===r.rank?p[0]:p[m*a+x]}return g.toTensor().reshape(o)},n}(bS);R.registerBackend("cpu",function(){return new p8},1);for(var uy=0,ZI=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var n=t.inputs,r=t.attrs,i=n.boxes,a=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=t.backend;z(i,"NonMaxSuppressionWithScore");var h=Ov(f.data.get(i.dataId).values,f.data.get(a.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var r=t.inputs.x,o=t.backend;z(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Ic,backendName:"cpu",kernelFunc:function(t){var n=t.inputs,o=n.a,i=n.b,a=t.backend;z([o,i],Ic);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(f,h,p,g,m,v){var b=Le(f,h),y=b.length,w=Pr(b),x=_s(m,ae(b)),_=f.length,M=h.length,I=Pr(f),E=Pr(h),S=Ko(f,b),P=Ko(h,b);if(S.length+P.length===0)for(var A=0;A<x.length;++A)x[A]=v(p[A%p.length],g[A%g.length]);else{var V=function(U){var F=_2(U,y,w),W=F.slice(-_);S.forEach(function(K){return W[K]=0});var H=rv(W,_,I),j=F.slice(-M);P.forEach(function(K){return j[K]=0});var q=rv(j,M,E);x[U]=v(p[H],g[q])};for(A=0;A<x.length;++A)V(A)}return[x,b]}(o.shape,i.shape,s,u,o.dtype,function(f,h){var p=f-h;return p*p}),d=c[1];return{dataId:a.write(c[0],d,o.dtype),shape:d,dtype:o.dtype}}}];uy<ZI.length;uy++)l2(ZI[uy]);for(var Os,g8=function(t){this.variableNames=["A"];var n=yn(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+e+".0);\n\n        vec4 values = "+n.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},m8=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=yn(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+e+".0);\n            vec4 values = "+n.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+n.output+" = result;\n      }\n    "},cy=0,eM=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.backend,o=t.inputs.pixels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],d=[l,c],f=[l,c,t.attrs.numChannels];(s||a)&&(null==Os&&(Os=document.createElement("canvas").getContext("2d")),Os.canvas.width=c,Os.canvas.height=l,Os.drawImage(o,0,0,c,l),o=Os.canvas);var h=e.makeTensorInfo(d,"int32");e.texData.get(h.dataId).usage=Zn.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(h.dataId),o);var p=L().getBool("WEBGL_PACK")?new m8(f):new g8(f),g=e.runWebGLProgram(p,[h],"int32");return e.disposeData(h.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=t.attrs;rf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=e,h=Ov(f.readSync(n.boxes.dataId),f.readSync(a.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var r=t.inputs.x,o=t.backend,i=new Te(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Ic,backendName:"webgl",kernelFunc:function(t){var n=t.inputs,o=n.a,i=n.b,a=t.backend,s=L().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xo("return (a - b) * (a - b);",o.shape,i.shape):new Ct("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];cy<eM.length;cy++)l2(eM[cy]);for(var ly=0,tM=[{kernelName:"Square",gradFunc:function(t,n){var e=n[0];return{x:function(){return t.mul(e.toFloat().mul(2))}}}},{kernelName:Ic,gradFunc:function(t,n){var e=n[0],r=n[1],o=Y(2);return{a:function(){return bn(t,bn(o,Kt(e,r)))},b:function(){return bn(t,bn(o,Kt(r,e)))}}}}];ly<tM.length;ly++)bj(tM[ly]);var v8=function(){function t(){}return t.prototype.fetch=function(n,e){return fetch(n,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return new TextDecoder(e).decode(n)},t}();L().get("IS_BROWSER")&&L().setPlatform("browser",new v8);var dy,b8=function(){function t(){this.util=Gs(118),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(n,e){return null!=L().global.fetch?L().global.fetch(n,e):(null==dy&&(dy=Gs(655)),dy(n,e))},t.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return 0===n.length?"":new this.util.TextDecoder(e).decode(n)},t}();L().get("IS_NODE")&&L().setPlatform("node",new b8);var fy={float32:4,int32:4,uint16:2,uint8:1,bool:1},kf=4;function nM(t,n){for(var e={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,d=ae(l),f=void 0;if("quantization"in s){var h=s.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=fy[h.dtype],g=t.slice(r,r+d*p),m="uint8"===h.dtype?new Uint8Array(g):new Uint16Array(g);if("float32"===c)f=Float32Array.from(m,function(_){return _*h.scale+h.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(m,function(_){return Math.round(_*h.scale+h.min)})}r+=d*p}else if("string"===c){var v=ae(s.shape);f=[];for(var b=0;b<v;b++){var y=new Uint32Array(t.slice(r,r+kf))[0];r+=kf;var w=new Uint8Array(t.slice(r,r+y));f.push(w),r+=y}}else{var x=fy[c];if(g=t.slice(r,r+d*x),"float32"===c)f=new Float32Array(g);else if("int32"===c)f=new Int32Array(g);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(g)}r+=d*x}e[u]=un(f,l,c)},i=0,a=n;i<a.length;i++)o(a[i]);return e}function w8(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var n=0,e=[];t.forEach(function(i){if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(n),o=0;return e.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var hy=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function rM(t){return hy?Buffer.byteLength(t):new Blob([t]).size}function py(t){var n=0;t.forEach(function(o){n+=o.byteLength});var e=new Uint8Array(n),r=0;return t.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function oM(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var n=t.split("/");return n[n.length-1]}function Ac(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:rM(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:rM(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var rr=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(n){t.getInstance().saveRouters.push(n)},t.registerLoadRouter=function(n){t.getInstance().loadRouters.push(n)},t.getSaveHandlers=function(n){return t.getHandlers(n,"save")},t.getLoadHandlers=function(n,e){return t.getHandlers(n,"load",e)},t.getHandlers=function(n,e,r){var o=[];return("load"===e?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(i){var a=i(n,r);null!==a&&o.push(a)}),o},t}(),Ns="://",Ti=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(n,e){D(null!=n,function(){return"scheme must not be undefined or null."}),n.endsWith(Ns)&&(n=n.slice(0,n.indexOf(Ns))),D(n.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();D(null==r.managers[n],function(){return"A model store manager is already registered for scheme '"+n+"'."}),r.managers[n]=e},t.getManager=function(n){var e=this.getInstance().managers[n];if(null==e)throw new Error("Cannot find model manager for scheme '"+n+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function Of(t){if(-1===t.indexOf(Ns))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ti.getSchemes().join(","));return{scheme:t.split(Ns)[0],path:t.split(Ns)[1]}}function iM(t,n,e){return void 0===e&&(e=!1),oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d;return ie(this,function(f){switch(f.label){case 0:return D(t!==n,function(){return"Old path and new path are the same: '"+t+"'"}),D((r=rr.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),D(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],D((i=rr.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),D(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."}),a=i[0],s=Of(t).scheme,u=Of(t).path,c=s===Of(t).scheme,[4,o.load()];case 1:return l=f.sent(),e&&c?[4,Ti.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(l)];case 4:return d=f.sent(),!e||c?[3,6]:[4,Ti.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var ma="models_store",Ai="model_info_store";function aM(){if(!L().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==n)throw new Error("The current browser does not appear to support IndexedDB.");return n}function gy(t){var n=t.result;n.createObjectStore(ma,{keyPath:"modelPath"}),n.createObjectStore(Ai,{keyPath:"modelPath"})}var Fs=function(){function t(n){if(this.indexedDB=aM(),null==n||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(e){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},t.prototype.load=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(n,e){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return gy(a)},a.onsuccess=function(){var s=a.result;if(null==e){var u=s.transaction(ma,"readonly"),c=u.objectStore(ma).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(g){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,d=Ac(e),f=s.transaction(Ai,"readwrite"),h=f.objectStore(Ai),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var g=(l=s.transaction(ma,"readwrite")).objectStore(ma).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:d});g.onsuccess=function(){return o({modelArtifactsInfo:d})},g.onerror=function(m){var v=(h=f.objectStore(Ai)).delete(r.modelPath);v.onsuccess=function(){return s.close(),i(g.error)},v.onerror=function(b){return s.close(),i(g.error)}}},p.onerror=function(g){return s.close(),i(p.error)},f.oncomplete=function(){null==l?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},t.URL_SCHEME="indexeddb://",t}(),sM=function(t){return L().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Fs.URL_SCHEME)?(n=t.slice(Fs.URL_SCHEME.length),new Fs(n)):null;var n};rr.registerSaveRouter(sM),rr.registerLoadRouter(sM);var x8=function(){function t(){this.indexedDB=aM()}return t.prototype.listModels=function(){return oe(this,void 0,void 0,function(){var n=this;return ie(this,function(e){return[2,new Promise(function(r,o){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return gy(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Ai,"readonly"),u=s.objectStore(Ai).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var f=d[l];c[f.modelPath]=f.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},t.prototype.removeModel=function(n){return oe(this,void 0,void 0,function(){var e=this;return ie(this,function(r){var o;return n=(o=n).startsWith(Fs.URL_SCHEME)?o.slice(Fs.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return gy(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(Ai,"readwrite"),d=l.objectStore(Ai),f=d.get(n);f.onsuccess=function(){if(null==f.result)return c.close(),a(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var h=d.delete(n),p=function(){var g=(u=c.transaction(ma,"readwrite")).objectStore(ma).delete(n);g.onsuccess=function(){return i(f.result.modelArtifactsInfo)},g.onerror=function(m){return a(f.error)}};h.onsuccess=p,h.onerror=function(g){return p(),c.close(),a(f.error)}},f.onerror=function(h){return c.close(),a(f.error)},l.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},t}();if(L().getBool("IS_BROWSER"))try{Ti.registerManager(Fs.URL_SCHEME,new x8)}catch{}var Yo="/",Ls="tensorflowjs_models",uM="info",_8="model_topology",C8="weight_specs",D8="weight_data",E8="model_metadata";function cM(t){return{info:[Ls,t,uM].join(Yo),topology:[Ls,t,_8].join(Yo),weightSpecs:[Ls,t,C8].join(Yo),weightData:[Ls,t,D8].join(Yo),modelMetadata:[Ls,t,E8].join(Yo)}}function S8(t){var n=t.split(Yo);if(n.length<3)throw new Error("Invalid key format: "+t);return n.slice(1,n.length-1).join(Yo)}var Bs=function(){function t(n){if(!L().getBool("IS_BROWSER")||typeof window>"u"||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==n||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=cM(this.modelPath)}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){var e,r,o;return ie(this,function(i){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),o=Ac(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(hy)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return oe(this,void 0,void 0,function(){var n,e,r,o,i,a,s;return ie(this,function(u){if(null==(n=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==n.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,null==(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,e.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(hy){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(s),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),lM=function(t){return L().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Bs.URL_SCHEME)?(n=t.slice(Bs.URL_SCHEME.length),new Bs(n)):null;var n};rr.registerSaveRouter(lM),rr.registerLoadRouter(lM);var I8=function(){function t(){D(L().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),D(typeof window>"u"||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return oe(this,void 0,void 0,function(){var n,e,r,o,i,a;return ie(this,function(s){for(n={},e=Ls+Yo,r=Yo+uM,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(e)&&i.endsWith(r)&&(a=S8(i),n[a]=JSON.parse(this.LS.getItem(i)));return[2,n]})})},t.prototype.removeModel=function(n){return oe(this,void 0,void 0,function(){var e,r;return ie(this,function(o){var i;if(n=(i=n).startsWith(Bs.URL_SCHEME)?i.slice(Bs.URL_SCHEME.length):i,e=cM(n),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},t}();if(L().getBool("IS_BROWSER"))try{Ti.registerManager(Bs.URL_SCHEME,new I8)}catch{}var M8="model",R8=".json",T8=".weights.bin";function dM(t){return new Promise(function(n){return setTimeout(n)}).then(t)}var my=function(){function t(n){if(!L().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(t.URL_SCHEME)&&(n=n.slice(t.URL_SCHEME.length)),null!=n&&0!==n.length||(n=M8),this.modelTopologyFileName=n+R8,this.weightDataFileName=n+T8}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){var e,i,a,s;return ie(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return i=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,dM(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==n.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,dM(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Ac(n)}]}})})},t.URL_SCHEME="downloads://",t}(),A8=function(){function t(n){if(null==n||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return t.prototype.load=function(){return oe(this,void 0,void 0,function(){var n,e,r=this;return ie(this,function(o){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(null!=l){0===e.length&&i({modelTopology:l});var d=c.weightsManifest;if(null!=d){var f;try{f=r.checkManifestAndWeightFiles(d,e)}catch(m){return void a(m)}var h=[],p=[],g=[];d.forEach(function(m){m.paths.forEach(function(v){p.push(v),g.push(null)}),h.push.apply(h,m.weights)}),d.forEach(function(m){m.paths.forEach(function(v){var b=new FileReader;b.onload=function(y){var w=y.target.result,x=p.indexOf(v);g[x]=w,-1===g.indexOf(null)&&i({modelTopology:l,weightSpecs:h,weightData:py(g),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},b.onerror=function(y){return a("Failed to weights data from file of path '"+v+"'.")},b.readAsArrayBuffer(f[v])})})}else a(new Error("weightManifest field is missing from file "+n.name))}else a(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},t.prototype.checkManifestAndWeightFiles=function(n,e){for(var r=[],o=e.map(function(u){return oM(u.name)}),i={},a=0,s=n;a<s.length;a++)s[a].paths.forEach(function(u){var c=oM(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===o.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=e[o.indexOf(c)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return i},t}();function fM(t,n,e,r){var i;D(null!=(i=t)&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"}),function(i,a){D(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),D(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),D(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(e=e??0,r=r??1);var o=0;return Promise.all(t.map(function(i){return i.then(function(a){var s=e+ ++o/t.length*(r-e);return n(s),a}),i}))}function hM(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l;return ie(this,function(d){switch(d.label){case 0:return null==n&&(n={}),e=null==n.fetchFunc?L().platform.fetch:n.fetchFunc,r=t.map(function(f){return e(f,n.requestInit,{isBinary:!0})}),o=0,i=.5,null!=n.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,fM(r,n.onProgress,o,i)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,c=1,null!=n.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,fM(s,n.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function pM(t){var n=this;return function(e,r,o){return void 0===r&&(r=""),oe(n,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p;return ie(this,function(g){switch(g.label){case 0:if(i=e.map(function(){return!1}),a={},s=null!=o?o.map(function(){return!1}):[],u=[],e.forEach(function(m,v){var b=0;m.weights.forEach(function(y){var x=fy["quantization"in y?y.quantization.dtype:y.dtype]*ae(y.shape),_=function(){i[v]=!0,null==a[v]&&(a[v]=[]),a[v].push({manifestEntry:y,groupOffset:b,sizeBytes:x})};null!=o?o.forEach(function(M,I){M===y.name&&(_(),s[I]=!0)}):_(),u.push(y.name),b+=x})}),!s.every(function(m){return m}))throw c=o.filter(function(m,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=i.reduce(function(m,v,b){return v&&m.push(b),m},[]),d=[],l.forEach(function(m){e[m].paths.forEach(function(v){var b=r+(r.endsWith("/")?"":"/")+v;d.push(b)})}),[4,t(d)];case 1:return f=g.sent(),h={},p=0,l.forEach(function(m){for(var v=e[m].paths.length,b=0,y=0;y<v;y++)b+=f[p+y].byteLength;for(var w=new ArrayBuffer(b),x=new Uint8Array(w),_=0,M=0;M<v;M++){var I=new Uint8Array(f[p+M]);x.set(I,_),_+=I.byteLength}a[m].forEach(function(E){var S=nM(w.slice(E.groupOffset,E.groupOffset+E.sizeBytes),[E.manifestEntry]);for(var P in S)h[P]=S[P]}),p+=v}),[2,h]}})})}}rr.registerSaveRouter(function(t){return L().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(my.URL_SCHEME)?(void 0===(n=t.slice(my.URL_SCHEME.length))&&(n="model"),new my(n)):null;var n});var gM=function(){function t(n,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(D("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=L().platform.fetch,D(null!=n&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&D(2===n.length,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){var e,i;return ie(this,function(a){switch(a.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:n.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=n.weightData&&e.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:Ac(n),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},t.prototype.load=function(){return oe(this,void 0,void 0,function(){var n,e,r,o,i,a,s,u,c,l,d,f;return ie(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,n.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=e.weightsManifest,a=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,null==(o=e.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:f=h.sent(),l=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},t.prototype.loadWeights=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,d,f;return ie(this,function(h){switch(h.label){case 0:for(void 0,void 0,g=(p=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),m=p.lastIndexOf("?"),r=[p.substring(0,g)+"/",m>g?p.substring(m):""],o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=n;u<c.length;u++)s.push.apply(s,c[u].weights);return d=[],n.forEach(function(p){p.paths.forEach(function(g){d.push(a+g+i)})}),[4,hM(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[s,py(f)]]}var p,g,m})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function vy(t){return null!=t.match(gM.URL_SCHEME_REGEX)}var mM=function(t,n){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(e){return vy(e)}):vy(t))?yy(t,{onProgress:n}):null};function yy(t,n){return new gM(t,n)}rr.registerSaveRouter(mM),rr.registerLoadRouter(mM);var Us,by=function(){function t(n){this.modelArtifacts=n}return t.prototype.load=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){return[2,this.modelArtifacts]})})},t}(),P8=function(){function t(n){this.saveHandler=n}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.saveHandler(n)]})})},t}(),vM=Object.freeze({browserFiles:function(t){return new A8(t)},browserHTTPRequest:function(t,n){return yy(t,n)},concatenateArrayBuffers:py,decodeWeights:nM,encodeWeights:function(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return ie(this,function(u){switch(u.label){case 0:for(e=[],r=[],o=Array.isArray(t)?t.map(function(c){return c.name}):Object.keys(t),i=function(c){var l=o[c],d=Array.isArray(t)?t[c].tensor:t[l];if("float32"!==d.dtype&&"int32"!==d.dtype&&"bool"!==d.dtype&&"string"!==d.dtype)throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var f={name:l,shape:d.shape,dtype:d.dtype};if("string"===d.dtype){var h=new Promise(function(p){return oe(s,void 0,void 0,function(){var g,m,v,b,y,w,x;return ie(this,function(_){switch(_.label){case 0:return[4,d.bytes()];case 1:for(g=_.sent(),m=g.reduce(function(M,I){return M+I.length},0)+kf*g.length,v=new Uint8Array(m),b=0,y=0;y<g.length;y++)w=g[y],x=new Uint8Array(new Uint32Array([w.length]).buffer),v.set(x,b),v.set(w,b+=kf),b+=w.length;return p(v),[2]}})})});r.push(h)}else r.push(d.data());null!=n&&(f.group=n),e.push(f)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:w8(u.sent()),specs:e}]}})})},fromMemory:function(t,n,e,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new by(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new by({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new by({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))},getLoadHandlers:function(t,n){return rr.getLoadHandlers(t,n)},getModelArtifactsInfoForJSON:Ac,getSaveHandlers:function(t){return rr.getSaveHandlers(t)},http:yy,isHTTPScheme:vy,loadWeights:function(t,n,e,r){return void 0===n&&(n=""),oe(this,void 0,void 0,function(){return ie(this,function(o){return[2,pM(function(i){return hM(i,{requestInit:r})})(t,n,e)]})})},registerLoadRouter:function(t){return rr.registerLoadRouter(t)},registerSaveRouter:function(t){return rr.registerSaveRouter(t)},weightsLoaderFactory:pM,withSaveHandler:function(t){return new P8(t)},copyModel:function(t,n){return oe(this,void 0,void 0,function(){return ie(this,function(e){return[2,iM(t,n,!1)]})})},listModels:function(){return oe(this,void 0,void 0,function(){var t,n,e,r,o,i,a;return ie(this,function(s){switch(s.label){case 0:t=Ti.getSchemes(),n={},e=0,r=t,s.label=1;case 1:return e<r.length?[4,Ti.getManager(o=r[e]).listModels()]:[3,4];case 2:for(a in i=s.sent())n[o+Ns+a]=i[a];s.label=3;case 3:return e++,[3,1];case 4:return[2,n]}})})},moveModel:function(t,n){return oe(this,void 0,void 0,function(){return ie(this,function(e){return[2,iM(t,n,!0)]})})},removeModel:function(t){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){return n=Of(t),[2,Ti.getManager(n.scheme).removeModel(n.path)]})})}}),k8=T({confusionMatrix_:function(t,n,e){var r=C(t,"labels","confusionMatrix"),o=C(n,"predictions","confusionMatrix");D(null==e||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),D(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),D(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),D(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),D(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=_v(r.asType("int32"),e),a=_v(o.asType("int32"),e);return i.transpose().matMul(a).asType("int32")}}),O8=(Object.freeze({confusionMatrix:k8}),T({fromPixels_:function(t,n){if(void 0===n&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=u2("FromPixels",R.backendName))return R.runKernel("FromPixels",{pixels:t},{numChannels:n});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],d=c[1];if(a?s=t.getContext("2d").getImageData(0,0,l,d).data:r||e?s=t.data:(i||o)&&(null==Us&&(Us=document.createElement("canvas").getContext("2d")),Us.canvas.width=l,Us.canvas.height=d,Us.drawImage(t,0,0,l,d),s=Us.getImageData(0,0,l,d).data),4===n)u=new Int32Array(s);else{var f=l*d;u=new Int32Array(f*n);for(var h=0;h<f;h++)for(var p=0;p<n;++p)u[h*n+p]=s[4*h+p]}return bv(u,[d,l,n],"int32")}})),wy=Object.freeze({toPixels:function(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,h,p,g,m,v,b,y,w,x,_,M,I;return ie(this,function(E){switch(E.label){case 0:if(e=C(t,"img","toPixels"),t instanceof ot||(e=e.toInt()),2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],i=r[1],(a=2===e.rank?1:e.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,e.data()];case 1:return s=E.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=E.sent(),h=l[0][0],p=l[1][0],u.dispose(),c.dispose(),"float32"===e.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==e.dtype)throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(g="float32"===e.dtype?255:1,m=new Uint8ClampedArray(i*o*4),v=0;v<o*i;++v)b=void 0,y=void 0,w=void 0,x=void 0,1===a?(b=s[v]*g,y=s[v]*g,w=s[v]*g,x=255):3===a?(b=s[3*v]*g,y=s[3*v+1]*g,w=s[3*v+2]*g,x=255):4===a&&(b=s[4*v]*g,y=s[4*v+1]*g,w=s[4*v+2]*g,x=s[4*v+3]*g),m[0+(_=4*v)]=Math.round(b),m[_+1]=Math.round(y),m[_+2]=Math.round(w),m[_+3]=Math.round(x);return null!=n&&(n.width=i,n.height=o,M=n.getContext("2d"),I=new ImageData(m,i,o),M.putImageData(I,0,0)),e!==t&&e.dispose(),[2,m]}})})},fromPixels:O8}),yM=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(n,e){return new n(e)},t}(),bM=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]},t}();function Pi(t){D(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),D("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),D(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),bM.register(t)}Object.freeze({Serializable:yM,SerializationMap:bM,registerClass:Pi});var N8=.001,wM=.1;function xy(){return 32===R.backend.floatPrecision()?N8:wM}function _y(t,n,e){var r=!0;if((on(t)||on(n))&&(r=!1),on(t)&&on(n)&&(r=!0),r){var o=t.constructor.name,i=n.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(n)){var a=co(t),s=co(n);if(!Lt(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=on(t)?t:zo(t),c=on(n)?n:zo(n);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var d=u[l],f=c[l];if(!e(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function Cy(t,n,e){return!isFinite(t)&&!isFinite(n)||!(isNaN(t)||isNaN(n)||Math.abs(t-n)>e)}Object.freeze({TEST_EPSILON_FLOAT16:wM,expectArraysClose:function(t,n,e){return null==e&&(e=xy()),_y(t,n,function(r,o){return Cy(r,o,e)})},testEpsilon:xy,expectPromiseToFail:function(t,n){t().then(function(){return n.fail()},function(){return n()})},expectArraysEqual:function(t,n){var e="string"==typeof n||"number"==typeof n||"boolean"==typeof n?[n]:n;return Di(t)||Di(t[0])||Di(n)||Di(n[0])?_y(t,e,function(r,o){return r==o}):_y(t,n,function(r,o){return Cy(r,o,0)})},expectNumbersClose:function(t,n,e){if(null==e&&(e=xy()),!Cy(t,n,e))throw new Error("Numbers differ: actual === "+t+", expected === "+n)},expectValuesInRange:function(t,n,e){for(var r=0;r<t.length;r++)if(t[r]<n||t[r]>e)throw new Error("Value out of range:"+t[r]+" low: "+n+", high: "+e)},expectArrayBuffersEqual:function(t,n){expect(new Float32Array(t)).toEqual(new Float32Array(n))}}),Object.freeze({gpgpu_util:oW,webgl_util:Mj,forceHalfFloat:function(){L().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:vI,setWebGLContext:T2,GPGPUContext:eI});var va=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Ar(n,t),n.prototype.minimize=function(e,r,o){void 0===r&&(r=!1);var i=this.computeGradients(e,o),a=i.value,s=i.grads;if(null!=o){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Ln(s),r?a:(a.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(e,r){return function uH(t,n){D(Ei(t),function(){return"The f passed in variableGrads(f) must be a function"}),D(null==n||Array.isArray(n)&&n.every(function(l){return l instanceof Es}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=null!=n;if(!e)for(var r in n=[],R.registeredVariables)n.push(R.registeredVariables[r]);var o=e?n.filter(function(l){return!l.trainable}):null,i=n.length;D((n=n.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=R.gradients(t,n,null,!0),s=a.value,u=a.grads;D(u.some(function(l){return null!=l}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),D(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return n.forEach(function(l,d){null!=u[d]&&(c[l.name]=u[d])}),o?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}(e,r)},n.prototype.dispose=function(){null!=this.iterations_&&Ln(this.iterations_)},n.prototype.saveIterations=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Y(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,e.slice(1)]}})})},n}(yM);Object.defineProperty(va,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var xM=function(t){function n(e,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==o&&(i.epsilon=R.backend.epsilon()),i}return Ar(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:ne(function(){return $e(a).variable(!1)})}),null==r.accumulatedUpdates[i]&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:ne(function(){return $e(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;ne(function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=c.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(l),c.assign(f);var h=d.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Ln(this.accumulatedGrads.map(function(e){return e.variable})),Ln(this.accumulatedUpdates.map(function(e){return e.variable})))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var e;return ie(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedGrads=e.slice(0,r=e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n}(va);Pi(xM);var _M=function(t){function n(e,r){void 0===r&&(r=.1);var o=t.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return Ar(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:ne(function(){return fo(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable;ne(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(R.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedGrads&&Ln(this.accumulatedGrads.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n}(va);Pi(_M);var CM=function(t){function n(e,r,o,i){void 0===i&&(i=null);var a=t.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],ne(function(){a.accBeta1=Y(r).variable(),a.accBeta2=Y(o).variable()}),null==i&&(a.epsilon=R.backend.epsilon()),a}return Ar(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);ne(function(){var i=Kt(1,r.accBeta1),a=Kt(1,r.accBeta2);o.forEach(function(s,u){var c=R.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ne(function(){return $e(c).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:ne(function(){return $e(c).variable(!1)})});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2).add(l.square().mul(1-r.beta2)),g=h.div(i),m=p.div(a);d.assign(h),f.assign(p);var v=g.div(m.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ln(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Ln(this.accumulatedSecondMoment.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var e;return ie(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){var r,o=this;return ie(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),ne(function(){o.accBeta1.assign(If(o.beta1,o.iterations_+1)),o.accBeta2.assign(If(o.beta2,o.iterations_+1))}),this.accumulatedFirstMoment=e.slice(0,r=e.length/2).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n}(va);Pi(CM);var DM=function(t){function n(e,r,o,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var s=t.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],ne(function(){s.iteration=Y(0).variable(),s.accBeta1=Y(r).variable()}),null==i&&(s.epsilon=R.backend.epsilon()),s}return Ar(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);ne(function(){var i=Kt(1,r.accBeta1),a=Br(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var c=R.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:$e(c).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:$e(c).variable(!1)});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2),g=l.abs(),m=p.maximum(g);d.assign(h),f.assign(m);var v=a.div(i).mul(h.div(m.add(r.epsilon))).add(c);c.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ln(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Ln(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n}(va);Pi(DM);var Dy=function(t){function n(e){var r=t.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return Ar(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=Array.isArray(e)?e[i].tensor:e[o];if(null!=a){var s=R.registeredVariables[o];ne(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function Rj(t){return R.keep(t)}(Y(-e))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(e,r){return new e(r.learningRate)},n.className="SGD",n}(va);Pi(Dy);var EM=function(t){function n(e,r,o){void 0===o&&(o=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=Y(i.momentum),i}return Ar(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulations[i]&&(r.accumulations[i]={originalName:o+"/momentum",variable:ne(function(){return $e(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(e)?e[i].tensor:e[o];null!=u&&ne(function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Ln(this.accumulations.map(function(e){return e.variable}))},n.prototype.setMomentum=function(e){this.momentum=e},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n}(Dy);Pi(EM);var SM=function(t){function n(e,r,o,i,a){void 0===r&&(r=.9),void 0===o&&(o=0),void 0===i&&(i=null),void 0===a&&(a=!1);var s=t.call(this)||this;if(s.learningRate=e,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,null==i&&(s.epsilon=R.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Ar(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulatedMeanSquares[i]&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:ne(function(){return $e(a).variable(!1)})}),null==r.accumulatedMoments[i]&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:ne(function(){return $e(a).variable(!1)})}),null==r.accumulatedMeanGrads[i]&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:ne(function(){return $e(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;ne(function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[i].variable,f=d.mul(r.decay).add(s.mul(1-r.decay)),h=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(f.square().add(r.epsilon)).sqrt()));u.assign(l),d.assign(f),c.assign(h);var p=a.sub(h);a.assign(p)}else{var g=u.mul(r.decay).add(s.square().mul(1-r.decay));h=c.mul(r.momentum).add(s.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),u.assign(g),c.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Ln(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Ln(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Ln(this.accumulatedMoments.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var e;return ie(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedMeanSquares=e.slice(0,r=this.centered?e.length/3:e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n}(va);Pi(SM),function(){function t(){}t.sgd=function(n){return new Dy(n)},t.momentum=function(n,e,r){return void 0===r&&(r=!1),new EM(n,e,r)},t.rmsprop=function(n,e,r,o,i){return void 0===e&&(e=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1),new SM(n,e,r,o,i)},t.adam=function(n,e,r,o){return void 0===n&&(n=.001),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),new CM(n,e,r,o)},t.adadelta=function(n,e,r){return void 0===n&&(n=.001),void 0===e&&(e=.95),void 0===r&&(r=null),new xM(n,e,r)},t.adamax=function(n,e,r,o,i){return void 0===n&&(n=.002),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),void 0===i&&(i=0),new DM(n,e,r,o,i)},t.adagrad=function(n,e){return void 0===e&&(e=.1),new _M(n,e)}}(),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate,ot.prototype.squaredDifference=function(t){return yI(this,t)},N=h8;var Ey=function(t,n){return(Ey=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(t,n)};function _e(t,n){function e(){this.constructor=t}Ey(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var xn=function(){return xn=Object.assign||function(n){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},xn.apply(this,arguments)};function se(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}function ue(t,n){var r,o,i,a,e={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,o=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(!(i=(i=e.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){e.label=c[1];break}if(6===c[0]&&e.label<i[1]){e.label=i[1],i=c;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(c);break}i[2]&&e.ops.pop(),e.trys.pop();continue}c=n.call(t,e)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function Pc(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var Vs=function(){function t(n,e){if(!ba(n)||!ba(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:e}));this._width=n,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function kc(t,n){return t instanceof ot&&t.shape.length===n}function Ff(t){return kc(t,3)}function ki(t){return kc(t,4)}function MM(t){return t%2==0}function RM(t){return t&&t.width&&t.height}function Sy(t){return t.reduce(function(n,e){return n.add(e)},new Xe(0,0)).div(new Xe(t.length,t.length))}function Oc(t,n,e){return Array(t).fill(0).map(function(r,o){return n+o*e})}function ba(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function TM(t){return ba(t)&&0<=t&&t<=1}var Xe=function(){function t(n,e){this._x=n,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y)},t.prototype.sub=function(n){return new t(this.x-n.x,this.y-n.y)},t.prototype.mul=function(n){return new t(this.x*n.x,this.y*n.y)},t.prototype.div=function(n){return new t(this.x/n.x,this.y/n.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),Jo=function(){function t(n,e){void 0===e&&(e=!0);var r=n||{},o=[r.left,r.top,r.right,r.bottom].every(ba),i=[r.x,r.y,r.width,r.height].every(ba);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",e),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(ba)},t.assertIsValidBox=function(n,e,r){if(void 0===r&&(r=!1),!t.isRect(n))throw new Error(e+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(e+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new Xe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new Xe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new Xe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new Xe(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.toSquare=function(){var n=this,e=n.x,r=n.y,o=n.width,i=n.height,a=Math.abs(o-i);return o<i&&(e-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new t({x:e,y:r,width:o,height:i})},t.prototype.rescale=function(n){var e=RM(n)?n.width:n,r=RM(n)?n.height:n;return new t({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},t.prototype.pad=function(n,e){var r=[this.x-n/2,this.y-e/2,this.width+n,this.height+e];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(n,e){var r=this,i=r.y,a=r.right,s=r.bottom,u=Math.max(r.x,0),c=Math.max(i,0),d=s-c;return new t({x:u,y:c,width:Math.min(a-u,n-u),height:Math.min(d,e-c)}).floor()},t.prototype.shift=function(n,e){return new t({x:this.x+n,y:this.y+e,width:this.width,height:this.height})},t.prototype.padAtBorders=function(n,e){var r=this.width+1,o=this.height+1,s=r,u=o,c=this.left,l=this.top,d=this.right,f=this.bottom;return d>e&&(s=-d+e+r,d=e),f>n&&(u=-f+n+o,f=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:1,edy:u,dx:1,edx:s,y:l,ey:f,x:c,ex:d,w:r,h:o}},t.prototype.calibrate=function(n){return new t({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},t}(),Lf=function(t){function n(e,r,o,i,a){return void 0===a&&(a=!1),t.call(this,{left:e,top:r,right:o,bottom:i},a)||this}return _e(n,t),n}(Jo),AM=function(){function t(n,e,r,o,i){this._imageDims=new Vs(i.width,i.height),this._score=n,this._classScore=e,this._className=r,this._box=new Jo(o).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new Jo(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:e})},t}(),po=function(t){function n(e,r,o){return t.call(this,e,e,"",r,o)||this}return _e(n,t),n.prototype.forSize=function(e,r){var o=t.prototype.forSize.call(this,e,r);return new n(o.score,o.relativeBox,o.imageDims)},n}(AM);function W8(t,n,e){void 0===e&&(e=!0);var i=Math.max(0,Math.min(t.right,n.right)-Math.max(t.left,n.left))*Math.max(0,Math.min(t.bottom,n.bottom)-Math.max(t.top,n.top));return e?i/(t.area+n.area-i):i/Math.min(t.area,n.area)}function Nc(t,n,e,r){void 0===r&&(r=!0);for(var o=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++)c.push(W8(t[s],t[u[l]],r));o=o.filter(function(p,g){return c[g]<=e})};o.length>0;)a();return i}function Fc(t,n){return ne(function(){var e=n[0],r=n[1],o=n[2],i=fo(Pc(t.shape.slice(0,3),[1]),e),a=fo(Pc(t.shape.slice(0,3),[1]),r),s=fo(Pc(t.shape.slice(0,3),[1]),o),u=Gt([i,a,s],3);return Kt(t,u)})}function Iy(t){return 1/(1+Math.exp(-t))}var Xt,My=function(t){function n(e,r,o,i,a){return void 0===a&&(a=!1),t.call(this,{x:e,y:r,width:o,height:i},a)||this}return _e(n,t),n}(Jo),Bf=function(){function t(n,e,r){void 0===r&&(r=new Xe(0,0));var o=e.width,i=e.height;this._imgDims=new Vs(o,i),this._shift=r,this._positions=n.map(function(a){return a.mul(new Xe(o,i)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new Xe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(e){return e.sub(n._shift).div(new Xe(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new this.constructor(this.relativePositions,{width:n,height:e})},t.prototype.shiftBy=function(n,e){return new this.constructor(this.relativePositions,this._imgDims,new Xe(n,e))},t.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},t.prototype.align=function(n,e){if(void 0===e&&(e={}),n){var r=n instanceof po?n.box.floor():new Jo(n);return this.shiftBy(r.x,r.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),a=o.minBoxPadding;return o.useDlibAlignment?this.alignDlib():this.alignMinBbox(a)},t.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),r=n[1],o=n[2],i=function(d){return o.sub(d).magnitude()},a=(i(n[0])+i(r))/2,s=Math.floor(a/.45),u=Sy(n),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new My(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},t.prototype.alignMinBbox=function(n){var e=function H8(t){var n=t.map(function(s){return s.x}),e=t.map(function(s){return s.y}),r=n.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return s<u?u:s},0),a=e.reduce(function(s,u){return s<u?u:s},0);return new Lf(r,o,i,a)}(this.positions);return e.pad(e.width*n,e.height*n)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),K8=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Sy([e[3],e[4]])]},n}(Bf),PM=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Sy)},n}(Bf),kM=function(){function t(n,e){this._label=n,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(n){return void 0===n&&(n=!0),this.label+(n?" ("+function V8(t,n){void 0===n&&(n=2);var e=Math.pow(10,n);return Math.floor(t*e)/e}(this.distance)+")":"")},t}(),OM=function(t){function n(e,r){var o=t.call(this,e)||this;return o._label=r,o}return _e(n,t),n.assertIsValidLabeledBox=function(e,r){if(Jo.assertIsValidBox(e,r),!ba(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(Jo),Uf=function(){function t(n,e){if("string"!=typeof n)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},t.fromJSON=function(n){var e=n.descriptors.map(function(r){return new Float32Array(r)});return new t(n.label,e)},t}();function Ry(t,n){return Object.assign({},t,{detection:n})}function NM(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function FM(t){var n="";if(!t)try{t=Gs(Object(function(){var o=new Error("Cannot find module 'fs'");throw o.code="MODULE_NOT_FOUND",o}()))}catch(r){n=r.toString()}return{readFile:t?function(r){return new Promise(function(o,i){t.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)}}}function LM(){var t=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=FM();return xn({Canvas:t||function a(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function a(){},Image:n||function a(){},ImageData:global.ImageData||function a(){},Video:global.HTMLVideoElement||function a(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},i)}function BM(){return"object"==typeof window&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function UM(){return"object"==typeof global&&typeof process<"u"&&!!process.version}function Ty(t){Xt=t}function Ay(){BM()&&Ty(NM()),UM()&&Ty(LM())}!function(t){function n(e,r,o,i){var a=t.call(this,e,r)||this;return a._score=o,a._classScore=i,a}_e(n,t),n.assertIsValidPredictedBox=function(e,r){if(OM.assertIsValidLabeledBox(e,r),!TM(e.score)||!TM(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(OM);var cn={getEnv:function Q8(){if(!Xt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Xt},setEnv:Ty,initialize:Ay,createBrowserEnv:NM,createFileSystem:FM,createNodejsEnv:LM,monkeyPatch:function Y8(t){if(Xt||Ay(),!Xt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=t.Canvas,e=void 0===n?Xt.Canvas:n,r=t.Image,o=void 0===r?Xt.Image:r;Xt.Canvas=e,Xt.Image=o,Xt.createCanvasElement=t.createCanvasElement||function(){return new e},Xt.createImageElement=t.createImageElement||function(){return new o},Xt.ImageData=t.ImageData||Xt.ImageData,Xt.Video=t.Video||Xt.Video,Xt.fetch=t.fetch||Xt.fetch,Xt.readFile=t.readFile||Xt.readFile},isBrowser:BM,isNodejs:UM};function Py(t){return cn.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function go(t){var n=cn.getEnv(),e=n.Canvas;if(t instanceof n.CanvasRenderingContext2D)return t;var o=Py(t);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}Ay();var Zo=(()=>(function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Zo||(Zo={})),Zo))(),VM=function t(n){void 0===n&&(n={});var r=n.backgroundColor,o=n.fontColor,i=n.fontSize,a=n.fontStyle,s=n.padding;this.anchorPosition=n.anchorPosition||Zo.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4};!function(){function t(n,e,r){void 0===r&&(r={}),this.text="string"==typeof n?[n]:n instanceof t?n.text:n,this.anchor=e,this.options=new VM(r)}t.prototype.measureWidth=function(n){var e=this.options.padding;return this.text.map(function(r){return n.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*e},t.prototype.measureHeight=function(){var n=this.options;return this.text.length*n.fontSize+2*n.padding},t.prototype.getUpperLeft=function(n,e){var r=this.options.anchorPosition,o=r===Zo.BOTTOM_RIGHT||r===Zo.TOP_RIGHT,i=r===Zo.BOTTOM_LEFT||r===Zo.BOTTOM_RIGHT,a=this.measureWidth(n),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(e){var d=e.height;return{x:Math.max(Math.min(u,e.width-a),0),y:Math.max(Math.min(c,d-s),0)}}return{x:u,y:c}},t.prototype.draw=function(n){var e=Py(n),r=go(e),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,c=o.padding;r.font=s+"px "+o.fontStyle;var l=this.measureWidth(r),d=this.measureHeight();r.fillStyle=i;var f=this.getUpperLeft(r,e);r.fillRect(f.x,f.y,l,d),r.fillStyle=a,this.text.forEach(function(h,p){r.fillText(h,c+f.x,c+f.y+(p+1)*s)})}}();function jM(t){var n=cn.getEnv();return t instanceof n.Image&&t.complete||t instanceof n.Video&&t.readyState>=3}function t$(t){return new Promise(function(n,e){if(!(t instanceof Blob))return e("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!=typeof r.result)return e("bufferToImage - expected reader.result to be a string, in onload");var o=cn.getEnv().createImageElement();o.onload=function(){return n(o)},o.onerror=e,o.src=r.result},r.onerror=e,r.readAsDataURL(t)})}function HM(t){var n=cn.getEnv(),r=n.Video;return t instanceof n.Image?new Vs(t.naturalWidth,t.naturalHeight):t instanceof r?new Vs(t.videoWidth,t.videoHeight):new Vs(t.width,t.height)}function Vf(t){var n=t.width,e=t.height,o=(0,cn.getEnv().createCanvasElement)();return o.width=n,o.height=e,o}function ky(t,n){var e=cn.getEnv().ImageData;if(!(t instanceof e||jM(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=n||HM(t),o=r.width,i=r.height,a=Vf({width:o,height:i});return t instanceof e?go(a).putImageData(t,0,0):go(a).drawImage(t,0,0,o,i),a}function n$(t,n){return se(this,void 0,void 0,function(){var e,r,o,i,a,s;return ue(this,function(u){switch(u.label){case 0:return e=n||cn.getEnv().createCanvasElement(),r=t.shape.slice(ki(t)?1:0),o=r[0],i=r[1],a=r[2],s=ne(function(){return t.as3D(o,i,a).toInt()}),[4,wy.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function WM(t){var n=cn.getEnv();return t instanceof n.Image||t instanceof n.Canvas||t instanceof n.Video}var jf=function(){function t(n,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=e,this._batchSize=n.length,n.forEach(function(o,i){if(Ff(o))return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape);if(ki(o)){var a=o.shape[0];if(1!==a)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape.slice(1))}var s=o instanceof cn.getEnv().Canvas?o:ky(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Oc(this.batchSize,0,1).map(function(e,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},t.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},t.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},t.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},t.prototype.getReshapedInputDimensions=function(n){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function j8(t,n){var e=t.width,r=t.height,o=n/Math.max(r,e);return new Vs(Math.round(e*o),Math.round(r*o))}({width:this.getInputWidth(n),height:this.getInputHeight(n)},this.inputSize)},t.prototype.toBatchTensor=function(n,e){var r=this;return void 0===e&&(e=!0),this._inputSize=n,ne(function(){var o=Oc(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof ot){var u=ki(s)?s:s.expandDims();return u=function z8(t,n){return void 0===n&&(n=!1),ne(function(){var e=t.shape.slice(1),r=e[0],o=e[1];if(r===o)return t;var i=Math.abs(r-o),a=Math.round(i*(n?.5:1)),s=r>o?2:1,u=function(h){var p=t.shape.slice();return p[s]=h,fo(p,0)},c=u(a),l=i-c.shape[s],f=[n&&l?u(l):null,t,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return Gt(f,s)})}(u,e),(u.shape[1]!==n||u.shape[2]!==n)&&(u=ny.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof cn.getEnv().Canvas)return wy.fromPixels(function r$(t,n,e){void 0===e&&(e=!1);var r=cn.getEnv(),i=r.Canvas;if(!(t instanceof r.Image||t instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=HM(t),s=n/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Vf({width:n,height:n}),d=t instanceof i?t:ky(t),f=Math.abs(u-c)/2,h=e&&u<c?f:0,p=e&&c<u?f:0;return go(l).drawImage(d,h,p,u,c),l}(s,n,e));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)});return nr(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,n,n,3)})},t}();function Jt(t){return se(this,void 0,void 0,function(){var n,e,r;return ue(this,function(o){switch(o.label){case 0:if(t instanceof jf)return[2,t];if(!(n=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(t)?" at input index "+i+":":""},(r=n.map(Py)).forEach(function(i,a){if(!WM(i)&&!Ff(i)&&!ki(i))throw"string"==typeof n[a]?new Error("toNetInput -"+e(a)+" string passed, but could not resolve HTMLElement for element id "+n[a]):new Error("toNetInput -"+e(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ki(i)){var s=i.shape[0];if(1!==s)throw new Error("toNetInput -"+e(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return WM(i)&&function e$(t){return new Promise(function(n,e){if(t instanceof cn.getEnv().Canvas||jM(t))return n();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),e(i))}t.addEventListener("load",r),t.addEventListener("error",o)})}(i)}))];case 1:return o.sent(),[2,new jf(r,Array.isArray(t))]}})})}function Oy(t,n){return se(this,void 0,void 0,function(){var e,r,o,i,a,s;return ue(this,function(c){switch(c.label){case 0:return e=cn.getEnv().Canvas,r=t,t instanceof e?[3,5]:[4,Jt(t)];case 1:if((o=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof e?(a=i,[3,4]):[3,2];case 2:return[4,n$(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=go(r),[2,n.map(function(l){return l instanceof po?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}).map(function(l){var d=l.x,f=l.y,h=l.width,p=l.height,g=Vf({width:h,height:p});return go(g).putImageData(s.getImageData(d,f,h,p),0,0),g})]}})})}function Ny(t,n){return se(this,void 0,void 0,function(){return ue(this,function(e){if(!Ff(t)&&!ki(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ki(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ne(function(){var r=t.shape.slice(ki(t)?1:0),o=r[0],i=r[1],a=r[2];return n.map(function(c){return c instanceof po?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}).map(function(c){var l=c.x,d=c.y,f=c.width,h=c.height;return jI(t.as3D(o,i,a),[d,l,0],[h,f,a])})})]})})}function zM(t,n){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return[4,(0,cn.getEnv().fetch)(t,n)];case 1:if(!((r=o.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function i$(t){return se(this,void 0,void 0,function(){return ue(this,function(n){switch(n.label){case 0:return[4,zM(t)];case 1:return[2,n.sent().json()]}})})}function $M(t,n){var e=n+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:e};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+e};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter(function(s){return s}),i=t.endsWith(".json")?o[o.length-1]:e,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function a$(t,n){return se(this,void 0,void 0,function(){var e,o,i;return ue(this,function(a){switch(a.label){case 0:return e=$M(t,n),o=e.modelBaseUri,[4,i$(e.manifestUri)];case 1:return i=a.sent(),[2,vM.loadWeights(i,o)]}})})}var ei=function(){function t(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(n){var e=this.traversePropertyPath(n);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(n,e){var r=this.traversePropertyPath(n),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=e},t.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Es})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Es)})},t.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(e){n.reassignParamFromPath(e.path,e.tensor.variable())})},t.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(e){var r=e.path,o=e.tensor,i=un(o.dataSync());o.dispose(),n.reassignParamFromPath(r,i)})},t.prototype.dispose=function(n){void 0===n&&(n=!0),this.getParamList().forEach(function(e){if(n&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){return Array.from(n.tensor.dataSync())}).reduce(function(n,e){return n.concat(e)}))},t.prototype.load=function(n){return se(this,void 0,void 0,function(){return ue(this,function(e){switch(e.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(n){return se(this,void 0,void 0,function(){var e;return ue(this,function(r){switch(r.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromUri - expected model uri");return[4,a$(n,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(n){return se(this,void 0,void 0,function(){var e,r,o,i,s,u,c,l,d;return ue(this,function(f){switch(f.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromDisk - expected model file path");return e=cn.getEnv().readFile,r=$M(n,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,s=vM.weightsLoaderFactory(function(h){return Promise.all(h.map(function(p){return e(p).then(function(g){return g.buffer})}))}),l=(c=JSON).parse,[4,e(o)];case 1:return u=l.apply(c,[f.sent().toString()]),[4,s(u,i)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},t.prototype.loadFromWeightMap=function(n){var e=this.extractParamsFromWeigthMap(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},t.prototype.extractWeights=function(n){var e=this.extractParams(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},t.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=n.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+n);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=e.obj,o=e.objProp;if(!(r&&o&&r[o]instanceof ot))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:o}},t}();function or(t,n,e){return ne(function(){var r=Yv(t,n.depthwise_filter,n.pointwise_filter,e,"same");return Be(r,n.bias)})}function Fy(t,n,e){return void 0===e&&(e=!1),ne(function(){var r=yt(e?Be(yr(t,n.conv0.filters,[2,2],"same"),n.conv0.bias):or(t,n.conv0,[2,2])),o=or(r,n.conv1,[1,1]),a=or(yt(Be(r,o)),n.conv2,[1,1]);return yt(Be(r,Be(o,a)))})}function Hf(t,n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),ne(function(){var o=yt(e?Be(yr(t,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):or(t,n.conv0,r?[2,2]:[1,1])),i=or(o,n.conv1,[1,1]),s=or(yt(Be(o,i)),n.conv2,[1,1]),c=or(yt(Be(o,Be(i,s))),n.conv3,[1,1]);return yt(Be(o,Be(i,Be(s,c))))})}function Ur(t,n,e,r){return void 0===e&&(e="same"),void 0===r&&(r=!1),ne(function(){var o=Be(yr(t,n.filters,[1,1],e),n.bias);return r?yt(o):o})}function ti(t,n){Object.keys(t).forEach(function(e){n.some(function(r){return r.originalPath===e})||t[e].dispose()})}function Wf(t,n){return function(e,r,o,i){var a=Un(t(e*r*o*o),[o,o,e,r]),s=Ut(t(r));return n.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function Ly(t,n){return function(e,r,o){var i=Ii(t(e*r),[e,r]),a=Ut(t(r));return n.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var GM=function t(n,e,r){this.depthwise_filter=n,this.pointwise_filter=e,this.bias=r};function By(t,n){return function(e,r,o){var i=Un(t(9*e),[3,3,e,1]),a=Un(t(e*r),[1,1,e,r]),s=Ut(t(r));return n.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new GM(i,a,s)}}function Uy(t){return function(n){var e=t(n+"/depthwise_filter",4),r=t(n+"/pointwise_filter",4),o=t(n+"/bias",1);return new GM(e,r,o)}}function Oi(t,n){return function(e,r,o){var i=t[e];if(!kc(i,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+i);return n.push({originalPath:e,paramPath:o||e}),i}}function ni(t){var n=t;return{extractWeights:function e(o){var i=n.slice(0,o);return n=n.slice(o),i},getRemainingWeights:function r(){return n}}}function qM(t,n){var e=Wf(t,n),r=By(t,n);function o(a,s,u,c){return void 0===c&&(c=!1),{conv0:c?e(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),conv1:r(s,s,u+"/conv1"),conv2:r(s,s,u+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function i(a,s,u,c){void 0===c&&(c=!1);var l=o(a,s,u,c);return{conv0:l.conv0,conv1:l.conv1,conv2:l.conv2,conv3:r(s,s,u+"/conv3")}}}}function KM(t){return function(n){return{filters:t(n+"/filters",4),bias:t(n+"/bias",1)}}}function XM(t,n){var e=Oi(t,n),r=KM(e),o=Uy(e);return{extractDenseBlock3Params:function i(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2")}},extractDenseBlock4Params:function a(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2"),conv3:o(s+"/conv3")}}}}var QM=function(t){function n(){return t.call(this,"FaceFeatureExtractor")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ne(function(){var s=Hf(Fc(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Y(255)),r.dense0,!0);return s=Hf(s,r.dense1),s=Hf(s,r.dense2),s=Hf(s,r.dense3),Tc(s,[7,7],[2,2],"valid")})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function u$(t){var n=[],e=XM(t,n).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return ti(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function s$(t){var n=[],e=ni(t),o=e.getRemainingWeights,i=qM(e.extractWeights,n).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(e)},n}(ei);function mo(t,n){return ne(function(){return Be(Rf(t,n.weights),n.bias)})}function YM(t){var n={},e={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?e:n)[r]=t[r]}),{featureExtractorMap:n,classifierMap:e}}var JM=function(t){function n(e,r){var o=t.call(this,e)||this;return o._faceFeatureExtractor=r,o}return _e(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ne(function(){var i=e instanceof jf?r.faceFeatureExtractor.forwardInput(e):e;return mo(i.as2D(i.shape[0],-1),o.fc)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return function c$(t,n,e){var r=[],o=ni(t),a=o.getRemainingWeights,u=Ly(o.extractWeights,r)(n,e,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(e){var r=YM(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function l$(t){var n=[],e=Oi(t,n),o={fc:function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}("fc")};return ti(t,n),{params:o,paramMappings:n}}(i)},n.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=e.slice(0,e.length-i),s=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},n}(ei),ZM=["neutral","happy","sad","angry","fearful","disgusted","surprised"],d$=function(){function t(n){var e=this;if(7!==n.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);ZM.forEach(function(r,o){e[r]=n[o]})}return t.prototype.asSortedArray=function(){var n=this;return ZM.map(function(e){return{expression:e,probability:n[e]}}).sort(function(e,r){return r.probability-e.probability})},t}(),f$=function(t){function n(e){return void 0===e&&(e=new QM),t.call(this,"FaceExpressionNet",e)||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this;return ne(function(){return qo(r.runNet(e))})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictExpressions=function(e){return se(this,void 0,void 0,function(){var r,o,i,a,s=this;return ue(this,function(u){switch(u.label){case 0:return[4,Jt(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(qt(o).map(function(c){return se(s,void 0,void 0,function(){var l;return ue(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new d$(c)}),[2,r.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(JM);function eR(t,n){return Object.assign({},t,{expressions:n})}function Vy(t,n){var e=t.detection.box,r=n.shiftBy(e.x,e.y),o=r.align(),i=t.detection.imageDims,a=new po(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:r,unshiftedLandmarks:n,alignedRect:a})}function tR(t,n,e){return Be(yr(t,n.filters,e,"same"),n.bias)}function jy(t,n,e){void 0===e&&(e=!0);var r=e?yt(t):t;return r=or(r,n.separable_conv0,[1,1]),r=or(yt(r),n.separable_conv1,[1,1]),r=Yt(r,[3,3],[2,2],"same"),Be(r,tR(t,n.expansion_conv,[2,2]))}var x$=function(t){function n(e){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return _e(n,t),n.prototype.forwardInput=function(e){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return ne(function(){var s=Fc(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Y(256)),u=yt(tR(s,o.entry_flow.conv_in,[2,2]));return u=jy(u,o.entry_flow.reduction_block_0,!1),u=jy(u,o.entry_flow.reduction_block_1),Oc(r._numMainBlocks,0,1).forEach(function(c){u=function w$(t,n){var e=or(yt(t),n.separable_conv0,[1,1]);return e=or(yt(e),n.separable_conv1,[1,1]),e=or(yt(e),n.separable_conv2,[1,1]),Be(e,t)}(u,o.middle_flow["main_block_"+c])}),u=jy(u,o.exit_flow.reduction_block),u=yt(or(u,o.exit_flow.separable_conv,[1,1]))})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function b$(t,n){var e=[],r=function y$(t,n){var e=Oi(t,n),r=KM(e),o=Uy(e);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function i(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),expansion_conv:r(s+"/expansion_conv")}},extractMainBlockParams:function a(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),separable_conv2:o(s+"/separable_conv2")}}}}(t,e),i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,d={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},f={};Oc(n,0,1).forEach(function(m){f["main_block_"+m]=s("middle_flow/main_block_"+m)});var g={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return ti(t,e),{params:{entry_flow:d,middle_flow:f,exit_flow:g},paramMappings:e}}(e,this._numMainBlocks)},n.prototype.extractParams=function(e){return function v$(t,n){var e=[],r=ni(t),i=r.getRemainingWeights,a=function m$(t,n){var e=Wf(t,n),r=By(t,n);return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:function o(a,s,u){return{separable_conv0:r(a,s,u+"/separable_conv0"),separable_conv1:r(s,s,u+"/separable_conv1"),expansion_conv:e(a,s,1,u+"/expansion_conv")}},extractMainBlockParams:function i(a,s){return{separable_conv0:r(a,a,s+"/separable_conv0"),separable_conv1:r(a,a,s+"/separable_conv1"),separable_conv2:r(a,a,s+"/separable_conv2")}}}}(r.extractWeights,e),u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,p={conv_in:(0,a.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},g={};Oc(n,0,1).forEach(function(y){g["main_block_"+y]=l(128,"middle_flow/main_block_"+y)});var b={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:g,exit_flow:b}}}(e,this._numMainBlocks)},n}(ei),Lc=(()=>(function(t){t.FEMALE="female",t.MALE="male"}(Lc||(Lc={})),Lc))(),D$=function(t){function n(e){void 0===e&&(e=new x$(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return _e(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ne(function(){var i=e instanceof jf?r.faceFeatureExtractor.forwardInput(e):e,a=Tc(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1);return{age:mo(a,o.fc.age).as1D(),gender:mo(a,o.fc.gender)}})},n.prototype.forwardInput=function(e){var r=this;return ne(function(){var o=r.runNet(e);return{age:o.age,gender:qo(o.gender)}})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictAgeAndGender=function(e){return se(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return ue(this,function(l){switch(l.label){case 0:return[4,Jt(e)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=qt(o.age),a=qt(o.gender),s=i.map(function(d,f){return{ageTensor:d,genderTensor:a[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,h=d.genderTensor;return se(c,void 0,void 0,function(){var p,g,m,v,b;return ue(this,function(y){switch(y.label){case 0:return[4,f.data()];case 1:return p=y.sent()[0],[4,h.data()];case 2:return g=y.sent()[0],v=(m=g>.5)?Lc.MALE:Lc.FEMALE,b=m?g:1-g,f.dispose(),h.dispose(),[2,{age:p,gender:v,genderProbability:b}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return function _$(t){var n=[],e=ni(t),o=e.getRemainingWeights,i=Ly(e.extractWeights,n),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:{age:a,gender:s}}}}(e)},n.prototype.extractParamsFromWeigthMap=function(e){var r=YM(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function C$(t){var n=[],e=Oi(t,n);function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return ti(t,n),{params:o,paramMappings:n}}(i)},n.prototype.extractParams=function(e){var o=e.slice(0,e.length-1539),i=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},n}(ei),nR=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.postProcess=function(e,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return ne(function(){var s=function(f,h){return nr([fo([68],f),fo([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=i[f],g=p.width,m=p.height;return h(g,m)?Math.abs(g-m)/2:0};return e.mul(fo([a,136],r)).sub(nr(Array.from(Array(a),function(f,h){return s(function(f){return u(f,function(h,p){return h<p})}(h),function(f){return u(f,function(h,p){return p<h})}(h))}))).div(nr(Array.from(Array(a),function(f,h){return s(i[h].width,i[h].height)})))})},n.prototype.forwardInput=function(e){var r=this;return ne(function(){var o=r.runNet(e);return r.postProcess(o,e.inputSize,e.inputDimensions.map(function(i){return{height:i[0],width:i[1]}}))})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.detectLandmarks=function(e){return se(this,void 0,void 0,function(){var r,o,i,a=this;return ue(this,function(s){switch(s.label){case 0:return[4,Jt(e)];case 1:return r=s.sent(),o=ne(function(){return qt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return se(a,void 0,void 0,function(){var l,d,f,h,p;return ue(this,function(g){switch(g.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return l=f.apply(d,[g.sent()]),h=l.filter(function(m,v){return MM(v)}),p=l.filter(function(m,v){return!MM(v)}),[2,new PM(Array(68).fill(0).map(function(m,v){return new Xe(h[v],p[v])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(JM),rR=function(t){function n(e){return void 0===e&&(e=new QM),t.call(this,"FaceLandmark68Net",e)||this}return _e(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(nR),I$=function(t){function n(){return t.call(this,"TinyFaceFeatureExtractor")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ne(function(){var s=Fy(Fc(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Y(255)),r.dense0,!0);return s=Fy(s,r.dense1),s=Fy(s,r.dense2),Tc(s,[14,14],[2,2],"valid")})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function E$(t){var n=[],e=XM(t,n).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return ti(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function S$(t){var n=[],e=ni(t),o=e.getRemainingWeights,i=qM(e.extractWeights,n).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u}}}(e)},n}(ei),M$=function(t){function n(e){return void 0===e&&(e=new I$),t.call(this,"FaceLandmark68TinyNet",e)||this}return _e(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(nR);function Hy(t,n,e,r,o){void 0===o&&(o="same");var i=n.conv,s=i.bias,u=yr(t,i.filters,e,o);return u=function R$(t,n){return Be(bn(t,n.weights),n.biases)}(u=Be(u,s),n.scale),r?yt(u):u}function oR(t,n){return Hy(t,n,[1,1],!1)}function iR(t,n){return Hy(t,n,[2,2],!0,"valid")}function A$(t,n){function i(s,u,c,l){var d=function r(s,u,c,l){var d=function e(s,u,c){var l=t(s),d=l.length/(u*c*c);if(function U8(t){return t%1!=0}(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return ne(function(){return Ri(Un(l,[u,d,c,c]),[2,3,1,0])})}(s,u,c),f=Ut(t(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:f}}(s,u,c,l+"/conv"),f=function o(s,u){var c=Ut(t(s)),l=Ut(t(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}(u,l+"/scale");return{conv:d,scale:f}}return{extractConvLayerParams:i,extractResidualLayerParams:function a(s,u,c,l,d){return void 0===d&&(d=!1),{conv1:i((d?.5:1)*s,u,c,l+"/conv1"),conv2:i(s,u,c,l+"/conv2")}}}}function O$(t){var n=[],e=function k$(t,n){var e=Oi(t,n);function o(a){var s=e(a+"/conv/filters",4),u=e(a+"/conv/bias",1),c=function r(a){return{weights:e(a+"/scale/weights",1),biases:e(a+"/scale/biases",1)}}(a);return{conv:{filters:s,bias:u},scale:c}}return{extractConvLayerParams:o,extractResidualLayerParams:function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}}}(t,n),o=e.extractResidualLayerParams,i=(0,e.extractConvLayerParams)("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),g=o("conv128_2"),m=o("conv256_down"),v=o("conv256_1"),b=o("conv256_2"),y=o("conv256_down_out"),w=t.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!function B8(t){return kc(t,2)}(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:g,conv256_down:m,conv256_1:v,conv256_2:b,conv256_down_out:y,fc:w};return ti(t,n),{params:x,paramMappings:n}}function vo(t,n){var e=function T$(t,n){return Hy(t,n,[1,1],!0)}(t,n.conv1);return e=oR(e,n.conv2),e=Be(e,t),yt(e)}function zf(t,n){var e=iR(t,n.conv1);e=oR(e,n.conv2);var r=Tc(t,2,2,"valid"),o=ht(r.shape),i=r.shape[3]!==e.shape[3];if(r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2]){var s=Pc(e.shape);s[1]=1;var u=ht(s),c=Pc((e=Gt([e,u],1)).shape);c[2]=1;var l=ht(c);e=Gt([e,l],2)}return r=i?Gt([r,o],3):r,e=Be(r,e),yt(e)}!function(t){_e(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(rR);var N$=function(t){function n(){return t.call(this,"FaceRecognitionNet")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ne(function(){var s=iR(Fc(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Y(256)),r.conv32_down);s=vo(s=Yt(s,3,2,"valid"),r.conv32_1),s=vo(s,r.conv32_2),s=vo(s,r.conv32_3),s=vo(s=zf(s,r.conv64_down),r.conv64_1),s=vo(s,r.conv64_2),s=vo(s,r.conv64_3),s=vo(s=zf(s,r.conv128_down),r.conv128_1),s=vo(s,r.conv128_2),s=vo(s=zf(s,r.conv256_down),r.conv256_1);var u=(s=zf(s=vo(s,r.conv256_2),r.conv256_down_out)).mean([1,2]);return Rf(u,r.fc)})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.computeFaceDescriptor=function(e){return se(this,void 0,void 0,function(){var r,o,i,a=this;return ue(this,function(s){switch(s.label){case 0:return[4,Jt(e)];case 1:return r=s.sent(),o=ne(function(){return qt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(e){return O$(e)},n.prototype.extractParams=function(e){return function P$(t){var n=ni(t),e=n.extractWeights,r=n.getRemainingWeights,o=[],i=A$(e,o),s=i.extractResidualLayerParams,u=(0,i.extractConvLayerParams)(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),M=ne(function(){return Ri(Ii(e(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:g,conv128_down:m,conv128_1:v,conv128_2:b,conv256_down:y,conv256_1:w,conv256_2:x,conv256_down_out:_,fc:M},paramMappings:o}}(e)},n}(ei);function aR(t,n,e){return Object.assign({},t,{gender:n,genderProbability:e})}var sR=function(){function t(n){var e=void 0===n?{}:n,r=e.minFaceSize,o=e.scaleFactor,i=e.maxNumScales,a=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function yo(t,n,e){return ne(function(){var r=yr(t,n.filters,e,"same");return r=Be(r,n.batch_norm_offset),$v(r,0,6)})}var V$=.0010000000474974513;function $$(t,n,e){var r=t.arraySync(),o=Math.min(r[n][0],r[n][2]),i=Math.min(r[n][1],r[n][3]),a=Math.max(r[n][0],r[n][2]),s=Math.max(r[n][1],r[n][3]),u=Math.min(r[e][0],r[e][2]),c=Math.min(r[e][1],r[e][3]),l=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),f=(a-o)*(s-i),h=(l-u)*(d-c);if(f<=0||h<=0)return 0;var p=Math.max(o,u),g=Math.max(i,c),m=Math.min(a,l),v=Math.min(s,d),b=Math.max(m-p,0)*Math.max(v-g,0);return b/(f+h-b)}function js(t,n){return ne(function(){var e=t.shape[0];return{boxPredictionEncoding:Fr(Ur(t,n.box_encoding_predictor),[e,-1,1,4]),classPrediction:Fr(Ur(t,n.class_predictor),[e,-1,3])}})}var $f=function(){function t(n){var e=void 0===n?{}:n,r=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),uR=function(t){function n(){return t.call(this,"SsdMobilenetv1")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ne(function(){var o=e.toBatchTensor(512,!1).toFloat(),a=function W$(t,n){return ne(function(){var e=null,r=yo(t,n.conv_0,[2,2]);if([n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13].forEach(function(i,a){var s=a+1,u=function H$(t){return[2,4,6,12].some(function(n){return n===t})?[2,2]:[1,1]}(s);r=function j$(t,n,e){return ne(function(){var r=Mf(t,n.filters,e,"same");return r=DI(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,V$),$v(r,0,6)})}(r,i.depthwise_conv,u),r=yo(r,i.pointwise_conv,[1,1]),11===s&&(e=r)}),null===e)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}(Kt(bn(o,Y(.007843137718737125)),Y(1)),r.mobilenetv1),s=function X$(t,n,e){return ne(function(){var r=yo(t,e.conv_0,[1,1]),o=yo(r,e.conv_1,[2,2]),i=yo(o,e.conv_2,[1,1]),a=yo(i,e.conv_3,[2,2]),s=yo(a,e.conv_4,[1,1]),u=yo(s,e.conv_5,[2,2]),c=yo(u,e.conv_6,[1,1]),l=yo(c,e.conv_7,[2,2]),d=js(n,e.box_predictor_0),f=js(t,e.box_predictor_1),h=js(o,e.box_predictor_2),p=js(a,e.box_predictor_3),g=js(u,e.box_predictor_4),m=js(l,e.box_predictor_5);return{boxPredictions:Gt([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:Gt([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,m.classPrediction],1)}})}(a.out,a.conv11,r.prediction_layer);return function K$(t,n,e){return ne(function(){var r=t.shape[0],o=function q$(t,n){var e=function G$(t){var n=qt(Ri(t,[1,0])),e=[Kt(n[2],n[0]),Kt(n[3],n[1])];return{sizes:e,centers:[Be(n[0],Br(e[0],Y(2))),Be(n[1],Br(e[1],Y(2)))]}}(t),r=e.sizes,o=e.centers,i=qt(Ri(n,[1,0])),a=Br(bn(Gv(Br(i[2],Y(5))),r[0]),Y(2)),s=Be(bn(Br(i[0],Y(10)),r[0]),o[0]),u=Br(bn(Gv(Br(i[3],Y(5))),r[1]),Y(2)),c=Be(bn(Br(i[1],Y(10)),r[1]),o[1]);return Ri(nr([Kt(s,a),Kt(c,u),Be(s,a),Be(c,u)]),[1,0])}(Fr(Is(e.extra_dim,[r,1,1]),[-1,4]),Fr(t,[-1,4]));o=Fr(o,[r,o.shape[0]/r,4]);var i=wI(ho(n,[0,0,1],[-1,-1,-1])),a=ho(i,[0,0,0],[-1,-1,1]);return a=Fr(a,[r,a.shape[1]]),{boxes:qt(o),scores:qt(a)}})}(s.boxPredictions,s.classPredictions,r.output_layer)})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.locateFaces=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,m,b,y,w,x,_,M,I;return ue(this,function(E){switch(E.label){case 0:return o=new $f(r),i=o.maxResults,a=o.minConfidence,[4,Jt(e)];case 1:for(s=E.sent(),u=this.forwardInput(s),d=(c=u.boxes)[0],f=(l=u.scores)[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return m=(g=Array).from,[4,f.data()];case 2:return p=m.apply(g,[E.sent()]),b=function z$(t,n,e,r,o){var a=Math.min(e,t.shape[0]),s=n.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>o}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var d=l.score,f=c.length-1;f>=0;--f){var h=$$(t,l.boxIndex,c[f]);if(0!==h&&(l.score*=u(h),l.score<=o))break}d===l.score&&c.push(l.boxIndex)}}),c}(d,p,i,.5,a),y=s.getReshapedInputDimensions(0),x=(w=s.inputSize)/y.width,_=w/y.height,M=d.arraySync(),I=b.map(function(S){var P=[Math.max(0,M[S][0]),Math.min(1,M[S][2])].map(function(H){return H*_}),A=P[0],V=P[1],U=[Math.max(0,M[S][1]),Math.min(1,M[S][3])].map(function(H){return H*x}),F=U[0];return new po(p[S],new My(F,A,U[1]-F,V-A),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,I]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function U$(t){var n=[],e=function B$(t,n){var e=Oi(t,n);function r(c,l,d){return{filters:e(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:e(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function o(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=l+"/depthwise_conv",h=l+"/pointwise_conv";return{depthwise_conv:{filters:e(d+"/depthwise_weights",4,f+"/filters"),batch_norm_scale:e(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),batch_norm_offset:e(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),batch_norm_mean:e(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),batch_norm_variance:e(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",c,h)}}function a(c,l){return{filters:e(c+"/weights",4,l+"/filters"),bias:e(c+"/biases",1,l+"/bias")}}function s(c){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}(t,n),r=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,i=t["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Ff(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return ti(t,n),{params:a,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function L$(t){var n=[],e=ni(t),r=e.extractWeights,o=e.getRemainingWeights,i=function F$(t,n){function r(u,c,l,d,f){var h=Un(t(u*c*l*l),[l,l,u,c]),p=Ut(t(c));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,c,l,d){var f=r(u,c,l,d,!0);return{filters:f.filters,batch_norm_offset:f.bias}}function i(u,c,l){var d=function e(u,c){var l=Un(t(9*u),[3,3,u,1]),d=Ut(t(u)),f=Ut(t(u)),h=Ut(t(u)),p=Ut(t(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}(u,l+"/depthwise_conv");return{depthwise_conv:d,pointwise_conv:o(u,c,1,l+"/pointwise_conv")}}return{extractMobilenetV1Params:function a(){return{conv_0:o(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function s(){return{conv_0:o(1024,256,1,"prediction_layer/conv_0"),conv_1:o(256,512,3,"prediction_layer/conv_1"),conv_2:o(512,128,1,"prediction_layer/conv_2"),conv_3:o(128,256,3,"prediction_layer/conv_3"),conv_4:o(256,128,1,"prediction_layer/conv_4"),conv_5:o(128,256,3,"prediction_layer/conv_5"),conv_6:o(256,64,1,"prediction_layer/conv_6"),conv_7:o(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,n),s=i.extractPredictionLayerParams,u=(0,i.extractMobilenetV1Params)(),c=s(),d={extra_dim:bv(r(20472),[1,5118,4])};if(n.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:n}}(e)},n}(ei);!function(t){_e(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(uR);var Y$=.4,J$=[new Xe(.738768,.874946),new Xe(2.42204,2.65704),new Xe(4.30971,7.04493),new Xe(10.246,4.59428),new Xe(12.6868,11.8741)],Z$=[new Xe(1.603231,2.094468),new Xe(6.041143,7.080126),new Xe(2.882459,3.518061),new Xe(4.266906,5.178857),new Xe(9.041765,10.66308)],eG=[117.001,114.697,97.404],Gf=function(t){return"number"==typeof t};function Wy(t){return ne(function(){var n=bn(t,Y(.10000000149011612));return Be(yt(Kt(t,n)),n)})}function Ni(t,n){return ne(function(){var e=da(t,[[0,0],[1,1],[1,1],[0,0]]);return e=yr(e,n.conv.filters,[1,1],"valid"),e=Kt(e,n.bn.sub),e=bn(e,n.bn.truediv),Wy(e=Be(e,n.conv.bias))})}function Fi(t,n){return ne(function(){var e=da(t,[[0,0],[1,1],[1,1],[0,0]]);return e=Yv(e,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),Wy(e=Be(e,n.bias))})}var zy=function(){function t(n){var e=void 0===n?{}:n,r=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),cR=function(t){function n(e){var r=t.call(this,"TinyYolov2")||this;return function rG(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!Gf(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(n){return"string"==typeof n}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(n){return n||{}}).every(function(n){return Gf(n.x)&&Gf(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(Gf)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),r._config=e,r}return _e(n,t),Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(e,r){var o=Ni(e,r.conv0);return o=Ni(o=Yt(o,[2,2],[2,2],"same"),r.conv1),o=Ni(o=Yt(o,[2,2],[2,2],"same"),r.conv2),o=Ni(o=Yt(o,[2,2],[2,2],"same"),r.conv3),o=Ni(o=Yt(o,[2,2],[2,2],"same"),r.conv4),o=Ni(o=Yt(o,[2,2],[2,2],"same"),r.conv5),o=Ni(o=Yt(o,[2,2],[1,1],"same"),r.conv6),Ur(o=Ni(o,r.conv7),r.conv8,"valid",!1)},n.prototype.runMobilenet=function(e,r){var o=this.config.isFirstLayerConv2d?Wy(Ur(e,r.conv0,"valid",!1)):Fi(e,r.conv0);return o=Fi(o=Yt(o,[2,2],[2,2],"same"),r.conv1),o=Fi(o=Yt(o,[2,2],[2,2],"same"),r.conv2),o=Fi(o=Yt(o,[2,2],[2,2],"same"),r.conv3),o=Fi(o=Yt(o,[2,2],[2,2],"same"),r.conv4),o=Fi(o=Yt(o,[2,2],[2,2],"same"),r.conv5),o=Yt(o,[2,2],[1,1],"same"),o=r.conv6?Fi(o,r.conv6):o,Ur(o=r.conv7?Fi(o,r.conv7):o,r.conv8,"valid",!1)},n.prototype.forwardInput=function(e,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return ne(function(){var a=e.toBatchTensor(r,!1).toFloat();return a=(a=o.config.meanRgb?Fc(a,o.config.meanRgb):a).div(Y(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},n.prototype.forward=function(e,r){return se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Jt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},n.prototype.detect=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,b=this;return ue(this,function(y){switch(y.label){case 0:return o=new zy(r),i=o.inputSize,a=o.scoreThreshold,[4,Jt(e)];case 1:return s=y.sent(),[4,this.forwardInput(s,i)];case 2:return u=y.sent(),c=ne(function(){return qt(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return d=y.sent(),u.dispose(),c.dispose(),f=d.map(function(w){return w.box}),h=d.map(function(w){return w.score}),p=d.map(function(w){return w.classScore}),g=d.map(function(w){return b.config.classes[w.label]}),[2,Nc(f.map(function(w){return w.rescale(i)}),h,this.config.iouThreshold,!0).map(function(w){return new AM(h[w],p[w],g[w],f[w],l)})]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(e){return function sG(t,n){var s,e=[],r=function aG(t,n){var e=Oi(t,n);function o(s){return{filters:e(s+"/filters",4),bias:e(s+"/bias",1)}}return{extractConvParams:o,extractConvWithBatchNormParams:function i(s){var u=o(s+"/conv"),c=function r(s){return{sub:e(s+"/sub",1),truediv:e(s+"/truediv",1)}}(s+"/bn");return{conv:u,bn:c}},extractSeparableConvParams:Uy(e)}}(t,e),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return ti(t,e),{params:s,paramMappings:e}}(e,this.config)},n.prototype.extractParams=function(e){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(7!==o&&8!==o&&9!==o)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return function iG(t,n,e,r){var f,o=ni(t),a=o.getRemainingWeights,s=[],u=function oG(t,n){var e=Wf(t,n),i=By(t,n);return{extractConvParams:e,extractConvWithBatchNormParams:function o(a,s,u){var c=e(a,s,3,u+"/conv"),l=function r(a,s){var u=Ut(t(a)),c=Ut(t(a));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}(s,u+"/bn");return{conv:c,bn:l}},extractSeparableConvParams:i}}(o.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(n.withSeparableConvs){var h=r[0],p=r[1],g=r[2],m=r[3],v=r[4],b=r[5],y=r[6],w=r[7],x=r[8];f={conv0:n.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,g,"conv1"),conv2:d(g,m,"conv2"),conv3:d(m,v,"conv3"),conv4:d(v,b,"conv4"),conv5:d(b,y,"conv5"),conv6:w?d(y,w,"conv6"):void 0,conv7:x?d(w,x,"conv7"):void 0,conv8:c(x||w||y,5*e,1,"conv8")}}else g=r[2],m=r[3],v=r[4],b=r[5],y=r[6],w=r[7],x=r[8],f={conv0:l(h=r[0],p=r[1],"conv0"),conv1:l(p,g,"conv1"),conv2:l(g,m,"conv2"),conv3:l(m,v,"conv3"),conv4:l(v,b,"conv4"),conv5:l(b,y,"conv5"),conv6:l(y,w,"conv6"),conv7:l(w,x,"conv7"),conv8:c(x,5*e,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}(e,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(e,r,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,m,v,b,y,w,x,_,M,I,E,S,P,A,V,U,F,W,H,j=this;return ue(this,function(q){switch(q.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=e.shape[1],d=this.config.anchors.length,f=ne(function(){var K=e.reshape([l,l,d,j.boxEncodingSize]);return[K.slice([0,0,0,0],[l,l,d,4]),K.slice([0,0,0,4],[l,l,d,1]),j.withClassScores?qo(K.slice([0,0,0,5],[l,l,d,j.config.classes.length]),3):Y(0)]}),h=f[0],g=f[2],m=[],[4,(p=f[1]).array()];case 1:return v=q.sent(),[4,h.array()];case 2:b=q.sent(),y=0,q.label=3;case 3:if(!(y<l))return[3,12];w=0,q.label=4;case 4:if(!(w<l))return[3,11];x=0,q.label=5;case 5:return x<d?(_=Iy(v[y][w][x][0]),!o||_>o?(M=(w+Iy(b[y][w][x][0]))/l*u,I=(y+Iy(b[y][w][x][1]))/l*c,E=Math.exp(b[y][w][x][2])*this.config.anchors[x].x/l*u,S=Math.exp(b[y][w][x][3])*this.config.anchors[x].y/l*c,P=M-E/2,A=I-S/2,V={row:y,col:w,anchor:x},this.withClassScores?[4,this.extractPredictedClass(g,V)]:[3,7]):[3,9]):[3,10];case 6:return H=q.sent(),[3,8];case 7:H={classScore:1,label:0},q.label=8;case 8:F=(U=H).classScore,W=U.label,m.push(xn({box:new Lf(P,A,P+E,A+S),score:_,classScore:_*F,label:W},V)),q.label=9;case 9:return x++,[3,5];case 10:return w++,[3,4];case 11:return y++,[3,3];case 12:return h.dispose(),p.dispose(),g.dispose(),[2,m]}})})},n.prototype.extractPredictedClass=function(e,r){return se(this,void 0,void 0,function(){var o,i,a,s;return ue(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(ei),uG=function(t){function n(e){void 0===e&&(e=!0);var o=Object.assign({},{withSeparableConvs:e,iouThreshold:Y$,classes:["face"]},e?{anchors:Z$,meanRgb:eG}:{anchors:J$,withClassScores:!0});return t.call(this,o)||this}return _e(n,t),Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return se(this,void 0,void 0,function(){return ue(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new po(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(cR),cG=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return _e(n,t),n}(zy),Bc=function(){function t(){}return t.prototype.then=function(n){return se(this,void 0,void 0,function(){var e;return ue(this,function(r){switch(r.label){case 0:return e=n,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},t}();function lR(t,n){return Object.assign({},t,{descriptor:n})}function qf(t,n,e,r,o){return void 0===o&&(o=function(i){return i.alignedRect}),se(this,void 0,void 0,function(){var i,a,s,u,c;return ue(this,function(l){switch(l.label){case 0:return i=t.map(function(d){return function h$(t){return function X8(t){return t.detection instanceof po}(t)&&t.landmarks instanceof Bf&&t.unshiftedLandmarks instanceof Bf&&t.alignedRect instanceof po}(d)?o(d):d.detection}),(s=r)?[3,5]:n instanceof ot?[4,Ny(n,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Oy(n,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,e(a=s)];case 6:return c=l.sent(),a.forEach(function(d){return d instanceof ot&&d.dispose()}),[2,c]}})})}function $y(t,n,e,r,o){return se(this,void 0,void 0,function(){var i=this;return ue(this,function(a){return[2,qf([t],n,function(s){return se(i,void 0,void 0,function(){return ue(this,function(u){return[2,e(s[0])]})})},r,o)]})})}var Kf=2,Xf=12;function Gy(t,n){var r=n[1];return{height:Math.floor(n[0]*t),width:Math.floor(r*t)}}var qy=function(t){function n(e,r,o,i){return t.call(this,{left:e,top:r,right:o,bottom:i},!0)||this}return _e(n,t),n}(Jo);function dR(t){return ne(function(){return bn(Kt(t,Y(127.5)),Y(.0078125))})}function Hs(t,n){return ne(function(){return Be(yt(t),bn(n,Cf(yt(Cf(t)))))})}function Ky(t,n,e){return void 0===e&&(e=!1),ne(function(){var r=Ur(t,n.conv1,"valid");return r=Hs(r,n.prelu1_alpha),r=Hs(r=Ur(r=Yt(r,e?[2,2]:[3,3],[2,2],"same"),n.conv2,"valid"),n.prelu2_alpha),Hs(r=Ur(r=e?r:Yt(r,[3,3],[2,2],"valid"),n.conv3,"valid"),n.prelu3_alpha)})}function bG(t,n,e,r,o){o.stage1=[];var i=n.map(function(f){return ne(function(){var h={scale:f},p=function vG(t,n){return ne(function(){var e=Gy(n,t.shape.slice(1)),a=dR(ny.resizeBilinear(t,[e.height,e.width]));return Ri(a,[0,2,1,3])})}(t,f),g=Date.now(),m=function mG(t,n){return ne(function(){var e=Ky(t,n,!0),r=Ur(e,n.conv4_1,"valid"),o=vr(Tf(r,3),3);return{prob:qo(Kt(r,o),3),regions:Ur(e,n.conv4_2,"valid")}})}(p,r),v=m.prob,b=m.regions;return h.pnet=Date.now()-g,{scoresTensor:qt(qt(v,3)[1])[0],regionsTensor:qt(b)[0],scale:f,statsForScale:h}})}),a=i.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,m=f.statsForScale,v=function yG(t,n,e,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=r&&o.push(new Xe(s,a));return o.map(function(c){var l=new Lf(Math.round((c.y*Kf+1)/e),Math.round((c.x*Kf+1)/e),Math.round((c.y*Kf+Xf)/e),Math.round((c.x*Kf+Xf)/e)),d=i[c.y][c.x],f=n.arraySync();return{cell:l,score:d,region:new qy(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3])}})}(h,p,f.scale,e);if(h.dispose(),p.dispose(),!v.length)return o.stage1.push(m),[];var b=Date.now(),y=Nc(v.map(function(w){return w.cell}),v.map(function(w){return w.score}),.5);return m.nms=Date.now()-b,m.numBoxes=y.length,o.stage1.push(m),y.map(function(w){return v[w]})}),s=a.reduce(function(f,h){return f.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),d=Nc(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-l,c=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var h=f.cell,p=f.region;return new Lf(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function fR(t,n,e){var r=e.width,o=e.height;return se(this,void 0,void 0,function(){var i,a,s,u=this;return ue(this,function(c){switch(c.label){case 0:return i=go(t),[4,Promise.all(n.map(function(l){return se(u,void 0,void 0,function(){var d,m,v,b;return ue(this,function(y){return d=l.padAtBorders(t.height,t.width),b=i.getImageData(m=d.x-1,v=d.y-1,d.ex-m,d.ey-v),[2,cn.isNodejs()?ky(b):createImageBitmap(b)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var f=go(Vf({width:r,height:o}));f.drawImage(l,0,0,r,o);for(var h=f.getImageData(0,0,r,o).data,p=[],g=0;g<h.length;g+=4)p.push(h[g+2]),p.push(h[g+1]),p.push(h[g]);s.push(p)}),[2,s.map(function(l){return ne(function(){return dR(Ri(Un(l,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function xG(t,n,e,r,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,m,v,b;return ue(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,fR(t,n,{width:24,height:24})];case 1:return a=y.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var x=function wG(t,n){return ne(function(){var e=Ky(t,n),i=Hs(mo(Fr(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu4_alpha),a=mo(i,n.fc2_1),s=vr(Tf(a,1),1),u=qo(Kt(a,s),1),c=mo(i,n.fc2_2);return{scores:qt(u,1)[1],regions:c}})}(w,r);return w.dispose(),x}),o.stage2_rnet=Date.now()-i,u=s.length>1?Gt(s.map(function(w){return w.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[y.sent()]),u.dispose(),f=c.map(function(w,x){return{score:w,idx:x}}).filter(function(w){return w.score>e}).map(function(w){return w.idx}),h=f.map(function(w){return n[w]}),p=f.map(function(w){return c[w]}),g=[],m=[],h.length>0&&(i=Date.now(),v=Nc(h,p,.7),o.stage2_nms=Date.now()-i,b=v.map(function(w){var x=s[f[w]].regions.arraySync();return new qy(x[0][0],x[0][1],x[0][2],x[0][3])}),m=v.map(function(w){return p[w]}),g=v.map(function(w,x){return h[w].calibrate(b[x])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:g,scores:m}]}})})}function CG(t,n,e,r,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,m,v,b,y;return ue(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,fR(t,n,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(x){var _=function _G(t,n){return ne(function(){var e=Ky(t,n);e=Hs(e=Ur(e=Yt(e,[2,2],[2,2],"same"),n.conv4,"valid"),n.prelu4_alpha);var i=Hs(mo(Fr(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu5_alpha),a=mo(i,n.fc2_1),s=vr(Tf(a,1),1),u=qo(Kt(a,s),1),c=mo(i,n.fc2_2),l=mo(i,n.fc2_3);return{scores:qt(u,1)[1],regions:c,points:l}})}(x,r);return x.dispose(),_}),o.stage3_onet=Date.now()-i,u=s.length>1?Gt(s.map(function(x){return x.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[w.sent()]),u.dispose(),f=c.map(function(x,_){return{score:x,idx:_}}).filter(function(x){return x.score>e}).map(function(x){return x.idx}),h=f.map(function(x){var _=s[x].regions.arraySync();return new qy(_[0][0],_[0][1],_[0][2],_[0][3])}),p=f.map(function(x,_){return n[x].calibrate(h[_])}),g=f.map(function(x){return c[x]}),m=[],v=[],b=[],p.length>0&&(i=Date.now(),y=Nc(p,g,.7,!1),o.stage3_nms=Date.now()-i,m=y.map(function(x){return p[x]}),v=y.map(function(x){return g[x]}),b=y.map(function(x,_){return Array(5).fill(0).map(function(M,I){var E=s[x].points.arraySync();return new Xe(E[0][I]*(m[_].width+1)+m[_].left,E[0][I+5]*(m[_].height+1)+m[_].top)})})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:m,scores:v,points:b}]}})})}var DG=function(t){function n(){return t.call(this,"Mtcnn")||this}return _e(n,t),n.prototype.load=function(e){return se(this,void 0,void 0,function(){return ue(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},n.prototype.loadFromDisk=function(e){return se(this,void 0,void 0,function(){return ue(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},n.prototype.forwardInput=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,m,v,y,w,x,_,M,I;return ue(this,function(E){switch(E.label){case 0:if(!(o=this.params))throw new Error("Mtcnn - load model before inference");if(!(i=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=ne(function(){return function lG(t){return ne(function(){return nr(qt(t,3).reverse(),3)})}(vr(wy.fromPixels(i)).toFloat())}),c=function(S){return u.dispose(),a.total=Date.now()-s,S},l=u.shape.slice(1),d=l[0],f=l[1],h=new sR(r),p=h.minFaceSize,g=h.scaleFactor,m=h.maxNumScales,v=h.scoreThresholds,y=(h.scaleSteps||function gG(t,n,e){for(var i=Xf/t,a=[],s=Math.min(e[0],e[1])*i,u=0;s>=12;)a.push(i*Math.pow(n,u)),s*=n,u+=1;return a}(p,g,[d,f])).filter(function(S){var P=Gy(S,[d,f]);return Math.min(P.width,P.height)>Xf}).slice(0,m),a.scales=y,a.pyramid=y.map(function(S){return Gy(S,[d,f])}),w=Date.now(),[4,bG(u,y,v[0],o.pnet,a)];case 1:return x=E.sent(),a.total_stage1=Date.now()-w,x.boxes.length?(a.stage2_numInputBoxes=x.boxes.length,w=Date.now(),[4,xG(i,x.boxes,v[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return _=E.sent(),a.total_stage2=Date.now()-w,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,w=Date.now(),[4,CG(i,_.boxes,v[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return M=E.sent(),a.total_stage3=Date.now()-w,I=M.boxes.map(function(S,P){return Vy(Ry({},new po(M.scores[P],new My(S.left/f,S.top/d,S.width/f,S.height/d),{height:d,width:f})),new K8(M.points[P].map(function(A){return A.sub(new Xe(S.left,S.top)).div(new Xe(S.width,S.height))}),{width:S.width,height:S.height}))}),[2,c({results:I,stats:a})]}})})},n.prototype.forward=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Jt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},n.prototype.forwardWithStats=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Jt(e)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function pG(t){var n=[],e=function hG(t,n){var e=Oi(t,n);function r(l){return{filters:e(l+"/weights",4,l+"/filters"),bias:e(l+"/bias",1)}}function o(l){return{weights:e(l+"/weights",2),bias:e(l+"/bias",1)}}function i(l){return e(l,1)}function a(l){return{conv1:r(l+"/conv1"),prelu1_alpha:i(l+"/prelu1_alpha"),conv2:r(l+"/conv2"),prelu2_alpha:i(l+"/prelu2_alpha"),conv3:r(l+"/conv3"),prelu3_alpha:i(l+"/prelu3_alpha")}}return{extractPNetParams:function s(){var l=a("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return xn(xn({},l),{conv4_1:d,conv4_2:f})},extractRNetParams:function u(){var l=a("rnet"),d=o("rnet/fc1"),f=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return xn(xn({},l),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})},extractONetParams:function c(){var l=a("onet"),d=r("onet/conv4"),f=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),g=o("onet/fc2_1"),m=o("onet/fc2_2"),v=o("onet/fc2_3");return xn(xn({},l),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:g,fc2_2:m,fc2_3:v})}}}(t,n),o=e.extractRNetParams,i=e.extractONetParams,a=(0,e.extractPNetParams)(),s=o(),u=i();return ti(t,n),{params:{pnet:a,rnet:s,onet:u},paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function fG(t){var n=ni(t),r=n.getRemainingWeights,o=[],i=function dG(t,n){var e=Wf(t,n),r=Ly(t,n);function o(c,l){var d=Ut(t(c));return n.push({paramPath:l}),d}function i(c,l,d){return void 0===d&&(d=!1),{conv1:e(c[0],c[1],3,l+"/conv1"),prelu1_alpha:o(c[1],l+"/prelu1_alpha"),conv2:e(c[1],c[2],3,l+"/conv2"),prelu2_alpha:o(c[2],l+"/prelu2_alpha"),conv3:e(c[2],c[3],d?2:3,l+"/conv3"),prelu3_alpha:o(c[3],l+"/prelu3_alpha")}}return{extractPNetParams:function a(){var c=i([3,10,16,32],"pnet"),l=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return xn(xn({},c),{conv4_1:l,conv4_2:d})},extractRNetParams:function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return xn(xn({},c),{fc1:l,prelu4_alpha:d,fc2_1:f,fc2_2:h})},extractONetParams:function u(){var c=i([3,32,64,64],"onet"),l=e(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),m=r(256,10,"onet/fc2_3");return xn(xn({},c),{conv4:l,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:g,fc2_3:m})}}}(n.extractWeights,o),s=i.extractRNetParams,u=i.extractONetParams,c=(0,i.extractPNetParams)(),l=s(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:o}}(e)},n}(ei),EG=.4,SG=[new Xe(1.603231,2.094468),new Xe(6.041143,7.080126),new Xe(2.882459,3.518061),new Xe(4.266906,5.178857),new Xe(9.041765,10.66308)],IG=[117.001,114.697,97.404],MG=function(t){function n(){return t.call(this,{withSeparableConvs:!0,iouThreshold:EG,classes:["face"],anchors:SG,meanRgb:IG,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return _e(n,t),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return se(this,void 0,void 0,function(){return ue(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new po(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(cR),et={ssdMobilenetv1:new uR,tinyFaceDetector:new MG,tinyYolov2:new uG,mtcnn:new DG,faceLandmark68Net:new rR,faceLandmark68TinyNet:new M$,faceRecognitionNet:new N$,faceExpressionNet:new f$,ageGenderNet:new D$},RG=function(t){return et.ssdMobilenetv1.load(t)},TG=function(t){return et.faceLandmark68Net.load(t)},AG=function(t){return et.faceRecognitionNet.load(t)};function hR(t,n){return Object.assign({},t,{age:n})}var pR=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return _e(n,t),n}(Bc),Xy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o=this;return ue(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,qf(e=i.sent(),this.input,function(a){return se(o,void 0,void 0,function(){return ue(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return et.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){return eR(a,r[s])})]}})})},n.prototype.withAgeAndGender=function(){return new Zy(this,this.input)},n}(pR),Qy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,$y(e,this.input,function(i){return et.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,eR(e,r)]}})})},n.prototype.withAgeAndGender=function(){return new e0(this,this.input)},n}(pR),Yy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withAgeAndGender=function(){return new t0(this,this.input)},n.prototype.withFaceDescriptors=function(){return new r0(this,this.input)},n}(Xy),Jy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withAgeAndGender=function(){return new n0(this,this.input)},n.prototype.withFaceDescriptor=function(){return new o0(this,this.input)},n}(Qy),gR=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return _e(n,t),n}(Bc),Zy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o=this;return ue(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,qf(e=i.sent(),this.input,function(a){return se(o,void 0,void 0,function(){return ue(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return et.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){var u=r[s],c=u.age;return hR(aR(a,u.gender,u.genderProbability),c)})]}})})},n.prototype.withFaceExpressions=function(){return new Xy(this,this.input)},n}(gR),e0=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o;return ue(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?[4,$y(e,this.input,function(u){return et.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,[2,hR(aR(e,r.gender,r.genderProbability),o)]}})})},n.prototype.withFaceExpressions=function(){return new Qy(this,this.input)},n}(gR),t0=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withFaceExpressions=function(){return new Yy(this,this.input)},n.prototype.withFaceDescriptors=function(){return new r0(this,this.input)},n}(Zy),n0=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withFaceExpressions=function(){return new Jy(this,this.input)},n.prototype.withFaceDescriptor=function(){return new o0(this,this.input)},n}(e0),mR=function(t){function n(e,r){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o}return _e(n,t),n}(Bc),r0=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,qf(e=o.sent(),this.input,function(i){return Promise.all(i.map(function(a){return et.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,o.sent().map(function(i,a){return lR(e[a],i)})]}})})},n.prototype.withFaceExpressions=function(){return new Yy(this,this.input)},n.prototype.withAgeAndGender=function(){return new t0(this,this.input)},n}(mR),o0=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,$y(e,this.input,function(i){return et.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,lR(e,r)]}})})},n.prototype.withFaceExpressions=function(){return new Jy(this,this.input)},n.prototype.withAgeAndGender=function(){return new n0(this,this.input)},n}(mR),vR=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.useTinyLandmarkNet=o,i}return _e(n,t),Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?et.faceLandmark68TinyNet:et.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(Bc),PG=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return ue(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(c){return c.detection}),this.input instanceof ot?[4,Ny(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,Oy(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof ot&&c.dispose()}),[2,e.map(function(c,l){return Vy(c,a[l])})]}})})},n.prototype.withFaceExpressions=function(){return new Yy(this,this.input)},n.prototype.withAgeAndGender=function(){return new t0(this,this.input)},n.prototype.withFaceDescriptors=function(){return new r0(this,this.input)},n}(vR),kG=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o,i,a;return ue(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?(r=e.detection,this.input instanceof ot?[4,Ny(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,Oy(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((o=i)[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof ot&&u.dispose()}),[2,Vy(e,a)]}})})},n.prototype.withFaceExpressions=function(){return new Jy(this,this.input)},n.prototype.withAgeAndGender=function(){return new n0(this,this.input)},n.prototype.withFaceDescriptor=function(){return new o0(this,this.input)},n}(vR),yR=function(t){function n(e,r){void 0===r&&(r=new $f);var o=t.call(this)||this;return o.input=e,o.options=r,o}return _e(n,t),n}(Bc),bR=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o,i;return ue(this,function(a){switch(a.label){case 0:return r=(e=this).input,(o=e.options)instanceof sR?[4,et.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(!(i=o instanceof cG?function(s){return et.tinyFaceDetector.locateFaces(s,o)}:o instanceof $f?function(s){return et.ssdMobilenetv1.locateFaces(s,o)}:o instanceof zy?function(s){return et.tinyYolov2.locateFaces(s,o)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return se(e,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return Ry({},a)}))]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new PG(this.runAndExtendWithFaceDetections(),this.input,e)},n.prototype.withFaceExpressions=function(){return new Xy(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new Zy(this.runAndExtendWithFaceDetections(),this.input)},n}(yR);function wR(t,n){return void 0===n&&(n=new $f),new bR(t,n)}function xR(t,n){if(t.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(t),r=Array.from(n);return Math.sqrt(e.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}function NG(t,n){1&t&&(O(0,"div",1),hn(),O(1,"svg",2),Z(2,"circle",3)(3,"circle",4),B()())}!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}_e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r;return ue(this,function(o){switch(o.label){case 0:return[4,new bR(this.input,this.options)];case 1:return e=o.sent(),r=e[0],e.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return se(e,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?Ry({},o):void 0)]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new kG(this.runAndExtendWithFaceDetection(),this.input,e)},n.prototype.withFaceExpressions=function(){return new Qy(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new e0(this.runAndExtendWithFaceDetection(),this.input)}}(yR),function(){function t(n,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof Uf)return a;if(a instanceof Float32Array)return new Uf(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Uf(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(n,e){return e.map(function(r){return xR(r,n)}).reduce(function(r,o){return r+o},0)/(e.length||1)},t.prototype.matchDescriptor=function(n){var e=this;return this.labeledDescriptors.map(function(r){return new kM(r.label,e.computeMeanDistance(n,r.descriptors))}).reduce(function(r,o){return r.distance<o.distance?r:o})},t.prototype.findBestMatch=function(n){var e=this.matchDescriptor(n);return e.distance<this.distanceThreshold?e:new kM("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},t.fromJSON=function(n){return new t(n.labeledDescriptors.map(function(r){return Uf.fromJSON(r)}),n.distanceThreshold)}}();let FG=(()=>{class t{constructor(){this.showCounting=!0}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ui({type:t,selectors:[["app-timers"]],decls:1,vars:1,consts:[["class","countdown","id","counting",4,"ngIf"],["id","counting",1,"countdown"],["viewBox","-50 -50 100 100","stroke-width","10"],["r","45"],["r","45","pathLength","1"]],template:function(e,r){1&e&&di(0,NG,4,0,"div",0),2&e&&nn("ngIf",r.showCounting)},dependencies:[hd],styles:['@property --t{syntax: "<number>"; initial-value: 3; inherits: true;}@property --s{syntax: "<integer>"; initial-value: 0; inherits: true;}.countdown[_ngcontent-%COMP%]{--s: calc(var(--t)/1);display:grid;margin:1em auto;width:10em;height:10em;animation:_ngcontent-%COMP%_t 3s linear infinite}.countdown[_ngcontent-%COMP%]:after{grid-column:1;grid-row:1;place-self:center;font:2.5em/2 ubuntu mono,consolas,monaco,monospace;counter-reset:s var(--s);content:"0:" counter(s,decimal-leading-zero);color:#fff}@keyframes _ngcontent-%COMP%_t{to{--t: 0}}svg[_ngcontent-%COMP%]{grid-column:1;grid-row:1}[r][_ngcontent-%COMP%]{fill:none;stroke:silver}[r][_ngcontent-%COMP%] + [r][_ngcontent-%COMP%]{--k: calc(var(--t)/3);transform:rotate(-90deg);stroke-linecap:round;stroke:color-mix(in hsl shorter hue,#8a9b0f calc(var(--k)*100%),#940a3d);stroke-dasharray:var(--k) 1}']}),t})();const LG=["action"],BG=["recogination"],UG=["videoElement"],VG=["canvasElement"],jG=["usermsg"];function HG(t,n){if(1&t&&(O(0,"span"),X(1),B()),2&t){const e=Du();tt(1),pi("",e.tries,"->left")}}function WG(t,n){1&t&&(O(0,"div",46),Z(1,"app-timers"),B())}let zG=(()=>{class t{constructor(){this.show_timer=!0,this.flip_card=!1,this.cameraloading=!0,this.qrscanned=!1,this.roll=0,this.stream="CS",this.id="",this.modelloading=!0,this.message="Loading",this.faceRecoginising=!1,this.user_image="assets/needs/frame.png",this.user_name="Message",this.user_message="Scan ID Card Below",this.tries=3,this.users={"9155CS20":{user_name:"Imtiyaz-Ali",roll:27,stream:"CS",img:"assets/students/me.jpeg"},"9028CS20":{user_name:"Kashinath S",roll:30,stream:"CS",img:"assets/students/kashi.jpg"},"8842CS20":{user_name:"Govind P",roll:26,stream:"CS",img:"assets/students/govind.jpg"},"9094CS20":{user_name:"AlanSavio",roll:7,stream:"CS",img:"assets/students/savio.jpg"}}}ngOnInit(){var e=this;return oa(function*(){e.user_message="Model is Loading"})()}ngAfterViewInit(){var e=this;return oa(function*(){setTimeout(()=>{e.loadModels(),e.user_name="Message",e.user_message="Scan Your ID Card",e.show_timer=!1,e.playUserAnim()},3e3),e.scanner?.start()})()}ngOnDestroy(){this.scanner?.isStart&&(this.scanner?.stop(),this.modelloading=!0,this.cameraloading=!0)}loadModels(){console.log("Model");const e="./assets/models/",r=[RG(e),TG(e),AG(e)];Promise.all(r).then(()=>{this.user_message="Scan Your ID-Card",console.log("Model loaded successfully")}).catch(o=>{this.user_message="Error On Model Loading",this.message="Error: "+o})}checkUser(e){for(let r in this.users)if(e===r)return this.user_name=this.users[e].user_name,this.user_name=this.users[e].user_name,this.user_image=this.users[e].img,this.user_message="Complete Face Scanning",this.roll=this.users[e].roll,this.id=e,!0;return!1}scanSuccessHandler(e){const r=e[0].value;if(this.faceRecoginising)return this.user_message="Face Recogination Still Going On",void this.playUserAnim();this.scanner?.pause();const i=this.checkUser(r),a=document.getElementById("alerting"),s=document.getElementById("alertingfail");i?document.getElementById("buttonAnim"):document.getElementById("buttonAnim1"),i?(this.playUserAnim(),this.faceRecoginising=!0,a?.classList.add("showAlert"),setTimeout(()=>{a?.classList.remove("showAlert"),this.show_timer=!0,this.scanner?.play(),setTimeout(()=>{this.show_timer=!1},3e3)},2e3),setTimeout(()=>{try{const c=this.scanner?.video.nativeElement;this.startRecogination(c)}catch(c){console.log(c)}},5e3)):(s?.classList.add("showAlert"),this.user_message="Error!Try Again",this.playUserAnim(),setTimeout(()=>{s?.classList.remove("showAlert"),this.user_message="Scan ID Card",this.scanner?.play()},2e3))}startRecogination(e){var r=this;this.tries=3,this.face_scanning_interval=setInterval(oa(function*(){0==r.tries&&(r.user_message="Not Identified.Reported To Admin",r.faceRecoginising=!1,r.playUserAnim(),clearInterval(r.face_scanning_interval));const o=yield wR(e).withFaceLandmarks().withFaceDescriptors();o.length>0&&(r.scanner?.stop(),o.length>1?(console.log("Multiple Faces Detected"),r.user_message="Multiple Face Detected.Try Again",r.playUserAnim(),setTimeout(()=>{r.scanner?.start()},3e3)):(r.user_message="Comparing Faces",r.playUserAnim(),r.compareFaces(r.user_image,o)))}),1e3)}compareFaces(e,r){var o=this;return oa(function*(){const i=yield function o$(t){return se(this,void 0,void 0,function(){var n,e;return ue(this,function(r){switch(r.label){case 0:return[4,zM(t)];case 1:return[4,(n=r.sent()).blob()];case 2:if(!(e=r.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+e.type+", for url: "+n.url);return[2,t$(e)]}})})}(e),a=yield wR(i).withFaceLandmarks().withFaceDescriptors();if(!(a.length>0&&r.length>0))return console.log("No faces detected in one or both images"),o.message="Error On Comparing.Contact Admin",void o.playUserAnim();xR(a[0].descriptor,r[0].descriptor)<.6?(o.faceRecoginising=!1,o.user_message="Faces Are Similar",o.playUserAnim(),clearInterval(o.face_scanning_interval),o.flip_card=!0,o.faceRecoginationSuccess(),setTimeout(()=>{o.flip_card=!1,o.user_name="Message",o.user_message="Scan You ID Card",o.user_image="assets/needs/frame.png",o.scanner?.start()},3e3)):(console.log("Faces are different.It Will Get Reported"),o.user_message="Face Not Matched.Try Again",o.tries=o.tries-1,o.playUserAnim(),setTimeout(()=>{o.scanner?.start()},3e3))})()}faceRecoginationSuccess(){console.log("ASdf")}playUserAnim(){this.usermsg.nativeElement.classList.add("blink"),setTimeout(()=>{this.usermsg.nativeElement.classList.remove("blink")},2e3)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ui({type:t,selectors:[["app-camera"]],viewQuery:function(e,r){if(1&e&&(eo(LG,5),eo(BG,5),eo(UG,5),eo(VG,5),eo(jG,5)),2&e){let o;Sr(o=Ir())&&(r.scanner=o.first),Sr(o=Ir())&&(r.recogination=o.first),Sr(o=Ir())&&(r.videoElement=o.first),Sr(o=Ir())&&(r.canvasElement=o.first),Sr(o=Ir())&&(r.usermsg=o.first)}},decls:97,vars:12,consts:[[1,"mainbody"],["id","usermsg"],["usermsg",""],[1,"user_detail"],[1,"img_pod"],["alt","random image",1,"user_img",2,"object-fit","cover",3,"src"],[1,"container_copy"],["id","studentName",2,"font-weight","bolder","padding","0px 35px","text-transform","capitalize","color","rgba(245, 235, 235, 0.829)"],[4,"ngIf"],["id","studentMessage",2,"font-size","smaller","font-weight","bolder","text-transform","uppercase","padding","0px 35px","color","#d4c9c9da"],[1,"anim-box","center","spacer"],["id","scanner",1,"scanner","startScan"],["id","response"],["type","checkbox","id","reg-log","name","reg-log",1,"checkbox",3,"checked"],[1,"card-3d-wrap","mx-auto"],[1,"card-3d-wrapper"],[1,"card-front"],["style","position:absolute;top: 20%;left:35%;z-index: 11;","class","timer",4,"ngIf"],[3,"event"],["action","scanner"],[1,"card-back"],[1,"card","profile-card-3"],[1,"background-block"],["src","https://images.pexels.com/photos/459225/pexels-photo-459225.jpeg?auto=compress&cs=tinysrgb&h=650&w=940","alt","profile-sample1",1,"background"],[1,"profile-thumb-block"],["alt","profile-image",1,"profile",2,"object-fit","cover",3,"src"],[1,"card-content"],[2,"font-weight","bold"],["id","buttonAnim",1,"btn-circle-download"],["id","arrow","width","27px","height","29px","viewBox","17 14 14 20"],["d","M24,15 L24,32"],["points","30 27 24 33 18 27"],["id","check","width","30px","height","30px","viewBox","13 17 21 15"],["points","32.5 18.5 20 31 14.5 25.5"],["id","border","width","60px","height","60px","viewBox","0 0 48 48"],["d","M24,1 L24,1 L24,1 C36.7025492,1 47,11.2974508 47,24 L47,24 L47,24 C47,36.7025492 36.7025492,47 24,47 L24,47 L24,47 C11.2974508,47 1,36.7025492 1,24 L1,24 L1,24 C1,11.2974508 11.2974508,1 24,1 L24,1 Z"],["id","alerting",1,"alerting"],[1,"blog_post"],[2,"color","#999","font-weight","bold","margin-top","1px","margin-bottom","2px"],[2,"margin","0em"],[2,"margin-bottom","-1px","font-weight","bold","background-color","rgb(35, 161, 35)"],[1,"typing"],["id","alertingfail",1,"alerting"],["id","buttonAnim1",1,"btn-circle-download"],["points","0 0 60 60 50 0 0 50"],[2,"margin-bottom","-1px","font-weight","bold","background-color","rgb(131, 33, 33)"],[1,"timer",2,"position","absolute","top","20%","left","35%","z-index","11"]],template:function(e,r){1&e&&(O(0,"div",0)(1,"div",1,2)(3,"div",3)(4,"div",4),Z(5,"img",5),B(),O(6,"div",6)(7,"h3",7),X(8),di(9,HG,2,1,"span",8),B(),Z(10,"hr"),O(11,"p",9),X(12),B()()()(),O(13,"div",10),Z(14,"div")(15,"div",11),O(16,"div",12),Z(17,"input",13),O(18,"div",14)(19,"div",15)(20,"div",16),di(21,WG,2,0,"div",17),O(22,"ngx-scanner-qrcode",18,19),fi("event",function(i){return r.scanSuccessHandler(i)}),B()(),O(24,"div",20)(25,"div",21)(26,"div",22),Z(27,"img",23),B(),O(28,"div",24),Z(29,"img",25),B(),O(30,"div",26)(31,"h2"),X(32),B(),O(33,"h5",27),X(34,"[Attendence Marked]"),B(),O(35,"div",28),hn(),O(36,"svg",29),Z(37,"path",30)(38,"polyline",31),B(),O(39,"svg",32),Z(40,"polyline",33),B(),O(41,"svg",34),Z(42,"path",35),B()()()()()()()()()(),kn(),O(43,"div",36)(44,"div",37)(45,"div",4)(46,"div",28),hn(),O(47,"svg",29),Z(48,"path",30)(49,"polyline",31),B(),O(50,"svg",32),Z(51,"polyline",33),B(),O(52,"svg",34),Z(53,"path",35),B()()(),kn(),O(54,"div",6)(55,"p",38),X(56,"12 January 2019"),B(),Z(57,"hr",39),O(58,"h3",40),X(59,"Success"),B(),Z(60,"hr",39),O(61,"p"),X(62,"Name: "),O(63,"span",41),X(64),B()(),O(65,"p"),X(66,"Roll No: "),O(67,"span",41),X(68),B()(),O(69,"p"),X(70,"ID NO: "),O(71,"span",41),X(72),B()(),O(73,"p"),X(74,"Stream: "),O(75,"span",41),X(76),B()()()()(),O(77,"div",42)(78,"div",37)(79,"div",4)(80,"div",43),hn(),O(81,"svg",29),Z(82,"path",30)(83,"polyline",31),B(),O(84,"svg",32),Z(85,"polyline",44),B(),O(86,"svg",34),Z(87,"path",35),B()()(),kn(),O(88,"div",6)(89,"p",38),X(90,"12 January 2019"),B(),Z(91,"hr",39),O(92,"h3",45),X(93,"Failed"),B(),Z(94,"hr",39),O(95,"p",41),X(96,"Unable To Find Your Data Please Make Sure You Are Registered First."),B()()()()),2&e&&(tt(5),nn("src",r.user_image,Va),tt(3),pi(" ",r.user_name," "),tt(1),nn("ngIf",r.faceRecoginising),tt(3),pi(" Message: ",r.user_message,". "),tt(5),nn("checked",r.flip_card),tt(4),nn("ngIf",r.show_timer),tt(8),nn("src",r.user_image,Va),tt(3),Xn(r.user_name),tt(32),Xn(r.user_name),tt(4),Xn(r.roll),tt(4),Xn(r.id),tt(4),Xn(r.stream))},dependencies:[hd,sU,FG],styles:['@import"https://fonts.googleapis.com/css?family=Poppins:400,500,600,700,800,900";.center[_ngcontent-%COMP%]{margin:0 auto;text-align:center}.anim-box[_ngcontent-%COMP%]{position:relative;padding:25px 30px;transition:transform .6s ease-out}.anim-box[_ngcontent-%COMP%]:before, .anim-box[_ngcontent-%COMP%]:after, .anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:before, .anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:after{position:absolute;width:10%;height:15%;border-color:#c53d3d;border-style:solid;content:" "}.anim-box[_ngcontent-%COMP%]:before{top:0;left:0;border-width:2px 0 0 2px}.anim-box[_ngcontent-%COMP%]:after{top:0;right:0;border-width:2px 2px 0 0}.anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:before{bottom:0;right:0;border-width:0 2px 2px 0}.anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:after{bottom:0;left:0;border-width:0 0 2px 2px}.anim-box[_ngcontent-%COMP%]:hover   .scanner[_ngcontent-%COMP%]{animation-play-state:running}.scanner[_ngcontent-%COMP%]{width:100%;height:3px;background-color:red;opacity:.7;position:relative;box-shadow:0 0 8px 10px #aa0b177d;top:50%}.startScan[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_scan;animation-duration:4s;animation-timing-function:linear;animation-iteration-count:infinite;z-index:10}@keyframes _ngcontent-%COMP%_scan{0%{box-shadow:0 0 8px 10px #aa0b177d;top:50%}25%{box-shadow:0 6px 8px 10px #aa0b177d;top:5px}75%{box-shadow:0 -6px 8px 10px #aa0b177d;top:98%}}#response[_ngcontent-%COMP%]{border:1px solid white;box-shadow:0 0 15px 7px #00f8d362}.camera[_ngcontent-%COMP%]{max-width:40vw;max-height:40vw}.mainbody[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;margin:2px;flex-direction:column;flex-wrap:wrap;align-content:center;justify-content:center;align-items:center}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_sparklyBits 1s infinite;position:absolute}#burrito[_ngcontent-%COMP%]{margin:5px}.message[_ngcontent-%COMP%]{margin-top:20px;font-size:15px;text-align:center;font-weight:700;color:#977e7e;font-family:Courier New,Courier,monospace;width:200px}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(1){animation-delay:35ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(2){animation-delay:70ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(3){animation-delay:105ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(4){animation-delay:.14s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(5){animation-delay:175ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(6){animation-delay:.21s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(7){animation-delay:245ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(8){animation-delay:.28s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(9){animation-delay:315ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(10){animation-delay:.35s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(11){animation-delay:385ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(12){animation-delay:.42s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(13){animation-delay:455ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(14){animation-delay:.49s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(15){animation-delay:525ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(16){animation-delay:.56s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(17){animation-delay:595ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(18){animation-delay:.63s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(19){animation-delay:665ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(20){animation-delay:.7s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(21){animation-delay:735ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(22){animation-delay:.77s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(23){animation-delay:805ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(24){animation-delay:.84s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(25){animation-delay:875ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(26){animation-delay:.91s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(27){animation-delay:945ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(28){animation-delay:.98s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(29){animation-delay:1015ms}@keyframes _ngcontent-%COMP%_sparklyBits{0%{opacity:0}to{opacity:1}}#sparkles[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], #burrito[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#9b8c8c}.btn-circle-download[_ngcontent-%COMP%]{position:relative;height:60px;width:60px;margin:auto;border-radius:100%;background:#E8EAED;cursor:pointer;overflow:hidden;transition:all .2s ease}.btn-circle-download[_ngcontent-%COMP%]:after{content:"";position:relative;display:block;width:200%;height:100%;background-image:linear-gradient(100deg,rgba(255,255,255,0),rgba(255,255,255,.25),rgba(255,255,255,0));transform:translate(-100%)}.btn-circle-download[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none}.btn-circle-download[_ngcontent-%COMP%]   svg#border[_ngcontent-%COMP%]{position:absolute;top:0;left:0;stroke:none;stroke-dasharray:144;stroke-dashoffset:144;transition:all .5s linear}.btn-circle-download[_ngcontent-%COMP%]   svg#arrow[_ngcontent-%COMP%]{position:absolute;top:14px;left:17px;stroke:#9098a9;transition:all .2s ease}.btn-circle-download[_ngcontent-%COMP%]   svg#check[_ngcontent-%COMP%]{position:absolute;top:17px;left:13px;stroke:#fff;transform:scale(0)}.btn-circle-download[_ngcontent-%COMP%]:hover{background:rgba(0,119,255,.2)}.btn-circle-download[_ngcontent-%COMP%]:hover   #arrow[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .btn-circle-download[_ngcontent-%COMP%]:hover   #arrow[_ngcontent-%COMP%]   polyline[_ngcontent-%COMP%]{stroke:#07f}.btn-circle-download.load[_ngcontent-%COMP%]{background:rgba(0,119,255,.2)}.btn-circle-download.load[_ngcontent-%COMP%]   #arrow[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .btn-circle-download.load[_ngcontent-%COMP%]   #arrow[_ngcontent-%COMP%]   polyline[_ngcontent-%COMP%]{stroke:#07f}.btn-circle-download.load[_ngcontent-%COMP%]   #border[_ngcontent-%COMP%]{stroke:#07f;stroke-dasharray:144;stroke-dashoffset:0}.btn-circle-download.done[_ngcontent-%COMP%]{background:#0077FF;animation:_ngcontent-%COMP%_rubberBand .8s}.btn-circle-download.done[_ngcontent-%COMP%]:after{transform:translate(50%);transition:transform .4s ease;transition-delay:.7s}.btn-circle-download.done[_ngcontent-%COMP%]   #border[_ngcontent-%COMP%], .btn-circle-download.done[_ngcontent-%COMP%]   #arrow[_ngcontent-%COMP%]{display:none}.btn-circle-download.done[_ngcontent-%COMP%]   #check[_ngcontent-%COMP%]{transform:scale(1);transition:all .2s ease;transition-delay:.2s}@keyframes _ngcontent-%COMP%_rubberBand{0%{transform:scale(1,1,1)}30%{transform:scale3d(1.15,.75,1)}40%{transform:scale3d(.75,1.15,1)}50%{transform:scale3d(1.1,.85,1)}65%{transform:scale3d(.95,1.05,1)}75%{transform:scale3d(1.05,.95,1)}to{transform:scaleZ(1)}}.credit[_ngcontent-%COMP%]{position:fixed;right:20px;bottom:20px;transition:all .2s ease;-webkit-user-select:none;user-select:none;opacity:.6}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:72px}.credit[_ngcontent-%COMP%]:hover{transform:scale(.95)}.blog_post[_ngcontent-%COMP%]{background:#fff;max-width:250px;border-radius:10px;box-shadow:1px 1px 2rem #0000004d;position:relative;text-align:center}.container_copy[_ngcontent-%COMP%]{padding:2px}.img_pod[_ngcontent-%COMP%]{height:60px;width:60px;background:rgb(66,52,52);z-index:10;box-shadow:1px 1px 2rem #0000004d;border-radius:100%;position:absolute;left:-10%;top:-13%;display:flex;align-items:center;justify-content:center}.date[_ngcontent-%COMP%]{font-weight:700;color:#999}.typing[_ngcontent-%COMP%]{position:relative}.typing[_ngcontent-%COMP%]:after{content:"|";position:absolute;right:0;width:100%;color:red;background:#ffffff;animation:_ngcontent-%COMP%_typing 1s steps(16) forwards,caret 1s infinite}@keyframes _ngcontent-%COMP%_typing{to{width:0}}@keyframes _ngcontent-%COMP%_caret{50%{color:transparent}}.alerting[_ngcontent-%COMP%]{width:350px;position:fixed;top:50%;left:50%;display:none}.showAlert[_ngcontent-%COMP%]{display:block;z-index:10}@media screen and (max-width: 512px){.mainbody[_ngcontent-%COMP%]{display:block}.loading[_ngcontent-%COMP%]{height:100%;display:flex;align-content:center;justify-content:center;align-items:center;justify-items:center;flex-direction:column;flex-wrap:wrap}.camera[_ngcontent-%COMP%]{max-width:auto;max-height:auto}.alerting[_ngcontent-%COMP%]{position:fixed;top:50%;left:30%;width:70vw}}[type=checkbox][_ngcontent-%COMP%]:checked, [type=checkbox][_ngcontent-%COMP%]:not(:checked){position:absolute;left:-9999px}.checkbox[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%], .checkbox[_ngcontent-%COMP%]:not(:checked) + label[_ngcontent-%COMP%]{position:relative;display:block;text-align:center;width:60px;height:16px;border-radius:8px;padding:0;margin:10px auto;cursor:pointer;background-color:#ffeba7}.checkbox[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:before, .checkbox[_ngcontent-%COMP%]:not(:checked) + label[_ngcontent-%COMP%]:before{position:absolute;display:block;width:36px;height:36px;border-radius:50%;color:#ffeba7;background-color:#102770;font-family:unicons;content:"\\eb4f";z-index:20;top:-10px;left:-10px;line-height:36px;text-align:center;font-size:24px;transition:all .5s ease}.checkbox[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:before{transform:translate(44px) rotate(-270deg)}.card-3d-wrap[_ngcontent-%COMP%]{position:relative;width:450px;height:50vh;transform-style:preserve-3d;perspective:800px}.card-3d-wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0;transform-style:preserve-3d;transition:all .6s ease-out}.card-front[_ngcontent-%COMP%], .card-back[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#2a2b38;background-image:url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/1462889/pat.svg);background-position:bottom center;background-repeat:no-repeat;background-size:300%;position:absolute;border-radius:6px;left:0;top:0;transform-style:preserve-3d;-webkit-backface-visibility:hidden;backface-visibility:hidden}.card-back[_ngcontent-%COMP%]{transform:rotateY(180deg)}.checkbox[_ngcontent-%COMP%]:checked ~ .card-3d-wrap[_ngcontent-%COMP%]   .card-3d-wrapper[_ngcontent-%COMP%]{transform:rotateY(180deg)}.center-wrap[_ngcontent-%COMP%]{position:absolute;width:100%;padding:0 35px;top:50%;left:0;transform:translate3d(0,-50%,35px) perspective(100px);z-index:20;display:block}.chekbox[_ngcontent-%COMP%]{display:none}.user_detail[_ngcontent-%COMP%]{background:#283030c7;max-width:380px;min-width:300px;border-radius:10px;border:2px solid rgba(255,0,0,.308);box-shadow:1px 1px 2rem #0000004d;text-align:center;position:absolute;top:14%;left:50%}.anim[_ngcontent-%COMP%]{position:inherit;animation:_ngcontent-%COMP%_moveFromRightToLeft 2s linear}@keyframes _ngcontent-%COMP%_moveFromRightToLeft{0%{max-width:400px;top:14%;left:100%}to{max-width:380px;top:14%;left:50%}}.blink[_ngcontent-%COMP%]{width:auto;animation:_ngcontent-%COMP%_blink 1s infinite}@keyframes _ngcontent-%COMP%_blink{0%{opacity:1}20%{opacity:0}40%{opacity:1}60%{opacity:0}80%{opacity:1}to{opacity:0}}.container_copy[_ngcontent-%COMP%]{width:auto}hr[_ngcontent-%COMP%]{margin:0;color:#ff0000b2}.img_pod[_ngcontent-%COMP%]{height:72px;width:75px;background:linear-gradient(90deg,#ff996681,#ff5e6191);z-index:10;box-shadow:1px 1px 2rem #0000004d;border-radius:20px;position:absolute;left:-20%;top:0%;display:flex;align-items:center;justify-content:center}.user_img[_ngcontent-%COMP%]{height:4.3rem;width:4.3rem;position:relative;border-radius:20px;box-shadow:1px 1px 2rem #0000004d;z-index:1}h3[_ngcontent-%COMP%]{color:#fff;font-size:1.25rem}.profile-card-3[_ngcontent-%COMP%]{font-family:Open Sans,Arial,sans-serif;position:relative;float:left;overflow:hidden;width:100%;text-align:center;height:99%;border:none}.profile-card-3[_ngcontent-%COMP%]   .background-block[_ngcontent-%COMP%]{float:left;width:100%;height:200px;overflow:hidden}.profile-card-3[_ngcontent-%COMP%]   .background-block[_ngcontent-%COMP%]   .background[_ngcontent-%COMP%]{width:100%;vertical-align:top;opacity:.9;filter:blur(.5px);transform:scale(2.8)}.profile-card-3[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{width:100%;padding:15px 25px;color:#232323;float:left;background:#efefef;height:50%;border-radius:0 0 5px 5px;position:relative;z-index:9999}.profile-card-3[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]:before{content:"";background:#efefef;width:120%;height:100%;left:11px;bottom:51px;position:absolute;z-index:-1;transform:rotate(-13deg)}.profile-card-3[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]{border-radius:10px;position:absolute;bottom:50%;left:50%;max-width:100px;opacity:1;box-shadow:3px 3px 20px #00000080;border:2px solid rgba(255,255,255,1);transform:translate(-50%);z-index:99999}.profile-card-3[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 5px;font-weight:600;font-size:25px}.profile-card-3[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;font-size:15px;margin-top:10px}.profile-card-3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:inline-block;font-size:16px;color:#232323;text-align:center;border:1px solid #232323;width:30px;height:30px;line-height:30px;border-radius:50%;margin:0 5px}.profile-card-3[_ngcontent-%COMP%]   .icon-block[_ngcontent-%COMP%]{float:left;width:100%;margin-top:15px}.profile-card-3[_ngcontent-%COMP%]   .icon-block[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.profile-card-3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{background-color:#232323;color:#fff;text-decoration:none}']}),t})(),$G=(()=>{class t{constructor(e){this.http=e}getAttendanceData(){return this.http.get("assets/data.json")}}return t.\u0275fac=function(e){return new(e||t)(ce(mm))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),GG=(()=>{class t{constructor(e,r,o){this.el=e,this.renderer=r,this.attendanceService=o}loadData(){var e=this;return oa(function*(){try{e.loadingData=!0;const r=yield e.attendanceService.getAttendanceData().toPromise();e.attendanceData=r,console.log(r),console.log(e.attendanceData[0]),e.getCalender()}catch(r){console.error(r)}finally{e.loadingData=!1}})()}getCalender(){this.attendanceData&&this.attendanceData.forEach(e=>{1==e.class?$("#calendar").evoCalendar("addCalendarEvent",[{id:e.date,name:`Attendence(${e.date})`,date:`${e.date}/2023`,type:"event",color:"green",description:`Total-Absents: ${e.absent}`},{id:`Absent ${e.date}`,name:"Absentees Roll-No",date:`${e.date}/2023`,type:"event",color:"red",description:`${e.rollNo}`},{id:`Leave ${e.leave}`,name:"On-Leave Roll-No",date:`${e.date}/2023`,type:"event",color:"blue",description:`${e.leave}`}]):$("#calendar").evoCalendar("addCalendarEvent",[{id:e.date,name:"No Class",date:`${e.date}/2023`,type:"holiday",description:"No Class Has Taken On This Day"}])})}ngOnInit(){this.loadData(),$("#calendar").evoCalendar({theme:"Midnight Blue"}),$("#calendar").evoCalendar("toggleSidebar",!1),this.getCalender(),setTimeout(()=>{$("#calendar").evoCalendar("addCalendarEvent",[{id:"123",name:"dxfg",date:"04/04/2023",type:"event",color:"green",description:"Total-Absents:"}])},3e3)}addEvent(){const r=this.el.nativeElement.querySelector("#calendar");$(r).evoCalendar("addCalendarEvent",[{id:"345345",name:"345",date:"04/04/2023",type:"event",color:"green",description:"Total-Absents:"}])}}return t.\u0275fac=function(e){return new(e||t)(he(Ao),he(Wa),he($G))},t.\u0275cmp=ui({type:t,selectors:[["app-teacher"]],decls:27,vars:0,consts:[["rel","stylesheet","href","https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/css/evo-calendar.min.css"],["rel","stylesheet","href","https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/css/evo-calendar.midnight-blue.min.css"],[1,"mainBody"],[1,"containerss","mt-5"],[1,"row","d-flex","justify-content-center"],[1,"col-md-7"],[1,"card","p-3","py-4"],[1,"text-center"],["src","https://i.imgur.com/bDLhJiP.jpg","width","100",1,"rounded-circle"],[1,"text-center","mt-3"],[1,"bg-secondary","p-1","px-4","rounded","text-white"],[1,"mt-2","mb-0"],[1,"px-4","mt-1"],[1,"fonts"],[1,"buttons"],[1,"btn","btn-outline-primary","px-4"],[1,"btn","btn-primary","px-4","ms-3"],[1,"hero"],["id","calendar"]],template:function(e,r){1&e&&(Z(0,"link",0)(1,"link",1),O(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),Z(8,"img",8),B(),O(9,"div",9)(10,"span",10),X(11,"Teacher"),B(),O(12,"h5",11),X(13,"Imtiyaz Ali"),B(),O(14,"span"),X(15,"Subject: Discrete Mathematics"),B(),O(16,"div",12)(17,"p",13),X(18,"Originally From Ladakh is an Gold Medalist Teacher in Discrete Mathematics."),B()(),O(19,"div",14)(20,"button",15),X(21,"Message"),B(),O(22,"button",16),X(23,"Contact"),B()()()()()()(),Ll(24),O(25,"div",17),Z(26,"div",18),B(),Bl(),B())},styles:[".mainBody[_ngcontent-%COMP%]{height:100vh;overflow:auto}.card[_ngcontent-%COMP%]{border:none;position:relative;overflow:hidden;border-radius:8px;cursor:pointer;color:var(--app-content-main-color);background:unset}.card[_ngcontent-%COMP%]:hover:after{transform:scaleY(1)}.fonts[_ngcontent-%COMP%]{font-size:11px}.social-list[_ngcontent-%COMP%]{display:flex;list-style:none;justify-content:center;padding:0}.social-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px;color:#8e24aa;font-size:19px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){border:1px solid #8E24AA!important;color:#8e24aa;height:40px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1):hover{border:1px solid #8E24AA!important;color:#fff;height:40px;background-color:#8e24aa}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){border:1px solid #8E24AA!important;background-color:#8e24aa;color:#fff;height:40px}.hero[_ngcontent-%COMP%]{width:100%;height:100%;display:grid}#calendar[_ngcontent-%COMP%]{width:90%;margin:40px auto}.calendar-events[_ngcontent-%COMP%]{background-color:red}@media screen and (max-width: 991px){.sidebar-hide[_ngcontent-%COMP%]   .calendar-inner[_ngcontent-%COMP%]{background-color:red}}"]}),t})();class qG extends jn{constructor(n,e){super()}schedule(n,e=0){return this}}const Qf={setInterval(t,n,...e){const{delegate:r}=Qf;return r?.setInterval?r.setInterval(t,n,...e):setInterval(t,n,...e)},clearInterval(t){const{delegate:n}=Qf;return(n?.clearInterval||clearInterval)(t)},delegate:void 0},_R={now:()=>(_R.delegate||Date).now(),delegate:void 0};class Uc{constructor(n,e=Uc.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,r){return new this.schedulerActionCtor(this,n).schedule(r,e)}}Uc.now=_R.now;const QG=new class XG extends Uc{constructor(n,e=Uc.now){super(n,e),this.actions=[],this._active=!1}flush(n){const{actions:e}=this;if(this._active)return void e.push(n);let r;this._active=!0;do{if(r=n.execute(n.state,n.delay))break}while(n=e.shift());if(this._active=!1,r){for(;n=e.shift();)n.unsubscribe();throw r}}}(class KG extends qG{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var r;if(this.closed)return this;this.state=n;const o=this.id,i=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(i,o,e)),this.pending=!0,this.delay=e,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,e),this}requestAsyncId(n,e,r=0){return Qf.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,e,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return e;null!=e&&Qf.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(n,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let o,r=!1;try{this.work(n)}catch(i){r=!0,o=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:n,scheduler:e}=this,{actions:r}=e;this.work=this.state=this.scheduler=null,this.pending=!1,Vc(r,this),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}});function CR(t=1/0){let n;n=t&&"object"==typeof t?t:{count:t};const{count:e=1/0,delay:r,resetOnSuccess:o=!1}=n;return e<=0?ai:jt((i,a)=>{let u,s=0;const c=()=>{let l=!1;u=i.subscribe(Pt(a,d=>{o&&(s=0),a.next(d)},void 0,d=>{if(s++<e){const f=()=>{u?(u.unsubscribe(),u=null,c()):l=!0};if(null!=r){const h="number"==typeof r?function JG(t=0,n,e=QG){let r=-1;return null!=n&&(O0(n)?e=n:r=n),new Et(o=>{let i=function YG(t){return t instanceof Date&&!isNaN(t)}(t)?+t-e.now():t;i<0&&(i=0);let a=0;return e.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}(r):ar(r(d,s)),p=Pt(a,()=>{p.unsubscribe(),f()},()=>{a.complete()});h.subscribe(p)}else f()}else a.error(d)})),l&&(u.unsubscribe(),u=null,c())};c()})}const ZG=["edits"];function e7(t,n){1&t&&Z(0,"img",79),2&t&&nn("src",Du().$implicit.value.img_data,Va)}function t7(t,n){if(1&t){const e=function H1(){return G()}();O(0,"tr")(1,"th",71)(2,"li",72)(3,"button",73),fi("click",function(){const i=function cb(t){return De.lFrame.contextLView=t,t[St]}(e).$implicit;return function lb(t){return De.lFrame.contextLView=null,t}(Du().editTeacherData(i.key))}),Z(4,"i",74),B()()(),O(5,"td"),X(6),B(),O(7,"td"),di(8,e7,1,1,"img",75),X(9),B(),O(10,"td"),X(11),B(),O(12,"td",76)(13,"span",77),X(14),B(),Z(15,"i",78),B()()}if(2&t){const e=n.$implicit;tt(6),Xn(e.key),tt(2),nn("ngIf",e.value.img_data),tt(1),pi(" | ",e.value.user_name,""),tt(2),Xn(e.value.subject),tt(3),Xn(e.value.stream)}}function n7(t,n){1&t&&Z(0,"img",79),2&t&&nn("src",Du().$implicit.value.img_data,Va)}function r7(t,n){if(1&t&&(O(0,"tr")(1,"th",71)(2,"li",72)(3,"button",80),Z(4,"i",74),B()()(),O(5,"td"),X(6),B(),O(7,"td"),di(8,n7,1,1,"img",75),X(9),B(),O(10,"td"),X(11),B(),O(12,"td",76)(13,"span",77),X(14),B(),Z(15,"i",78),B()()),2&t){const e=n.$implicit;tt(6),Xn(e.key),tt(2),nn("ngIf",e.value.img_data),tt(1),pi(" | ",e.value.user_name,""),tt(2),Xn(e.value.stream),tt(3),Xn(e.value.roll)}}const o7=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",component:zG},{path:"teacher",component:GG},{path:"admin",component:(()=>{class t{constructor(e){this.http=e,this.tempName="",this.tempSubject="",this.tempId="",this.tempProfile=""}ngOnInit(){this.loadStudent(),this.loadTeacher()}loadStudent(){var e=this;return oa(function*(){e.http.get("assets/database/student.json").subscribe(r=>{e.studentStore=r})})()}loadTeacher(){var e=this;return oa(function*(){e.http.get("assets/database/teacher.json").subscribe(r=>{e.teacherStore=r})})()}editStudentData(){}editTeacherData(e){document.getElementById("edits")?.classList.add("showEdit"),console.log("DFS")}handleError(e){return alert(e.message),ls(()=>e)}getBlogs(){let e=this.http.get("assets/database/teacher.json").pipe(CR(1),oo(this.handleError));return e.forEach(o=>{}),this.http.delete("assets/database/teacher.json1234").pipe(CR(1),oo(this.handleError)),e}}return t.\u0275fac=function(e){return new(e||t)(he(mm))},t.\u0275cmp=ui({type:t,selectors:[["app-admin"]],viewQuery:function(e,r){if(1&e&&eo(ZG,5),2&e){let o;Sr(o=Ir())&&(r.edit=o.first)}},decls:151,vars:9,consts:[["rel","stylesheet","href","https://unicons.iconscout.com/release/v3.0.6/css/line.css"],["rel","stylesheet","href","https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"],[1,"mainbody"],[1,"p-4",2,"width","100%"],[1,"welcome"],[1,"content","rounded-3","p-3"],[1,"fs-3"],[1,"mb-0"],[1,"statistics","mt-4"],[1,"row"],[1,"col-lg-4"],[1,"box","d-flex","rounded-2","align-items-center","mb-4","mb-lg-0","p-3"],[1,"uil-envelope-shield","fs-2","text-center","bg-primary","rounded-circle"],[1,"ms-3"],[1,"d-flex","align-items-center"],[1,"d-block","ms-2"],[1,"fs-normal","mb-0"],[1,"uil-file","fs-2","text-center","bg-danger","rounded-circle"],[1,"box","d-flex","rounded-2","align-items-center","p-3"],[1,"uil-users-alt","fs-2","text-center","bg-success","rounded-circle"],[1,"p-4"],["href","https://fonts.googleapis.com/css?family=Work+Sans:400,600,700&display=swap","rel","stylesheet"],[1,"layout"],["name","nav","type","radio","id","home","checked","checked",1,"nav","home-radio"],[1,"page","home-page"],[1,"container","mt-5","px-2"],[1,"mb-2","d-flex","justify-content-between","align-items-center"],[1,"position-relative"],[1,"position-absolute","search"],[1,"fa","fa-search"],["placeholder","Search by order#, name...",1,"form-control","w-100"],[1,"px-2"],[1,"fa","fa-angle-down"],[1,"fa","fa-ellipsis-h","ms-3"],[1,"table-responsive"],[1,"table","table-responsive","table-borderless"],[1,"bg-light"],["scope","col","width","5%"],["scope","col","width","10%"],["scope","col","width","40%"],["scope","col","width","25%"],["scope","col","width","20%",1,"text-end"],[4,"ngFor","ngForOf"],["for","home",1,"nav"],["viewBox","0 0 24 24","width","24","height","24","stroke","currentColor","stroke-width","2","fill","none","stroke-linecap","round","stroke-linejoin","round",1,"css-i6dzq1"],["d","M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"],["points","9 22 9 12 15 12 15 22"],["name","nav","type","radio","id","contact",1,"contact-radio"],[1,"page","contact-page"],["for","contact",1,"nav"],["d","M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"],["id","edits",1,"edit"],[1,"form-bg"],[1,"container"],[1,"form-container",2,"width","600px"],[1,"form-icon"],[1,"avatar"],["src","assets/me2.jpeg","alt","Avatar",2,"width","95px","height","95px","object-fit","cover"],[1,"signup"],[1,"form-horizontal"],[1,"title"],[1,"form-group"],[1,"input-icon"],[1,"fa","fa-at"],["type","text","placeholder","Email Address",1,"form-control",3,"value"],[1,"fa","fa-id-card"],[1,"fa","fa-institution"],["type","text","placeholder","Password",1,"form-control",3,"value"],[1,"btn","signin"],[1,"forgot-pass"],["href","#"],["scope","row"],[1,"list-inline-item"],["type","button","data-toggle","tooltip","data-placement","top","title","Edit",1,"btn","btn-success","btn-sm","rounded-0",3,"click"],[1,"fa","fa-edit"],["class","user_image",3,"src",4,"ngIf"],[1,"text-end"],[1,"fw-bolder"],[1,"fa","fa-ellipsis-h","ms-2"],[1,"user_image",3,"src"],["type","button","data-toggle","tooltip","data-placement","top","title","Edit",1,"btn","btn-success","btn-sm","rounded-0"]],template:function(e,r){1&e&&(Z(0,"link",0)(1,"link",1),O(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h1",6),X(7,"Welcome to Admin Dashboard"),B(),O(8,"p",7),X(9,"Here You Can Add And Manipulate Data Of Student/Teachers."),B()()(),O(10,"section",8)(11,"div",9)(12,"div",10)(13,"div",11),Z(14,"i",12),O(15,"div",13)(16,"div",14)(17,"h3",7),X(18,"10"),B(),O(19,"span",15),X(20,"Total Data"),B()(),O(21,"p",16),X(22,"..................."),B()()()(),O(23,"div",10)(24,"div",11),Z(25,"i",17),O(26,"div",13)(27,"div",14)(28,"h3",7),X(29,"5"),B(),O(30,"span",15),X(31,"Teachers"),B()(),O(32,"p",16),X(33,".............."),B()()()(),O(34,"div",10)(35,"div",18),Z(36,"i",19),O(37,"div",13)(38,"div",14)(39,"h3",7),X(40,"6"),B(),O(41,"span",15),X(42,"Students"),B()(),O(43,"p",16),X(44,"......................."),B()()()()()(),O(45,"div",20),Z(46,"link",21),O(47,"div",22),Z(48,"input",23),O(49,"div",24)(50,"div",25)(51,"div",26)(52,"div",27)(53,"span",28),Z(54,"i",29),B(),Z(55,"input",30),B(),O(56,"div",31)(57,"span"),X(58,"Filters "),Z(59,"i",32),B(),Z(60,"i",33),B()(),O(61,"div",34)(62,"table",35)(63,"thead")(64,"tr",36)(65,"th",37),X(66,"Edit"),B(),O(67,"th",38),X(68,"ID"),B(),O(69,"th",39),X(70,"Teacher"),B(),O(71,"th",40),X(72,"Subject"),B(),O(73,"th",41)(74,"span"),X(75,"Class-Taken"),B()()()(),O(76,"tbody"),di(77,t7,16,5,"tr",42),ig(78,"keyvalue"),B()()()()(),O(79,"label",43)(80,"span"),hn(),O(81,"svg",44),Z(82,"path",45)(83,"polyline",46),B(),X(84," Teacher "),B()(),kn(),Z(85,"input",47),O(86,"div",48)(87,"div",25)(88,"div",26)(89,"div",27)(90,"span",28),Z(91,"i",29),B(),Z(92,"input",30),B(),O(93,"div",31)(94,"span"),X(95,"Filters "),Z(96,"i",32),B(),Z(97,"i",33),B()(),O(98,"div",34)(99,"table",35)(100,"thead")(101,"tr",36)(102,"th",37),X(103,"Edit"),B(),O(104,"th",38),X(105,"ID"),B(),O(106,"th",39),X(107,"Student Profile"),B(),O(108,"th",40),X(109,"Stream"),B(),O(110,"th",41)(111,"span"),X(112,"Roll-No"),B()()()(),O(113,"tbody"),di(114,r7,16,5,"tr",42),ig(115,"keyvalue"),B()()()()(),O(116,"label",49)(117,"span"),hn(),O(118,"svg",44),Z(119,"path",50),B(),X(120," Student "),B()()()()(),kn(),O(121,"div",51)(122,"div",52)(123,"div",53)(124,"div",54)(125,"div",55)(126,"div",56),Z(127,"img",57),B(),O(128,"span",58)(129,"button"),X(130,"Upload File"),B()()(),O(131,"form",59)(132,"h3",60),X(133,"Edit Profile"),B(),O(134,"div",61)(135,"span",62),Z(136,"i",63),B(),Z(137,"input",64),B(),O(138,"div",61)(139,"span",62),Z(140,"i",65),B(),Z(141,"input",64),B(),O(142,"div",61)(143,"span",62),Z(144,"i",66),B(),Z(145,"input",67),B(),O(146,"button",68),X(147,"Login"),B(),O(148,"span",69)(149,"a",70),X(150,"Forgot Username/Password?"),B()()()()()()()()),2&e&&(tt(77),nn("ngForOf",ag(78,5,r.teacherStore)),tt(37),nn("ngForOf",ag(115,7,r.studentStore)),tt(23),nn("value",r.tempName),tt(4),nn("value",r.tempId),tt(4),nn("value",r.tempSubject))},dependencies:[$C,hd,XC],styles:['.mainbody[_ngcontent-%COMP%]{height:100vh;padding-bottom:30px;overflow:auto}.welcome[_ngcontent-%COMP%]{color:#d1d5db}.welcome[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{background-color:var(--dk-dark-bg);border:2px solid #D1D5DB}.welcome[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af}.statistics[_ngcontent-%COMP%]{color:#e5e7eb}.statistics[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{background-color:#313348}.statistics[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:60px;height:60px;line-height:60px}.statistics[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af}.admins[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   .admin[_ngcontent-%COMP%]{background-color:var(--dk-dark-bg)}.admins[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--dk-gray-300)}.admins[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--dk-gray-400)}.statis[_ngcontent-%COMP%]{color:var(--dk-gray-100)}.statis[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{position:relative;overflow:hidden;border-radius:3px}.statis[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:after{content:"";height:2px;width:70%;margin:10px auto auto;background-color:#ffffff1f;display:block}.statis[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;height:70px;width:70px;font-size:22px;padding:15px;top:-25px;left:-25px;background-color:#ffffff26;line-height:60px;text-align:right;border-radius:50%}label[_ngcontent-%COMP%], a[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;text-decoration:none;display:inline-block;color:inherit;transition:border .2s;border-bottom:5px solid rgba(#8e44ad,.2);padding:3px 2px;&:hover{border-bottom-color:#9b59b6}}.layout[_ngcontent-%COMP%]{display:grid;height:100%;width:100%;overflow:hidden;grid-template-rows:50px 1fr;grid-template-columns:1fr 1fr}input[type=radio][_ngcontent-%COMP%]{display:none}label.nav[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;cursor:pointer;border-bottom:2px solid #8e44ad;background:#ecf0f1;-webkit-user-select:none;user-select:none;transition:background .4s,padding-left .2s;padding-left:0;input[type="radio"]:checked + .page + &{background: #9b59b6; color: #ffffff; padding-left: 20px; span{padding-left: 20px} svg{opacity: 1;}} span{padding-left: 0px; position: relative;} svg{left: 0; top: -3px; position: absolute; width: 15px; opacity: 0; transition: opacity .2s;}}.page[_ngcontent-%COMP%]{background-color:#313348;grid-column-start:1;grid-row-start:2;grid-column-end:span 3;padding:0 20px;display:flex;align-items:center}.page-contents[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:0;transform:translateY(20px);transition:opacity .2s,transform .2s}input[type=radio][_ngcontent-%COMP%] + .page[_ngcontent-%COMP%]{transition:transform .2s;transform:translate(100%)}input[type=radio][_ngcontent-%COMP%]:checked + .page[_ngcontent-%COMP%]{transform:translate(0);.page-contents > *{opacity: 1; transform: translateY(0px);}}.page-contents[_ngcontent-%COMP%]{max-width:100%;width:500px;margin:0 auto}.search[_ngcontent-%COMP%]{left:10px}.form-control[_ngcontent-%COMP%]{border:1px solid white;padding-left:32px}.form-control[_ngcontent-%COMP%]:focus{border:none;box-shadow:none}.green[_ngcontent-%COMP%]{color:green}td[_ngcontent-%COMP%]{color:#fff}tr[_ngcontent-%COMP%]{align-items:center}.user_image[_ngcontent-%COMP%]{border-radius:100%;object-fit:cover;width:45px;border:1px solid indianred;height:45px}.form-container[_ngcontent-%COMP%]{background:linear-gradient(#E9374C,#D31128);font-family:Roboto,sans-serif;font-size:0;padding:0 15px;border:1px solid #DC2036;border-radius:15px;box-shadow:0 0 20px #0003}.form-container[_ngcontent-%COMP%]   .form-icon[_ngcontent-%COMP%]{color:#fff;font-size:13px;text-align:center;text-shadow:0 0 20px rgba(0,0,0,.2);width:35%;padding:70px 0;vertical-align:top;display:inline-flex;flex-direction:column;flex-wrap:nowrap;justify-content:center;align-items:center}.form-container[_ngcontent-%COMP%]   .form-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:124px;margin:0 0 15px;display:block}.form-container[_ngcontent-%COMP%]   .form-icon[_ngcontent-%COMP%]   .signup[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-transform:capitalize;transition:all .3s ease}.form-container[_ngcontent-%COMP%]   .form-icon[_ngcontent-%COMP%]   .signup[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]{background:rgba(255,255,255,.99);width:65%;padding:60px 30px;margin:-20px 0;border-radius:15px;box-shadow:0 0 20px #0003;display:inline-block}.form-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#454545;font-size:23px;font-weight:900;text-align:center;text-transform:capitalize;letter-spacing:.5px;margin:0 0 30px}.form-horizontal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{background-color:#ffffff26;margin:0 0 15px;border:1px solid #b5b5b5;border-radius:20px}.form-horizontal[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]{color:#b5b5b5;font-size:15px;text-align:center;line-height:38px;height:35px;width:40px;vertical-align:top;display:inline-block}.form-horizontal[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{color:#b5b5b5;background-color:transparent;font-size:14px;letter-spacing:1px;width:calc(100% - 55px);height:33px;padding:2px 10px 0 0;box-shadow:none;border:none;border-radius:0;display:inline-block;transition:all .3s}.form-horizontal[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{box-shadow:none;border:none}.form-horizontal[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:#b5b5b5;font-size:13px;text-transform:capitalize}.form-horizontal[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{color:#fffc;background:#E9374C;font-size:15px;font-weight:500;text-transform:uppercase;letter-spacing:1px;width:100%;margin:0 0 10px;border:none;border-radius:20px;transition:all .3s ease}.form-horizontal[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover, .form-horizontal[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:focus{color:#fff;background-color:#c20c21ad;box-shadow:0 0 5px #00000080}.form-horizontal[_ngcontent-%COMP%]   .forgot-pass[_ngcontent-%COMP%]{font-size:12px;text-align:center;display:block}.form-horizontal[_ngcontent-%COMP%]   .forgot-pass[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#999;transition:all .3s ease}.form-horizontal[_ngcontent-%COMP%]   .forgot-pass[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#777;text-decoration:underline}@media only screen and (max-width:576px){.form-container[_ngcontent-%COMP%]{padding-bottom:15px}.form-container[_ngcontent-%COMP%]   .form-icon[_ngcontent-%COMP%]{width:100%;padding:20px 0}.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]{width:100%;margin:0}}.edit[_ngcontent-%COMP%]{display:none;position:absolute;top:20%;left:25%}.showEdit[_ngcontent-%COMP%]{display:block;animation:_ngcontent-%COMP%_editanimation 1s linear}@keyframes _ngcontent-%COMP%_editanimation{0%{opacity:0}to{opacity:1}}.avatar[_ngcontent-%COMP%]{width:95px;height:95px;border-radius:50%;background:#60c7c1;box-shadow:0 2px 2px #0000001a;overflow:hidden}']}),t})()}];let i7=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=So({type:t}),t.\u0275inj=Hr({imports:[r2.forRoot(o7),r2]}),t})(),a7=(()=>{class t{constructor(){this.showMobileNav=!1}switchMode(){var e=document.querySelector(".mode-switch");document.documentElement.classList.toggle("light"),e.classList.toggle("active")}mobileNav(){this.showMobileNav=!this.showMobileNav,document.querySelector(".menu__button");const r=document.querySelector(".menu__body");this.showMobileNav?r.removeAttribute("hidden"):r.setAttribute("hidden","")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ui({type:t,selectors:[["app-root"]],decls:101,vars:0,consts:[[1,"app-container"],[1,"sidebar"],[1,"sidebar-header",2,"background","rgba(245, 245, 245, 0.842)"],[1,"app-icon"],["src","assets/college_logo.png","alt","","width","100%","height","32px","srcset",""],[1,"sidebar-list"],["routerLinkActive","active",1,"sidebar-list-item"],["routerLink","/home"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-home"],["d","M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"],["points","9 22 9 12 15 12 15 22"],["routerLink","/teacher"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-shopping-bag"],["d","M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"],["x1","3","y1","6","x2","21","y2","6"],["d","M16 10a4 4 0 0 1-8 0"],["routerLink","/admin"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-pie-chart"],["d","M21.21 15.89A10 10 0 1 1 8 2.83"],["d","M22 12A10 10 0 0 0 12 2v10z"],[1,"account-info"],[1,"account-info-picture"],["src","assets/profile.jpg?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTE2fHx3b21hbnxlbnwwfHwwfHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=900&q=60","alt","Account"],[1,"account-info-name"],[1,"account-info-more"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-more-horizontal"],["cx","12","cy","12","r","1"],["cx","19","cy","12","r","1"],["cx","5","cy","12","r","1"],[1,"mobileNav"],[1,"menu"],["title","logo"],[1,"menu-button","home"],["title","Home","routerLink","/home"],["routerLinkActive","active",1,"search"],["title","Teacher","routerLink","/about"],["routerLinkActive","active",1,"pencil"],["title","Admin","routerLink","/contact"],["routerLinkActive","active",1,"active","about"],[1,"app-content"],[1,"app-content-header"],[1,"app-content-headerText"],["title","Switch Theme",1,"mode-switch",3,"click"],["fill","none","stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","width","24","height","24","viewBox","0 0 24 24",1,"moon"],["d","M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"],["id","menu_button",1,"menu__button"],["type","checkbox","id","menu_checkbox",3,"click"],["for","menu_checkbox","id","menu_label"],["id","menu_text_bar"],["hidden","hidden",1,"menu__body"],[1,"d-flex","justify-content-between","align-items-center"],["type","button","aria-label","Close",1,"btn","btn-link",3,"click"],["aria-hidden","true"],[1,"list-group"],["routerLink","/home","routerLinkActive","active",1,"list-group-item"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-home"],["routerLink","/teacher","routerLinkActive","active",1,"list-group-item"],["routerLink","/about","routerLinkActive","active",1,"list-group-item"],["routerLink","/oo","routerLinkActive","active",1,"list-group-item"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-inbox"],["points","22 12 16 12 14 15 10 15 8 12 2 12"],["d","M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"]],template:function(e,r){1&e&&(O(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),Z(4,"img",4),B()(),O(5,"ul",5)(6,"li",6)(7,"a",7),hn(),O(8,"svg",8),Z(9,"path",9)(10,"polyline",10),B(),kn(),O(11,"span"),X(12,"Attendence"),B()()(),O(13,"li",6)(14,"a",11),hn(),O(15,"svg",12),Z(16,"path",13)(17,"line",14)(18,"path",15),B(),kn(),O(19,"span"),X(20,"Teacher"),B()()(),O(21,"li",6)(22,"a",16),hn(),O(23,"svg",17),Z(24,"path",18)(25,"path",19),B(),kn(),O(26,"span"),X(27,"Admin"),B()()()(),O(28,"div",20)(29,"div",21),Z(30,"img",22),B(),O(31,"div",23),X(32,"Imityaz Ali"),B(),O(33,"button",24),hn(),O(34,"svg",25),Z(35,"circle",26)(36,"circle",27)(37,"circle",28),B()()()(),kn(),O(38,"div",29)(39,"ul",30)(40,"li",31)(41,"a",32),X(42,"Logo"),B()(),O(43,"li",33)(44,"a",34),X(45,"Home"),B()(),O(46,"li",35)(47,"a",36),X(48,"Teacher"),B()(),O(49,"li",37)(50,"a",38),X(51,"Admin"),B()()()(),O(52,"div",39)(53,"div",40)(54,"h1",41),X(55,"Products"),B(),O(56,"button",42),fi("click",function(){return r.switchMode()}),hn(),O(57,"svg",43),Z(58,"defs")(59,"path",44),B()(),kn(),O(60,"div",45)(61,"input",46),fi("click",function(){return r.mobileNav()}),B(),O(62,"label",47),Z(63,"div",48),B()()(),Z(64,"router-outlet"),B()(),O(65,"section",49)(66,"div",50)(67,"h3"),X(68,"Navigate"),B(),O(69,"button",51),fi("click",function(){return r.mobileNav()}),O(70,"span",52),X(71,"\xd7"),B()()(),O(72,"ul",53)(73,"li",54)(74,"i"),hn(),O(75,"svg",55),Z(76,"path",9)(77,"polyline",10),B(),X(78," - "),B(),X(79," Home"),B(),kn(),O(80,"li",56)(81,"i"),hn(),O(82,"svg",12),Z(83,"path",13)(84,"line",14)(85,"path",15),B(),X(86," - "),B(),X(87," Teacher"),B(),kn(),O(88,"li",57)(89,"i"),hn(),O(90,"svg",17),Z(91,"path",18)(92,"path",19),B(),X(93," - "),B(),X(94," Admin"),B(),kn(),O(95,"li",58)(96,"i"),hn(),O(97,"svg",59),Z(98,"polyline",60)(99,"path",61),B()(),X(100," Contact"),B()()())},dependencies:[Fm,Gd,XE],styles:['@import"//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css";.app-container[_ngcontent-%COMP%]{border-radius:4px;width:100%;height:100%;max-height:100%;max-width:1280px;display:flex;overflow:hidden;box-shadow:#63636333 0 2px 8px;max-width:2000px;margin:0 auto}.sidebar[_ngcontent-%COMP%]{flex-basis:200px;max-width:200px;flex-shrink:0;background-color:var(--sidebar);display:flex;flex-direction:column}.sidebar-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px}.sidebar-list[_ngcontent-%COMP%]{list-style-type:none;padding:0}.sidebar-list-item[_ngcontent-%COMP%]{position:relative;margin-bottom:4px}.sidebar-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;padding:10px 16px;color:var(--sidebar-link);text-decoration:none;font-size:14px;line-height:24px}.sidebar-list-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-right:8px}.sidebar-list-item[_ngcontent-%COMP%]:hover{background-color:var(--sidebar-hover-link)}.sidebar-list-item.active[_ngcontent-%COMP%]{background-color:var(--sidebar-active-link)}.sidebar-list-item.active[_ngcontent-%COMP%]:before{content:"";position:absolute;right:0;background-color:var(--action-color);height:100%;width:4px}@media screen and (max-width: 1024px){.sidebar[_ngcontent-%COMP%]{display:none}.mobileNav[_ngcontent-%COMP%]{display:block}}.mode-switch[_ngcontent-%COMP%]{background-color:transparent;border:none;padding:0;color:var(--app-content-main-color);display:flex;justify-content:center;align-items:center;margin-left:auto;margin-right:8px;cursor:pointer}.mode-switch[_ngcontent-%COMP%]   .moon[_ngcontent-%COMP%]{fill:var(--app-content-main-color)}.mode-switch.active[_ngcontent-%COMP%]   .moon[_ngcontent-%COMP%]{fill:none}.account-info[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px;margin-top:auto}.account-info-picture[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;overflow:hidden;flex-shrink:0}.account-info-picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.account-info-name[_ngcontent-%COMP%]{font-size:14px;color:var(--sidebar-main-color);margin:0 8px;overflow:hidden;max-width:100%;text-overflow:ellipsis;white-space:nowrap}.account-info-more[_ngcontent-%COMP%]{color:var(--sidebar-main-color);padding:0;border:none;background-color:transparent;margin-left:auto}.app-icon[_ngcontent-%COMP%]{color:var(--sidebar-main-color)}.app-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}.app-content[_ngcontent-%COMP%]{padding:16px;background-color:var(--app-bg);height:100%;flex:1;max-height:100%;display:flex;flex-direction:column}.app-content-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0 4px}.app-content-headerText[_ngcontent-%COMP%]{color:var(--app-content-main-color);font-size:24px;line-height:32px;margin:0}.app-content-headerButton[_ngcontent-%COMP%]{background-color:var(--action-color);color:#fff;font-size:14px;line-height:24px;border:none;border-radius:4px;height:32px;padding:0 16px;transition:.2s;cursor:pointer}.app-content-headerButton[_ngcontent-%COMP%]:hover{background-color:var(--action-color-hover)}.app-content-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 4px}.app-content-actions-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:auto}@media screen and (max-width: 520px){.app-content-actions[_ngcontent-%COMP%]{flex-direction:column}.app-content-actions[_ngcontent-%COMP%]   .app-content-actions-wrapper[_ngcontent-%COMP%]{padding-bottom:16px;order:1}}.menu[_ngcontent-%COMP%]{position:fixed;bottom:0;display:grid;align-content:center;left:0;height:100%;list-style-type:none;margin:0;padding:0;z-index:10;overflow:hidden;box-shadow:2px 0 18px #00000042}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;text-indent:-500em;height:5em;width:3em;line-height:5em;text-align:center;position:relative;border-bottom:1px solid rgba(0,0,0,.05);transition:background .1s ease-in-out}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:before{font-family:FontAwesome;text-indent:0em;position:absolute;bottom:0;left:0;width:100%;height:100%;font-size:1.4em}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.search[_ngcontent-%COMP%]:before{content:"\\f029"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.archive[_ngcontent-%COMP%]:before{content:"\\f187"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.pencil[_ngcontent-%COMP%]:before{content:"\\f040"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.contact[_ngcontent-%COMP%]:before{content:"\\f007"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.about[_ngcontent-%COMP%]:before{content:"\\f003"}.activeLink[_ngcontent-%COMP%], .menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:#267fdd;color:#fff}.para[_ngcontent-%COMP%]{color:#033f72;padding-left:100px;font-size:3em;margin-bottom:20px}.open[_ngcontent-%COMP%]{width:10em;height:100%}@media all and (max-width: 500px){.menu[_ngcontent-%COMP%]{height:5em;width:100%}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-block}.open[_ngcontent-%COMP%]{width:100%;height:auto}.para[_ngcontent-%COMP%]{padding-left:5px}}@media screen and (max-height: 34em){.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:70%}}@media screen and (max-height: 34em) and (max-width: 500px){.menu[_ngcontent-%COMP%]{height:3.5em}}.mobileNav[_ngcontent-%COMP%]{display:none}@media screen and (min-width: 512px) and (max-width:1024px){.mobileNav[_ngcontent-%COMP%]{display:block}}.menu__button[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 512px){.fab[_ngcontent-%COMP%], .menu__button[_ngcontent-%COMP%]{display:block}}#menu_button[_ngcontent-%COMP%]{width:35px;overflow:hidden}#menu_checkbox[_ngcontent-%COMP%]{display:none}#menu_label[_ngcontent-%COMP%]{position:relative;display:block;height:30px;cursor:pointer}#menu_label[_ngcontent-%COMP%]:before, #menu_label[_ngcontent-%COMP%]:after, #menu_text_bar[_ngcontent-%COMP%]{position:absolute;left:0;width:100%;height:4px;background-color:var(--app-content-main-color)}#menu_label[_ngcontent-%COMP%]:before, #menu_label[_ngcontent-%COMP%]:after{content:"";transition:.4s cubic-bezier(.68,-.55,.27,1.55) left}#menu_label[_ngcontent-%COMP%]:before{top:0}#menu_label[_ngcontent-%COMP%]:after{top:12px}#menu_text_bar[_ngcontent-%COMP%]{top:24px}#menu_text_bar[_ngcontent-%COMP%]:before{content:"MENU";position:absolute;top:4px;right:0;left:0;color:var(--app-content-main-color);font-size:12px;font-weight:700;font-family:Montserrat,Arial,Helvetica,sans-serif}#menu_checkbox[_ngcontent-%COMP%]:checked + #menu_label[_ngcontent-%COMP%]:before{left:-39px}#menu_checkbox[_ngcontent-%COMP%]:checked + #menu_label[_ngcontent-%COMP%]:after{left:39px}#menu_checkbox[_ngcontent-%COMP%]:checked + #menu_label[_ngcontent-%COMP%]   #menu_text_bar[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_moveUpThenDown .8s ease .2s forwards,shakeWhileMovingUp .8s ease .2s forwards,shakeWhileMovingDown .2s ease .8s forwards}@keyframes _ngcontent-%COMP%_moveUpThenDown{0%{top:0}50%{top:-27px}to{top:-14px}}@keyframes _ngcontent-%COMP%_shakeWhileMovingUp{0%{transform:rotate(0)}25%{transform:rotate(-10deg)}50%{transform:rotate(0)}75%{transform:rotate(10deg)}to{transform:rotate(0)}}@keyframes _ngcontent-%COMP%_shakeWhileMovingDown{0%{transform:rotate(0)}80%{transform:rotate(3deg)}90%{transform:rotate(-3deg)}to{transform:rotate(0)}}.menu__body[_ngcontent-%COMP%]{--x: 0;--y: 0;--z: 0;display:block;width:100%;padding:0 30px 15px;color:var(--app-content-main-color);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 -9px 50px -30px #000;font-family:Montserrat,sans-serif;position:absolute;bottom:0;z-index:105;transform:translate3d(var(--x),var(--y),var(--z));transition:.2s cubic-bezier(.33,1,.53,1)}.menu__body[hidden][_ngcontent-%COMP%]{--y: 150%}li[_ngcontent-%COMP%]{font-weight:700}']}),t})(),s7=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=So({type:t,bootstrap:[a7]}),t.\u0275inj=Hr({imports:[WB,i7,cU,PU]}),t})();HB().bootstrapModule(s7).catch(t=>console.error(t))},369:()=>{},655:()=>{},118:()=>{}},Yf=>{Yf(Yf.s=94)}]);