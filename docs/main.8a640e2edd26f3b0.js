(self.webpackChunkweb3=self.webpackChunkweb3||[]).push([[179],{490:(Kf,u0,zs)=>{"use strict";function ct(t){return"function"==typeof t}function Xf(t){const e=t(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Qf=Xf(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function Yf(t,n){if(t){const e=t.indexOf(n);0<=e&&t.splice(e,1)}}class or{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const i of e)i.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(ct(r))try{r()}catch(i){n=i instanceof Qf?i.errors:[i]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const i of o)try{d0(i)}catch(a){n=n??[],a instanceof Qf?n=[...n,...a.errors]:n.push(a)}}if(n)throw new Qf(n)}}add(n){var e;if(n&&n!==this)if(this.closed)d0(n);else{if(n instanceof or){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(n)}}_hasParent(n){const{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){const{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&Yf(e,n)}remove(n){const{_finalizers:e}=this;e&&Yf(e,n),n instanceof or&&n._removeParent(this)}}or.EMPTY=(()=>{const t=new or;return t.closed=!0,t})();const c0=or.EMPTY;function l0(t){return t instanceof or||t&&"closed"in t&&ct(t.remove)&&ct(t.add)&&ct(t.unsubscribe)}function d0(t){ct(t)?t():t.unsubscribe()}const Fi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Bc={setTimeout(t,n,...e){const{delegate:r}=Bc;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){const{delegate:n}=Bc;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function f0(t){Bc.setTimeout(()=>{const{onUnhandledError:n}=Fi;if(!n)throw t;n(t)})}function h0(){}const vR=Jf("C",void 0,void 0);function Jf(t,n,e){return{kind:t,value:n,error:e}}let Li=null;function Uc(t){if(Fi.useDeprecatedSynchronousErrorHandling){const n=!Li;if(n&&(Li={errorThrown:!1,error:null}),t(),n){const{errorThrown:e,error:r}=Li;if(Li=null,e)throw r}}else t()}class Zf extends or{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,l0(n)&&n.add(this)):this.destination=CR}static create(n,e,r){return new $s(n,e,r)}next(n){this.isStopped?th(function yR(t){return Jf("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?th(function mR(t){return Jf("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?th(vR,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const wR=Function.prototype.bind;function eh(t,n){return wR.call(t,n)}class xR{constructor(n){this.partialObserver=n}next(n){const{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Vc(r)}}error(n){const{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Vc(r)}else Vc(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Vc(e)}}}class $s extends Zf{constructor(n,e,r){let o;if(super(),ct(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&Fi.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&eh(n.next,i),error:n.error&&eh(n.error,i),complete:n.complete&&eh(n.complete,i)}):o=n}this.destination=new xR(o)}}function Vc(t){Fi.useDeprecatedSynchronousErrorHandling?function bR(t){Fi.useDeprecatedSynchronousErrorHandling&&Li&&(Li.errorThrown=!0,Li.error=t)}(t):f0(t)}function th(t,n){const{onStoppedNotification:e}=Fi;e&&Bc.setTimeout(()=>e(t,n))}const CR={closed:!0,next:h0,error:function _R(t){throw t},complete:h0},nh="function"==typeof Symbol&&Symbol.observable||"@@observable";function Bi(t){return t}function p0(t){return 0===t.length?Bi:1===t.length?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}let At=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){const i=function SR(t){return t&&t instanceof Zf||function ER(t){return t&&ct(t.next)&&ct(t.error)&&ct(t.complete)}(t)&&l0(t)}(e)?e:new $s(e,r,o);return Uc(()=>{const{operator:a,source:s}=this;i.add(a?a.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=g0(r))((o,i)=>{const a=new $s({next:s=>{try{e(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});this.subscribe(a)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[nh](){return this}pipe(...e){return p0(e)(this)}toPromise(e){return new(e=g0(e))((r,o)=>{let i;this.subscribe(a=>i=a,a=>o(a),()=>r(i))})}}return t.create=n=>new t(n),t})();function g0(t){var n;return null!==(n=t??Fi.Promise)&&void 0!==n?n:Promise}const IR=Xf(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Br=(()=>{class t extends At{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const r=new v0(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new IR}next(e){Uc(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(e)}})}error(e){Uc(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){Uc(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:r,isStopped:o,observers:i}=this;return r||o?c0:(this.currentObservers=null,i.push(e),new or(()=>{this.currentObservers=null,Yf(i,e)}))}_checkFinalizedStatuses(e){const{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){const e=new At;return e.source=this,e}}return t.create=(n,e)=>new v0(n,e),t})();class v0 extends Br{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,n)}error(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,n)}complete(){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===e||e.call(n)}_subscribe(n){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(n))&&void 0!==r?r:c0}}function m0(t){return ct(t?.lift)}function Kt(t){return n=>{if(m0(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Xt(t,n,e,r,o){return new MR(t,n,e,r,o)}class MR extends Zf{constructor(n,e,r,o,i,a){super(n),this.onFinalize=i,this.shouldUnsubscribe=a,this._next=e?function(s){try{e(s)}catch(u){n.error(u)}}:super._next,this._error=o?function(s){try{o(s)}catch(u){n.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(s){n.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function ke(t,n){return Kt((e,r)=>{let o=0;e.subscribe(Xt(r,i=>{r.next(t.call(n,i,o++))}))})}function Ui(t){return this instanceof Ui?(this.v=t,this):new Ui(t)}function kR(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function w0(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(a){return new Promise(function(s,u){!function o(i,a,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},a)}(s,u,(a=t[i](a)).done,a.value)})}}}const x0=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function _0(t){return ct(t?.then)}function C0(t){return ct(t[nh])}function D0(t){return Symbol.asyncIterator&&ct(t?.[Symbol.asyncIterator])}function E0(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const S0=function OR(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function I0(t){return ct(t?.[S0])}function M0(t){return function AR(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=e.apply(t,n||[]),i=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(f){r[f]&&(o[f]=function(h){return new Promise(function(p,g){i.push([f,h,p,g])>1||s(f,h)})})}function s(f,h){try{!function u(f){f.value instanceof Ui?Promise.resolve(f.value.v).then(c,l):d(i[0][2],f)}(r[f](h))}catch(p){d(i[0][3],p)}}function c(f){s("next",f)}function l(f){s("throw",f)}function d(f,h){f(h),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:r,done:o}=yield Ui(e.read());if(o)return yield Ui(void 0);yield yield Ui(r)}}finally{e.releaseLock()}})}function R0(t){return ct(t?.getReader)}function mr(t){if(t instanceof At)return t;if(null!=t){if(C0(t))return function NR(t){return new At(n=>{const e=t[nh]();if(ct(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(x0(t))return function FR(t){return new At(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}(t);if(_0(t))return function LR(t){return new At(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,f0)})}(t);if(D0(t))return T0(t);if(I0(t))return function BR(t){return new At(n=>{for(const e of t)if(n.next(e),n.closed)return;n.complete()})}(t);if(R0(t))return function UR(t){return T0(M0(t))}(t)}throw E0(t)}function T0(t){return new At(n=>{(function VR(t,n){var e,r,o,i;return function RR(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(e=kR(t);!(r=yield e.next()).done;)if(n.next(r.value),n.closed)return}catch(a){o={error:a}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})})(t,n).catch(e=>n.error(e))})}function wo(t,n,e,r=0,o=!1){const i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function Zt(t,n,e=1/0){return ct(n)?Zt((r,o)=>ke((i,a)=>n(r,i,o,a))(mr(t(r,o))),e):("number"==typeof n&&(e=n),Kt((r,o)=>function jR(t,n,e,r,o,i,a,s){const u=[];let c=0,l=0,d=!1;const f=()=>{d&&!u.length&&!c&&n.complete()},h=g=>c<r?p(g):u.push(g),p=g=>{i&&n.next(g),c++;let v=!1;mr(e(g,l++)).subscribe(Xt(n,m=>{o?.(m),i?h(m):n.next(m)},()=>{v=!0},void 0,()=>{if(v)try{for(c--;u.length&&c<r;){const m=u.shift();a?wo(n,a,()=>p(m)):p(m)}f()}catch(m){n.error(m)}}))};return t.subscribe(Xt(n,h,()=>{d=!0,f()})),()=>{s?.()}}(r,o,t,e)))}function wa(t=1/0){return Zt(Bi,t)}const Ur=new At(t=>t.complete());function oh(t){return t[t.length-1]}function Gs(t){return function WR(t){return t&&ct(t.schedule)}(oh(t))?t.pop():void 0}function A0(t,n=0){return Kt((e,r)=>{e.subscribe(Xt(r,o=>wo(r,t,()=>r.next(o),n),()=>wo(r,t,()=>r.complete(),n),o=>wo(r,t,()=>r.error(o),n)))})}function k0(t,n=0){return Kt((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function P0(t,n){if(!t)throw new Error("Iterable cannot be null");return new At(e=>{wo(e,n,()=>{const r=t[Symbol.asyncIterator]();wo(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function Vt(t,n){return n?function YR(t,n){if(null!=t){if(C0(t))return function GR(t,n){return mr(t).pipe(k0(n),A0(n))}(t,n);if(x0(t))return function KR(t,n){return new At(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}(t,n);if(_0(t))return function qR(t,n){return mr(t).pipe(k0(n),A0(n))}(t,n);if(D0(t))return P0(t,n);if(I0(t))return function XR(t,n){return new At(e=>{let r;return wo(e,n,()=>{r=t[S0](),wo(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(a){return void e.error(a)}i?e.complete():e.next(o)},0,!0)}),()=>ct(r?.return)&&r.return()})}(t,n);if(R0(t))return function QR(t,n){return P0(M0(t),n)}(t,n)}throw E0(t)}(t,n):mr(t)}function ih(t,n,...e){if(!0===n)return void t();if(!1===n)return;const r=new $s({next:()=>{r.unsubscribe(),t()}});return mr(n(...e)).subscribe(r)}function nt(t){for(let n in t)if(t[n]===nt)return n;throw Error("Could not find renamed property on target object.")}function ot(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(ot).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function sh(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const eT=nt({__forward_ref__:nt});function uh(t){return t.__forward_ref__=uh,t.toString=function(){return ot(this())},t}function ye(t){return ch(t)?t():t}function ch(t){return"function"==typeof t&&t.hasOwnProperty(eT)&&t.__forward_ref__===uh}function lh(t){return t&&!!t.\u0275providers}const O0="https://g.co/ng/security#xss";class Q extends Error{constructor(n,e){super(jc(n,e)),this.code=n}}function jc(t,n){return`NG0${Math.abs(t)}${n?": "+n.trim():""}`}function Ce(t){return"string"==typeof t?t:null==t?"":String(t)}function Hc(t,n){throw new Q(-201,!1)}function ir(t,n){null==t&&function Je(t,n,e,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${e} ${r} ${n} <=Actual]`))}(n,t,null,"!=")}function de(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}const aT=de;function Vr(t){return{providers:t.providers||[],imports:t.imports||[]}}function Wc(t){return N0(t,zc)||N0(t,L0)}function N0(t,n){return t.hasOwnProperty(n)?t[n]:null}function F0(t){return t&&(t.hasOwnProperty(dh)||t.hasOwnProperty(lT))?t[dh]:null}const zc=nt({\u0275prov:nt}),dh=nt({\u0275inj:nt}),L0=nt({ngInjectableDef:nt}),lT=nt({ngInjectorDef:nt});var be=(()=>((be=be||{})[be.Default=0]="Default",be[be.Host=1]="Host",be[be.Self=2]="Self",be[be.SkipSelf=4]="SkipSelf",be[be.Optional=8]="Optional",be))();let fh;function ar(t){const n=fh;return fh=t,n}function B0(t,n,e){const r=Wc(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:e&be.Optional?null:void 0!==n?n:void Hc(ot(t))}const lt=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),qs={},hh="__NG_DI_FLAG__",$c="ngTempTokenPath",fT="ngTokenPath",hT=/\n/gm,pT="\u0275",U0="__source";let Ks;function xa(t){const n=Ks;return Ks=t,n}function gT(t,n=be.Default){if(void 0===Ks)throw new Q(-203,!1);return null===Ks?B0(t,void 0,n):Ks.get(t,n&be.Optional?null:void 0,n)}function ce(t,n=be.Default){return(function dT(){return fh}()||gT)(ye(t),n)}function Ne(t,n=be.Default){return ce(t,Gc(n))}function Gc(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function ph(t){const n=[];for(let e=0;e<t.length;e++){const r=ye(t[e]);if(Array.isArray(r)){if(0===r.length)throw new Q(900,!1);let o,i=be.Default;for(let a=0;a<r.length;a++){const s=r[a],u=vT(s);"number"==typeof u?-1===u?o=s.token:i|=u:o=s}n.push(ce(o,i))}else n.push(ce(r))}return n}function Xs(t,n){return t[hh]=n,t.prototype[hh]=n,t}function vT(t){return t[hh]}function xo(t){return{toString:t}.toString()}var jr=(()=>((jr=jr||{})[jr.OnPush=0]="OnPush",jr[jr.Default=1]="Default",jr))(),Hr=(()=>{return(t=Hr||(Hr={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",Hr;var t})();const _o={},Ke=[],qc=nt({\u0275cmp:nt}),gh=nt({\u0275dir:nt}),vh=nt({\u0275pipe:nt}),j0=nt({\u0275mod:nt}),Co=nt({\u0275fac:nt}),Qs=nt({__NG_ELEMENT_ID__:nt});let bT=0;function ai(t){return xo(()=>{const n=W0(t),e={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===jr.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,data:t.data||{},encapsulation:t.encapsulation||Hr.Emulated,id:"c"+bT++,styles:t.styles||Ke,_:null,schemas:t.schemas||null,tView:null};z0(e);const r=t.dependencies;return e.directiveDefs=Kc(r,!1),e.pipeDefs=Kc(r,!0),e})}function xT(t){return Ze(t)||cn(t)}function _T(t){return null!==t}function Do(t){return xo(()=>({type:t.type,bootstrap:t.bootstrap||Ke,declarations:t.declarations||Ke,imports:t.imports||Ke,exports:t.exports||Ke,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function H0(t,n){if(null==t)return _o;const e={};for(const r in t)if(t.hasOwnProperty(r)){let o=t[r],i=o;Array.isArray(o)&&(i=o[1],o=o[0]),e[o]=r,n&&(n[o]=i)}return e}function xn(t){return xo(()=>{const n=W0(t);return z0(n),n})}function Tn(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function Ze(t){return t[qc]||null}function cn(t){return t[gh]||null}function An(t){return t[vh]||null}function Hn(t,n){const e=t[j0]||null;if(!e&&!0===n)throw new Error(`Type ${ot(t)} does not have '\u0275mod' property.`);return e}function W0(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,exportAs:t.exportAs||null,standalone:!0===t.standalone,selectors:t.selectors||Ke,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:H0(t.inputs,n),outputs:H0(t.outputs)}}function z0(t){t.features?.forEach(n=>n(t))}function Kc(t,n){if(!t)return null;const e=n?An:xT;return()=>("function"==typeof t?t():t).map(r=>e(r)).filter(_T)}const Eo=0,ee=1,Me=2,xt=3,yr=4,Vi=5,ln=6,Ca=7,Et=8,Xc=9,Qc=10,Ae=11,mh=12,Ys=13,$0=14,Da=15,dn=16,Js=17,Ea=18,Wr=19,Zs=20,G0=21,dt=22,yh=1,q0=2,Yc=7,Jc=8,Sa=9,_n=10;function Wn(t){return Array.isArray(t)&&"object"==typeof t[yh]}function br(t){return Array.isArray(t)&&!0===t[yh]}function bh(t){return 0!=(4&t.flags)}function eu(t){return t.componentOffset>-1}function Zc(t){return 1==(1&t.flags)}function wr(t){return!!t.template}function DT(t){return 0!=(256&t[Me])}function ji(t,n){return t.hasOwnProperty(Co)?t[Co]:null}class IT{constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function Hi(){return Q0}function Q0(t){return t.type.prototype.ngOnChanges&&(t.setInput=RT),MT}function MT(){const t=J0(this),n=t?.current;if(n){const e=t.previous;if(e===_o)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function RT(t,n,e,r){const o=this.declaredInputs[e],i=J0(t)||function TT(t,n){return t[Y0]=n}(t,{previous:_o,current:null}),a=i.current||(i.current={}),s=i.previous,u=s[o];a[o]=new IT(u&&u.currentValue,n,s===_o),t[r]=n}Hi.ngInherit=!0;const Y0="__ngSimpleChanges__";function J0(t){return t[Y0]||null}const sr=function(t,n,e){},Z0="svg";function en(t){for(;Array.isArray(t);)t=t[Eo];return t}function zn(t,n){return en(n[t.index])}function tb(t,n){return t.data[n]}function $n(t,n){const e=n[t];return Wn(e)?e:e[Eo]}function tl(t){return 64==(64&t[Me])}function si(t,n){return null==n?null:t[n]}function nb(t){t[Ea]=0}function xh(t,n){t[Vi]+=n;let e=t,r=t[xt];for(;null!==r&&(1===n&&1===e[Vi]||-1===n&&0===e[Vi]);)r[Vi]+=n,e=r,r=r[xt]}const De={lFrame:fb(null),bindingsEnabled:!0};function ob(){return De.bindingsEnabled}function G(){return De.lFrame.lView}function We(){return De.lFrame.tView}function tn(){let t=ib();for(;null!==t&&64===t.type;)t=t.parent;return t}function ib(){return De.lFrame.currentTNode}function zr(t,n){const e=De.lFrame;e.currentTNode=t,e.isParent=n}function _h(){return De.lFrame.isParent}function Ch(){De.lFrame.isParent=!1}function Ma(){return De.lFrame.bindingIndex++}function $T(t,n){const e=De.lFrame;e.bindingIndex=e.bindingRootIndex=t,Dh(n)}function Dh(t){De.lFrame.currentDirectiveIndex=t}function cb(){return De.lFrame.currentQueryIndex}function Sh(t){De.lFrame.currentQueryIndex=t}function qT(t){const n=t[ee];return 2===n.type?n.declTNode:1===n.type?t[ln]:null}function lb(t,n,e){if(e&be.SkipSelf){let o=n,i=t;for(;!(o=o.parent,null!==o||e&be.Host||(o=qT(i),null===o||(i=i[Da],10&o.type))););if(null===o)return!1;n=o,t=i}const r=De.lFrame=db();return r.currentTNode=n,r.lView=t,!0}function Ih(t){const n=db(),e=t[ee];De.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function db(){const t=De.lFrame,n=null===t?null:t.child;return null===n?fb(t):n}function fb(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function hb(){const t=De.lFrame;return De.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const pb=hb;function Mh(){const t=hb();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Dn(){return De.lFrame.selectedIndex}function Wi(t){De.lFrame.selectedIndex=t}function gt(){const t=De.lFrame;return tb(t.tView,t.selectedIndex)}function fn(){De.lFrame.currentNamespace=Z0}function kn(){!function YT(){De.lFrame.currentNamespace=null}()}function nl(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){const i=t.data[e].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;a&&(t.contentHooks||(t.contentHooks=[])).push(-e,a),s&&((t.contentHooks||(t.contentHooks=[])).push(e,s),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(e,s)),u&&(t.viewHooks||(t.viewHooks=[])).push(-e,u),c&&((t.viewHooks||(t.viewHooks=[])).push(e,c),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(e,c)),null!=l&&(t.destroyHooks||(t.destroyHooks=[])).push(e,l)}}function rl(t,n,e){gb(t,n,3,e)}function ol(t,n,e,r){(3&t[Me])===e&&gb(t,n,e,r)}function Rh(t,n){let e=t[Me];(3&e)===n&&(e&=2047,e+=1,t[Me]=e)}function gb(t,n,e,r){const i=r??-1,a=n.length-1;let s=0;for(let u=void 0!==r?65535&t[Ea]:0;u<a;u++)if("number"==typeof n[u+1]){if(s=n[u],null!=r&&s>=r)break}else n[u]<0&&(t[Ea]+=65536),(s<i||-1==i)&&(eA(t,e,n,u),t[Ea]=(4294901760&t[Ea])+u+2),u++}function eA(t,n,e,r){const o=e[r]<0,i=e[r+1],s=t[o?-e[r]:e[r]];if(o){if(t[Me]>>11<t[Ea]>>16&&(3&t[Me])===n){t[Me]+=2048,sr(4,s,i);try{i.call(s)}finally{sr(5,s,i)}}}else{sr(4,s,i);try{i.call(s)}finally{sr(5,s,i)}}}const Ra=-1;class nu{constructor(n,e,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}}function Ah(t,n,e){let r=0;for(;r<e.length;){const o=e[r];if("number"==typeof o){if(0!==o)break;r++;const i=e[r++],a=e[r++],s=e[r++];t.setAttribute(n,a,s,i)}else{const i=o,a=e[++r];mb(i)?t.setProperty(n,i,a):t.setAttribute(n,i,a),r++}}return r}function vb(t){return 3===t||4===t||6===t}function mb(t){return 64===t.charCodeAt(0)}function ru(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){const o=n[r];"number"==typeof o?e=o:0===e||yb(t,e,o,null,-1===e||2===e?n[++r]:null)}}return t}function yb(t,n,e,r,o){let i=0,a=t.length;if(-1===n)a=-1;else for(;i<t.length;){const s=t[i++];if("number"==typeof s){if(s===n){a=-1;break}if(s>n){a=i-1;break}}}for(;i<t.length;){const s=t[i];if("number"==typeof s)break;if(s===e){if(null===r)return void(null!==o&&(t[i+1]=o));if(r===t[i+1])return void(t[i+2]=o)}i++,null!==r&&i++,null!==o&&i++}-1!==a&&(t.splice(a,0,n),i=a+1),t.splice(i++,0,e),null!==r&&t.splice(i++,0,r),null!==o&&t.splice(i++,0,o)}function bb(t){return t!==Ra}function il(t){return 32767&t}function al(t,n){let e=function oA(t){return t>>16}(t),r=n;for(;e>0;)r=r[Da],e--;return r}let kh=!0;function sl(t){const n=kh;return kh=t,n}const wb=255,xb=5;let iA=0;const $r={};function ul(t,n){const e=_b(t,n);if(-1!==e)return e;const r=n[ee];r.firstCreatePass&&(t.injectorIndex=n.length,Ph(r.data,t),Ph(n,null),Ph(r.blueprint,null));const o=Oh(t,n),i=t.injectorIndex;if(bb(o)){const a=il(o),s=al(o,n),u=s[ee].data;for(let c=0;c<8;c++)n[i+c]=s[a+c]|u[a+c]}return n[i+8]=o,i}function Ph(t,n){t.push(0,0,0,0,0,0,0,0,n)}function _b(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Oh(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;null!==o;){if(r=Tb(o),null===r)return Ra;if(e++,o=o[Da],-1!==r.injectorIndex)return r.injectorIndex|e<<16}return Ra}function Nh(t,n,e){!function aA(t,n,e){let r;"string"==typeof e?r=e.charCodeAt(0)||0:e.hasOwnProperty(Qs)&&(r=e[Qs]),null==r&&(r=e[Qs]=iA++);const o=r&wb;n.data[t+(o>>xb)]|=1<<o}(t,n,e)}function Cb(t,n,e){if(e&be.Optional||void 0!==t)return t;Hc()}function Db(t,n,e,r){if(e&be.Optional&&void 0===r&&(r=null),!(e&(be.Self|be.Host))){const o=t[Xc],i=ar(void 0);try{return o?o.get(n,r,e&be.Optional):B0(n,r,e&be.Optional)}finally{ar(i)}}return Cb(r,0,e)}function Eb(t,n,e,r=be.Default,o){if(null!==t){if(1024&n[Me]){const a=function dA(t,n,e,r,o){let i=t,a=n;for(;null!==i&&null!==a&&1024&a[Me]&&!(256&a[Me]);){const s=Sb(i,a,e,r|be.Self,$r);if(s!==$r)return s;let u=i.parent;if(!u){const c=a[G0];if(c){const l=c.get(e,$r,r);if(l!==$r)return l}u=Tb(a),a=a[Da]}i=u}return o}(t,n,e,r,$r);if(a!==$r)return a}const i=Sb(t,n,e,r,$r);if(i!==$r)return i}return Db(n,e,r,o)}function Sb(t,n,e,r,o){const i=function cA(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Qs)?t[Qs]:void 0;return"number"==typeof n?n>=0?n&wb:lA:n}(e);if("function"==typeof i){if(!lb(n,t,r))return r&be.Host?Cb(o,0,r):Db(n,e,r,o);try{const a=i(r);if(null!=a||r&be.Optional)return a;Hc()}finally{pb()}}else if("number"==typeof i){let a=null,s=_b(t,n),u=Ra,c=r&be.Host?n[dn][ln]:null;for((-1===s||r&be.SkipSelf)&&(u=-1===s?Oh(t,n):n[s+8],u!==Ra&&Mb(r,!1)?(a=n[ee],s=il(u),n=al(u,n)):s=-1);-1!==s;){const l=n[ee];if(Ib(i,s,l.data)){const d=uA(s,n,e,a,r,c);if(d!==$r)return d}u=n[s+8],u!==Ra&&Mb(r,n[ee].data[s+8]===c)&&Ib(i,s,n)?(a=l,s=il(u),n=al(u,n)):s=-1}}return o}function uA(t,n,e,r,o,i){const a=n[ee],s=a.data[t+8],l=cl(s,a,e,null==r?eu(s)&&kh:r!=a&&0!=(3&s.type),o&be.Host&&i===s);return null!==l?zi(n,a,l,s):$r}function cl(t,n,e,r,o){const i=t.providerIndexes,a=n.data,s=1048575&i,u=t.directiveStart,l=i>>20,f=o?s+l:t.directiveEnd;for(let h=r?s:s+l;h<f;h++){const p=a[h];if(h<u&&e===p||h>=u&&p.type===e)return h}if(o){const h=a[u];if(h&&wr(h)&&h.type===e)return u}return null}function zi(t,n,e,r){let o=t[e];const i=n.data;if(function tA(t){return t instanceof nu}(o)){const a=o;a.resolving&&function tT(t,n){const e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new Q(-200,`Circular dependency in DI detected for ${t}${e}`)}(function Ye(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Ce(t)}(i[e]));const s=sl(a.canSeeViewProviders);a.resolving=!0;const u=a.injectImpl?ar(a.injectImpl):null;lb(t,r,be.Default);try{o=t[e]=a.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&function ZT(t,n,e){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){const a=Q0(n);(e.preOrderHooks||(e.preOrderHooks=[])).push(t,a),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,a)}o&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-t,o),i&&((e.preOrderHooks||(e.preOrderHooks=[])).push(t,i),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,i))}(e,i[e],n)}finally{null!==u&&ar(u),sl(s),a.resolving=!1,pb()}}return o}function Ib(t,n,e){return!!(e[n+(t>>xb)]&1<<t)}function Mb(t,n){return!(t&be.Self||t&be.Host&&n)}class Ta{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return Eb(this._tNode,this._lView,n,Gc(r),e)}}function lA(){return new Ta(tn(),G())}function Fh(t){return ch(t)?()=>{const n=Fh(ye(t));return n&&n()}:ji(t)}function Tb(t){const n=t[ee],e=n.type;return 2===e?n.declTNode:1===e?t[ln]:null}const ka="__parameters__";function Oa(t,n,e){return xo(()=>{const r=function Lh(t){return function(...e){if(t){const r=t(...e);for(const o in r)this[o]=r[o]}}}(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;const a=new o(...i);return s.annotation=a,s;function s(u,c,l){const d=u.hasOwnProperty(ka)?u[ka]:Object.defineProperty(u,ka,{value:[]})[ka];for(;d.length<=l;)d.push(null);return(d[l]=d[l]||[]).push(a),u}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}class fe{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=de({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function $i(t,n){t.forEach(e=>Array.isArray(e)?$i(e,n):n(e))}function kb(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function dl(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}const su=Xs(Oa("Optional"),8),uu=Xs(Oa("SkipSelf"),4);var Pn=(()=>((Pn=Pn||{})[Pn.Important=1]="Important",Pn[Pn.DashCase=2]="DashCase",Pn))();const $h=new Map;let LA=0;const qh="__ngContext__";function hn(t,n){Wn(n)?(t[qh]=n[Zs],function UA(t){$h.set(t[Zs],t)}(n)):t[qh]=n}let Kh;function Xh(t,n){return Kh(t,n)}function fu(t){const n=t[xt];return br(n)?n[xt]:n}function Qh(t){return Zb(t[Ys])}function Yh(t){return Zb(t[yr])}function Zb(t){for(;null!==t&&!br(t);)t=t[yr];return t}function La(t,n,e,r,o){if(null!=r){let i,a=!1;br(r)?i=r:Wn(r)&&(a=!0,r=r[Eo]);const s=en(r);0===t&&null!==e?null==o?iw(n,e,s):Gi(n,e,s,o||null,!0):1===t&&null!==e?Gi(n,e,s,o||null,!0):2===t?function op(t,n,e){const r=gl(t,n);r&&function ik(t,n,e,r){t.removeChild(n,e,r)}(t,r,n,e)}(n,s,a):3===t&&n.destroyNode(s),null!=i&&function uk(t,n,e,r,o){const i=e[Yc];i!==en(e)&&La(n,t,r,i,o);for(let s=_n;s<e.length;s++){const u=e[s];hu(u[ee],u,t,n,r,i)}}(n,t,i,e,o)}}function Zh(t,n,e){return t.createElement(n,e)}function tw(t,n){const e=t[Sa],r=e.indexOf(n),o=n[xt];512&n[Me]&&(n[Me]&=-513,xh(o,-1)),e.splice(r,1)}function ep(t,n){if(t.length<=_n)return;const e=_n+n,r=t[e];if(r){const o=r[Js];null!==o&&o!==t&&tw(o,r),n>0&&(t[e-1][yr]=r[yr]);const i=dl(t,_n+n);!function YA(t,n){hu(t,n,n[Ae],2,null,null),n[Eo]=null,n[ln]=null}(r[ee],r);const a=i[Wr];null!==a&&a.detachView(i[ee]),r[xt]=null,r[yr]=null,r[Me]&=-65}return r}function nw(t,n){if(!(128&n[Me])){const e=n[Ae];e.destroyNode&&hu(t,n,e,3,null,null),function ek(t){let n=t[Ys];if(!n)return tp(t[ee],t);for(;n;){let e=null;if(Wn(n))e=n[Ys];else{const r=n[_n];r&&(e=r)}if(!e){for(;n&&!n[yr]&&n!==t;)Wn(n)&&tp(n[ee],n),n=n[xt];null===n&&(n=t),Wn(n)&&tp(n[ee],n),e=n&&n[yr]}n=e}}(n)}}function tp(t,n){if(!(128&n[Me])){n[Me]&=-65,n[Me]|=128,function ok(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let r=0;r<e.length;r+=2){const o=n[e[r]];if(!(o instanceof nu)){const i=e[r+1];if(Array.isArray(i))for(let a=0;a<i.length;a+=2){const s=o[i[a]],u=i[a+1];sr(4,s,u);try{u.call(s)}finally{sr(5,s,u)}}else{sr(4,o,i);try{i.call(o)}finally{sr(5,o,i)}}}}}(t,n),function rk(t,n){const e=t.cleanup,r=n[Ca];let o=-1;if(null!==e)for(let i=0;i<e.length-1;i+=2)if("string"==typeof e[i]){const a=e[i+3];a>=0?r[o=a]():r[o=-a].unsubscribe(),i+=2}else{const a=r[o=e[i+1]];e[i].call(a)}if(null!==r){for(let i=o+1;i<r.length;i++)(0,r[i])();n[Ca]=null}}(t,n),1===n[ee].type&&n[Ae].destroy();const e=n[Js];if(null!==e&&br(n[xt])){e!==n[xt]&&tw(e,n);const r=n[Wr];null!==r&&r.detachView(t)}!function VA(t){$h.delete(t[Zs])}(n)}}function rw(t,n,e){return function ow(t,n,e){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return e[Eo];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:i}=t.data[r.directiveStart+o];if(i===Hr.None||i===Hr.Emulated)return null}return zn(r,e)}}(t,n.parent,e)}function Gi(t,n,e,r,o){t.insertBefore(n,e,r,o)}function iw(t,n,e){t.appendChild(n,e)}function aw(t,n,e,r,o){null!==r?Gi(t,n,e,r,o):iw(t,n,e)}function gl(t,n){return t.parentNode(n)}let np,sp,bl,cw=function uw(t,n,e){return 40&t.type?zn(t,e):null};function vl(t,n,e,r){const o=rw(t,r,n),i=n[Ae],s=function sw(t,n,e){return cw(t,n,e)}(r.parent||n[ln],r,n);if(null!=o)if(Array.isArray(e))for(let u=0;u<e.length;u++)aw(i,o,e[u],s,!1);else aw(i,o,e,s,!1);void 0!==np&&np(i,r,n,e,o)}function ml(t,n){if(null!==n){const e=n.type;if(3&e)return zn(n,t);if(4&e)return rp(-1,t[n.index]);if(8&e){const r=n.child;if(null!==r)return ml(t,r);{const o=t[n.index];return br(o)?rp(-1,o):en(o)}}if(32&e)return Xh(n,t)()||en(t[n.index]);{const r=dw(t,n);return null!==r?Array.isArray(r)?r[0]:ml(fu(t[dn]),r):ml(t,n.next)}}return null}function dw(t,n){return null!==n?t[dn][ln].projection[n.projection]:null}function rp(t,n){const e=_n+t+1;if(e<n.length){const r=n[e],o=r[ee].firstChild;if(null!==o)return ml(r,o)}return n[Yc]}function ip(t,n,e,r,o,i,a){for(;null!=e;){const s=r[e.index],u=e.type;if(a&&0===n&&(s&&hn(en(s),r),e.flags|=2),32!=(32&e.flags))if(8&u)ip(t,n,e.child,r,o,i,!1),La(n,t,o,s,i);else if(32&u){const c=Xh(e,r);let l;for(;l=c();)La(n,t,o,l,i);La(n,t,o,s,i)}else 16&u?fw(t,n,r,e,o,i):La(n,t,o,s,i);e=a?e.projectionNext:e.next}}function hu(t,n,e,r,o,i){ip(e,r,t.firstChild,n,o,i,!1)}function fw(t,n,e,r,o,i){const a=e[dn],u=a[ln].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)La(n,t,o,u[c],i);else ip(t,n,u,a[xt],o,i,!0)}function hw(t,n,e){""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function pw(t,n,e){const{mergedAttrs:r,classes:o,styles:i}=e;null!==r&&Ah(t,n,r),null!==o&&hw(t,n,o),null!==i&&function lk(t,n,e){t.setAttribute(n,"style",e)}(t,n,i)}function yw(t){return function up(){if(void 0===bl&&(bl=null,lt.trustedTypes))try{bl=lt.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return bl}()?.createScriptURL(t)||t}class bw{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${O0})`}}function ui(t){return t instanceof bw?t.changingThisBreaksApplicationSecurity:t}function pu(t,n){const e=function wk(t){return t instanceof bw&&t.getTypeName()||null}(t);if(null!=e&&e!==n){if("ResourceURL"===e&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${O0})`)}return e===n}const Dk=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var kt=(()=>((kt=kt||{})[kt.NONE=0]="NONE",kt[kt.HTML=1]="HTML",kt[kt.STYLE=2]="STYLE",kt[kt.SCRIPT=3]="SCRIPT",kt[kt.URL=4]="URL",kt[kt.RESOURCE_URL=5]="RESOURCE_URL",kt))();function Ua(t){const n=vu();return n?n.sanitize(kt.URL,t)||"":pu(t,"URL")?ui(t):function cp(t){return(t=String(t)).match(Dk)?t:"unsafe:"+t}(Ce(t))}function Sw(t){const n=vu();if(n)return yw(n.sanitize(kt.RESOURCE_URL,t)||"");if(pu(t,"ResourceURL"))return yw(ui(t));throw new Q(904,!1)}function vu(){const t=G();return t&&t[mh]}const xl=new fe("ENVIRONMENT_INITIALIZER"),Mw=new fe("INJECTOR",-1),Rw=new fe("INJECTOR_DEF_TYPES");class Tw{get(n,e=qs){if(e===qs){const r=new Error(`NullInjectorError: No provider for ${ot(n)}!`);throw r.name="NullInjectorError",r}return e}}function Bk(...t){return{\u0275providers:Aw(0,t),\u0275fromNgModule:!0}}function Aw(t,...n){const e=[],r=new Set;let o;return $i(n,i=>{const a=i;hp(a,e,[],r)&&(o||(o=[]),o.push(a))}),void 0!==o&&kw(o,e),e}function kw(t,n){for(let e=0;e<t.length;e++){const{providers:o}=t[e];pp(o,i=>{n.push(i)})}}function hp(t,n,e,r){if(!(t=ye(t)))return!1;let o=null,i=F0(t);const a=!i&&Ze(t);if(i||a){if(a&&!a.standalone)return!1;o=t}else{const u=t.ngModule;if(i=F0(u),!i)return!1;o=u}const s=r.has(o);if(a){if(s)return!1;if(r.add(o),a.dependencies){const u="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const c of u)hp(c,n,e,r)}}else{if(!i)return!1;{if(null!=i.imports&&!s){let c;r.add(o);try{$i(i.imports,l=>{hp(l,n,e,r)&&(c||(c=[]),c.push(l))})}finally{}void 0!==c&&kw(c,n)}if(!s){const c=ji(o)||(()=>new o);n.push({provide:o,useFactory:c,deps:Ke},{provide:Rw,useValue:o,multi:!0},{provide:xl,useValue:()=>ce(o),multi:!0})}const u=i.providers;null==u||s||pp(u,l=>{n.push(l)})}}return o!==t&&void 0!==t.providers}function pp(t,n){for(let e of t)lh(e)&&(e=e.\u0275providers),Array.isArray(e)?pp(e,n):n(e)}const Uk=nt({provide:String,useValue:nt});function gp(t){return null!==t&&"object"==typeof t&&Uk in t}function qi(t){return"function"==typeof t}const vp=new fe("Set Injector scope."),_l={},jk={};let mp;function Cl(){return void 0===mp&&(mp=new Tw),mp}class Gr{}class Nw extends Gr{get destroyed(){return this._destroyed}constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,bp(n,a=>this.processProvider(a)),this.records.set(Mw,Va(void 0,this)),o.has("environment")&&this.records.set(Gr,Va(void 0,this));const i=this.records.get(vp);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(Rw.multi,Ke,be.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();for(const n of this._onDestroyHooks)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(n){this._onDestroyHooks.push(n)}runInContext(n){this.assertNotDestroyed();const e=xa(this),r=ar(void 0);try{return n()}finally{xa(e),ar(r)}}get(n,e=qs,r=be.Default){this.assertNotDestroyed(),r=Gc(r);const o=xa(this),i=ar(void 0);try{if(!(r&be.SkipSelf)){let s=this.records.get(n);if(void 0===s){const u=function Gk(t){return"function"==typeof t||"object"==typeof t&&t instanceof fe}(n)&&Wc(n);s=u&&this.injectableDefInScope(u)?Va(yp(n),_l):null,this.records.set(n,s)}if(null!=s)return this.hydrate(n,s)}return(r&be.Self?Cl():this.parent).get(n,e=r&be.Optional&&e===qs?null:e)}catch(a){if("NullInjectorError"===a.name){if((a[$c]=a[$c]||[]).unshift(ot(n)),o)throw a;return function mT(t,n,e,r){const o=t[$c];throw n[U0]&&o.unshift(n[U0]),t.message=function yT(t,n,e,r=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==pT?t.slice(2):t;let o=ot(n);if(Array.isArray(n))o=n.map(ot).join(" -> ");else if("object"==typeof n){let i=[];for(let a in n)if(n.hasOwnProperty(a)){let s=n[a];i.push(a+":"+("string"==typeof s?JSON.stringify(s):ot(s)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(hT,"\n  ")}`}("\n"+t.message,o,e,r),t[fT]=o,t[$c]=null,t}(a,n,"R3InjectorError",this.source)}throw a}finally{ar(i),xa(o)}}resolveInjectorInitializers(){const n=xa(this),e=ar(void 0);try{const r=this.get(xl.multi,Ke,be.Self);for(const o of r)o()}finally{xa(n),ar(e)}}toString(){const n=[],e=this.records;for(const r of e.keys())n.push(ot(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Q(205,!1)}processProvider(n){let e=qi(n=ye(n))?n:ye(n&&n.provide);const r=function Wk(t){return gp(t)?Va(void 0,t.useValue):Va(function Fw(t,n,e){let r;if(qi(t)){const o=ye(t);return ji(o)||yp(o)}if(gp(t))r=()=>ye(t.useValue);else if(function Ow(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...ph(t.deps||[]));else if(function Pw(t){return!(!t||!t.useExisting)}(t))r=()=>ce(ye(t.useExisting));else{const o=ye(t&&(t.useClass||t.provide));if(!function zk(t){return!!t.deps}(t))return ji(o)||yp(o);r=()=>new o(...ph(t.deps))}return r}(t),_l)}(n);if(qi(n)||!0!==n.multi)this.records.get(e);else{let o=this.records.get(e);o||(o=Va(void 0,_l,!0),o.factory=()=>ph(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){return e.value===_l&&(e.value=jk,e.value=e.factory()),"object"==typeof e.value&&e.value&&function $k(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=ye(n.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function yp(t){const n=Wc(t),e=null!==n?n.factory:ji(t);if(null!==e)return e;if(t instanceof fe)throw new Q(204,!1);if(t instanceof Function)return function Hk(t){const n=t.length;if(n>0)throw function au(t,n){const e=[];for(let r=0;r<t;r++)e.push(n);return e}(n,"?"),new Q(204,!1);const e=function uT(t){const n=t&&(t[zc]||t[L0]);return n?(function cT(t){if(t.hasOwnProperty("name"))return t.name;(""+t).match(/^function\s*([^\s(]+)/)}(t),n):null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new Q(204,!1)}function Va(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function bp(t,n){for(const e of t)Array.isArray(e)?bp(e,n):e&&lh(e)?bp(e.\u0275providers,n):n(e)}class qk{}class Lw{}class Xk{resolveComponentFactory(n){throw function Kk(t){const n=Error(`No component factory found for ${ot(t)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=t,n}(n)}}let mu=(()=>{class t{}return t.NULL=new Xk,t})();function Qk(){return ja(tn(),G())}function ja(t,n){return new Ro(zn(t,n))}let Ro=(()=>{class t{constructor(e){this.nativeElement=e}}return t.__NG_ELEMENT_ID__=Qk,t})();function Yk(t){return t instanceof Ro?t.nativeElement:t}class Uw{}let Ha=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function Jk(){const t=G(),e=$n(tn().index,t);return(Wn(e)?e:t)[Ae]}(),t})(),Zk=(()=>{class t{}return t.\u0275prov=de({token:t,providedIn:"root",factory:()=>null}),t})();class Dl{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const eP=new Dl("15.2.3"),wp={},xp="ngOriginalError";function _p(t){return t[xp]}class Wa{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n);this._console.error("ERROR",n),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(n){let e=n&&_p(n);for(;e&&_p(e);)e=_p(e);return e||null}}function To(t){return t instanceof Function?t():t}function jw(t,n,e){let r=t.length;for(;;){const o=t.indexOf(n,e);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}const Hw="ng-template";function dP(t,n,e){let r=0;for(;r<t.length;){let o=t[r++];if(e&&"class"===o){if(o=t[r],-1!==jw(o.toLowerCase(),n,0))return!0}else if(1===o){for(;r<t.length&&"string"==typeof(o=t[r++]);)if(o.toLowerCase()===n)return!0;return!1}}return!1}function Ww(t){return 4===t.type&&t.value!==Hw}function fP(t,n,e){return n===(4!==t.type||e?t.value:Hw)}function hP(t,n,e){let r=4;const o=t.attrs||[],i=function vP(t){for(let n=0;n<t.length;n++)if(vb(t[n]))return n;return t.length}(o);let a=!1;for(let s=0;s<n.length;s++){const u=n[s];if("number"!=typeof u){if(!a)if(4&r){if(r=2|1&r,""!==u&&!fP(t,u,e)||""===u&&1===n.length){if(xr(r))return!1;a=!0}}else{const c=8&r?u:n[++s];if(8&r&&null!==t.attrs){if(!dP(t.attrs,c,e)){if(xr(r))return!1;a=!0}continue}const d=pP(8&r?"class":u,o,Ww(t),e);if(-1===d){if(xr(r))return!1;a=!0;continue}if(""!==c){let f;f=d>i?"":o[d+1].toLowerCase();const h=8&r?f:null;if(h&&-1!==jw(h,c,0)||2&r&&c!==f){if(xr(r))return!1;a=!0}}}}else{if(!a&&!xr(r)&&!xr(u))return!1;if(a&&xr(u))continue;a=!1,r=u|1&r}}return xr(r)||a}function xr(t){return 0==(1&t)}function pP(t,n,e,r){if(null===n)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){const a=n[o];if(a===t)return o;if(3===a||6===a)i=!0;else{if(1===a||2===a){let s=n[++o];for(;"string"==typeof s;)s=n[++o];continue}if(4===a)break;if(0===a){o+=4;continue}}o+=i?1:2}return-1}return function mP(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const r=t[e];if("number"==typeof r)return-1;if(r===n)return e;e++}return-1}(n,t)}function zw(t,n,e=!1){for(let r=0;r<n.length;r++)if(hP(t,n[r],e))return!0;return!1}function $w(t,n){return t?":not("+n.trim()+")":n}function bP(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let a=t[e];if("string"==typeof a)if(2&r){const s=t[++e];o+="["+a+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?o+="."+a:4&r&&(o+=" "+a);else""!==o&&!xr(a)&&(n+=$w(i,o),o=""),r=a,i=i||!xr(r);e++}return""!==o&&(n+=$w(i,o)),n}const Ee={};function ht(t){Gw(We(),G(),Dn()+t,!1)}function Gw(t,n,e,r){if(!r)if(3==(3&n[Me])){const i=t.preOrderCheckHooks;null!==i&&rl(n,i,e)}else{const i=t.preOrderHooks;null!==i&&ol(n,i,0,e)}Wi(e)}function Qw(t,n=null,e=null,r){const o=Yw(t,n,e,r);return o.resolveInjectorInitializers(),o}function Yw(t,n=null,e=null,r,o=new Set){const i=[e||Ke,Bk(t)];return r=r||("object"==typeof t?void 0:ot(t)),new Nw(i,n||Cl(),r||null,o)}let qr=(()=>{class t{static create(e,r){if(Array.isArray(e))return Qw({name:""},r,e,"");{const o=e.name??"";return Qw({name:o},e.parent,e.providers,o)}}}return t.THROW_IF_NOT_FOUND=qs,t.NULL=new Tw,t.\u0275prov=de({token:t,providedIn:"any",factory:()=>ce(Mw)}),t.__NG_ELEMENT_ID__=-1,t})();function he(t,n=be.Default){const e=G();return null===e?ce(t,n):Eb(tn(),e,ye(t),n)}function i1(t,n){const e=t.contentQueries;if(null!==e)for(let r=0;r<e.length;r+=2){const i=e[r+1];if(-1!==i){const a=t.data[i];Sh(e[r]),a.contentQueries(2,n[i],i)}}}function Sl(t,n,e,r,o,i,a,s,u,c,l){const d=n.blueprint.slice();return d[Eo]=o,d[Me]=76|r,(null!==l||t&&1024&t[Me])&&(d[Me]|=1024),nb(d),d[xt]=d[Da]=t,d[Et]=e,d[Qc]=a||t&&t[Qc],d[Ae]=s||t&&t[Ae],d[mh]=u||t&&t[mh]||null,d[Xc]=c||t&&t[Xc]||null,d[ln]=i,d[Zs]=function BA(){return LA++}(),d[G0]=l,d[dn]=2==n.type?t[dn]:d,d}function Ga(t,n,e,r,o){let i=t.data[n];if(null===i)i=function Ip(t,n,e,r,o){const i=ib(),a=_h(),u=t.data[n]=function $P(t,n,e,r,o,i){return{type:e,index:r,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?i:i&&i.parent,e,n,r,o);return null===t.firstChild&&(t.firstChild=u),null!==i&&(a?null==i.child&&null!==u.parent&&(i.child=u):null===i.next&&(i.next=u,u.prev=i)),u}(t,n,e,r,o),function zT(){return De.lFrame.inI18n}()&&(i.flags|=32);else if(64&i.type){i.type=e,i.value=r,i.attrs=o;const a=function tu(){const t=De.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();i.injectorIndex=null===a?-1:a.injectorIndex}return zr(i,!0),i}function yu(t,n,e,r){if(0===e)return-1;const o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function Mp(t,n,e){Ih(n);try{const r=t.viewQuery;null!==r&&Bp(1,r,e);const o=t.template;null!==o&&a1(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&i1(t,n),t.staticViewQueries&&Bp(2,t.viewQuery,e);const i=t.components;null!==i&&function HP(t,n){for(let e=0;e<n.length;e++)lO(t,n[e])}(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Me]&=-5,Mh()}}function Il(t,n,e,r){const o=n[Me];if(128!=(128&o)){Ih(n);try{nb(n),function sb(t){return De.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&a1(t,n,e,2,r);const a=3==(3&o);if(a){const c=t.preOrderCheckHooks;null!==c&&rl(n,c,null)}else{const c=t.preOrderHooks;null!==c&&ol(n,c,0,null),Rh(n,0)}if(function uO(t){for(let n=Qh(t);null!==n;n=Yh(n)){if(!n[q0])continue;const e=n[Sa];for(let r=0;r<e.length;r++){const o=e[r];512&o[Me]||xh(o[xt],1),o[Me]|=512}}}(n),function sO(t){for(let n=Qh(t);null!==n;n=Yh(n))for(let e=_n;e<n.length;e++){const r=n[e],o=r[ee];tl(r)&&Il(o,r,o.template,r[Et])}}(n),null!==t.contentQueries&&i1(t,n),a){const c=t.contentCheckHooks;null!==c&&rl(n,c)}else{const c=t.contentHooks;null!==c&&ol(n,c,1),Rh(n,1)}!function VP(t,n){const e=t.hostBindingOpCodes;if(null!==e)try{for(let r=0;r<e.length;r++){const o=e[r];if(o<0)Wi(~o);else{const i=o,a=e[++r],s=e[++r];$T(a,i),s(2,n[i])}}}finally{Wi(-1)}}(t,n);const s=t.components;null!==s&&function jP(t,n){for(let e=0;e<n.length;e++)cO(t,n[e])}(n,s);const u=t.viewQuery;if(null!==u&&Bp(2,u,r),a){const c=t.viewCheckHooks;null!==c&&rl(n,c)}else{const c=t.viewHooks;null!==c&&ol(n,c,2),Rh(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[Me]&=-41,512&n[Me]&&(n[Me]&=-513,xh(n[xt],-1))}finally{Mh()}}}function a1(t,n,e,r,o){const i=Dn(),a=2&r;try{Wi(-1),a&&n.length>dt&&Gw(t,n,dt,!1),sr(a?2:0,o),e(r,o)}finally{Wi(i),sr(a?3:1,o)}}function Rp(t,n,e){if(bh(n)){const o=n.directiveEnd;for(let i=n.directiveStart;i<o;i++){const a=t.data[i];a.contentQueries&&a.contentQueries(1,e[i],i)}}}function Tp(t,n,e){ob()&&(function YP(t,n,e,r){const o=e.directiveStart,i=e.directiveEnd;eu(e)&&function oO(t,n,e){const r=zn(n,t),o=s1(e),i=t[Qc],a=Ml(t,Sl(t,o,null,e.onPush?32:16,r,n,i,i.createRenderer(r,e),null,null,null));t[n.index]=a}(n,e,t.data[o+e.componentOffset]),t.firstCreatePass||ul(e,n),hn(r,n);const a=e.initialInputs;for(let s=o;s<i;s++){const u=t.data[s],c=zi(n,t,s,e);hn(c,n),null!==a&&iO(0,s-o,c,u,0,a),wr(u)&&($n(e.index,n)[Et]=zi(n,t,s,e))}}(t,n,e,zn(e,n)),64==(64&e.flags)&&h1(t,n,e))}function Ap(t,n,e=zn){const r=n.localNames;if(null!==r){let o=n.index+1;for(let i=0;i<r.length;i+=2){const a=r[i+1],s=-1===a?e(n,t):t[a];t[o++]=s}}}function s1(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=kp(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function kp(t,n,e,r,o,i,a,s,u,c){const l=dt+r,d=l+o,f=function WP(t,n){const e=[];for(let r=0;r<n;r++)e.push(r<t?null:Ee);return e}(l,d),h="function"==typeof c?c():c;return f[ee]={type:t,blueprint:f,template:e,queries:null,viewQuery:s,declTNode:n,data:f.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:u,consts:h,incompleteFirstPass:!1}}function u1(t,n,e,r){const o=g1(n);null===e?o.push(r):(o.push(e),t.firstCreatePass&&v1(t).push(r,o.length-1))}function c1(t,n,e,r){for(let o in t)if(t.hasOwnProperty(o)){e=null===e?{}:e;const i=t[o];null===r?l1(e,n,o,i):r.hasOwnProperty(o)&&l1(e,n,r[o],i)}return e}function l1(t,n,e,r){t.hasOwnProperty(e)?t[e].push(n,r):t[e]=[n,r]}function d1(t,n){const e=$n(n,t);16&e[Me]||(e[Me]|=32)}function Pp(t,n,e,r){if(ob()){const o=null===r?null:{"":-1},i=function ZP(t,n){const e=t.directiveRegistry;let r=null,o=null;if(e)for(let i=0;i<e.length;i++){const a=e[i];if(zw(n,a.selectors,!1))if(r||(r=[]),wr(a))if(null!==a.findHostDirectiveDefs){const s=[];o=o||new Map,a.findHostDirectiveDefs(a,s,o),r.unshift(...s,a),Op(t,n,s.length)}else r.unshift(a),Op(t,n,0);else o=o||new Map,a.findHostDirectiveDefs?.(a,r,o),r.push(a)}return null===r?null:[r,o]}(t,e);let a,s;null===i?a=s=null:[a,s]=i,null!==a&&f1(t,n,e,a,o,s),o&&function eO(t,n,e){if(n){const r=t.localNames=[];for(let o=0;o<n.length;o+=2){const i=e[n[o+1]];if(null==i)throw new Q(-301,!1);r.push(n[o],i)}}}(e,r,o)}e.mergedAttrs=ru(e.mergedAttrs,e.attrs)}function f1(t,n,e,r,o,i){for(let c=0;c<r.length;c++)Nh(ul(e,n),t,r[c].type);!function nO(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}(e,t.data.length,r.length);for(let c=0;c<r.length;c++){const l=r[c];l.providersResolver&&l.providersResolver(l)}let a=!1,s=!1,u=yu(t,n,r.length,null);for(let c=0;c<r.length;c++){const l=r[c];e.mergedAttrs=ru(e.mergedAttrs,l.hostAttrs),rO(t,e,n,u,l),tO(u,l,o),null!==l.contentQueries&&(e.flags|=4),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(e.flags|=64);const d=l.type.prototype;!a&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(e.index),a=!0),!s&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(e.index),s=!0),u++}!function GP(t,n,e){const o=n.directiveEnd,i=t.data,a=n.attrs,s=[];let u=null,c=null;for(let l=n.directiveStart;l<o;l++){const d=i[l],f=e?e.get(d):null,p=f?f.outputs:null;u=c1(d.inputs,l,u,f?f.inputs:null),c=c1(d.outputs,l,c,p);const g=null===u||null===a||Ww(n)?null:aO(u,l,a);s.push(g)}null!==u&&(u.hasOwnProperty("class")&&(n.flags|=8),u.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=s,n.inputs=u,n.outputs=c}(t,e,i)}function h1(t,n,e){const r=e.directiveStart,o=e.directiveEnd,i=e.index,a=function GT(){return De.lFrame.currentDirectiveIndex}();try{Wi(i);for(let s=r;s<o;s++){const u=t.data[s],c=n[s];Dh(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&JP(u,c)}}finally{Wi(-1),Dh(a)}}function JP(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function Op(t,n,e){n.componentOffset=e,(t.components||(t.components=[])).push(n.index)}function tO(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;wr(n)&&(e[""]=t)}}function rO(t,n,e,r,o){t.data[r]=o;const i=o.factory||(o.factory=ji(o.type)),a=new nu(i,wr(o),he);t.blueprint[r]=a,e[r]=a,function XP(t,n,e,r,o){const i=o.hostBindings;if(i){let a=t.hostBindingOpCodes;null===a&&(a=t.hostBindingOpCodes=[]);const s=~n.index;(function QP(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(a)!=s&&a.push(s),a.push(e,r,i)}}(t,n,r,yu(t,e,o.hostVars,Ee),o)}function Kr(t,n,e,r,o,i){const a=zn(t,n);!function Np(t,n,e,r,o,i,a){if(null==i)t.removeAttribute(n,o,e);else{const s=null==a?Ce(i):a(i,r||"",o);t.setAttribute(n,o,s,e)}}(n[Ae],a,i,t.value,e,r,o)}function iO(t,n,e,r,o,i){const a=i[n];if(null!==a){const s=r.setInput;for(let u=0;u<a.length;){const c=a[u++],l=a[u++],d=a[u++];null!==s?r.setInput(e,d,c,l):e[l]=d}}}function aO(t,n,e){let r=null,o=0;for(;o<e.length;){const i=e[o];if(0!==i)if(5!==i){if("number"==typeof i)break;if(t.hasOwnProperty(i)){null===r&&(r=[]);const a=t[i];for(let s=0;s<a.length;s+=2)if(a[s]===n){r.push(i,a[s+1],e[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function p1(t,n,e,r){return[t,!0,!1,n,null,0,r,e,null,null]}function cO(t,n){const e=$n(n,t);if(tl(e)){const r=e[ee];48&e[Me]?Il(r,e,r.template,e[Et]):e[Vi]>0&&Fp(e)}}function Fp(t){for(let r=Qh(t);null!==r;r=Yh(r))for(let o=_n;o<r.length;o++){const i=r[o];if(tl(i))if(512&i[Me]){const a=i[ee];Il(a,i,a.template,i[Et])}else i[Vi]>0&&Fp(i)}const e=t[ee].components;if(null!==e)for(let r=0;r<e.length;r++){const o=$n(e[r],t);tl(o)&&o[Vi]>0&&Fp(o)}}function lO(t,n){const e=$n(n,t),r=e[ee];(function dO(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])})(r,e),Mp(r,e,e[Et])}function Ml(t,n){return t[Ys]?t[$0][yr]=n:t[Ys]=n,t[$0]=n,n}function Lp(t){for(;t;){t[Me]|=32;const n=fu(t);if(DT(t)&&!n)return t;t=n}return null}function Rl(t,n,e,r=!0){const o=n[Qc];o.begin&&o.begin();try{Il(t,n,t.template,e)}catch(a){throw r&&y1(n,a),a}finally{o.end&&o.end()}}function Bp(t,n,e){Sh(0),n(t,e)}function g1(t){return t[Ca]||(t[Ca]=[])}function v1(t){return t.cleanup||(t.cleanup=[])}function y1(t,n){const e=t[Xc],r=e?e.get(Wa,null):null;r&&r.handleError(n)}function Up(t,n,e,r,o){for(let i=0;i<e.length;){const a=e[i++],s=e[i++],u=n[a],c=t.data[a];null!==c.setInput?c.setInput(u,o,r,s):u[s]=o}}function Ao(t,n,e){const r=function el(t,n){return en(n[t])}(n,t);!function ew(t,n,e){t.setValue(n,e)}(t[Ae],r,e)}function Tl(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(null!==n)for(let a=0;a<n.length;a++){const s=n[a];"number"==typeof s?i=s:1==i?o=sh(o,s):2==i&&(r=sh(r,s+": "+n[++a]+";"))}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}function Al(t,n,e,r,o=!1){for(;null!==e;){const i=n[e.index];if(null!==i&&r.push(en(i)),br(i))for(let s=_n;s<i.length;s++){const u=i[s],c=u[ee].firstChild;null!==c&&Al(u[ee],u,c,r)}const a=e.type;if(8&a)Al(t,n,e.child,r);else if(32&a){const s=Xh(e,n);let u;for(;u=s();)r.push(u)}else if(16&a){const s=dw(n,e);if(Array.isArray(s))r.push(...s);else{const u=fu(n[dn]);Al(u[ee],u,s,r,!0)}}e=o?e.projectionNext:e.next}return r}class bu{get rootNodes(){const n=this._lView,e=n[ee];return Al(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Et]}set context(n){this._lView[Et]=n}get destroyed(){return 128==(128&this._lView[Me])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[xt];if(br(n)){const e=n[Jc],r=e?e.indexOf(this):-1;r>-1&&(ep(n,r),dl(e,r))}this._attachedToViewContainer=!1}nw(this._lView[ee],this._lView)}onDestroy(n){u1(this._lView[ee],this._lView,null,n)}markForCheck(){Lp(this._cdRefInjectingView||this._lView)}detach(){this._lView[Me]&=-65}reattach(){this._lView[Me]|=64}detectChanges(){Rl(this._lView[ee],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Q(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function ZA(t,n){hu(t,n,n[Ae],2,null,null)}(this._lView[ee],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Q(902,!1);this._appRef=n}}class fO extends bu{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Rl(n[ee],n,n[Et],!1)}checkNoChanges(){}get context(){return null}}class b1 extends mu{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=Ze(n);return new wu(e,this.ngModule)}}function w1(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}class pO{constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=Gc(r);const o=this.injector.get(n,wp,r);return o!==wp||e===wp?o:this.parentInjector.get(n,e,r)}}class wu extends Lw{get inputs(){return w1(this.componentDef.inputs)}get outputs(){return w1(this.componentDef.outputs)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function wP(t){return t.map(bP).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}create(n,e,r,o){let i=(o=o||this.ngModule)instanceof Gr?o:o?.injector;i&&null!==this.componentDef.getStandaloneInjector&&(i=this.componentDef.getStandaloneInjector(i)||i);const a=i?new pO(n,i):n,s=a.get(Uw,null);if(null===s)throw new Q(407,!1);const u=a.get(Zk,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",d=r?function zP(t,n,e){return t.selectRootElement(n,e===Hr.ShadowDom)}(c,r,this.componentDef.encapsulation):Zh(c,l,function hO(t){const n=t.toLowerCase();return"svg"===n?Z0:"math"===n?"math":null}(l)),f=this.componentDef.onPush?288:272,h=kp(0,null,null,1,0,null,null,null,null,null),p=Sl(null,h,null,f,null,null,s,c,u,a,null);let g,v;Ih(p);try{const m=this.componentDef;let b,y=null;m.findHostDirectiveDefs?(b=[],y=new Map,m.findHostDirectiveDefs(m,b,y),b.push(m)):b=[m];const w=function vO(t,n){const e=t[ee],r=dt;return t[r]=n,Ga(e,r,2,"#host",null)}(p,d),x=function mO(t,n,e,r,o,i,a,s){const u=o[ee];!function yO(t,n,e,r){for(const o of t)n.mergedAttrs=ru(n.mergedAttrs,o.hostAttrs);null!==n.mergedAttrs&&(Tl(n,n.mergedAttrs,!0),null!==e&&pw(r,e,n))}(r,t,n,a);const c=i.createRenderer(n,e),l=Sl(o,s1(e),null,e.onPush?32:16,o[t.index],t,i,c,s||null,null,null);return u.firstCreatePass&&Op(u,t,r.length-1),Ml(o,l),o[t.index]=l}(w,d,m,b,p,s,c);v=tb(h,dt),d&&function wO(t,n,e,r){if(r)Ah(t,e,["ng-version",eP.full]);else{const{attrs:o,classes:i}=function xP(t){const n=[],e=[];let r=1,o=2;for(;r<t.length;){let i=t[r];if("string"==typeof i)2===o?""!==i&&n.push(i,t[++r]):8===o&&e.push(i);else{if(!xr(o))break;o=i}r++}return{attrs:n,classes:e}}(n.selectors[0]);o&&Ah(t,e,o),i&&i.length>0&&hw(t,e,i.join(" "))}}(c,m,d,r),void 0!==e&&function xO(t,n,e){const r=t.projection=[];for(let o=0;o<n.length;o++){const i=e[o];r.push(null!=i?Array.from(i):null)}}(v,this.ngContentSelectors,e),g=function bO(t,n,e,r,o,i){const a=tn(),s=o[ee],u=zn(a,o);f1(s,o,a,e,null,r);for(let l=0;l<e.length;l++)hn(zi(o,s,a.directiveStart+l,a),o);h1(s,o,a),u&&hn(u,o);const c=zi(o,s,a.directiveStart+a.componentOffset,a);if(t[Et]=o[Et]=c,null!==i)for(const l of i)l(c,n);return Rp(s,a,t),c}(x,m,b,y,p,[_O]),Mp(h,p,null)}finally{Mh()}return new gO(this.componentType,g,ja(v,p),p,v)}}class gO extends qk{constructor(n,e,r,o,i){super(),this.location=r,this._rootLView=o,this._tNode=i,this.instance=e,this.hostView=this.changeDetectorRef=new fO(o),this.componentType=n}setInput(n,e){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[n])){const i=this._rootLView;Up(i[ee],i,o,n,e),d1(i,this._tNode.index)}}get injector(){return new Ta(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function _O(){const t=tn();nl(G()[ee],t)}function kl(t){return!!jp(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function jp(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function pn(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function Hp(t,n,e,r){const o=G();return pn(o,Ma(),n)&&(We(),Kr(gt(),o,t,n,e,r)),Hp}function ci(t,n,e,r,o,i,a,s){const u=G(),c=We(),l=t+dt,d=c.firstCreatePass?function FO(t,n,e,r,o,i,a,s,u){const c=n.consts,l=Ga(n,t,4,a||null,si(c,s));Pp(n,e,l,si(c,u)),nl(n,l);const d=l.tView=kp(2,l,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c);return null!==n.queries&&(n.queries.template(n,l),d.queries=n.queries.embeddedTView(l)),l}(l,c,u,n,e,r,o,i,a):c.data[l];zr(d,!1);const f=u[Ae].createComment("");vl(c,u,f,d),hn(f,u),Ml(u,u[l]=p1(f,u,f,d)),Zc(d)&&Tp(c,u,d),null!=a&&Ap(u,d,s)}function Nn(t,n,e){const r=G();return pn(r,Ma(),n)&&function qn(t,n,e,r,o,i,a,s){const u=zn(n,e);let l,c=n.inputs;!s&&null!=c&&(l=c[r])?(Up(t,e,l,r,o),eu(n)&&d1(e,n.index)):3&n.type&&(r=function qP(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(r),o=null!=a?a(o,n.value||"",r):o,i.setProperty(u,r,o))}(We(),gt(),r,t,n,r[Ae],e,!1),Nn}function Wp(t,n,e,r,o){const a=o?"class":"style";Up(t,e,n.inputs[a],a,r)}function L(t,n,e,r){const o=G(),i=We(),a=dt+t,s=o[Ae],u=i.firstCreatePass?function UO(t,n,e,r,o,i){const a=n.consts,u=Ga(n,t,2,r,si(a,o));return Pp(n,e,u,si(a,i)),null!==u.attrs&&Tl(u,u.attrs,!1),null!==u.mergedAttrs&&Tl(u,u.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,u),u}(a,i,o,n,e,r):i.data[a],c=o[a]=Zh(s,n,function JT(){return De.lFrame.currentNamespace}()),l=Zc(u);return zr(u,!0),pw(s,c,u),32!=(32&u.flags)&&vl(i,o,c,u),0===function FT(){return De.lFrame.elementDepthCount}()&&hn(c,o),function LT(){De.lFrame.elementDepthCount++}(),l&&(Tp(i,o,u),Rp(i,u,o)),null!==r&&Ap(o,u),L}function V(){let t=tn();_h()?Ch():(t=t.parent,zr(t,!1));const n=t;!function BT(){De.lFrame.elementDepthCount--}();const e=We();return e.firstCreatePass&&(nl(e,t),bh(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function nA(t){return 0!=(8&t.flags)}(n)&&Wp(e,n,G(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function rA(t){return 0!=(16&t.flags)}(n)&&Wp(e,n,G(),n.stylesWithoutHost,!1),V}function re(t,n,e,r){return L(t,n,e,r),V(),re}function Ol(t,n,e){const r=G(),o=We(),i=t+dt,a=o.firstCreatePass?function VO(t,n,e,r,o){const i=n.consts,a=si(i,r),s=Ga(n,t,8,"ng-container",a);return null!==a&&Tl(s,a,!0),Pp(n,e,s,si(i,o)),null!==n.queries&&n.queries.elementStart(n,s),s}(i,o,r,n,e):o.data[i];zr(a,!0);const s=r[i]=r[Ae].createComment("");return vl(o,r,s,a),hn(s,r),Zc(a)&&(Tp(o,r,a),Rp(o,a,r)),null!=e&&Ap(r,a),Ol}function Nl(){let t=tn();const n=We();return _h()?Ch():(t=t.parent,zr(t,!1)),n.firstCreatePass&&(nl(n,t),bh(t)&&n.queries.elementEnd(t)),Nl}function Fl(t){return!!t&&"function"==typeof t.then}const L1=function F1(t){return!!t&&"function"==typeof t.subscribe};function Xi(t,n,e,r){const o=G(),i=We(),a=tn();return function U1(t,n,e,r,o,i,a){const s=Zc(r),c=t.firstCreatePass&&v1(t),l=n[Et],d=g1(n);let f=!0;if(3&r.type||a){const g=zn(r,n),v=a?a(g):g,m=d.length,b=a?w=>a(en(w[r.index])):r.index;let y=null;if(!a&&s&&(y=function HO(t,n,e,r){const o=t.cleanup;if(null!=o)for(let i=0;i<o.length-1;i+=2){const a=o[i];if(a===e&&o[i+1]===r){const s=n[Ca],u=o[i+2];return s.length>u?s[u]:null}"string"==typeof a&&(i+=2)}return null}(t,n,o,r.index)),null!==y)(y.__ngLastListenerFn__||y).__ngNextListenerFn__=i,y.__ngLastListenerFn__=i,f=!1;else{i=j1(r,n,l,i,!1);const w=e.listen(v,o,i);d.push(i,w),c&&c.push(o,b,m,m+1)}}else i=j1(r,n,l,i,!1);const h=r.outputs;let p;if(f&&null!==h&&(p=h[o])){const g=p.length;if(g)for(let v=0;v<g;v+=2){const x=n[p[v]][p[v+1]].subscribe(i),_=d.length;d.push(i,x),c&&c.push(o,r.index,_,-(_+1))}}}(i,o,o[Ae],a,t,n,r),Xi}function V1(t,n,e,r){try{return sr(6,n,e),!1!==e(r)}catch(o){return y1(t,o),!1}finally{sr(7,n,e)}}function j1(t,n,e,r,o){return function i(a){if(a===Function)return r;Lp(t.componentOffset>-1?$n(t.index,n):n);let u=V1(n,e,r,a),c=i.__ngNextListenerFn__;for(;c;)u=V1(n,e,c,a)&&u,c=c.__ngNextListenerFn__;return o&&!1===u&&(a.preventDefault(),a.returnValue=!1),u}}function Ll(t=1){return function KT(t){return(De.lFrame.contextLView=function XT(t,n){for(;t>0;)n=n[Da],t--;return n}(t,De.lFrame.contextLView))[Et]}(t)}function X(t,n=""){const e=G(),r=We(),o=t+dt,i=r.firstCreatePass?Ga(r,o,1,n,null):r.data[o],a=e[o]=function Jh(t,n){return t.createText(n)}(e[Ae],n);vl(r,e,a,i),zr(i,!1)}function Dr(t){return di("",t,""),Dr}function di(t,n,e){const r=G(),o=function Ka(t,n,e,r){return pn(t,Ma(),e)?n+Ce(e)+r:Ee}(r,t,n,e);return o!==Ee&&Ao(r,Dn(),o),di}const os="en-US";let Px=os;class is{}class i_{}class a_ extends is{constructor(n,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new b1(this);const r=Hn(n);this._bootstrapComponents=To(r.bootstrap),this._r3Injector=Yw(n,e,[{provide:is,useValue:this},{provide:mu,useValue:this.componentFactoryResolver}],ot(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class tg extends i_{constructor(n){super(),this.moduleType=n}create(n){return new a_(this.moduleType,n)}}class PF extends is{constructor(n,e,r){super(),this.componentFactoryResolver=new b1(this),this.instance=null;const o=new Nw([...n,{provide:is,useValue:this},{provide:mu,useValue:this.componentFactoryResolver}],e||Cl(),r,new Set(["environment"]));this.injector=o,o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function zl(t,n,e=null){return new PF(t,n,e).injector}let OF=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const r=Aw(0,e.type),o=r.length>0?zl([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,o)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return t.\u0275prov=de({token:t,providedIn:"environment",factory:()=>new t(ce(Gr))}),t})();function s_(t){t.getStandaloneInjector=n=>n.get(OF).getOrCreateStandaloneInjector(t)}function p_(t,n,e,r,o,i){const a=n+e;return pn(t,a,o)?function Xr(t,n,e){return t[n]=e}(t,a+1,i?r.call(i,o):r(o)):function Mu(t,n){const e=t[n];return e===Ee?void 0:e}(t,a+1)}function rg(t,n){const e=We();let r;const o=t+dt;e.firstCreatePass?(r=function ZF(t,n){if(n)for(let e=n.length-1;e>=0;e--){const r=n[e];if(t===r.name)return r}}(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(o,r.onDestroy)):r=e.data[o];const i=r.factory||(r.factory=ji(r.type)),a=ar(he);try{const s=sl(!1),u=i();return sl(s),function LO(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}(e,G(),o,u),u}finally{ar(a)}}function og(t,n,e){const r=t+dt,o=G(),i=function Ia(t,n){return t[n]}(o,r);return function Ru(t,n){return t[ee].data[n].pure}(o,r)?p_(o,function Cn(){const t=De.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}(),n,i.transform,e,i):i.transform(e)}function ig(t){return n=>{setTimeout(t,void 0,n)}}const gn=class o3 extends Br{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,r){let o=n,i=e||(()=>null),a=r;if(n&&"object"==typeof n){const u=n;o=u.next?.bind(u),i=u.error?.bind(u),a=u.complete?.bind(u)}this.__isAsync&&(i=ig(i),o&&(o=ig(o)),a&&(a=ig(a)));const s=super.subscribe({next:o,error:i,complete:a});return n instanceof or&&n.add(s),s}};function i3(){return this._results[Symbol.iterator]()}class ag{get changes(){return this._changes||(this._changes=new gn)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=ag.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=i3)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){const r=this;r.dirty=!1;const o=function ur(t){return t.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function hA(t,n,e){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let o=t[r],i=n[r];if(e&&(o=e(o),i=e(i)),i!==o)return!1}return!0}(r._results,o,e))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let ko=(()=>{class t{}return t.__NG_ELEMENT_ID__=u3,t})();const a3=ko,s3=class extends a3{constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}createEmbeddedView(n,e){const r=this._declarationTContainer.tView,o=Sl(this._declarationLView,r,n,16,null,r.declTNode,null,null,null,null,e||null);o[Js]=this._declarationLView[this._declarationTContainer.index];const a=this._declarationLView[Wr];return null!==a&&(o[Wr]=a.createEmbeddedView(r)),Mp(r,o,n),new bu(o)}};function u3(){return $l(tn(),G())}function $l(t,n){return 4&t.type?new s3(n,t,ja(t,n)):null}let Er=(()=>{class t{}return t.__NG_ELEMENT_ID__=c3,t})();function c3(){return x_(tn(),G())}const l3=Er,b_=class extends l3{constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return ja(this._hostTNode,this._hostLView)}get injector(){return new Ta(this._hostTNode,this._hostLView)}get parentInjector(){const n=Oh(this._hostTNode,this._hostLView);if(bb(n)){const e=al(n,this._hostLView),r=il(n);return new Ta(e[ee].data[r+8],e)}return new Ta(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=w_(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-_n}createEmbeddedView(n,e,r){let o,i;"number"==typeof r?o=r:null!=r&&(o=r.index,i=r.injector);const a=n.createEmbeddedView(e||{},i);return this.insert(a,o),a}createComponent(n,e,r,o,i){const a=n&&!function iu(t){return"function"==typeof t}(n);let s;if(a)s=e;else{const d=e||{};s=d.index,r=d.injector,o=d.projectableNodes,i=d.environmentInjector||d.ngModuleRef}const u=a?n:new wu(Ze(n)),c=r||this.parentInjector;if(!i&&null==u.ngModule){const f=(a?c:this.parentInjector).get(Gr,null);f&&(i=f)}const l=u.create(c,o,void 0,i);return this.insert(l.hostView,s),l}insert(n,e){const r=n._lView,o=r[ee];if(function NT(t){return br(t[xt])}(r)){const l=this.indexOf(n);if(-1!==l)this.detach(l);else{const d=r[xt],f=new b_(d,d[ln],d[xt]);f.detach(f.indexOf(n))}}const i=this._adjustIndex(e),a=this._lContainer;!function tk(t,n,e,r){const o=_n+r,i=e.length;r>0&&(e[o-1][yr]=n),r<i-_n?(n[yr]=e[o],kb(e,_n+r,n)):(e.push(n),n[yr]=null),n[xt]=e;const a=n[Js];null!==a&&e!==a&&function nk(t,n){const e=t[Sa];n[dn]!==n[xt][xt][dn]&&(t[q0]=!0),null===e?t[Sa]=[n]:e.push(n)}(a,n);const s=n[Wr];null!==s&&s.insertView(t),n[Me]|=64}(o,r,a,i);const s=rp(i,a),u=r[Ae],c=gl(u,a[Yc]);return null!==c&&function JA(t,n,e,r,o,i){r[Eo]=o,r[ln]=n,hu(t,r,e,1,o,i)}(o,a[ln],u,r,c,s),n.attachToViewContainerRef(),kb(sg(a),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=w_(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),r=ep(this._lContainer,e);r&&(dl(sg(this._lContainer),e),nw(r[ee],r))}detach(n){const e=this._adjustIndex(n,-1),r=ep(this._lContainer,e);return r&&null!=dl(sg(this._lContainer),e)?new bu(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function w_(t){return t[Jc]}function sg(t){return t[Jc]||(t[Jc]=[])}function x_(t,n){let e;const r=n[t.index];if(br(r))e=r;else{let o;if(8&t.type)o=en(r);else{const i=n[Ae];o=i.createComment("");const a=zn(t,n);Gi(i,gl(i,a),o,function ak(t,n){return t.nextSibling(n)}(i,a),!1)}n[t.index]=e=p1(r,n,o,t),Ml(n,e)}return new b_(e,t,n)}class ug{constructor(n){this.queryList=n,this.matches=null}clone(){return new ug(this.queryList)}setDirty(){this.queryList.setDirty()}}class cg{constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const r=null!==n.contentQueries?n.contentQueries[0]:e.length,o=[];for(let i=0;i<r;i++){const a=e.getByIndex(i);o.push(this.queries[a.indexInDeclarationView].clone())}return new cg(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==I_(n,e).matches&&this.queries[e].setDirty()}}class __{constructor(n,e,r=null){this.predicate=n,this.flags=e,this.read=r}}class lg{constructor(n=[]){this.queries=n}elementStart(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let r=0;r<this.length;r++){const o=null!==e?e.length:0,i=this.getByIndex(r).embeddedTView(n,o);i&&(i.indexInDeclarationView=r,null!==e?e.push(i):e=[i])}return null!==e?new lg(e):null}template(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class dg{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new dg(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==e;)r=r.parent;return e===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const i=r[o];this.matchTNodeWithReadOption(n,e,d3(e,i)),this.matchTNodeWithReadOption(n,e,cl(e,n,i,!1,!1))}else r===ko?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,cl(e,n,r,!1,!1))}matchTNodeWithReadOption(n,e,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===Ro||o===Er||o===ko&&4&e.type)this.addMatch(e.index,-2);else{const i=cl(e,n,o,!1,!1);null!==i&&this.addMatch(e.index,i)}else this.addMatch(e.index,r)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function d3(t,n){const e=t.localNames;if(null!==e)for(let r=0;r<e.length;r+=2)if(e[r]===n)return e[r+1];return null}function h3(t,n,e,r){return-1===e?function f3(t,n){return 11&t.type?ja(t,n):4&t.type?$l(t,n):null}(n,t):-2===e?function p3(t,n,e){return e===Ro?ja(n,t):e===ko?$l(n,t):e===Er?x_(n,t):void 0}(t,n,r):zi(t,t[ee],e,n)}function C_(t,n,e,r){const o=n[Wr].queries[r];if(null===o.matches){const i=t.data,a=e.matches,s=[];for(let u=0;u<a.length;u+=2){const c=a[u];s.push(c<0?null:h3(n,i[c],a[u+1],e.metadata.read))}o.matches=s}return o.matches}function fg(t,n,e,r){const o=t.queries.getByIndex(e),i=o.matches;if(null!==i){const a=C_(t,n,o,e);for(let s=0;s<i.length;s+=2){const u=i[s];if(u>0)r.push(a[s/2]);else{const c=i[s+1],l=n[-u];for(let d=_n;d<l.length;d++){const f=l[d];f[Js]===f[xt]&&fg(f[ee],f,c,r)}if(null!==l[Sa]){const d=l[Sa];for(let f=0;f<d.length;f++){const h=d[f];fg(h[ee],h,c,r)}}}}}return r}function Jr(t){const n=G(),e=We(),r=cb();Sh(r+1);const o=I_(e,r);if(t.dirty&&function OT(t){return 4==(4&t[Me])}(n)===(2==(2&o.metadata.flags))){if(null===o.matches)t.reset([]);else{const i=o.crossesNgTemplate?fg(e,n,r,[]):C_(e,n,o,r);t.reset(i,Yk),t.notifyOnChanges()}return!0}return!1}function Po(t,n,e){const r=We();r.firstCreatePass&&(S_(r,new __(t,n,e),-1),2==(2&n)&&(r.staticViewQueries=!0)),E_(r,G(),n)}function Zr(){return function g3(t,n){return t[Wr].queries[n].queryList}(G(),cb())}function E_(t,n,e){const r=new ag(4==(4&e));u1(t,n,r,r.destroy),null===n[Wr]&&(n[Wr]=new cg),n[Wr].queries.push(new ug(r))}function S_(t,n,e){null===t.queries&&(t.queries=new lg),t.queries.track(new dg(n,e))}function I_(t,n){return t.queries.getByIndex(n)}function ql(...t){}const Kl=new fe("Application Initializer");let Xl=(()=>{class t{constructor(e){this.appInits=e,this.resolve=ql,this.reject=ql,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}runInitializers(){if(this.initialized)return;const e=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const i=this.appInits[o]();if(Fl(i))e.push(i);else if(L1(i)){const a=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});e.push(a)}}Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),0===e.length&&r(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(ce(Kl,8))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Au=new fe("AppId",{providedIn:"root",factory:function $_(){return`${yg()}${yg()}${yg()}`}});function yg(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const G_=new fe("Platform Initializer"),bg=new fe("Platform ID",{providedIn:"platform",factory:()=>"unknown"});let L3=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Oo=new fe("LocaleId",{providedIn:"root",factory:()=>Ne(Oo,be.Optional|be.SkipSelf)||function B3(){return typeof $localize<"u"&&$localize.locale||os}()});class V3{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}let q_=(()=>{class t{compileModuleSync(e){return new tg(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const r=this.compileModuleSync(e),i=To(Hn(e).declarations).reduce((a,s)=>{const u=Ze(s);return u&&a.push(new wu(u)),a},[]);return new V3(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const W3=(()=>Promise.resolve(0))();function wg(t){typeof Zone>"u"?W3.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class St{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new gn(!1),this.onMicrotaskEmpty=new gn(!1),this.onStable=new gn(!1),this.onError=new gn(!1),typeof Zone>"u")throw new Q(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&e,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function z3(){let t=lt.requestAnimationFrame,n=lt.cancelAnimationFrame;if(typeof Zone<"u"&&t&&n){const e=t[Zone.__symbol__("OriginalDelegate")];e&&(t=e);const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function q3(t){const n=()=>{!function G3(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(lt,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,_g(t),t.isCheckStableRunning=!0,xg(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),_g(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,o,i,a,s)=>{try{return Q_(t),e.invokeTask(o,i,a,s)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||t.shouldCoalesceRunChangeDetection)&&n(),Y_(t)}},onInvoke:(e,r,o,i,a,s,u)=>{try{return Q_(t),e.invoke(o,i,a,s,u)}finally{t.shouldCoalesceRunChangeDetection&&n(),Y_(t)}},onHasTask:(e,r,o,i)=>{e.hasTask(o,i),r===o&&("microTask"==i.change?(t._hasPendingMicrotasks=i.microTask,_g(t),xg(t)):"macroTask"==i.change&&(t.hasPendingMacrotasks=i.macroTask))},onHandleError:(e,r,o,i)=>(e.handleError(o,i),t.runOutsideAngular(()=>t.onError.emit(i)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!St.isInAngularZone())throw new Q(909,!1)}static assertNotInAngularZone(){if(St.isInAngularZone())throw new Q(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){const i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+o,n,$3,ql,ql);try{return i.runTask(a,e,r)}finally{i.cancelTask(a)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}}const $3={};function xg(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function _g(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Q_(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Y_(t){t._nesting--,xg(t)}class K3{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new gn,this.onMicrotaskEmpty=new gn,this.onStable=new gn,this.onError=new gn}run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}}const J_=new fe(""),Ql=new fe("");let Eg,Cg=(()=>{class t{constructor(e,r,o){this._ngZone=e,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Eg||(function X3(t){Eg=t}(o),o.addToWindow(r)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{St.assertNotInAngularZone(),wg(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())wg(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(e)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,r,o){let i=-1;r&&r>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==i),e(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:e,timeoutId:i,updateCb:o})}whenStable(e,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,r,o){return[]}}return t.\u0275fac=function(e){return new(e||t)(ce(St),ce(Dg),ce(Ql))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),Dg=(()=>{class t{constructor(){this._applications=new Map}registerApplication(e,r){this._applications.set(e,r)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,r=!0){return Eg?.findTestabilityInTree(this,e,r)??null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const No=!1;let fi=null;const Z_=new fe("AllowMultipleToken"),Sg=new fe("PlatformDestroyListeners"),eC=new fe("appBootstrapListener");class tC{constructor(n,e){this.name=n,this.token=e}}function rC(t,n,e=[]){const r=`Platform: ${n}`,o=new fe(r);return(i=[])=>{let a=Ig();if(!a||a.injector.get(Z_,!1)){const s=[...e,...i,{provide:o,useValue:!0}];t?t(s):function J3(t){if(fi&&!fi.get(Z_,!1))throw new Q(400,!1);fi=t;const n=t.get(iC);(function nC(t){const n=t.get(G_,null);n&&n.forEach(e=>e())})(t)}(function oC(t=[],n){return qr.create({name:n,providers:[{provide:vp,useValue:"platform"},{provide:Sg,useValue:new Set([()=>fi=null])},...t]})}(s,r))}return function eL(t){const n=Ig();if(!n)throw new Q(401,!1);return n}()}}function Ig(){return fi?.get(iC)??null}let iC=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,r){const o=function sC(t,n){let e;return e="noop"===t?new K3:("zone.js"===t?void 0:t)||new St(n),e}(r?.ngZone,function aC(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!t||!t.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!t||!t.ngZoneRunCoalescing)||!1}}(r)),i=[{provide:St,useValue:o}];return o.run(()=>{const a=qr.create({providers:i,parent:this.injector,name:e.moduleType.name}),s=e.create(a),u=s.injector.get(Wa,null);if(!u)throw new Q(402,!1);return o.runOutsideAngular(()=>{const c=o.onError.subscribe({next:l=>{u.handleError(l)}});s.onDestroy(()=>{Jl(this._modules,s),c.unsubscribe()})}),function uC(t,n,e){try{const r=e();return Fl(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}(u,o,()=>{const c=s.injector.get(Xl);return c.runInitializers(),c.donePromise.then(()=>(function Ox(t){ir(t,"Expected localeId to be defined"),"string"==typeof t&&(Px=t.toLowerCase().replace(/_/g,"-"))}(s.injector.get(Oo,os)||os),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,r=[]){const o=cC({},r);return function Q3(t,n,e){const r=new tg(e);return Promise.resolve(r)}(0,0,e).then(i=>this.bootstrapModuleFactory(i,o))}_moduleDoBootstrap(e){const r=e.injector.get(Yl);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!e.instance.ngDoBootstrap)throw new Q(-403,!1);e.instance.ngDoBootstrap(r)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Q(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const e=this._injector.get(Sg,null);e&&(e.forEach(r=>r()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(ce(qr))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function cC(t,n){return Array.isArray(n)?n.reduce(cC,t):{...t,...n}}let Yl=(()=>{class t{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(e,r,o){this._zone=e,this._injector=r,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const i=new At(s=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{s.next(this._stable),s.complete()})}),a=new At(s=>{let u;this._zone.runOutsideAngular(()=>{u=this._zone.onStable.subscribe(()=>{St.assertNotInAngularZone(),wg(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,s.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{St.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{s.next(!1)}))});return()=>{u.unsubscribe(),c.unsubscribe()}});this.isStable=function JR(...t){const n=Gs(t),e=function $R(t,n){return"number"==typeof oh(t)?t.pop():n}(t,1/0),r=t;return r.length?1===r.length?mr(r[0]):wa(e)(Vt(r,n)):Ur}(i,a.pipe(function ZR(t={}){const{connector:n=(()=>new Br),resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=t;return i=>{let a,s,u,c=0,l=!1,d=!1;const f=()=>{s?.unsubscribe(),s=void 0},h=()=>{f(),a=u=void 0,l=d=!1},p=()=>{const g=a;h(),g?.unsubscribe()};return Kt((g,v)=>{c++,!d&&!l&&f();const m=u=u??n();v.add(()=>{c--,0===c&&!d&&!l&&(s=ih(p,o))}),m.subscribe(v),!a&&c>0&&(a=new $s({next:b=>m.next(b),error:b=>{d=!0,f(),s=ih(h,e,b),m.error(b)},complete:()=>{l=!0,f(),s=ih(h,r),m.complete()}}),mr(g).subscribe(a))})(i)}}()))}bootstrap(e,r){const o=e instanceof Lw;if(!this._injector.get(Xl).done){!o&&function _a(t){const n=Ze(t)||cn(t)||An(t);return null!==n&&n.standalone}(e);throw new Q(405,No)}let a;a=o?e:this._injector.get(mu).resolveComponentFactory(e),this.componentTypes.push(a.componentType);const s=function Y3(t){return t.isBoundToModule}(a)?void 0:this._injector.get(is),c=a.create(qr.NULL,[],r||a.selector,s),l=c.location.nativeElement,d=c.injector.get(J_,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),Jl(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new Q(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){const r=e;Jl(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const r=this._injector.get(eC,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Jl(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Q(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return t.\u0275fac=function(e){return new(e||t)(ce(St),ce(Gr),ce(Wa))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Jl(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}let Mg=(()=>{class t{}return t.__NG_ELEMENT_ID__=nL,t})();function nL(t){return function rL(t,n,e){if(eu(t)&&!e){const r=$n(t.index,n);return new bu(r,r)}return 47&t.type?new bu(n[dn],n):null}(tn(),G(),16==(16&t))}class pC{constructor(){}supports(n){return kl(n)}create(n){return new cL(n)}}const uL=(t,n)=>n;class cL{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||uL}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){const a=!r||e&&e.currentIndex<vC(r,o,i)?e:r,s=vC(a,o,i),u=a.currentIndex;if(a===r)o--,r=r._nextRemoved;else if(e=e._next,null==a.previousIndex)o++;else{i||(i=[]);const c=s-o,l=u-o;if(c!=l){for(let f=0;f<c;f++){const h=f<i.length?i[f]:i[f]=0,p=h+f;l<=p&&p<c&&(i[f]=h+1)}i[a.previousIndex]=l-c}}s!==u&&n(a,s,u)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!kl(n))throw new Q(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o,i,a,e=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let s=0;s<this.length;s++)i=n[s],a=this._trackByFn(s,i),null!==e&&Object.is(e.trackById,a)?(r&&(e=this._verifyReinsertion(e,i,a,s)),Object.is(e.item,i)||this._addIdentityChange(e,i)):(e=this._mismatch(e,i,a,s),r=!0),e=e._next}else o=0,function PO(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Symbol.iterator]();let r;for(;!(r=e.next()).done;)n(r.value)}}(n,s=>{a=this._trackByFn(o,s),null!==e&&Object.is(e.trackById,a)?(r&&(e=this._verifyReinsertion(e,s,a,o)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,a,o),r=!0),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return null===n?i=this._itTail:(i=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new lL(e,r),i,o),n}_verifyReinsertion(n,e,r,o){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const o=n._prevRemoved,i=n._nextRemoved;return null===o?this._removalsHead=i:o._nextRemoved=i,null===i?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){const o=null===e?this._itHead:e._next;return n._next=o,n._prev=e,null===o?this._itTail=n:o._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new gC),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,r=n._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gC),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class lL{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class dL{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const e=n._prevDup,r=n._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class gC{constructor(){this.map=new Map}put(n){const e=n.trackById;let r=this.map.get(e);r||(r=new dL,this.map.set(e,r)),r.add(n)}get(n,e){const o=this.map.get(n);return o?o.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function vC(t,n,e){const r=t.previousIndex;if(null===r)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}class mC{constructor(){}supports(n){return n instanceof Map||jp(n)}create(){return new fL}}class fL{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||jp(n)))throw new Q(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,o)=>{if(e&&e.key===o)this._maybeAddToChanges(e,r),this._appendAfter=e,e=e._next;else{const i=this._getOrCreateRecordForKey(o,r);e=this._insertBeforeOrAppend(e,i)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let r=e;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const r=n._prev;return e._next=n,e._prev=r,n._prev=e,r&&(r._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const o=this._records.get(n);this._maybeAddToChanges(o,e);const i=o._prev,a=o._next;return i&&(i._next=a),a&&(a._prev=i),o._next=null,o._prev=null,o}const r=new hL(n);return this._records.set(n,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(r=>e(n[r],r))}}class hL{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function yC(){return new td([new pC])}let td=(()=>{class t{constructor(e){this.factories=e}static create(e,r){if(null!=r){const o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||yC()),deps:[[t,new uu,new su]]}}find(e){const r=this.factories.find(o=>o.supports(e));if(null!=r)return r;throw new Q(901,!1)}}return t.\u0275prov=de({token:t,providedIn:"root",factory:yC}),t})();function bC(){return new ku([new mC])}let ku=(()=>{class t{constructor(e){this.factories=e}static create(e,r){if(r){const o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||bC()),deps:[[t,new uu,new su]]}}find(e){const r=this.factories.find(o=>o.supports(e));if(r)return r;throw new Q(901,!1)}}return t.\u0275prov=de({token:t,providedIn:"root",factory:bC}),t})();const vL=rC(null,"core",[]);let mL=(()=>{class t{constructor(e){}}return t.\u0275fac=function(e){return new(e||t)(ce(Yl))},t.\u0275mod=Do({type:t}),t.\u0275inj=Vr({}),t})();function Pg(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}let Og=null;function Zi(){return Og}class wL{}const In=new fe("DocumentToken");let Ng=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return function xL(){return ce(wC)}()},providedIn:"platform"}),t})();const _L=new fe("Location Initialized");let wC=(()=>{class t extends Ng{constructor(e){super(),this._doc=e,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Zi().getBaseHref(this._doc)}onPopState(e){const r=Zi().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){const r=Zi().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){xC()?this._history.pushState(e,r,o):this._location.hash=o}replaceState(e,r,o){xC()?this._history.replaceState(e,r,o):this._location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(ce(In))},t.\u0275prov=de({token:t,factory:function(){return function CL(){return new wC(ce(In))}()},providedIn:"platform"}),t})();function xC(){return!!window.history.pushState}function Fg(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function _C(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function Fo(t){return t&&"?"!==t[0]?"?"+t:t}let ea=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne(DC)},providedIn:"root"}),t})();const CC=new fe("appBaseHref");let DC=(()=>{class t extends ea{constructor(e,r){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Ne(In).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Fg(this._baseHref,e)}path(e=!1){const r=this._platformLocation.pathname+Fo(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){const a=this.prepareExternalUrl(o+Fo(i));this._platformLocation.pushState(e,r,a)}replaceState(e,r,o,i){const a=this.prepareExternalUrl(o+Fo(i));this._platformLocation.replaceState(e,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return t.\u0275fac=function(e){return new(e||t)(ce(Ng),ce(CC,8))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),DL=(()=>{class t extends ea{constructor(e,r){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(e){const r=Fg(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,o,i){let a=this.prepareExternalUrl(o+Fo(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(e,r,a)}replaceState(e,r,o,i){let a=this.prepareExternalUrl(o+Fo(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(e,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return t.\u0275fac=function(e){return new(e||t)(ce(Ng),ce(CC,8))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),Lg=(()=>{class t{constructor(e){this._subject=new gn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const r=this._locationStrategy.getBaseHref();this._basePath=function IL(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(_C(EC(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Fo(r))}normalize(e){return t.stripTrailingSlash(function SL(t,n){if(!t||!n.startsWith(t))return n;const e=n.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:n}(this._basePath,EC(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Fo(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Fo(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r,complete:o})}}return t.normalizeQueryParams=Fo,t.joinWithSlash=Fg,t.stripTrailingSlash=_C,t.\u0275fac=function(e){return new(e||t)(ce(ea))},t.\u0275prov=de({token:t,factory:function(){return function EL(){return new Lg(ce(ea))}()},providedIn:"root"}),t})();function EC(t){return t.replace(/\/index.html$/,"")}function OC(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const r=e.indexOf("="),[o,i]=-1==r?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}class f4{constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let BC=(()=>{class t{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const r=this._viewContainer;e.forEachOperation((o,i,a)=>{if(null==o.previousIndex)r.createEmbeddedView(this._template,new f4(o.item,this._ngForOf,-1,-1),null===a?void 0:a);else if(null==a)r.remove(null===i?void 0:i);else if(null!==i){const s=r.get(i);r.move(s,a),UC(s,o)}});for(let o=0,i=r.length;o<i;o++){const s=r.get(o).context;s.index=o,s.count=i,s.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{UC(r.get(o.currentIndex),o)})}static ngTemplateContextGuard(e,r){return!0}}return t.\u0275fac=function(e){return new(e||t)(he(Er),he(ko),he(td))},t.\u0275dir=xn({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function UC(t,n){t.context.$implicit=n.item}let dd=(()=>{class t{constructor(e,r){this._viewContainer=e,this._context=new p4,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){VC("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){VC("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,r){return!0}}return t.\u0275fac=function(e){return new(e||t)(he(Er),he(ko))},t.\u0275dir=xn({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class p4{constructor(){this.$implicit=null,this.ngIf=null}}function VC(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${ot(n)}'.`)}let HC=(()=>{class t{constructor(e){this.differs=e,this.keyValues=[],this.compareFn=WC}transform(e,r=WC){if(!e||!(e instanceof Map)&&"object"!=typeof e)return null;this.differ||(this.differ=this.differs.find(e).create());const o=this.differ.diff(e),i=r!==this.compareFn;return o&&(this.keyValues=[],o.forEachItem(a=>{this.keyValues.push(function O4(t,n){return{key:t,value:n}}(a.key,a.currentValue))})),(o||i)&&(this.keyValues.sort(r),this.compareFn=r),this.keyValues}}return t.\u0275fac=function(e){return new(e||t)(he(ku,16))},t.\u0275pipe=Tn({name:"keyvalue",type:t,pure:!1,standalone:!0}),t})();function WC(t,n){const e=t.key,r=n.key;if(e===r)return 0;if(void 0===e)return 1;if(void 0===r)return-1;if(null===e)return 1;if(null===r)return-1;if("string"==typeof e&&"string"==typeof r)return e<r?-1:1;if("number"==typeof e&&"number"==typeof r)return e-r;if("boolean"==typeof e&&"boolean"==typeof r)return e<r?-1:1;const o=String(e),i=String(r);return o==i?0:o<i?-1:1}let B4=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Do({type:t}),t.\u0275inj=Vr({}),t})();let H4=(()=>{class t{}return t.\u0275prov=de({token:t,providedIn:"root",factory:()=>new W4(ce(In),window)}),t})();class W4{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function z4(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const i=o.shadowRoot;if(i){const a=i.getElementById(n)||i.querySelector(`[name="${n}"]`);if(a)return a}o=r.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=n)}}scrollToElement(n){const e=n.getBoundingClientRect(),r=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(r-i[0],o-i[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=$C(this.window.history)||$C(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function $C(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class GC{}class mB extends wL{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class ev extends mB{static makeCurrent(){!function bL(t){Og||(Og=t)}(new ev)}onAndCancel(n,e,r){return n.addEventListener(e,r,!1),()=>{n.removeEventListener(e,r,!1)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=function yB(){return Fu=Fu||document.querySelector("base"),Fu?Fu.getAttribute("href"):null}();return null==e?null:function bB(t){pd=pd||document.createElement("a"),pd.setAttribute("href",t);const n=pd.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){Fu=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return OC(document.cookie,n)}}let pd,Fu=null;const YC=new fe("TRANSITION_ID"),xB=[{provide:Kl,useFactory:function wB(t,n,e){return()=>{e.get(Xl).donePromise.then(()=>{const r=Zi(),o=n.querySelectorAll(`style[ng-transition="${t}"]`);for(let i=0;i<o.length;i++)r.remove(o[i])})}},deps:[YC,In,qr],multi:!0}];let CB=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const gd=new fe("EventManagerPlugins");let vd=(()=>{class t{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o){return this._findPluginFor(r).addEventListener(e,r,o)}addGlobalEventListener(e,r,o){return this._findPluginFor(r).addGlobalEventListener(e,r,o)}getZone(){return this._zone}_findPluginFor(e){const r=this._eventNameToPlugin.get(e);if(r)return r;const o=this._plugins;for(let i=0;i<o.length;i++){const a=o[i];if(a.supports(e))return this._eventNameToPlugin.set(e,a),a}throw new Error(`No event manager plugin found for event ${e}`)}}return t.\u0275fac=function(e){return new(e||t)(ce(gd),ce(St))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();class JC{constructor(n){this._doc=n}addGlobalEventListener(n,e,r){const o=Zi().getGlobalEventTarget(this._doc,n);if(!o)throw new Error(`Unsupported event target ${o} for event ${e}`);return this.addEventListener(o,e,r)}}let ZC=(()=>{class t{constructor(){this.usageCount=new Map}addStyles(e){for(const r of e)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(e){for(const r of e)0===this.changeUsageCount(r,-1)&&this.onStyleRemoved(r)}onStyleRemoved(e){}onStyleAdded(e){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(e,r){const o=this.usageCount;let i=o.get(e)??0;return i+=r,i>0?o.set(e,i):o.delete(e),i}ngOnDestroy(){for(const e of this.getAllStyles())this.onStyleRemoved(e);this.usageCount.clear()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),Lu=(()=>{class t extends ZC{constructor(e){super(),this.doc=e,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(e){for(const r of this.hostNodes)this.addStyleToHost(r,e)}onStyleRemoved(e){const r=this.styleRef;r.get(e)?.forEach(i=>i.remove()),r.delete(e)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const r of this.getAllStyles())this.addStyleToHost(e,r)}removeHost(e){this.hostNodes.delete(e)}addStyleToHost(e,r){const o=this.doc.createElement("style");o.textContent=r,e.appendChild(o);const i=this.styleRef.get(r);i?i.push(o):this.styleRef.set(r,[o])}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}}return t.\u0275fac=function(e){return new(e||t)(ce(In))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const tv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},nv=/%COMP%/g,nD=new fe("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function rD(t,n){return n.flat(100).map(e=>e.replace(nv,t))}function oD(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&(n.preventDefault(),n.returnValue=!1)}}let rv=(()=>{class t{constructor(e,r,o,i){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestory=i,this.rendererByCompId=new Map,this.defaultRenderer=new ov(e)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;const o=this.getOrCreateRenderer(e,r);return o instanceof sD?o.applyToHost(e):o instanceof iv&&o.applyStyles(),o}getOrCreateRenderer(e,r){const o=this.rendererByCompId;let i=o.get(r.id);if(!i){const a=this.eventManager,s=this.sharedStylesHost,u=this.removeStylesOnCompDestory;switch(r.encapsulation){case Hr.Emulated:i=new sD(a,s,r,this.appId,u);break;case Hr.ShadowDom:return new TB(a,s,e,r);default:i=new iv(a,s,r,u)}i.onDestroy=()=>o.delete(r.id),o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(ce(vd),ce(Lu),ce(Au),ce(nD))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();class ov{constructor(n){this.eventManager=n,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,e){return e?document.createElementNS(tv[e]||e,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,e){(aD(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(aD(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let r="string"==typeof n?document.querySelector(n):n;if(!r)throw new Error(`The selector "${n}" did not match any elements`);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;const i=tv[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){const o=tv[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(Pn.DashCase|Pn.Important)?n.style.setProperty(e,r,o&Pn.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&Pn.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n[e]=r}setValue(n,e){n.nodeValue=e}listen(n,e,r){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,e,oD(r)):this.eventManager.addEventListener(n,e,oD(r))}}function aD(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class TB extends ov{constructor(n,e,r,o){super(n),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=rD(o.id,o.styles);for(const a of i){const s=document.createElement("style");s.textContent=a,this.shadowRoot.appendChild(s)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class iv extends ov{constructor(n,e,r,o,i=r.id){super(n),this.sharedStylesHost=e,this.removeStylesOnCompDestory=o,this.rendererUsageCount=0,this.styles=rD(i,r.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class sD extends iv{constructor(n,e,r,o,i){const a=o+"-"+r.id;super(n,e,r,i,a),this.contentAttr=function IB(t){return"_ngcontent-%COMP%".replace(nv,t)}(a),this.hostAttr=function MB(t){return"_nghost-%COMP%".replace(nv,t)}(a)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){const r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}}let AB=(()=>{class t extends JC{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o){return e.addEventListener(r,o,!1),()=>this.removeEventListener(e,r,o)}removeEventListener(e,r,o){return e.removeEventListener(r,o)}}return t.\u0275fac=function(e){return new(e||t)(ce(In))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const uD=["alt","control","meta","shift"],kB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},PB={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let OB=(()=>{class t extends JC{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,r,o){const i=t.parseEventName(r),a=t.eventCallback(i.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Zi().onAndCancel(e,i.domEventName,a))}static parseEventName(e){const r=e.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const i=t._normalizeKey(r.pop());let a="",s=r.indexOf("code");if(s>-1&&(r.splice(s,1),a="code."),uD.forEach(c=>{const l=r.indexOf(c);l>-1&&(r.splice(l,1),a+=c+".")}),a+=i,0!=r.length||0===i.length)return null;const u={};return u.domEventName=o,u.fullKey=a,u}static matchEventFullKeyCode(e,r){let o=kB[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),uD.forEach(a=>{a!==o&&(0,PB[a])(e)&&(i+=a+".")}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return t.\u0275fac=function(e){return new(e||t)(ce(In))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const lD=[{provide:bg,useValue:"browser"},{provide:G_,useValue:function NB(){ev.makeCurrent()},multi:!0},{provide:In,useFactory:function LB(){return function pk(t){sp=t}(document),document},deps:[]}],BB=rC(vL,"browser",lD),dD=new fe(""),fD=[{provide:Ql,useClass:class _B{addToWindow(n){lt.getAngularTestability=(r,o=!0)=>{const i=n.findTestabilityInTree(r,o);if(null==i)throw new Error("Could not find testability for element.");return i},lt.getAllAngularTestabilities=()=>n.getAllTestabilities(),lt.getAllAngularRootElements=()=>n.getAllRootElements(),lt.frameworkStabilizers||(lt.frameworkStabilizers=[]),lt.frameworkStabilizers.push(r=>{const o=lt.getAllAngularTestabilities();let i=o.length,a=!1;const s=function(u){a=a||u,i--,0==i&&r(a)};o.forEach(function(u){u.whenStable(s)})})}findTestabilityInTree(n,e,r){return null==e?null:n.getTestability(e)??(r?Zi().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null)}},deps:[]},{provide:J_,useClass:Cg,deps:[St,Dg,Ql]},{provide:Cg,useClass:Cg,deps:[St,Dg,Ql]}],hD=[{provide:vp,useValue:"root"},{provide:Wa,useFactory:function FB(){return new Wa},deps:[]},{provide:gd,useClass:AB,multi:!0,deps:[In,St,bg]},{provide:gd,useClass:OB,multi:!0,deps:[In]},{provide:rv,useClass:rv,deps:[vd,Lu,Au,nD]},{provide:Uw,useExisting:rv},{provide:ZC,useExisting:Lu},{provide:Lu,useClass:Lu,deps:[In]},{provide:vd,useClass:vd,deps:[gd,St]},{provide:GC,useClass:CB,deps:[]},[]];let UB=(()=>{class t{constructor(e){}static withServerTransition(e){return{ngModule:t,providers:[{provide:Au,useValue:e.appId},{provide:YC,useExisting:Au},xB]}}}return t.\u0275fac=function(e){return new(e||t)(ce(dD,12))},t.\u0275mod=Do({type:t}),t.\u0275inj=Vr({providers:[...hD,...fD],imports:[B4,mL]}),t})(),pD=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return t.\u0275fac=function(e){return new(e||t)(ce(In))},t.\u0275prov=de({token:t,factory:function(e){let r=null;return r=e?new e:function jB(){return new pD(ce(In))}(),r},providedIn:"root"}),t})();function md(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}typeof window<"u"&&window;class eo extends Br{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(n){const{hasError:e,_hasValue:r,_value:o,thrownError:i,isStopped:a,_isComplete:s}=this;e?n.error(i):(a||s)&&(r&&n.next(o),n.complete())}next(n){this.isStopped||(this._value=n,this._hasValue=!0)}complete(){const{_hasValue:n,_value:e,_isComplete:r}=this;r||(this._isComplete=!0,n&&super.next(e),super.complete())}}class Kn extends Br{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){const{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}const KB=["video"],XB=["canvas"],QB=["resultsPanel"],bD={audio:!1,video:!0},Bo={src:"",fps:30,vibrate:300,decode:"utf-8",isBeep:!0,deviceActive:0,constraints:bD},at=(t,n,e=null)=>{e?t.error(e):t.next(n),t.complete()},wD=(t=!1)=>{if(!1===t)return;const n=new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"+Array(300).join("101"));n.oncanplaythrough=()=>{const e=n.play();e&&e.catch(r=>{})}},fr=(t,n)=>{const e=n.split(".");for(let r=0;r<e.length;r++){let o=e[r];if(!t.hasOwnProperty(o))return!1;t=t[o]}return!0},xD=(t,n,e)=>{let r,o,i=n.width,a=n.height,s=i/a,u=parseInt(getComputedStyle(n).width),c=parseInt(getComputedStyle(n).height),l=u/c;e.innerHTML="",s>l?(r=u/i,o=u/s/a):(o=c/a,r=c*s/i);for(let d=0;d<t.length;d++){const f=t[d];let h=document.createElement("canvas"),p=h.getContext("2d",{willReadFrequently:!0}),g={},v=[],m=[];const b=f.points;for(let N=0;N<b.length;N++){const W=fr(b,`${N}.x`)?b[N].x:0,H=fr(b,`${N}.y`)?b[N].y:0;g[`x${N+1}`]=W,g[`y${N+1}`]=H,v.push(W),m.push(H)}let y=Math.max(...v),w=Math.min(...v),x=Math.max(...m),_=Math.min(...m);h.setAttribute("class","qrcode-polygon"),s>l?(h.style.top=_*o+.5*(c-u/s)+"px",h.style.left=w*r+"px",h.width=(y-w)*r,h.height=(x-_)*r):(h.style.top=_*o+"px",h.style.left=w*r+.5*(u-c*s)+"px",h.width=(y-w)*o,h.height=(x-_)*o),p.lineWidth=1,p.strokeStyle="green",p.fillStyle="#55f02880";const M=[];for(let N=0;N<v.length;N++)M.push((g[`x${N+1}`]-w)*o),M.push((g[`y${N+1}`]-_)*r);const I=M.slice(0);for(p.beginPath(),p.moveTo(I.shift(),I.shift());I.length;)p.lineTo(I.shift(),I.shift());p.closePath(),p.fill(),p.stroke();const E=document.createElement("div");E.setAttribute("class","qrcode-tooltip-temp"),E.innerText=f.value;const S=`<?xml version="1.0" encoding="utf-8"?><svg version="1.1" class="qrcode-tooltip-clipboard" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${15*r}" x="0px" y="0px" title="Copy value to clipboard" viewBox="0 0 115.77 122.88" xml:space="preserve"><style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style><g><path class="st0" d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path></g></svg> `,k=(new DOMParser).parseFromString(S,"application/xml"),A=E.ownerDocument.importNode(k.documentElement,!0);E.appendChild(A),A.addEventListener("click",()=>window.navigator.clipboard.writeText(f.value));const U=document.createElement("div");U.setAttribute("class","qrcode-tooltip"),U.appendChild(E),o=c/a,r=c*s/i,U.style.fontSize=15*r+"px",U.style.top=_*o+"px",U.style.left=w*r+.5*(u-c*s)+"px",U.style.width=(y-w)*o+"px",U.style.height=(x-_)*o+"px";const B=document.createElement("span");B.innerText=f.value,B.style.fontSize=13*r+"px",B.style.top=_*o+-20*o+"px",B.style.left=w*r+.5*(u-c*s)+"px",e&&(e.appendChild(U),e.appendChild(B),e.appendChild(h))}},_D=(t,n)=>new Promise((e,r)=>t.toBlob(o=>e(o),n)),CD=(t=[],n,e=new eo)=>(Promise.all(Object.assign([],t).map(r=>((t,n)=>{let e=fr(n,"decode")?n.decode:Bo.decode;return new Promise((r,o)=>{const i=new FileReader;i.onload=()=>{const a={name:t.name,file:t,url:URL.createObjectURL(t)},s=new Image;s.setAttribute("crossOrigin","anonymous"),s.onload=()=>md(void 0,void 0,void 0,function*(){const u=document.createElement("canvas");u.width=s.naturalWidth||s.width,u.height=s.naturalHeight||s.height;const c=u.getContext("2d");c.drawImage(s,0,0,u.width,u.height);const l=c.getImageData(0,0,u.width,u.height),d=yield zbarWasm.scanImageData(l);if(d&&d.length){d.forEach(g=>g.value=g.decode(e&&e.toLocaleLowerCase())),((t,n)=>{let e=n.getContext("2d",{willReadFrequently:!0});for(let r=0;r<t.length;r++){const o=t[r];let i={},a=[],s=[];const u=o.points;for(let h=0;h<u.length;h++){const p=fr(u,`${h}.x`)?u[h].x:0,g=fr(u,`${h}.y`)?u[h].y:0;i[`x${h+1}`]=p,i[`y${h+1}`]=g,a.push(p),s.push(g)}let c=Math.min(...a),l=Math.min(...s);e.lineWidth=1,e.strokeStyle="green",e.fillStyle="#55f02880",e.font="15px serif",tU(e,o.value,c,l-5);const d=[];for(let h=0;h<a.length;h++)d.push(i[`x${h+1}`]),d.push(i[`y${h+1}`]);const f=d.slice(0);for(e.beginPath(),e.moveTo(f.shift(),f.shift());f.length;)e.lineTo(f.shift(),f.shift());e.closePath(),e.fill(),e.stroke()}})(d,u);const f=yield _D(u),h=URL.createObjectURL(f);r(Object.assign({},a,{data:d,url:h,canvas:u,file:(g=f,v=a.name,new File([g],v,{lastModified:(new Date).getTime(),type:g.type}))}))}else r(Object.assign({},a,{data:d,canvas:u}));var g,v}),s.src=a.url},i.onerror=a=>o(a),i.readAsDataURL(t)})})(r,n))).then(r=>at(e,r)).catch(r=>at(e,null,r)),e),tU=(t,n,e,r)=>{let o=1.2*t.measureText("M").width,i=n.split("\n");for(var a=0;a<i.length;++a)t.fillText(i[a],e,r),t.strokeText(i[a],e,r),r+=o},DD=t=>{t&&nU()&&window&&window.navigator&&window.navigator.vibrate(t)},nU=()=>{const t=navigator.userAgent||navigator.vendor||window.opera;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4))||/^((?!chrome|android).)*safari/i.test(t))};class Uo{loadFiles(n=[]){const e=new eo;return Promise.all(Object.assign([],n).map(r=>this.readAsDataURL(r))).then(r=>at(e,r)).catch(r=>at(e,null,r)),e}loadFilesToScan(n=[],e){return CD(n,e)}readAsDataURL(n){return new Promise((e,r)=>{const o=new FileReader;o.onload=()=>{const i={name:n.name,file:n,url:URL.createObjectURL(n)};e(i)},o.onerror=i=>r(i),o.readAsDataURL(n)})}}Uo.\u0275fac=function(n){return new(n||Uo)},Uo.\u0275prov=de({token:Uo,factory:Uo.\u0275fac,providedIn:"root"}),Uo.ngInjectableDef=aT({factory:function(){return new Uo},token:Uo,providedIn:"root"});let rU=(()=>{class t{constructor(e){this.renderer=e,this.event=new gn,this.src=Bo.src,this.fps=Bo.fps,this.vibrate=Bo.vibrate,this.decode=Bo.decode,this.isBeep=Bo.isBeep,this.deviceActive=Bo.deviceActive,this.config=Bo,this.constraints=Bo.constraints,this.isStart=!1,this.isLoading=!1,this.isTorch=!1,this.isReady=!1,this.data=new Kn([]),this.devices=new Kn([]),this.dataForResize=[],this.wasmRemote="https://cdn.jsdelivr.net/npm/ngx-scanner-qrcode@latest/wasm/index.js",this.wasmProject="assets/wasm/index.js"}ngOnInit(){this.overrideConfig(),this.addJsToElement().then(()=>{this.src&&this.loadImage(this.src),this.resize(),this.isReady=!0}).catch(()=>{this.isReady=!1})}addJsToElement(){return new Promise((e,r)=>{if(document.querySelectorAll(`script[src="${this.wasmRemote}"]`).length)return e(!0);{document.querySelectorAll(`script[src="${this.wasmProject}"]`).forEach(s=>s.remove());const a=this.renderer.createElement("script");this.renderer.setAttribute(a,"type","text/javascript"),this.renderer.setAttribute(a,"src",this.wasmProject),this.renderer.appendChild(document.body,a),a.onload=()=>e(!0),a.onerror=()=>r(!1)}})}start(){const e=new eo;return this.isStart?at(e,!1):this.safariWebRTC(e),e}playDevice(e,r=new eo){const o=!this.isStart||this.getConstraints().deviceId!=e;switch(!0){case"null"==e||null==e:stop(),this.stop(),at(r,!1);break;case e&&o:stop(),this.stop(!1,!1),clearInterval(this.rAF_ID),this.status(!1,!0);const i={audio:!1,video:"boolean"==typeof(this.constraints&&this.constraints.video)?{deviceId:e}:Object.assign({deviceId:e},this.constraints&&this.constraints.video)};this.deviceActive=this.devices.value.findIndex(a=>a.deviceId==e),navigator.mediaDevices.getUserMedia(i).then(a=>{this.video.nativeElement.srcObject=a,this.video.nativeElement.onloadedmetadata=()=>{this.video.nativeElement.play(),this.requestAnimationFrame(),this.status(!0,!1),at(r,!0)}}).catch(a=>{this.status(!1,!1),this.eventEmit(!1),at(r,!1,a)});break;default:this.status(this.isStart,!1),at(r,!1)}return r}stop(e=!0,r=!0){e&&this.eventEmit(null),r&&this.status(!1,!1);const o=new eo;try{this.removeCanvas(),clearInterval(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(i=>{i.stop(),at(o,!0)})}catch(i){at(o,!1,i)}return o}play(){const e=new eo;return this.isPause?(this.video.nativeElement.play(),this.requestAnimationFrame(),at(e,!0)):at(e,!1),e}pause(){const e=new eo;return this.isStart?(clearInterval(this.rAF_ID),this.video.nativeElement.pause(),at(e,!0)):at(e,!1),e}loadImage(e){const r=new eo;this.status(!1,!0);const o=new Image;return o.setAttribute("crossOrigin","anonymous"),o.onload=()=>{this.drawImage(o,i=>{this.status(!1,!1),at(r,i)})},o.src=e,r}torcher(){const e=this.applyConstraints({torch:this.isTorch});return e.subscribe(()=>!1,()=>this.isTorch=!this.isTorch),e}applyConstraints(e){const r=new eo,i=this.video.nativeElement.srcObject.getVideoTracks()[0];return new window.ImageCapture(i).getPhotoCapabilities().then(()=>md(this,void 0,void 0,function*(){yield i.applyConstraints({advanced:[e]}),at(r,!0)})).catch(s=>{switch(s&&s.name){case"NotFoundError":case"DevicesNotFoundError":at(r,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":at(r,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":at(r,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":at(r,!1,"Permission denied in browser");break;case"TypeError":at(r,!1,"Empty constraints object");break;default:at(r,!1,s)}}),r}getConstraints(){const e=this.video.nativeElement.srcObject,r=e&&e.getVideoTracks()[0];return r&&r.getConstraints()}download(e=`ngx-scanner-qrcode-${Date.now()}.png`){const r=new eo;return(()=>{md(this,void 0,void 0,function*(){const a=((t,n)=>new File([t],n,{lastModified:(new Date).getTime(),type:t.type}))(yield _D(this.canvas.nativeElement),e);CD([a],this.config,r).subscribe(s=>{s.forEach(u=>{const c=document.createElement("a");c.href=u.url,c.download=u.name,c.click(),c.remove()})})})})(),r}resize(){window.addEventListener("resize",()=>{this.dataForResize&&this.dataForResize.length&&xD(this.dataForResize,this.canvas.nativeElement,this.resultsPanel.nativeElement)})}overrideConfig(){fr(this.config,"src")&&(this.src=this.config.src),fr(this.config,"fps")&&(this.fps=this.config.fps),fr(this.config,"vibrate")&&(this.vibrate=this.config.vibrate),fr(this.config,"decode")&&(this.decode=this.config.decode),fr(this.config,"isBeep")&&(this.isBeep=this.config.isBeep),fr(this.config,"deviceActive")&&(this.deviceActive=this.config.deviceActive),fr(this.config,"constraints")&&(this.constraints=((t,n,e)=>{if(n&&Object.keys(n[t]).length){for(const r in e){const o=JSON.parse(JSON.stringify(Object.assign({},n[t],{[r]:e[r]})));n[t]=n[t].hasOwnProperty(r)?n[t]:o}return n[t]}return e})("constraints",this.config,bD))}safariWebRTC(e){this.status(!1,!0),navigator.mediaDevices.getUserMedia(this.constraints).then(r=>{r.getTracks().forEach(o=>o.stop()),this.loadAllDevices(e)}).catch(r=>{this.status(!1,!1),at(e,!1,r)})}loadAllDevices(e){navigator.mediaDevices.enumerateDevices().then(r=>{let o=[];if(r.forEach(i=>"videoinput"==i.kind&&o.push(i)),this.devices.next(o),o.length>0){const i=Math.max(0,o.length>this.deviceActive?this.deviceActive:0);this.playDevice(o[i].deviceId,e)}else this.status(!1,!1),at(e,!1,"No camera detected.")}).catch(r=>{this.status(!1,!1),at(e,!1,r)})}drawImage(e,r=(()=>{})){return md(this,void 0,void 0,function*(){const o=this.canvas.nativeElement,i=o.getContext("2d",{willReadFrequently:!0});e instanceof HTMLImageElement&&(o.width=e.naturalWidth,o.height=e.naturalHeight,e.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.video.nativeElement.style.height=o.offsetHeight+"px"),e instanceof HTMLVideoElement&&(o.width=e.videoWidth,o.height=e.videoHeight,e.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),i.clearRect(0,0,o.width,o.height),i.drawImage(e,0,0,o.width,o.height);const a=i.getImageData(0,0,o.width,o.height),s=yield zbarWasm.scanImageData(a);if(s&&s.length){s.forEach(c=>c.value=c.decode(this.decode&&this.decode.toLocaleLowerCase())),xD(s,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement);const u=()=>{this.eventEmit(s),this.dataForResize=s};e instanceof HTMLImageElement&&(r(!0),u(),DD(this.vibrate),wD(this.isBeep)),e instanceof HTMLVideoElement&&(u(),DD(this.vibrate),wD(this.isBeep))}else r(!1),this.removeCanvas(),this.dataForResize=s})}removeCanvas(){Object.assign([],this.resultsPanel.nativeElement.childNodes).forEach(e=>this.resultsPanel.nativeElement.removeChild(e))}status(e,r){this.isStart=e,this.isLoading=r}eventEmit(e=!1){!1!==e&&this.data.next(e||{data:null}),!1!==e&&this.event.emit(e||{data:null})}requestAnimationFrame(){this.rAF_ID=setInterval(()=>{this.video.nativeElement.readyState===this.video.nativeElement.HAVE_ENOUGH_DATA&&this.drawImage(this.video.nativeElement)},this.fps)}get isPause(){return this.isStart&&this.video.nativeElement.paused}ngOnDestroy(){this.pause()}}return t.\u0275fac=function(e){return new(e||t)(he(Ha))},t.\u0275cmp=ai({type:t,selectors:[["ngx-scanner-qrcode"]],viewQuery:function(e,r){if(1&e&&(Po(KB,5),Po(XB,5),Po(QB,5)),2&e){let o;Jr(o=Zr())&&(r.video=o.first),Jr(o=Zr())&&(r.canvas=o.first),Jr(o=Zr())&&(r.resultsPanel=o.first)}},hostAttrs:[1,"ngx-scanner-qrcode"],inputs:{src:"src",fps:"fps",vibrate:"vibrate",decode:"decode",isBeep:"isBeep",deviceActive:"deviceActive",config:"config",constraints:"constraints"},outputs:{event:"event"},exportAs:["scanner"],decls:6,vars:0,consts:[[1,"origin-overlay"],["resultsPanel",""],[1,"origin-canvas"],["canvas",""],["playsinline","",1,"origin-video"],["video",""]],template:function(e,r){1&e&&re(0,"div",0,1)(2,"canvas",2,3)(4,"video",4,5)},styles:[".ngx-scanner-qrcode{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;color:red;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute}.qrcode-tooltip-temp{bottom:0;left:50%;padding:5px;color:#fff;text-align:left;display:none;max-width:450px;border-radius:5px;width:-moz-max-content;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip-temp .qrcode-tooltip-clipboard{cursor:pointer;margin-left:5px;fill:#fff}.qrcode-tooltip-temp .qrcode-tooltip-clipboard:active{fill:#afafaf}"],encapsulation:2}),t})();const me={ScannerQRCode_NONE:0,ScannerQRCode_PARTIAL:1,ScannerQRCode_EAN2:2,ScannerQRCode_EAN5:5,ScannerQRCode_EAN8:8,ScannerQRCode_UPCE:9,ScannerQRCode_ISBN10:10,ScannerQRCode_UPCA:12,ScannerQRCode_EAN13:13,ScannerQRCode_ISBN13:14,ScannerQRCode_COMPOSITE:15,ScannerQRCode_I25:25,ScannerQRCode_DATABAR:34,ScannerQRCode_DATABAR_EXP:35,ScannerQRCode_CODABAR:38,ScannerQRCode_CODE39:39,ScannerQRCode_PDF417:57,ScannerQRCode_QRCODE:64,ScannerQRCode_SQCODE:80,ScannerQRCode_CODE93:93,ScannerQRCode_CODE128:128,ScannerQRCode_SYMBOL:255,ScannerQRCode_ADDON2:512,ScannerQRCode_ADDON5:1280,ScannerQRCode_ADDON:1792};me[me.ScannerQRCode_NONE]="ScannerQRCode_NONE",me[me.ScannerQRCode_PARTIAL]="ScannerQRCode_PARTIAL",me[me.ScannerQRCode_EAN2]="ScannerQRCode_EAN2",me[me.ScannerQRCode_EAN5]="ScannerQRCode_EAN5",me[me.ScannerQRCode_EAN8]="ScannerQRCode_EAN8",me[me.ScannerQRCode_UPCE]="ScannerQRCode_UPCE",me[me.ScannerQRCode_ISBN10]="ScannerQRCode_ISBN10",me[me.ScannerQRCode_UPCA]="ScannerQRCode_UPCA",me[me.ScannerQRCode_EAN13]="ScannerQRCode_EAN13",me[me.ScannerQRCode_ISBN13]="ScannerQRCode_ISBN13",me[me.ScannerQRCode_COMPOSITE]="ScannerQRCode_COMPOSITE",me[me.ScannerQRCode_I25]="ScannerQRCode_I25",me[me.ScannerQRCode_DATABAR]="ScannerQRCode_DATABAR",me[me.ScannerQRCode_DATABAR_EXP]="ScannerQRCode_DATABAR_EXP",me[me.ScannerQRCode_CODABAR]="ScannerQRCode_CODABAR",me[me.ScannerQRCode_CODE39]="ScannerQRCode_CODE39",me[me.ScannerQRCode_PDF417]="ScannerQRCode_PDF417",me[me.ScannerQRCode_QRCODE]="ScannerQRCode_QRCODE",me[me.ScannerQRCode_SQCODE]="ScannerQRCode_SQCODE",me[me.ScannerQRCode_CODE93]="ScannerQRCode_CODE93",me[me.ScannerQRCode_CODE128]="ScannerQRCode_CODE128",me[me.ScannerQRCode_SYMBOL]="ScannerQRCode_SYMBOL",me[me.ScannerQRCode_ADDON2]="ScannerQRCode_ADDON2",me[me.ScannerQRCode_ADDON5]="ScannerQRCode_ADDON5",me[me.ScannerQRCode_ADDON]="ScannerQRCode_ADDON";const st={ScannerQRCode_CFG_ENABLE:0,ScannerQRCode_CFG_ADD_CHECK:1,ScannerQRCode_CFG_EMIT_CHECK:2,ScannerQRCode_CFG_ASCII:3,ScannerQRCode_CFG_BINARY:4,ScannerQRCode_CFG_NUM:5,ScannerQRCode_CFG_MIN_LEN:32,ScannerQRCode_CFG_MAX_LEN:33,ScannerQRCode_CFG_UNCERTAINTY:64,ScannerQRCode_CFG_POSITION:128,ScannerQRCode_CFG_TEST_INVERTED:129,ScannerQRCode_CFG_X_DENSITY:256,ScannerQRCode_CFG_Y_DENSITY:257};st[st.ScannerQRCode_CFG_ENABLE]="ScannerQRCode_CFG_ENABLE",st[st.ScannerQRCode_CFG_ADD_CHECK]="ScannerQRCode_CFG_ADD_CHECK",st[st.ScannerQRCode_CFG_EMIT_CHECK]="ScannerQRCode_CFG_EMIT_CHECK",st[st.ScannerQRCode_CFG_ASCII]="ScannerQRCode_CFG_ASCII",st[st.ScannerQRCode_CFG_BINARY]="ScannerQRCode_CFG_BINARY",st[st.ScannerQRCode_CFG_NUM]="ScannerQRCode_CFG_NUM",st[st.ScannerQRCode_CFG_MIN_LEN]="ScannerQRCode_CFG_MIN_LEN",st[st.ScannerQRCode_CFG_MAX_LEN]="ScannerQRCode_CFG_MAX_LEN",st[st.ScannerQRCode_CFG_UNCERTAINTY]="ScannerQRCode_CFG_UNCERTAINTY",st[st.ScannerQRCode_CFG_POSITION]="ScannerQRCode_CFG_POSITION",st[st.ScannerQRCode_CFG_TEST_INVERTED]="ScannerQRCode_CFG_TEST_INVERTED",st[st.ScannerQRCode_CFG_X_DENSITY]="ScannerQRCode_CFG_X_DENSITY",st[st.ScannerQRCode_CFG_Y_DENSITY]="ScannerQRCode_CFG_Y_DENSITY";const to={ScannerQRCode_ORIENT_UNKNOWN:-1,ScannerQRCode_ORIENT_UP:0,ScannerQRCode_ORIENT_RIGHT:1,ScannerQRCode_ORIENT_DOWN:2,ScannerQRCode_ORIENT_LEFT:3};to[to.ScannerQRCode_ORIENT_UNKNOWN]="ScannerQRCode_ORIENT_UNKNOWN",to[to.ScannerQRCode_ORIENT_UP]="ScannerQRCode_ORIENT_UP",to[to.ScannerQRCode_ORIENT_RIGHT]="ScannerQRCode_ORIENT_RIGHT",to[to.ScannerQRCode_ORIENT_DOWN]="ScannerQRCode_ORIENT_DOWN",to[to.ScannerQRCode_ORIENT_LEFT]="ScannerQRCode_ORIENT_LEFT";let iU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Do({type:t}),t.\u0275inj=Vr({providers:[Uo]}),t})();function ge(...t){return Vt(t,Gs(t))}function pi(t,n){return ct(n)?Zt(t,n,1):Zt(t,1)}function Vo(t,n){return Kt((e,r)=>{let o=0;e.subscribe(Xt(r,i=>t.call(n,i,o++)&&r.next(i)))})}class bd{}class lv{}class jo{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(e=>{const r=e.indexOf(":");if(r>0){const o=e.slice(0,r),i=o.toLowerCase(),a=e.slice(r+1).trim();this.maybeSetNormalizedName(o,i),this.headers.has(i)?this.headers.get(i).push(a):this.headers.set(i,[a])}})}:()=>{this.headers=new Map,Object.keys(n).forEach(e=>{let r=n[e];const o=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(o,r),this.maybeSetNormalizedName(e,o))})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof jo?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){const e=new jo;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof jo?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){const e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,e);const o=("a"===n.op?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":const i=n.value;if(i){let a=this.headers.get(e);if(!a)return;a=a.filter(s=>-1===i.indexOf(s)),0===a.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,a)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}}class aU{encodeKey(n){return SD(n)}encodeValue(n){return SD(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const uU=/%(\d[a-f0-9])/gi,cU={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function SD(t){return encodeURIComponent(t).replace(uU,(n,e)=>cU[e]??n)}function wd(t){return`${t}`}class gi{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new aU,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function sU(t,n){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{const i=o.indexOf("="),[a,s]=-1==i?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],u=e.get(a)||[];u.push(s),e.set(a,u)}),e}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{const r=n.fromObject[e],o=Array.isArray(r)?r.map(wd):[wd(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){const e=[];return Object.keys(n).forEach(r=>{const o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const e=new gi({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const e=("a"===n.op?this.map.get(n.param):void 0)||[];e.push(wd(n.value)),this.map.set(n.param,e);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const o=r.indexOf(wd(n.value));-1!==o&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class lU{constructor(){this.map=new Map}set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function ID(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function MD(t){return typeof Blob<"u"&&t instanceof Blob}function RD(t){return typeof FormData<"u"&&t instanceof FormData}class Bu{constructor(n,e,r,o){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function dU(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new jo),this.context||(this.context=new lU),this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=e;else{const s=e.indexOf("?");this.urlWithParams=e+(-1===s?"?":s<e.length-1?"&":"")+a}}else this.params=new gi,this.urlWithParams=e}serializeBody(){return null===this.body?null:ID(this.body)||MD(this.body)||RD(this.body)||function fU(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof gi?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||RD(this.body)?null:MD(this.body)?this.body.type||null:ID(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof gi?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=void 0!==n.body?n.body:this.body,a=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,s=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let u=n.headers||this.headers,c=n.params||this.params;const l=n.context??this.context;return void 0!==n.setHeaders&&(u=Object.keys(n.setHeaders).reduce((d,f)=>d.set(f,n.setHeaders[f]),u)),n.setParams&&(c=Object.keys(n.setParams).reduce((d,f)=>d.set(f,n.setParams[f]),c)),new Bu(e,r,i,{params:c,headers:u,context:l,reportProgress:s,responseType:o,withCredentials:a})}}var Nt=(()=>((Nt=Nt||{})[Nt.Sent=0]="Sent",Nt[Nt.UploadProgress=1]="UploadProgress",Nt[Nt.ResponseHeader=2]="ResponseHeader",Nt[Nt.DownloadProgress=3]="DownloadProgress",Nt[Nt.Response=4]="Response",Nt[Nt.User=5]="User",Nt))();class dv{constructor(n,e=200,r="OK"){this.headers=n.headers||new jo,this.status=void 0!==n.status?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class fv extends dv{constructor(n={}){super(n),this.type=Nt.ResponseHeader}clone(n={}){return new fv({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class xd extends dv{constructor(n={}){super(n),this.type=Nt.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new xd({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class TD extends dv{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function hv(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let AD=(()=>{class t{constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof Bu)i=e;else{let u,c;u=o.headers instanceof jo?o.headers:new jo(o.headers),o.params&&(c=o.params instanceof gi?o.params:new gi({fromObject:o.params})),i=new Bu(e,r,void 0!==o.body?o.body:null,{headers:u,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const a=ge(i).pipe(pi(u=>this.handler.handle(u)));if(e instanceof Bu||"events"===o.observe)return a;const s=a.pipe(Vo(u=>u instanceof xd));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return s.pipe(ke(u=>{if(null!==u.body&&!(u.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return u.body}));case"blob":return s.pipe(ke(u=>{if(null!==u.body&&!(u.body instanceof Blob))throw new Error("Response is not a Blob.");return u.body}));case"text":return s.pipe(ke(u=>{if(null!==u.body&&"string"!=typeof u.body)throw new Error("Response is not a string.");return u.body}));default:return s.pipe(ke(u=>u.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:(new gi).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,hv(o,r))}post(e,r,o={}){return this.request("POST",e,hv(o,r))}put(e,r,o={}){return this.request("PUT",e,hv(o,r))}}return t.\u0275fac=function(e){return new(e||t)(ce(bd))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();function kD(t,n){return n(t)}function hU(t,n){return(e,r)=>n.intercept(e,{handle:o=>t(o,r)})}const gU=new fe("HTTP_INTERCEPTORS"),Uu=new fe("HTTP_INTERCEPTOR_FNS");function vU(){let t=null;return(n,e)=>(null===t&&(t=(Ne(gU,{optional:!0})??[]).reduceRight(hU,kD)),t(n,e))}let PD=(()=>{class t extends bd{constructor(e,r){super(),this.backend=e,this.injector=r,this.chain=null}handle(e){if(null===this.chain){const r=Array.from(new Set(this.injector.get(Uu)));this.chain=r.reduceRight((o,i)=>function pU(t,n,e){return(r,o)=>e.runInContext(()=>n(r,i=>t(i,o)))}(o,i,this.injector),kD)}return this.chain(e,r=>this.backend.handle(r))}}return t.\u0275fac=function(e){return new(e||t)(ce(lv),ce(Gr))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const wU=/^\)\]\}',?\n/;let ND=(()=>{class t{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new At(r=>{const o=this.xhrFactory.build();if(o.open(e.method,e.urlWithParams),e.withCredentials&&(o.withCredentials=!0),e.headers.forEach((h,p)=>o.setRequestHeader(h,p.join(","))),e.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const h=e.detectContentTypeHeader();null!==h&&o.setRequestHeader("Content-Type",h)}if(e.responseType){const h=e.responseType.toLowerCase();o.responseType="json"!==h?h:"text"}const i=e.serializeBody();let a=null;const s=()=>{if(null!==a)return a;const h=o.statusText||"OK",p=new jo(o.getAllResponseHeaders()),g=function xU(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(o)||e.url;return a=new fv({headers:p,status:o.status,statusText:h,url:g}),a},u=()=>{let{headers:h,status:p,statusText:g,url:v}=s(),m=null;204!==p&&(m=typeof o.response>"u"?o.responseText:o.response),0===p&&(p=m?200:0);let b=p>=200&&p<300;if("json"===e.responseType&&"string"==typeof m){const y=m;m=m.replace(wU,"");try{m=""!==m?JSON.parse(m):null}catch(w){m=y,b&&(b=!1,m={error:w,text:m})}}b?(r.next(new xd({body:m,headers:h,status:p,statusText:g,url:v||void 0})),r.complete()):r.error(new TD({error:m,headers:h,status:p,statusText:g,url:v||void 0}))},c=h=>{const{url:p}=s(),g=new TD({error:h,status:o.status||0,statusText:o.statusText||"Unknown Error",url:p||void 0});r.error(g)};let l=!1;const d=h=>{l||(r.next(s()),l=!0);let p={type:Nt.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),"text"===e.responseType&&o.responseText&&(p.partialText=o.responseText),r.next(p)},f=h=>{let p={type:Nt.UploadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),r.next(p)};return o.addEventListener("load",u),o.addEventListener("error",c),o.addEventListener("timeout",c),o.addEventListener("abort",c),e.reportProgress&&(o.addEventListener("progress",d),null!==i&&o.upload&&o.upload.addEventListener("progress",f)),o.send(i),r.next({type:Nt.Sent}),()=>{o.removeEventListener("error",c),o.removeEventListener("abort",c),o.removeEventListener("load",u),o.removeEventListener("timeout",c),e.reportProgress&&(o.removeEventListener("progress",d),null!==i&&o.upload&&o.upload.removeEventListener("progress",f)),o.readyState!==o.DONE&&o.abort()}})}}return t.\u0275fac=function(e){return new(e||t)(ce(GC))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();const pv=new fe("XSRF_ENABLED"),FD=new fe("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),LD=new fe("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class BD{}let DU=(()=>{class t{constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=OC(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return t.\u0275fac=function(e){return new(e||t)(ce(In),ce(bg),ce(FD))},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();function EU(t,n){const e=t.url.toLowerCase();if(!Ne(pv)||"GET"===t.method||"HEAD"===t.method||e.startsWith("http://")||e.startsWith("https://"))return n(t);const r=Ne(BD).getToken(),o=Ne(LD);return null!=r&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var Rt=(()=>((Rt=Rt||{})[Rt.Interceptors=0]="Interceptors",Rt[Rt.LegacyInterceptors=1]="LegacyInterceptors",Rt[Rt.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Rt[Rt.NoXsrfProtection=3]="NoXsrfProtection",Rt[Rt.JsonpSupport=4]="JsonpSupport",Rt[Rt.RequestsMadeViaParent=5]="RequestsMadeViaParent",Rt))();function us(t,n){return{\u0275kind:t,\u0275providers:n}}function SU(...t){const n=[AD,ND,PD,{provide:bd,useExisting:PD},{provide:lv,useExisting:ND},{provide:Uu,useValue:EU,multi:!0},{provide:pv,useValue:!0},{provide:BD,useClass:DU}];for(const e of t)n.push(...e.\u0275providers);return function Lk(t){return{\u0275providers:t}}(n)}const UD=new fe("LEGACY_INTERCEPTOR_FN");let MU=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Do({type:t}),t.\u0275inj=Vr({providers:[SU(us(Rt.LegacyInterceptors,[{provide:UD,useFactory:vU},{provide:Uu,useExisting:UD,multi:!0}]))]}),t})();const _d=Xf(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:RU}=Array,{getPrototypeOf:TU,prototype:AU,keys:kU}=Object;const{isArray:NU}=Array;function VD(...t){const n=Gs(t),e=function zR(t){return ct(oh(t))?t.pop():void 0}(t),{args:r,keys:o}=function PU(t){if(1===t.length){const n=t[0];if(RU(n))return{args:n,keys:null};if(function OU(t){return t&&"object"==typeof t&&TU(t)===AU}(n)){const e=kU(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}(t);if(0===r.length)return Vt([],n);const i=new At(function UU(t,n,e=Bi){return r=>{jD(n,()=>{const{length:o}=t,i=new Array(o);let a=o,s=o;for(let u=0;u<o;u++)jD(n,()=>{const c=Vt(t[u],n);let l=!1;c.subscribe(Xt(r,d=>{i[u]=d,l||(l=!0,s--),s||r.next(e(i.slice()))},()=>{--a||r.complete()}))},r)},r)}}(r,n,o?a=>function BU(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}(o,a):Bi));return e?i.pipe(function LU(t){return ke(n=>function FU(t,n){return NU(n)?t(...n):t(n)}(t,n))}(e)):i}function jD(t,n,e){t?wo(e,t,n):n()}function gv(...t){return function VU(){return wa(1)}()(Vt(t,Gs(t)))}function HD(t){return new At(n=>{mr(t()).subscribe(n)})}function Vu(t,n){const e=ct(t)?t:()=>t,r=o=>o.error(e());return new At(n?o=>n.schedule(r,0,o):r)}function vv(){return Kt((t,n)=>{let e=null;t._refCount++;const r=Xt(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}class WD extends At{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,m0(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new or;const e=this.getSubject();n.add(this.source.subscribe(Xt(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=or.EMPTY)}return n}refCount(){return vv()(this)}}function no(t,n){return Kt((e,r)=>{let o=null,i=0,a=!1;const s=()=>a&&!o&&r.complete();e.subscribe(Xt(r,u=>{o?.unsubscribe();let c=0;const l=i++;mr(t(u,l)).subscribe(o=Xt(r,d=>r.next(n?n(u,d,l,c++):d),()=>{o=null,s()}))},()=>{a=!0,s()}))})}function ju(t){return t<=0?()=>Ur:Kt((n,e)=>{let r=0;n.subscribe(Xt(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function Cd(t){return Kt((n,e)=>{let r=!1;n.subscribe(Xt(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function zD(t=HU){return Kt((n,e)=>{let r=!1;n.subscribe(Xt(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function HU(){return new _d}function vi(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Vo((o,i)=>t(o,i,r)):Bi,ju(1),e?Cd(n):zD(()=>new _d))}function vn(t,n,e){const r=ct(t)||n||e?{next:t,error:n,complete:e}:t;return r?Kt((o,i)=>{var a;null===(a=r.subscribe)||void 0===a||a.call(r);let s=!0;o.subscribe(Xt(i,u=>{var c;null===(c=r.next)||void 0===c||c.call(r,u),i.next(u)},()=>{var u;s=!1,null===(u=r.complete)||void 0===u||u.call(r),i.complete()},u=>{var c;s=!1,null===(c=r.error)||void 0===c||c.call(r,u),i.error(u)},()=>{var u,c;s&&(null===(u=r.unsubscribe)||void 0===u||u.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):Bi}function mi(t){return Kt((n,e)=>{let i,r=null,o=!1;r=n.subscribe(Xt(e,void 0,void 0,a=>{i=mr(t(a,mi(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function $D(t,n){return Kt(function WU(t,n,e,r,o){return(i,a)=>{let s=e,u=n,c=0;i.subscribe(Xt(a,l=>{const d=c++;u=s?t(u,l,d):(s=!0,l),r&&a.next(u)},o&&(()=>{s&&a.next(u),a.complete()})))}}(t,n,arguments.length>=2,!0))}function mv(t){return t<=0?()=>Ur:Kt((n,e)=>{let r=[];n.subscribe(Xt(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(const o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function GD(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Vo((o,i)=>t(o,i,r)):Bi,mv(1),e?Cd(n):zD(()=>new _d))}function yv(t){return Kt((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}const Ie="primary",Hu=Symbol("RouteTitle");class GU{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function cs(t){return new GU(t)}function qU(t,n,e){const r=e.path.split("/");if(r.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||r.length<t.length))return null;const o={};for(let i=0;i<r.length;i++){const a=r[i],s=t[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function ro(t,n){const e=t?Object.keys(t):void 0,r=n?Object.keys(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!qD(t[o],n[o]))return!1;return!0}function qD(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}return t===n}function KD(t){return Array.prototype.concat.apply([],t)}function XD(t){return t.length>0?t[t.length-1]:null}function nn(t,n){for(const e in t)t.hasOwnProperty(e)&&n(t[e],e)}function yi(t){return L1(t)?t:Fl(t)?Vt(Promise.resolve(t)):ge(t)}const Dd=!1,XU={exact:function JD(t,n,e){if(!ta(t.segments,n.segments)||!Ed(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!t.children[r]||!JD(t.children[r],n.children[r],e))return!1;return!0},subset:ZD},QD={exact:function QU(t,n){return ro(t,n)},subset:function YU(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>qD(t[e],n[e]))},ignored:()=>!0};function YD(t,n,e){return XU[e.paths](t.root,n.root,e.matrixParams)&&QD[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function ZD(t,n,e){return eE(t,n,n.segments,e)}function eE(t,n,e,r){if(t.segments.length>e.length){const o=t.segments.slice(0,e.length);return!(!ta(o,e)||n.hasChildren()||!Ed(o,e,r))}if(t.segments.length===e.length){if(!ta(t.segments,e)||!Ed(t.segments,e,r))return!1;for(const o in n.children)if(!t.children[o]||!ZD(t.children[o],n.children[o],r))return!1;return!0}{const o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!!(ta(t.segments,o)&&Ed(t.segments,o,r)&&t.children[Ie])&&eE(t.children[Ie],n,i,r)}}function Ed(t,n,e){return n.every((r,o)=>QD[e](t[o].parameters,r.parameters))}class bi{constructor(n=new Fe([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=cs(this.queryParams)),this._queryParamMap}toString(){return eV.serialize(this)}}class Fe{constructor(n,e){this.segments=n,this.children=e,this.parent=null,nn(e,(r,o)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Sd(this)}}class Wu{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=cs(this.parameters)),this._parameterMap}toString(){return rE(this)}}function ta(t,n){return t.length===n.length&&t.every((e,r)=>e.path===n[r].path)}let zu=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return new bv},providedIn:"root"}),t})();class bv{parse(n){const e=new cV(n);return new bi(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){const e=`/${$u(n.root,!0)}`,r=function rV(t){const n=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(o=>`${Id(e)}=${Id(o)}`).join("&"):`${Id(e)}=${Id(r)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${e}${r}${"string"==typeof n.fragment?`#${function tV(t){return encodeURI(t)}(n.fragment)}`:""}`}}const eV=new bv;function Sd(t){return t.segments.map(n=>rE(n)).join("/")}function $u(t,n){if(!t.hasChildren())return Sd(t);if(n){const e=t.children[Ie]?$u(t.children[Ie],!1):"",r=[];return nn(t.children,(o,i)=>{i!==Ie&&r.push(`${i}:${$u(o,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}{const e=function ZU(t,n){let e=[];return nn(t.children,(r,o)=>{o===Ie&&(e=e.concat(n(r,o)))}),nn(t.children,(r,o)=>{o!==Ie&&(e=e.concat(n(r,o)))}),e}(t,(r,o)=>o===Ie?[$u(t.children[Ie],!1)]:[`${o}:${$u(r,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[Ie]?`${Sd(t)}/${e[0]}`:`${Sd(t)}/(${e.join("//")})`}}function tE(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Id(t){return tE(t).replace(/%3B/gi,";")}function wv(t){return tE(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Md(t){return decodeURIComponent(t)}function nE(t){return Md(t.replace(/\+/g,"%20"))}function rE(t){return`${wv(t.path)}${function nV(t){return Object.keys(t).map(n=>`;${wv(n)}=${wv(t[n])}`).join("")}(t.parameters)}`}const oV=/^[^\/()?;=#]+/;function Rd(t){const n=t.match(oV);return n?n[0]:""}const iV=/^[^=?&#]+/,sV=/^[^&#]+/;class cV{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Fe([],{}):new Fe([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[Ie]=new Fe(n,e)),r}parseSegment(){const n=Rd(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Q(4009,Dd);return this.capture(n),new Wu(Md(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=Rd(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const o=Rd(this.remaining);o&&(r=o,this.capture(r))}n[Md(e)]=Md(r)}parseQueryParam(n){const e=function aV(t){const n=t.match(iV);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const a=function uV(t){const n=t.match(sV);return n?n[0]:""}(this.remaining);a&&(r=a,this.capture(r))}const o=nE(e),i=nE(r);if(n.hasOwnProperty(o)){let a=n[o];Array.isArray(a)||(a=[a],n[o]=a),a.push(i)}else n[o]=i}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Rd(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new Q(4010,Dd);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=Ie);const a=this.parseChildren();e[i]=1===Object.keys(a).length?a[Ie]:new Fe([],a),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Q(4011,Dd)}}function xv(t){return t.segments.length>0?new Fe([],{[Ie]:t}):t}function Td(t){const n={};for(const r of Object.keys(t.children)){const i=Td(t.children[r]);(i.segments.length>0||i.hasChildren())&&(n[r]=i)}return function lV(t){if(1===t.numberOfChildren&&t.children[Ie]){const n=t.children[Ie];return new Fe(t.segments.concat(n.segments),n.children)}return t}(new Fe(t.segments,n))}function na(t){return t instanceof bi}const _v=!1;function dV(t,n,e,r,o){if(0===e.length)return ls(n.root,n.root,n.root,r,o);const i=function uE(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new sE(!0,0,t);let n=0,e=!1;const r=t.reduce((o,i,a)=>{if("object"==typeof i&&null!=i){if(i.outlets){const s={};return nn(i.outlets,(u,c)=>{s[c]="string"==typeof u?u.split("/"):u}),[...o,{outlets:s}]}if(i.segmentPath)return[...o,i.segmentPath]}return"string"!=typeof i?[...o,i]:0===a?(i.split("/").forEach((s,u)=>{0==u&&"."===s||(0==u&&""===s?e=!0:".."===s?n++:""!=s&&o.push(s))}),o):[...o,i]},[]);return new sE(e,n,r)}(e);return i.toRoot()?ls(n.root,n.root,new Fe([],{}),r,o):function a(u){const c=function hV(t,n,e,r){if(t.isAbsolute)return new ds(n.root,!0,0);if(-1===r)return new ds(e,e===n.root,0);return function cE(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new Q(4005,_v&&"Invalid number of '../'");o=r.segments.length}return new ds(r,!1,o-i)}(e,r+(Gu(t.commands[0])?0:1),t.numberOfDoubleDots)}(i,n,t.snapshot?._urlSegment,u),l=c.processChildren?fs(c.segmentGroup,c.index,i.commands):Cv(c.segmentGroup,c.index,i.commands);return ls(n.root,c.segmentGroup,l,r,o)}(t.snapshot?._lastPathIndex)}function Gu(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function qu(t){return"object"==typeof t&&null!=t&&t.outlets}function ls(t,n,e,r,o){let a,i={};r&&nn(r,(u,c)=>{i[c]=Array.isArray(u)?u.map(l=>`${l}`):`${u}`}),a=t===n?e:aE(t,n,e);const s=xv(Td(a));return new bi(s,i,o)}function aE(t,n,e){const r={};return nn(t.children,(o,i)=>{r[i]=o===n?e:aE(o,n,e)}),new Fe(t.segments,r)}class sE{constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Gu(r[0]))throw new Q(4003,_v&&"Root segment cannot have matrix parameters");const o=r.find(qu);if(o&&o!==XD(r))throw new Q(4004,_v&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class ds{constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}}function Cv(t,n,e){if(t||(t=new Fe([],{})),0===t.segments.length&&t.hasChildren())return fs(t,n,e);const r=function gV(t,n,e){let r=0,o=n;const i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;const a=t.segments[o],s=e[r];if(qu(s))break;const u=`${s}`,c=r<e.length-1?e[r+1]:null;if(o>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!dE(u,c,a))return i;r+=2}else{if(!dE(u,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const i=new Fe(t.segments.slice(0,r.pathIndex),{});return i.children[Ie]=new Fe(t.segments.slice(r.pathIndex),t.children),fs(i,0,o)}return r.match&&0===o.length?new Fe(t.segments,{}):r.match&&!t.hasChildren()?Dv(t,n,e):r.match?fs(t,0,o):Dv(t,n,e)}function fs(t,n,e){if(0===e.length)return new Fe(t.segments,{});{const r=function pV(t){return qu(t[0])?t[0].outlets:{[Ie]:t}}(e),o={};return!r[Ie]&&t.children[Ie]&&1===t.numberOfChildren&&0===t.children[Ie].segments.length?fs(t.children[Ie],n,e):(nn(r,(i,a)=>{"string"==typeof i&&(i=[i]),null!==i&&(o[a]=Cv(t.children[a],n,i))}),nn(t.children,(i,a)=>{void 0===r[a]&&(o[a]=i)}),new Fe(t.segments,o))}}function Dv(t,n,e){const r=t.segments.slice(0,n);let o=0;for(;o<e.length;){const i=e[o];if(qu(i)){const u=vV(i.outlets);return new Fe(r,u)}if(0===o&&Gu(e[0])){r.push(new Wu(t.segments[n].path,lE(e[0]))),o++;continue}const a=qu(i)?i.outlets[Ie]:`${i}`,s=o<e.length-1?e[o+1]:null;a&&s&&Gu(s)?(r.push(new Wu(a,lE(s))),o+=2):(r.push(new Wu(a,{})),o++)}return new Fe(r,{})}function vV(t){const n={};return nn(t,(e,r)=>{"string"==typeof e&&(e=[e]),null!==e&&(n[r]=Dv(new Fe([],{}),0,e))}),n}function lE(t){const n={};return nn(t,(e,r)=>n[r]=`${e}`),n}function dE(t,n,e){return t==e.path&&ro(n,e.parameters)}const Ku="imperative";class oo{constructor(n,e){this.id=n,this.url=e}}class Ev extends oo{constructor(n,e,r="imperative",o=null){super(n,e),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ra extends oo{constructor(n,e,r){super(n,e),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ad extends oo{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class kd extends oo{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=16}}class Sv extends oo{constructor(n,e,r,o){super(n,e),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class mV extends oo{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yV extends oo{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bV extends oo{constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class wV extends oo{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xV extends oo{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _V{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class CV{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class DV{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class EV{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class SV{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class IV{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class fE{constructor(n,e,r){this.routerEvent=n,this.position=e,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let TV=(()=>{class t{createUrlTree(e,r,o,i,a,s){return dV(e||r.root,o,i,a,s)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})(),kV=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(n){return TV.\u0275fac(n)},providedIn:"root"}),t})();class hE{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=Iv(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){const e=Iv(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=Mv(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return Mv(n,this._root).map(e=>e.value)}}function Iv(t,n){if(t===n.value)return n;for(const e of n.children){const r=Iv(t,e);if(r)return r}return null}function Mv(t,n){if(t===n.value)return[n];for(const e of n.children){const r=Mv(t,e);if(r.length)return r.unshift(n),r}return[]}class Ho{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function hs(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class pE extends hE{constructor(n,e){super(n),this.snapshot=e,Rv(this,n)}toString(){return this.snapshot.toString()}}function gE(t,n){const e=function PV(t,n){const a=new Pd([],{},{},"",{},Ie,n,null,t.root,-1,{});return new mE("",new Ho(a,[]))}(t,n),r=new Kn([new Wu("",{})]),o=new Kn({}),i=new Kn({}),a=new Kn({}),s=new Kn(""),u=new ps(r,o,a,s,i,Ie,n,e.root);return u.snapshot=e.root,new pE(new Ho(u,[]),e)}class ps{constructor(n,e,r,o,i,a,s,u){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.title=this.data?.pipe(ke(c=>c[Hu]))??ge(void 0),this._futureSnapshot=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(ke(n=>cs(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(ke(n=>cs(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function vE(t,n="emptyOnly"){const e=t.pathFromRoot;let r=0;if("always"!==n)for(r=e.length-1;r>=1;){const o=e[r],i=e[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(i.component)break;r--}}return function OV(t){return t.reduce((n,e)=>({params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.resolve,...e.routeConfig?.data,...e._resolvedData}}),{params:{},data:{},resolve:{}})}(e.slice(r))}class Pd{get title(){return this.data?.[Hu]}constructor(n,e,r,o,i,a,s,u,c,l,d){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=cs(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=cs(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class mE extends hE{constructor(n,e){super(e),this.url=n,Rv(this,e)}toString(){return yE(this._root)}}function Rv(t,n){n.value._routerState=t,n.children.forEach(e=>Rv(t,e))}function yE(t){const n=t.children.length>0?` { ${t.children.map(yE).join(", ")} } `:"";return`${t.value}${n}`}function Tv(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,ro(n.queryParams,e.queryParams)||t.queryParams.next(e.queryParams),n.fragment!==e.fragment&&t.fragment.next(e.fragment),ro(n.params,e.params)||t.params.next(e.params),function KU(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!ro(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.url.next(e.url),ro(n.data,e.data)||t.data.next(e.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Av(t,n){const e=ro(t.params,n.params)&&function JU(t,n){return ta(t,n)&&t.every((e,r)=>ro(e.parameters,n[r].parameters))}(t.url,n.url);return e&&!(!t.parent!=!n.parent)&&(!t.parent||Av(t.parent,n.parent))}function Xu(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const r=e.value;r._futureSnapshot=n.value;const o=function FV(t,n,e){return n.children.map(r=>{for(const o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return Xu(t,r,o);return Xu(t,r)})}(t,n,e);return new Ho(r,o)}{if(t.shouldAttach(n.value)){const i=t.retrieve(n.value);if(null!==i){const a=i.route;return a.value._futureSnapshot=n.value,a.children=n.children.map(s=>Xu(t,s)),a}}const r=function LV(t){return new ps(new Kn(t.url),new Kn(t.params),new Kn(t.queryParams),new Kn(t.fragment),new Kn(t.data),t.outlet,t.component,t)}(n.value),o=n.children.map(i=>Xu(t,i));return new Ho(r,o)}}const kv="ngNavigationCancelingError";function bE(t,n){const{redirectTo:e,navigationBehaviorOptions:r}=na(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=wE(!1,0,n);return o.url=e,o.navigationBehaviorOptions=r,o}function wE(t,n,e){const r=new Error("NavigationCancelingError: "+(t||""));return r[kv]=!0,r.cancellationCode=n,e&&(r.url=e),r}function xE(t){return _E(t)&&na(t.url)}function _E(t){return t&&t[kv]}class BV{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Qu,this.attachRef=null}}let Qu=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(e,r){const o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){const r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new BV,this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Od=!1;let Pv=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ie,this.activateEvents=new gn,this.deactivateEvents=new gn,this.attachEvents=new gn,this.detachEvents=new gn,this.parentContexts=Ne(Qu),this.location=Ne(Er),this.changeDetector=Ne(Mg),this.environmentInjector=Ne(Gr)}ngOnChanges(e){if(e.name){const{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Q(4012,Od);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Q(4012,Od);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Q(4012,Od);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new Q(4013,Od);this._activatedRoute=e;const o=this.location,a=e.snapshot.component,s=this.parentContexts.getOrCreateContext(this.name).children,u=new UV(e,s,o.injector);if(r&&function VV(t){return!!t.resolveComponentFactory}(r)){const c=r.resolveComponentFactory(a);this.activated=o.createComponent(c,o.length,u)}else this.activated=o.createComponent(a,{index:o.length,injector:u,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=xn({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Hi]}),t})();class UV{constructor(n,e,r){this.route=n,this.childContexts=e,this.parent=r}get(n,e){return n===ps?this.route:n===Qu?this.childContexts:this.parent.get(n,e)}}let Ov=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ai({type:t,selectors:[["ng-component"]],standalone:!0,features:[s_],decls:1,vars:0,template:function(e,r){1&e&&re(0,"router-outlet")},dependencies:[Pv],encapsulation:2}),t})();function CE(t,n){return t.providers&&!t._injector&&(t._injector=zl(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Fv(t){const n=t.children&&t.children.map(Fv),e=n?{...t,children:n}:{...t};return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Ie&&(e.component=Ov),e}function hr(t){return t.outlet||Ie}function DE(t,n){const e=t.filter(r=>hr(r)===n);return e.push(...t.filter(r=>hr(r)!==n)),e}function Yu(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class $V{constructor(n,e,r,o){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o}activate(n){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),Tv(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){const o=hs(e);n.children.forEach(i=>{const a=i.value.outlet;this.deactivateRoutes(i,o[a],r),delete o[a]}),nn(o,(i,a)=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){const o=n.value,i=e?e.value:null;if(o===i)if(o.component){const a=r.getContext(o.outlet);a&&this.deactivateChildRoutes(n,e,a.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=hs(n);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);if(r&&r.outlet){const a=r.outlet.detach(),s=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:a,route:n,contexts:s})}}deactivateRouteAndOutlet(n,e){const r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=hs(n);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(n,e,r){const o=hs(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new IV(i.value.snapshot))}),n.children.length&&this.forwardEvent(new EV(n.value.snapshot))}activateRoutes(n,e,r){const o=n.value,i=e?e.value:null;if(Tv(o),o===i)if(o.component){const a=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,a.children)}else this.activateChildRoutes(n,e,r);else if(o.component){const a=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const s=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),a.children.onOutletReAttached(s.contexts),a.attachRef=s.componentRef,a.route=s.route.value,a.outlet&&a.outlet.attach(s.componentRef,s.route.value),Tv(s.route.value),this.activateChildRoutes(n,null,a.children)}else{const s=Yu(o.snapshot),u=s?.get(mu)??null;a.attachRef=null,a.route=o,a.resolver=u,a.injector=s,a.outlet&&a.outlet.activateWith(o,a.injector),this.activateChildRoutes(n,null,a.children)}}else this.activateChildRoutes(n,null,r)}}class EE{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class Nd{constructor(n,e){this.component=n,this.route=e}}function GV(t,n,e){const r=t._root;return Ju(r,n?n._root:null,e,[r.value])}function gs(t,n){const e=Symbol(),r=n.get(t,e);return r===e?"function"!=typeof t||function sT(t){return null!==Wc(t)}(t)?n.get(t):t:r}function Ju(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=hs(n);return t.children.forEach(a=>{(function KV(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=t.value,a=n?n.value:null,s=e?e.getContext(t.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){const u=function XV(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!ta(t.url,n.url);case"pathParamsOrQueryParamsChange":return!ta(t.url,n.url)||!ro(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Av(t,n)||!ro(t.queryParams,n.queryParams);default:return!Av(t,n)}}(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new EE(r)):(i.data=a.data,i._resolvedData=a._resolvedData),Ju(t,n,i.component?s?s.children:null:e,r,o),u&&s&&s.outlet&&s.outlet.isActivated&&o.canDeactivateChecks.push(new Nd(s.outlet.component,a))}else a&&Zu(n,s,o),o.canActivateChecks.push(new EE(r)),Ju(t,null,i.component?s?s.children:null:e,r,o)})(a,i[a.value.outlet],e,r.concat([a.value]),o),delete i[a.value.outlet]}),nn(i,(a,s)=>Zu(a,e.getContext(s),o)),o}function Zu(t,n,e){const r=hs(t),o=t.value;nn(r,(i,a)=>{Zu(i,o.component?n?n.children.getContext(a):null:n,e)}),e.canDeactivateChecks.push(new Nd(o.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,o))}function ec(t){return"function"==typeof t}function Lv(t){return t instanceof _d||"EmptyError"===t?.name}const Fd=Symbol("INITIAL_VALUE");function vs(){return no(t=>VD(t.map(n=>n.pipe(ju(1),function jU(...t){const n=Gs(t);return Kt((e,r)=>{(n?gv(t,e,n):gv(t,e)).subscribe(r)})}(Fd)))).pipe(ke(n=>{for(const e of n)if(!0!==e){if(e===Fd)return Fd;if(!1===e||e instanceof bi)return e}return!0}),Vo(n=>n!==Fd),ju(1)))}function SE(t){return function DR(...t){return p0(t)}(vn(n=>{if(na(n))throw bE(0,n)}),ke(n=>!0===n))}const Bv={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function IE(t,n,e,r,o){const i=Uv(t,n,e);return i.matched?function fj(t,n,e,r){const o=n.canMatch;return o&&0!==o.length?ge(o.map(a=>{const s=gs(a,t);return yi(function tj(t){return t&&ec(t.canMatch)}(s)?s.canMatch(n,e):t.runInContext(()=>s(n,e)))})).pipe(vs(),SE()):ge(!0)}(r=CE(n,r),n,e).pipe(ke(a=>!0===a?i:{...Bv})):ge(i)}function Uv(t,n,e){if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?{...Bv}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const o=(n.matcher||qU)(e,t,n);if(!o)return{...Bv};const i={};nn(o.posParams,(s,u)=>{i[u]=s.path});const a=o.consumed.length>0?{...i,...o.consumed[o.consumed.length-1].parameters}:i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:a,positionalParamSegments:o.posParams??{}}}function Ld(t,n,e,r){if(e.length>0&&function gj(t,n,e){return e.some(r=>Bd(t,n,r)&&hr(r)!==Ie)}(t,e,r)){const i=new Fe(n,function pj(t,n,e,r){const o={};o[Ie]=r,r._sourceSegment=t,r._segmentIndexShift=n.length;for(const i of e)if(""===i.path&&hr(i)!==Ie){const a=new Fe([],{});a._sourceSegment=t,a._segmentIndexShift=n.length,o[hr(i)]=a}return o}(t,n,r,new Fe(e,t.children)));return i._sourceSegment=t,i._segmentIndexShift=n.length,{segmentGroup:i,slicedSegments:[]}}if(0===e.length&&function vj(t,n,e){return e.some(r=>Bd(t,n,r))}(t,e,r)){const i=new Fe(t.segments,function hj(t,n,e,r,o){const i={};for(const a of r)if(Bd(t,e,a)&&!o[hr(a)]){const s=new Fe([],{});s._sourceSegment=t,s._segmentIndexShift=n.length,i[hr(a)]=s}return{...o,...i}}(t,n,e,r,t.children));return i._sourceSegment=t,i._segmentIndexShift=n.length,{segmentGroup:i,slicedSegments:e}}const o=new Fe(t.segments,t.children);return o._sourceSegment=t,o._segmentIndexShift=n.length,{segmentGroup:o,slicedSegments:e}}function Bd(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}function ME(t,n,e,r){return!!(hr(t)===r||r!==Ie&&Bd(n,e,t))&&("**"===t.path||Uv(n,t,e).matched)}function RE(t,n,e){return 0===n.length&&!t.children[e]}const Ud=!1;class Vd{constructor(n){this.segmentGroup=n||null}}class TE{constructor(n){this.urlTree=n}}function tc(t){return Vu(new Vd(t))}function AE(t){return Vu(new TE(t))}class wj{constructor(n,e,r,o,i){this.injector=n,this.configLoader=e,this.urlSerializer=r,this.urlTree=o,this.config=i,this.allowRedirects=!0}apply(){const n=Ld(this.urlTree.root,[],[],this.config).segmentGroup,e=new Fe(n.segments,n.children);return this.expandSegmentGroup(this.injector,this.config,e,Ie).pipe(ke(i=>this.createUrlTree(Td(i),this.urlTree.queryParams,this.urlTree.fragment))).pipe(mi(i=>{if(i instanceof TE)return this.allowRedirects=!1,this.match(i.urlTree);throw i instanceof Vd?this.noMatchError(i):i}))}match(n){return this.expandSegmentGroup(this.injector,this.config,n.root,Ie).pipe(ke(o=>this.createUrlTree(Td(o),n.queryParams,n.fragment))).pipe(mi(o=>{throw o instanceof Vd?this.noMatchError(o):o}))}noMatchError(n){return new Q(4002,Ud)}createUrlTree(n,e,r){const o=xv(n);return new bi(o,e,r)}expandSegmentGroup(n,e,r,o){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(n,e,r).pipe(ke(i=>new Fe([],i))):this.expandSegment(n,r,e,r.segments,o,!0)}expandChildren(n,e,r){const o=[];for(const i of Object.keys(r.children))"primary"===i?o.unshift(i):o.push(i);return Vt(o).pipe(pi(i=>{const a=r.children[i],s=DE(e,i);return this.expandSegmentGroup(n,s,a,i).pipe(ke(u=>({segment:u,outlet:i})))}),$D((i,a)=>(i[a.outlet]=a.segment,i),{}),GD())}expandSegment(n,e,r,o,i,a){return Vt(r).pipe(pi(s=>this.expandSegmentAgainstRoute(n,e,r,s,o,i,a).pipe(mi(c=>{if(c instanceof Vd)return ge(null);throw c}))),vi(s=>!!s),mi((s,u)=>{if(Lv(s))return RE(e,o,i)?ge(new Fe([],{})):tc(e);throw s}))}expandSegmentAgainstRoute(n,e,r,o,i,a,s){return ME(o,e,i,a)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,e,o,i,a):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a):tc(e):tc(e)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,o,a):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,r,o){const i=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?AE(i):this.lineralizeSegments(r,i).pipe(Zt(a=>{const s=new Fe(a,{});return this.expandSegment(n,s,e,a,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a){const{matched:s,consumedSegments:u,remainingSegments:c,positionalParamSegments:l}=Uv(e,o,i);if(!s)return tc(e);const d=this.applyRedirectCommands(u,o.redirectTo,l);return o.redirectTo.startsWith("/")?AE(d):this.lineralizeSegments(o,d).pipe(Zt(f=>this.expandSegment(n,e,r,f.concat(c),a,!1)))}matchSegmentAgainstRoute(n,e,r,o,i){return"**"===r.path?(n=CE(r,n),r.loadChildren?(r._loadedRoutes?ge({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(n,r)).pipe(ke(s=>(r._loadedRoutes=s.routes,r._loadedInjector=s.injector,new Fe(o,{})))):ge(new Fe(o,{}))):IE(e,r,o,n).pipe(no(({matched:a,consumedSegments:s,remainingSegments:u})=>a?this.getChildConfig(n=r._injector??n,r,o).pipe(Zt(l=>{const d=l.injector??n,f=l.routes,{segmentGroup:h,slicedSegments:p}=Ld(e,s,u,f),g=new Fe(h.segments,h.children);if(0===p.length&&g.hasChildren())return this.expandChildren(d,f,g).pipe(ke(y=>new Fe(s,y)));if(0===f.length&&0===p.length)return ge(new Fe(s,{}));const v=hr(r)===i;return this.expandSegment(d,g,f,p,v?Ie:i,!0).pipe(ke(b=>new Fe(s.concat(b.segments),b.children)))})):tc(e)))}getChildConfig(n,e,r){return e.children?ge({routes:e.children,injector:n}):e.loadChildren?void 0!==e._loadedRoutes?ge({routes:e._loadedRoutes,injector:e._loadedInjector}):function dj(t,n,e,r){const o=n.canLoad;return void 0===o||0===o.length?ge(!0):ge(o.map(a=>{const s=gs(a,t);return yi(function YV(t){return t&&ec(t.canLoad)}(s)?s.canLoad(n,e):t.runInContext(()=>s(n,e)))})).pipe(vs(),SE())}(n,e,r).pipe(Zt(o=>o?this.configLoader.loadChildren(n,e).pipe(vn(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):function yj(t){return Vu(wE(Ud,3))}())):ge({routes:[],injector:n})}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return ge(r);if(o.numberOfChildren>1||!o.children[Ie])return n.redirectTo,Vu(new Q(4e3,Ud));o=o.children[Ie]}}applyRedirectCommands(n,e,r){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r)}applyRedirectCreateUrlTree(n,e,r,o){const i=this.createSegmentGroup(n,e.root,r,o);return new bi(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const r={};return nn(n,(o,i)=>{if("string"==typeof o&&o.startsWith(":")){const s=o.substring(1);r[i]=e[s]}else r[i]=o}),r}createSegmentGroup(n,e,r,o){const i=this.createSegments(n,e.segments,r,o);let a={};return nn(e.children,(s,u)=>{a[u]=this.createSegmentGroup(n,s,r,o)}),new Fe(i,a)}createSegments(n,e,r,o){return e.map(i=>i.path.startsWith(":")?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){const o=r[e.path.substring(1)];if(!o)throw new Q(4001,Ud);return o}findOrReturn(n,e){let r=0;for(const o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}}class _j{}class Ej{constructor(n,e,r,o,i,a,s){this.injector=n,this.rootComponentType=e,this.config=r,this.urlTree=o,this.url=i,this.paramsInheritanceStrategy=a,this.urlSerializer=s}recognize(){const n=Ld(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,Ie).pipe(ke(e=>{if(null===e)return null;const r=new Pd([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ie,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new Ho(r,e),i=new mE(this.url,o);return this.inheritParamsAndData(i._root),i}))}inheritParamsAndData(n){const e=n.value,r=vE(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),n.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(n,e,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,e,r):this.processSegment(n,e,r,r.segments,o)}processChildren(n,e,r){return Vt(Object.keys(r.children)).pipe(pi(o=>{const i=r.children[o],a=DE(e,o);return this.processSegmentGroup(n,a,i,o)}),$D((o,i)=>o&&i?(o.push(...i),o):null),function zU(t,n=!1){return Kt((e,r)=>{let o=0;e.subscribe(Xt(r,i=>{const a=t(i,o++);(a||n)&&r.next(i),!a&&r.complete()}))})}(o=>null!==o),Cd(null),GD(),ke(o=>{if(null===o)return null;const i=PE(o);return function Sj(t){t.sort((n,e)=>n.value.outlet===Ie?-1:e.value.outlet===Ie?1:n.value.outlet.localeCompare(e.value.outlet))}(i),i}))}processSegment(n,e,r,o,i){return Vt(e).pipe(pi(a=>this.processSegmentAgainstRoute(a._injector??n,a,r,o,i)),vi(a=>!!a),mi(a=>{if(Lv(a))return RE(r,o,i)?ge([]):ge(null);throw a}))}processSegmentAgainstRoute(n,e,r,o,i){if(e.redirectTo||!ME(e,r,o,i))return ge(null);let a;if("**"===e.path){const s=o.length>0?XD(o).parameters:{},u=NE(r)+o.length;a=ge({snapshot:new Pd(o,s,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,FE(e),hr(e),e.component??e._loadedComponent??null,e,OE(r),u,LE(e)),consumedSegments:[],remainingSegments:[]})}else a=IE(r,e,o,n).pipe(ke(({matched:s,consumedSegments:u,remainingSegments:c,parameters:l})=>{if(!s)return null;const d=NE(r)+u.length;return{snapshot:new Pd(u,l,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,FE(e),hr(e),e.component??e._loadedComponent??null,e,OE(r),d,LE(e)),consumedSegments:u,remainingSegments:c}}));return a.pipe(no(s=>{if(null===s)return ge(null);const{snapshot:u,consumedSegments:c,remainingSegments:l}=s;n=e._injector??n;const d=e._loadedInjector??n,f=function Ij(t){return t.children?t.children:t.loadChildren?t._loadedRoutes:[]}(e),{segmentGroup:h,slicedSegments:p}=Ld(r,c,l,f.filter(v=>void 0===v.redirectTo));if(0===p.length&&h.hasChildren())return this.processChildren(d,f,h).pipe(ke(v=>null===v?null:[new Ho(u,v)]));if(0===f.length&&0===p.length)return ge([new Ho(u,[])]);const g=hr(e)===i;return this.processSegment(d,f,h,p,g?Ie:i).pipe(ke(v=>null===v?null:[new Ho(u,v)]))}))}}function Mj(t){const n=t.value.routeConfig;return n&&""===n.path&&void 0===n.redirectTo}function PE(t){const n=[],e=new Set;for(const r of t){if(!Mj(r)){n.push(r);continue}const o=n.find(i=>r.value.routeConfig===i.value.routeConfig);void 0!==o?(o.children.push(...r.children),e.add(o)):n.push(r)}for(const r of e){const o=PE(r.children);n.push(new Ho(r.value,o))}return n.filter(r=>!e.has(r))}function OE(t){let n=t;for(;n._sourceSegment;)n=n._sourceSegment;return n}function NE(t){let n=t,e=n._segmentIndexShift??0;for(;n._sourceSegment;)n=n._sourceSegment,e+=n._segmentIndexShift??0;return e-1}function FE(t){return t.data||{}}function LE(t){return t.resolve||{}}function BE(t){return"string"==typeof t.title||null===t.title}function Vv(t){return no(n=>{const e=t(n);return e?Vt(e).pipe(ke(()=>n)):ge(n)})}const ms=new fe("ROUTES");let jv=(()=>{class t{constructor(e,r){this.injector=e,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return ge(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const r=yi(e.loadComponent()).pipe(ke(VE),vn(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),yv(()=>{this.componentLoaders.delete(e)})),o=new WD(r,()=>new Br).pipe(vv());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return ge({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const i=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(ke(s=>{this.onLoadEndListener&&this.onLoadEndListener(r);let u,c,l=!1;Array.isArray(s)?c=s:(u=s.create(e).injector,c=KD(u.get(ms,[],be.Self|be.Optional)));return{routes:c.map(Fv),injector:u}}),yv(()=>{this.childrenLoaders.delete(r)})),a=new WD(i,()=>new Br).pipe(vv());return this.childrenLoaders.set(r,a),a}loadModuleFactoryOrRoutes(e){return yi(e()).pipe(ke(VE),Zt(o=>o instanceof i_||Array.isArray(o)?ge(o):Vt(this.compiler.compileModuleAsync(o))))}}return t.\u0275fac=function(e){return new(e||t)(ce(qr),ce(q_))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function VE(t){return function Lj(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let Hd=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Br,this.configLoader=Ne(jv),this.environmentInjector=Ne(Gr),this.urlSerializer=Ne(zu),this.rootContexts=Ne(Qu),this.navigationId=0,this.afterPreactivation=()=>ge(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new CV(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new _V(o))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:r})}setupNavigations(e){return this.transitions=new Kn({id:0,targetPageId:0,currentUrlTree:e.currentUrlTree,currentRawUrl:e.currentUrlTree,extractedUrl:e.urlHandlingStrategy.extract(e.currentUrlTree),urlAfterRedirects:e.urlHandlingStrategy.extract(e.currentUrlTree),rawUrl:e.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ku,restoredState:null,currentSnapshot:e.routerState.snapshot,targetSnapshot:null,currentRouterState:e.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Vo(r=>0!==r.id),ke(r=>({...r,extractedUrl:e.urlHandlingStrategy.extract(r.rawUrl)})),no(r=>{let o=!1,i=!1;return ge(r).pipe(vn(a=>{this.currentNavigation={id:a.id,initialUrl:a.rawUrl,extractedUrl:a.extractedUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),no(a=>{const s=e.browserUrlTree.toString(),u=!e.navigated||a.extractedUrl.toString()!==s||s!==e.currentUrlTree.toString();if(!u&&"reload"!==(a.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const l="";return this.events.next(new kd(a.id,e.serializeUrl(r.rawUrl),l,0)),e.rawUrlTree=a.rawUrl,a.resolve(null),Ur}if(e.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return jE(a.source)&&(e.browserUrlTree=a.extractedUrl),ge(a).pipe(no(l=>{const d=this.transitions?.getValue();return this.events.next(new Ev(l.id,this.urlSerializer.serialize(l.extractedUrl),l.source,l.restoredState)),d!==this.transitions?.getValue()?Ur:Promise.resolve(l)}),function xj(t,n,e,r){return no(o=>function bj(t,n,e,r,o){return new wj(t,n,e,r,o).apply()}(t,n,e,o.extractedUrl,r).pipe(ke(i=>({...o,urlAfterRedirects:i}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,e.config),vn(l=>{this.currentNavigation={...this.currentNavigation,finalUrl:l.urlAfterRedirects},r.urlAfterRedirects=l.urlAfterRedirects}),function Tj(t,n,e,r,o){return Zt(i=>function Dj(t,n,e,r,o,i,a="emptyOnly"){return new Ej(t,n,e,r,o,a,i).recognize().pipe(no(s=>null===s?function Cj(t){return new At(n=>n.error(t))}(new _j):ge(s)))}(t,n,e,i.urlAfterRedirects,r.serialize(i.urlAfterRedirects),r,o).pipe(ke(a=>({...i,targetSnapshot:a}))))}(this.environmentInjector,this.rootComponentType,e.config,this.urlSerializer,e.paramsInheritanceStrategy),vn(l=>{if(r.targetSnapshot=l.targetSnapshot,"eager"===e.urlUpdateStrategy){if(!l.extras.skipLocationChange){const f=e.urlHandlingStrategy.merge(l.urlAfterRedirects,l.rawUrl);e.setBrowserUrl(f,l)}e.browserUrlTree=l.urlAfterRedirects}const d=new mV(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}));if(u&&e.urlHandlingStrategy.shouldProcessUrl(e.rawUrlTree)){const{id:l,extractedUrl:d,source:f,restoredState:h,extras:p}=a,g=new Ev(l,this.urlSerializer.serialize(d),f,h);this.events.next(g);const v=gE(d,this.rootComponentType).snapshot;return ge(r={...a,targetSnapshot:v,urlAfterRedirects:d,extras:{...p,skipLocationChange:!1,replaceUrl:!1}})}{const l="";return this.events.next(new kd(a.id,e.serializeUrl(r.extractedUrl),l,1)),e.rawUrlTree=a.rawUrl,a.resolve(null),Ur}}),vn(a=>{const s=new yV(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(s)}),ke(a=>r={...a,guards:GV(a.targetSnapshot,a.currentSnapshot,this.rootContexts)}),function rj(t,n){return Zt(e=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:a}}=e;return 0===a.length&&0===i.length?ge({...e,guardsResult:!0}):function oj(t,n,e,r){return Vt(t).pipe(Zt(o=>function lj(t,n,e,r,o){const i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return i&&0!==i.length?ge(i.map(s=>{const u=Yu(n)??o,c=gs(s,u);return yi(function ej(t){return t&&ec(t.canDeactivate)}(c)?c.canDeactivate(t,n,e,r):u.runInContext(()=>c(t,n,e,r))).pipe(vi())})).pipe(vs()):ge(!0)}(o.component,o.route,e,n,r)),vi(o=>!0!==o,!0))}(a,r,o,t).pipe(Zt(s=>s&&function QV(t){return"boolean"==typeof t}(s)?function ij(t,n,e,r){return Vt(n).pipe(pi(o=>gv(function sj(t,n){return null!==t&&n&&n(new DV(t)),ge(!0)}(o.route.parent,r),function aj(t,n){return null!==t&&n&&n(new SV(t)),ge(!0)}(o.route,r),function cj(t,n,e){const r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(a=>function qV(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(a)).filter(a=>null!==a).map(a=>HD(()=>ge(a.guards.map(u=>{const c=Yu(a.node)??e,l=gs(u,c);return yi(function ZV(t){return t&&ec(t.canActivateChild)}(l)?l.canActivateChild(r,t):c.runInContext(()=>l(r,t))).pipe(vi())})).pipe(vs())));return ge(i).pipe(vs())}(t,o.path,e),function uj(t,n,e){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return ge(!0);const o=r.map(i=>HD(()=>{const a=Yu(n)??e,s=gs(i,a);return yi(function JV(t){return t&&ec(t.canActivate)}(s)?s.canActivate(n,t):a.runInContext(()=>s(n,t))).pipe(vi())}));return ge(o).pipe(vs())}(t,o.route,e))),vi(o=>!0!==o,!0))}(r,i,t,n):ge(s)),ke(s=>({...e,guardsResult:s})))})}(this.environmentInjector,a=>this.events.next(a)),vn(a=>{if(r.guardsResult=a.guardsResult,na(a.guardsResult))throw bE(0,a.guardsResult);const s=new bV(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.events.next(s)}),Vo(a=>!!a.guardsResult||(e.restoreHistory(a),this.cancelNavigationTransition(a,"",3),!1)),Vv(a=>{if(a.guards.canActivateChecks.length)return ge(a).pipe(vn(s=>{const u=new wV(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(u)}),no(s=>{let u=!1;return ge(s).pipe(function Aj(t,n){return Zt(e=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return ge(e);let i=0;return Vt(o).pipe(pi(a=>function kj(t,n,e,r){const o=t.routeConfig,i=t._resolve;return void 0!==o?.title&&!BE(o)&&(i[Hu]=o.title),function Pj(t,n,e,r){const o=function Oj(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===o.length)return ge({});const i={};return Vt(o).pipe(Zt(a=>function Nj(t,n,e,r){const o=Yu(n)??r,i=gs(t,o);return yi(i.resolve?i.resolve(n,e):o.runInContext(()=>i(n,e)))}(t[a],n,e,r).pipe(vi(),vn(s=>{i[a]=s}))),mv(1),function $U(t){return ke(()=>t)}(i),mi(a=>Lv(a)?Ur:Vu(a)))}(i,t,n,r).pipe(ke(a=>(t._resolvedData=a,t.data=vE(t,e).resolve,o&&BE(o)&&(t.data[Hu]=o.title),null)))}(a.route,r,t,n)),vn(()=>i++),mv(1),Zt(a=>i===o.length?ge(e):Ur))})}(e.paramsInheritanceStrategy,this.environmentInjector),vn({next:()=>u=!0,complete:()=>{u||(e.restoreHistory(s),this.cancelNavigationTransition(s,"",2))}}))}),vn(s=>{const u=new xV(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(u)}))}),Vv(a=>{const s=u=>{const c=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(u.routeConfig).pipe(vn(l=>{u.component=l}),ke(()=>{})));for(const l of u.children)c.push(...s(l));return c};return VD(s(a.targetSnapshot.root)).pipe(Cd(),ju(1))}),Vv(()=>this.afterPreactivation()),ke(a=>{const s=function NV(t,n,e){const r=Xu(t,n._root,e?e._root:void 0);return new pE(r,n)}(e.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return r={...a,targetRouterState:s}}),vn(a=>{e.currentUrlTree=a.urlAfterRedirects,e.rawUrlTree=e.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),e.routerState=a.targetRouterState,"deferred"===e.urlUpdateStrategy&&(a.extras.skipLocationChange||e.setBrowserUrl(e.rawUrlTree,a),e.browserUrlTree=a.urlAfterRedirects)}),((t,n,e)=>ke(r=>(new $V(n,r.targetRouterState,r.currentRouterState,e).activate(t),r)))(this.rootContexts,e.routeReuseStrategy,a=>this.events.next(a)),vn({next:a=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,e.navigated=!0,this.events.next(new ra(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(e.currentUrlTree))),e.titleStrategy?.updateTitle(a.targetRouterState.snapshot),a.resolve(!0)},complete:()=>{o=!0}}),yv(()=>{o||i||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),mi(a=>{if(i=!0,_E(a)){xE(a)||(e.navigated=!0,e.restoreHistory(r,!0));const s=new Ad(r.id,this.urlSerializer.serialize(r.extractedUrl),a.message,a.cancellationCode);if(this.events.next(s),xE(a)){const u=e.urlHandlingStrategy.merge(a.url,e.rawUrlTree),c={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===e.urlUpdateStrategy||jE(r.source)};e.scheduleNavigation(u,Ku,null,c,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{e.restoreHistory(r,!0);const s=new Sv(r.id,this.urlSerializer.serialize(r.extractedUrl),a,r.targetSnapshot??void 0);this.events.next(s);try{r.resolve(e.errorHandler(a))}catch(u){r.reject(u)}}return Ur}))}))}cancelNavigationTransition(e,r,o){const i=new Ad(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function jE(t){return t!==Ku}let HE=(()=>{class t{buildTitle(e){let r,o=e.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===Ie);return r}getResolvedTitleForRoute(e){return e.data[Hu]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne(Bj)},providedIn:"root"}),t})(),Bj=(()=>{class t extends HE{constructor(e){super(),this.title=e}updateTitle(e){const r=this.buildTitle(e);void 0!==r&&this.title.setTitle(r)}}return t.\u0275fac=function(e){return new(e||t)(ce(pD))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Uj=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne(jj)},providedIn:"root"}),t})();class Vj{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}let jj=(()=>{class t extends Vj{}return t.\u0275fac=function(){let n;return function(r){return(n||(n=function Rb(t){return xo(()=>{const n=t.prototype.constructor,e=n[Co]||Fh(n),r=Object.prototype;let o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){const i=o[Co]||Fh(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}(t)))(r||t)}}(),t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Wd=new fe("",{providedIn:"root",factory:()=>({})});let Wj=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:function(){return Ne(zj)},providedIn:"root"}),t})(),zj=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function $j(t){throw t}function Gj(t,n,e){return n.parse("/")}const qj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Kj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Xn=(()=>{class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Ne(L3),this.isNgZoneEnabled=!1,this.options=Ne(Wd,{optional:!0})||{},this.errorHandler=this.options.errorHandler||$j,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Gj,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Ne(Wj),this.routeReuseStrategy=Ne(Uj),this.urlCreationStrategy=Ne(kV),this.titleStrategy=Ne(HE),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=KD(Ne(ms,{optional:!0})??[]),this.navigationTransitions=Ne(Hd),this.urlSerializer=Ne(zu),this.location=Ne(Lg),this.isNgZoneEnabled=Ne(St)instanceof St&&St.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new bi,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=gE(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(e=>{this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const e=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Ku,e)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const r="popstate"===e.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(e.url,r,e.state)},0)}))}navigateToSyncWithBrowser(e,r,o){const i={replaceUrl:!0},a=o?.navigationId?o:null;if(o){const u={...o};delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(i.state=u)}const s=this.parseUrl(e);this.scheduleNavigation(s,r,a,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(e){this.config=e.map(Fv),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,r={}){const{relativeTo:o,queryParams:i,fragment:a,queryParamsHandling:s,preserveFragment:u}=r,c=u?this.currentUrlTree.fragment:a;let l=null;switch(s){case"merge":l={...this.currentUrlTree.queryParams,...i};break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=i||null}return null!==l&&(l=this.removeEmptyProps(l)),this.urlCreationStrategy.createUrlTree(o,this.routerState,this.currentUrlTree,e,l,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){const o=na(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,Ku,null,r)}navigate(e,r={skipLocationChange:!1}){return function Xj(t){for(let n=0;n<t.length;n++){const e=t[n];if(null==e)throw new Q(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let r;try{r=this.urlSerializer.parse(e)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,e)}return r}isActive(e,r){let o;if(o=!0===r?{...qj}:!1===r?{...Kj}:r,na(e))return YD(this.currentUrlTree,e,o);const i=this.parseUrl(e);return YD(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.keys(e).reduce((r,o)=>{const i=e[o];return null!=i&&(r[o]=i),r},{})}scheduleNavigation(e,r,o,i,a){if(this.disposed)return Promise.resolve(!1);let s,u,c,l;return a?(s=a.resolve,u=a.reject,c=a.promise):c=new Promise((d,f)=>{s=d,u=f}),l="computed"===this.canceledNavigationResolution?o&&o.\u0275routerPageId?o.\u0275routerPageId:i.replaceUrl||i.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:l,source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}setBrowserUrl(e,r){const o=this.urlSerializer.serialize(e),i={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl?this.location.replaceState(o,"",i):this.location.go(o,"",i)}restoreHistory(e,r=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===o?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===o&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(o)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),zd=(()=>{class t{constructor(e,r,o,i,a,s){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=a,this.locationStrategy=s,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new Br;const u=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===u||"area"===u,this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof ra&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(e){this._preserveFragment=Pg(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=Pg(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=Pg(e)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(e){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(e,r,o,i,a){return!!(null===this.urlTree||this.isAnchorElement&&(0!==e||r||o||i||a||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const e=null===this.href?null:function Iw(t,n,e){return function Fk(t,n){return"src"===n&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===n&&("base"===t||"link"===t)?Sw:Ua}(n,e)(t)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",e)}applyAttributeValue(e,r){const o=this.renderer,i=this.el.nativeElement;null!==r?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return t.\u0275fac=function(e){return new(e||t)(he(Xn),he(ps),function ll(t){return function sA(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const e=t.attrs;if(e){const r=e.length;let o=0;for(;o<r;){const i=e[o];if(vb(i))break;if(0===i)o+=2;else if("number"==typeof i)for(o++;o<r&&"string"==typeof e[o];)o++;else{if(i===n)return e[o+1];o+=2}}}return null}(tn(),t)}("tabindex"),he(Ha),he(Ro),he(ea))},t.\u0275dir=xn({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(e,r){1&e&&Xi("click",function(i){return r.onClick(i.button,i.ctrlKey,i.shiftKey,i.altKey,i.metaKey)}),2&e&&Hp("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Hi]}),t})(),WE=(()=>{class t{get isActive(){return this._isActive}constructor(e,r,o,i,a){this.router=e,this.element=r,this.renderer=o,this.cdr=i,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new gn,this.routerEventsSubscription=e.events.subscribe(s=>{s instanceof ra&&this.update()})}ngAfterContentInit(){ge(this.links.changes,ge(null)).pipe(wa()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const e=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=Vt(e).pipe(wa()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(e){const r=Array.isArray(e)?e:e.split(" ");this.classes=r.filter(o=>!!o)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||Promise.resolve().then(()=>{const e=this.hasActiveLinks();this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.classes.forEach(r=>{e?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),e&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(e))})}isLinkActive(e){const r=function Qj(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return o=>!!o.urlTree&&e.isActive(o.urlTree,r)}hasActiveLinks(){const e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}}return t.\u0275fac=function(e){return new(e||t)(he(Xn),he(Ro),he(Ha),he(Mg),he(zd,8))},t.\u0275dir=xn({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(e,r,o){if(1&e&&function D_(t,n,e,r){const o=We();if(o.firstCreatePass){const i=tn();S_(o,new __(n,e,r),i.index),function v3(t,n){const e=t.contentQueries||(t.contentQueries=[]);n!==(e.length?e[e.length-1]:-1)&&e.push(t.queries.length-1,n)}(o,t),2==(2&e)&&(o.staticContentQueries=!0)}E_(o,G(),e)}(o,zd,5),2&e){let i;Jr(i=Zr())&&(r.links=i)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[Hi]}),t})();class zE{}let Yj=(()=>{class t{constructor(e,r,o,i,a){this.router=e,this.injector=o,this.preloadingStrategy=i,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(Vo(e=>e instanceof ra),pi(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){const o=[];for(const i of r){i.providers&&!i._injector&&(i._injector=zl(i.providers,e,`Route: ${i.path}`));const a=i._injector??e,s=i._loadedInjector??a;i.loadChildren&&!i._loadedRoutes&&void 0===i.canLoad||i.loadComponent&&!i._loadedComponent?o.push(this.preloadConfig(a,i)):(i.children||i._loadedRoutes)&&o.push(this.processRoutes(s,i.children??i._loadedRoutes))}return Vt(o).pipe(wa())}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(e,r):ge(null);const i=o.pipe(Zt(a=>null===a?ge(void 0):(r._loadedRoutes=a.routes,r._loadedInjector=a.injector,this.processRoutes(a.injector??e,a.routes))));return r.loadComponent&&!r._loadedComponent?Vt([i,this.loader.loadComponent(r)]).pipe(wa()):i})}}return t.\u0275fac=function(e){return new(e||t)(ce(Xn),ce(q_),ce(Gr),ce(zE),ce(jv))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Wv=new fe("");let $E=(()=>{class t{constructor(e,r,o,i,a={}){this.urlSerializer=e,this.transitions=r,this.viewportScroller=o,this.zone=i,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Ev?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof ra&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof fE&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new fE(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return t.\u0275fac=function(e){!function o1(){throw new Error("invalid")}()},t.\u0275prov=de({token:t,factory:t.\u0275fac}),t})();var Qn=(()=>((Qn=Qn||{})[Qn.COMPLETE=0]="COMPLETE",Qn[Qn.FAILED=1]="FAILED",Qn[Qn.REDIRECTING=2]="REDIRECTING",Qn))();const ys=!1;function wi(t,n){return{\u0275kind:t,\u0275providers:n}}const zv=new fe("",{providedIn:"root",factory:()=>!1});function qE(){const t=Ne(qr);return n=>{const e=t.get(Yl);if(n!==e.components[0])return;const r=t.get(Xn),o=t.get(KE);1===t.get($v)&&r.initialNavigation(),t.get(XE,null,be.Optional)?.setUpPreloading(),t.get(Wv,null,be.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.unsubscribe())}}const KE=new fe(ys?"bootstrap done indicator":"",{factory:()=>new Br}),$v=new fe(ys?"initial navigation":"",{providedIn:"root",factory:()=>1});function n5(){let t=[];return t=ys?[{provide:xl,multi:!0,useFactory:()=>{const n=Ne(Xn);return()=>n.events.subscribe(e=>{console.group?.(`Router Event: ${e.constructor.name}`),console.log(function MV(t){if(!("type"in t))return`Unknown Router Event: ${t.constructor.name}`;switch(t.type){case 14:return`ActivationEnd(path: '${t.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${t.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${t.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${t.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state}, shouldActivate: ${t.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 2:return`NavigationCancel(id: ${t.id}, url: '${t.url}')`;case 16:return`NavigationSkipped(id: ${t.id}, url: '${t.url}')`;case 1:return`NavigationEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${t.id}, url: '${t.url}', error: ${t.error})`;case 0:return`NavigationStart(id: ${t.id}, url: '${t.url}')`;case 6:return`ResolveEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 5:return`ResolveStart(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 10:return`RouteConfigLoadEnd(path: ${t.route.path})`;case 9:return`RouteConfigLoadStart(path: ${t.route.path})`;case 4:return`RoutesRecognized(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 15:return`Scroll(anchor: '${t.anchor}', position: '${t.position?`${t.position[0]}, ${t.position[1]}`:null}')`}}(e)),console.log(e),console.groupEnd?.()})}}]:[],wi(1,t)}const XE=new fe(ys?"router preloader":"");function r5(t){return wi(0,[{provide:XE,useExisting:Yj},{provide:zE,useExisting:t}])}const nc=!1,QE=new fe(nc?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),o5=[Lg,{provide:zu,useClass:bv},Xn,Qu,{provide:ps,useFactory:function GE(t){return t.routerState.root},deps:[Xn]},jv,nc?{provide:zv,useValue:!0}:[]];function i5(){return new tC("Router",Xn)}let YE=(()=>{class t{constructor(e){}static forRoot(e,r){return{ngModule:t,providers:[o5,nc&&r?.enableTracing?n5().\u0275providers:[],{provide:ms,multi:!0,useValue:e},{provide:QE,useFactory:c5,deps:[[Xn,new su,new uu]]},{provide:Wd,useValue:r||{}},r?.useHash?{provide:ea,useClass:DL}:{provide:ea,useClass:DC},{provide:Wv,useFactory:()=>{const t=Ne(H4),n=Ne(St),e=Ne(Wd),r=Ne(Hd),o=Ne(zu);return e.scrollOffset&&t.setOffset(e.scrollOffset),new $E(o,r,t,n,e)}},r?.preloadingStrategy?r5(r.preloadingStrategy).\u0275providers:[],{provide:tC,multi:!0,useFactory:i5},r?.initialNavigation?l5(r):[],[{provide:JE,useFactory:qE},{provide:eC,multi:!0,useExisting:JE}]]}}static forChild(e){return{ngModule:t,providers:[{provide:ms,multi:!0,useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)(ce(QE,8))},t.\u0275mod=Do({type:t}),t.\u0275inj=Vr({imports:[Ov]}),t})();function c5(t){if(nc&&t)throw new Q(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function l5(t){return["disabled"===t.initialNavigation?wi(3,[{provide:Kl,multi:!0,useFactory:()=>{const n=Ne(Xn);return()=>{n.setUpLocationChangeListener()}}},{provide:$v,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?wi(2,[{provide:$v,useValue:0},{provide:Kl,multi:!0,deps:[qr],useFactory:n=>{const e=n.get(_L,Promise.resolve());return()=>e.then(()=>new Promise(r=>{const o=n.get(Xn),i=n.get(KE);(function Jj(t,n){t.events.pipe(Vo(e=>e instanceof ra||e instanceof Ad||e instanceof Sv||e instanceof kd),ke(e=>e instanceof ra||e instanceof kd?Qn.COMPLETE:e instanceof Ad&&(0===e.code||1===e.code)?Qn.REDIRECTING:Qn.FAILED),Vo(e=>e!==Qn.REDIRECTING),ju(1)).subscribe(()=>{n()})})(o,()=>{r(!0)}),n.get(Hd).afterPreactivation=()=>(r(!0),i.closed?ge(void 0):i),o.initialNavigation()}))}}]).\u0275providers:[]]}const JE=new fe(nc?"Router Initializer":"");function ZE(t,n,e,r,o,i,a){try{var s=t[i](a),u=s.value}catch(c){return void e(c)}s.done?n(u):Promise.resolve(u).then(r,o)}function rc(t){return function(){var n=this,e=arguments;return new Promise(function(r,o){var i=t.apply(n,e);function a(u){ZE(i,r,o,a,s,"next",u)}function s(u){ZE(i,r,o,a,s,"throw",u)}a(void 0)})}}var e2=function(t,n){return(e2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(t,n)};function Rr(t,n){function e(){this.constructor=t}e2(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function oe(t,n,e,r){return new(e||(e=Promise))(function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new e(function(l){l(c.value)}).then(a,s)}u((r=r.apply(t,n||[])).next())})}function ie(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(t,a)}catch(d){l=[6,d],r=0}finally{e=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var f5=function(){function t(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(n,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=n,this.platform=e},t.prototype.registerFlag=function(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},null!=this.urlFlags[n]){var o=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+o+"."),this.set(n,o)}},t.prototype.get=function(n){return n in this.flags||(this.flags[n]=this.evaluateFlag(n)),this.flags[n]},t.prototype.getNumber=function(n){return this.get(n)},t.prototype.getBool=function(n){return this.get(n)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(n,e){if(null==this.flagRegistry[n])throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=e,null!=this.flagRegistry[n].setHook&&this.flagRegistry[n].setHook(e)},t.prototype.evaluateFlag=function(n){if(null==this.flagRegistry[n])throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},t.prototype.setFlags=function(n){this.flags=Object.assign({},n)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var n=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,o=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return function h5(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0];n.urlFlags[s]=function(c,l){if("true"===(l=l.toLowerCase())||"false"===l)return"true"===l;if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,a[1])})}},t}();function F(){return t2}var t2=null,bs=new Map,oc=new Map;function n2(t,n){var e=Gv(t,n);return bs.get(e)}function r2(t){for(var n=bs.entries(),e=[];;){var r=n.next(),i=r.value;if(r.done)break;var s=i[1];i[0].split("_")[0]===t&&e.push(s)}return e}function o2(t){var n=t.kernelName,e=t.backendName,r=Gv(n,e);if(bs.has(r))throw new Error("The kernel '"+n+"' for backend '"+e+"' is already registered");bs.set(r,t)}function g5(t){var n=t.kernelName;oc.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),oc.set(n,t)}function Gv(t,n){return n+"_"+t}function i2(t){for(var n=t.length,e=0,r=0;n>0;)r=Math.random()*n|0,e=t[--n],t[n]=t[r],t[r]=e}function $d(t,n,e){return Math.max(t,Math.min(n,e))}function qv(t){return t%2==0?t:t+1}function a2(t){for(var n=0,e=0;e<t.length;e++)n+=t[e];return n}function D(t,n){if(!t)throw new Error("string"==typeof n?n:n())}function ze(t,n,e){void 0===e&&(e=""),D(Ft(t,n),function(){return e+" Shapes "+t+" and "+n+" must match"})}function oa(t){D(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function Wo(t,n,e){if(void 0===n&&(n=[]),void 0===e&&(e=!1),null==n&&(n=[]),Array.isArray(t)||rn(t)&&!e)for(var r=0;r<t.length;++r)Wo(t[r],n,e);else n.push(t);return n}function ae(t){if(0===t.length)return 1;for(var n=t[0],e=1;e<t.length;e++)n*=t[e];return n}function Ft(t,n){if(t===n)return!0;if(null==t||null==n||t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function mt(t){return t%1==0}function s2(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var n=Math.exp(2*t);return(n-1)/(n+1)}function Gd(t){var n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function ia(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function Kv(t,n,e){return void 0===n&&(n=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{i++;var s=n(i);null!=e&&i>=e?o():setTimeout(a,s)}};a()})}function u2(t,n){for(var e=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)e*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(n>0&&n!==e)throw Error("Size("+n+") must match the product of shape "+t);return t}if(0===e)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(n%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+e);var i=t.slice();return i[r]=n/e,i}function Lt(t,n){var e=n.length;return D((t=null==t?n.map(function(r,o){return o}):[].concat(t)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+t}),D(t.every(function(r){return mt(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?e+r:r})}function xi(t,n){for(var e=[],r=[],o=null!=n&&Array.isArray(n)&&0===n.length,i=null==n||o?null:Lt(n,t).sort(),a=0,s=0;s<t.length;++s){if(null!=i){if(i[a]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===t[s]&&(e.push(t[s]),r.push(s)),i[a]<=s&&a++}1!==t[s]&&(e.push(t[s]),r.push(s))}return{newShape:e,keptDims:r}}function ws(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else{if("bool"!==t)throw new Error("Unknown data type "+t);e=new Uint8Array(n)}return e}function ic(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else if("bool"===t)e=new Uint8Array(n);else{if("string"!==t)throw new Error("Unknown data type "+t);e=new Array(n)}return e}function c2(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function l2(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function d2(t,n){return!("complex64"===n||"float32"===n&&"complex64"!==t||"int32"===n&&"float32"!==t&&"complex64"!==t||"bool"===n&&"bool"===t)}function rn(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Xv(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function f2(t){if(null==t)return 0;var n=0;return t.forEach(function(e){return n+=e.length}),n}function _i(t){return"string"==typeof t||t instanceof String}function h2(t){return"boolean"==typeof t}function p2(t){return"number"==typeof t}function xs(t){return Array.isArray(t)?xs(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":p2(t)?"float32":_i(t)?"string":h2(t)?"bool":"float32"}function Ci(t){return!!(t&&t.constructor&&t.call&&t.apply)}function qd(t,n){for(var e=n;e<t;++e)if(t%e==0)return e;return t}function Tr(t){var n=t.length;if(n<2)return[];var e=new Array(n-1);e[n-2]=t[n-1];for(var r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function Qv(t,n,e){if("string"===n)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Wo(t)),e&&c2(t,n),a=n,(i=t)instanceof Float32Array&&"float32"===a||i instanceof Int32Array&&"int32"===a||i instanceof Uint8Array&&"bool"===a)return t;var i,a;if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+n)}function Yv(t,n){if(0===t.length)return n[0];var e=t.reduce(function(r,o){return r*o});if(0===e)return[];if(e!==n.length)throw new Error("["+t+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(1===i.length)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),d=l.reduce(function(f,h){return f*h});for(c=0;c<u;c++)s[c]=r(o+c*d,l,a)}return s}(0,t,n)}function Jv(t,n){for(var e=_s(t,n),r=0;r<e.length;r++)e[r]=1;return e}function _s(t,n){if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n)return new Uint8Array(t);throw new Error("Unknown data type "+n)}function Ar(){return F().platform.now()}function Zv(t){t.forEach(function(n){D(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function g2(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",F().platform.encode(t,n)}function ac(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",F().platform.decode(t,n)}function em(t,n,e){if(0===n)return 0;if(1===n)return t[0];for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function v2(t,n,e){if(0===n)return[];if(1===n)return[t];for(var r=new Array(n),o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}Object.freeze({shuffle:i2,clamp:$d,nearestLargerEven:qv,sum:a2,randUniform:function(t,n){var e=Math.random();return n*e+(1-e)*t},distSquared:function(t,n){for(var e=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(n[r]);e+=o*o}return e},assert:D,assertShapesMatch:ze,assertNonNull:oa,flatten:Wo,sizeFromShape:ae,isScalarShape:function(t){return 0===t.length},arraysEqual:Ft,isInt:mt,tanh:s2,sizeToSquarishShape:Gd,createShuffledIndices:function(t){for(var n=new Uint32Array(t),e=0;e<t;++e)n[e]=e;return i2(n),n},rightPad:ia,repeatedTry:Kv,inferFromImplicitShape:u2,parseAxisParam:Lt,squeezeShape:xi,getTypedArrayFromDType:ws,getArrayFromDType:ic,checkConversionForErrors:c2,isValidDtype:l2,hasEncodingLoss:d2,isTypedArray:rn,bytesPerElement:Xv,bytesFromStringArray:f2,isString:_i,isBoolean:h2,isNumber:p2,inferDtype:xs,isFunction:Ci,nearestDivisor:qd,computeStrides:Tr,toTypedArray:Qv,toNestedArray:Yv,makeOnesTypedArray:Jv,makeZerosTypedArray:_s,now:Ar,assertNonNegativeIntegerDimensions:Zv,fetch:function(t,n){return F().platform.fetch(t,n)},encodeString:g2,decodeString:ac,locToIndex:em,indexToLoc:v2});var v5=function(){function t(n,e){this.backendTimer=n,this.logger=e,null==e&&(this.logger=new m5)}return t.prototype.profileKernel=function(n,e,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(c,l,d){if("float32"!==l)return!1;for(var f=0;f<c.length;f++){var h=c[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,n),a.then(function(c){var l="";null!=c.getExtraProfileInfo&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(n,s,u,c.kernelMs,e,l)})})}),o},t}(),m5=function(){function t(){}return t.prototype.logKernelProfile=function(n,e,r,o,i,a){var s="number"==typeof o?ia(o+"ms",9):o.error,u=ia(n,25),c=e.rank,l=e.size,d=ia(e.shape.toString(),14),f="";for(var h in i){var p=i[h].shape||e.shape,g=p.length;f+=h+": "+g+"D "+(g>0?p:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+d+"\t%c"+l+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),tm=7;function uc(t,n,e){return ia(Array.isArray(t)?parseFloat(t[0].toFixed(tm))+" + "+parseFloat(t[1].toFixed(tm))+"j":_i(t)?"'"+t+"'":"bool"===e?y2(t):parseFloat(t.toFixed(tm)).toString(),n)}function y2(t){return 0===t?"false":"true"}function cc(t){for(var n=[],e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var lc=function(){function t(n,e,r){var o=this;if(this.dtype=e,this.shape=n.slice(),this.size=ae(n),null!=r){var i=r.length;D(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ic(e,this.size),this.strides=Tr(n)}return t.prototype.set=function(n){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];0===r.length&&(r=[0]),D(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(r);this.values[i]=n},t.prototype.get=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];0===n.length&&(n=[0]);for(var r=0,o=0,i=n;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r])throw new Error("Requested out of range element at "+n+".   Buffer shape="+this.shape);r++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},t.prototype.locToIndex=function(n){if(0===this.rank)return 0;if(1===this.rank)return n[0];for(var e=n[n.length-1],r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e},t.prototype.indexToLoc=function(n){if(0===this.rank)return[];if(1===this.rank)return[n];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return io().makeTensor(this.values,this.shape,this.dtype)},t}(),io=null,O=null,b2=null,rt=function(){function t(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=ae(n),this.strides=Tr(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),D(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(n,e){return this.throwIfDisposed(),this.reshape([n,e])},t.prototype.as3D=function(n,e,r){return this.throwIfDisposed(),this.reshape([n,e,r])},t.prototype.as4D=function(n,e,r,o){return this.throwIfDisposed(),this.reshape([n,e,r,o])},t.prototype.as5D=function(n,e,r,o,i){return this.throwIfDisposed(),this.reshape([n,e,r,o,i])},t.prototype.asType=function(n){return this.throwIfDisposed(),O.cast(this,n)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,O.buffer(this.shape,this.dtype,n)]}})})},t.prototype.bufferSync=function(){return O.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,Yv(this.shape,n)]}})})},t.prototype.arraySync=function(){return Yv(this.shape,this.dataSync())},t.prototype.data=function(){return oe(this,void 0,void 0,function(){var n,e;return ie(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=io().read(this.dataId),"string"!==this.dtype?[3,2]:[4,n];case 1:e=r.sent();try{return[2,e.map(function(o){return ac(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var n=io().readSync(this.dataId);if("string"===this.dtype)try{return n.map(function(e){return ac(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},t.prototype.bytes=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,io().read(this.dataId)];case 1:return n=e.sent(),"string"===this.dtype?[2,n]:[2,new Uint8Array(n.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(io().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(n){return void 0===n&&(n=!1),O.print(this,n)},t.prototype.reshape=function(n){return this.throwIfDisposed(),O.reshape(this,n)},t.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},t.prototype.expandDims=function(n){return void 0===n&&(n=0),O.expandDims(this,n)},t.prototype.cumsum=function(n,e,r){return void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1),O.cumsum(this,n,e,r)},t.prototype.squeeze=function(n){return this.throwIfDisposed(),O.squeeze(this,n)},t.prototype.clone=function(){return this.throwIfDisposed(),O.clone(this)},t.prototype.oneHot=function(n,e,r){return this.throwIfDisposed(),O.oneHot(this,n,e,r)},t.prototype.toString=function(n){return void 0===n&&(n=!1),function y5(t,n,e,r){var o=Tr(n),i=function(c,l,d,f){var h=ae(l),p=f[f.length-1],g=new Array(p).fill(0),v=l.length,m="complex64"===d?cc(c):c;if(v>1)for(var b=0;b<h/p;b++)for(var y=b*p,w=0;w<p;w++)g[w]=Math.max(g[w],uc(m[y+w],0,d).length);return g}(t,n,e,o),a=n.length,s=function c(l,d,f,h,p,g){void 0===g&&(g=!0);var v="complex64"===f?2:1,m=d[0],b=d.length;if(0===b)return"complex64"===f?[uc(cc(l)[0],0,f)]:"bool"===f?[y2(l[0])]:[l[0].toString()];if(1===b){if(m>20){var w=Array.from(l.slice(0,3*v)),x=Array.from(l.slice((m-3)*v,m*v));return"complex64"===f&&(w=cc(w),x=cc(x)),["["+w.map(function(N,W){return uc(N,p[W],f)}).join(", ")+", ..., "+x.map(function(N,W){return uc(N,p[m-3+W],f)}).join(", ")+"]"]}return["["+("complex64"===f?cc(l):Array.from(l)).map(function(N,W){return uc(N,p[W],f)}).join(", ")+"]"]}var _=d.slice(1),M=h.slice(1),I=h[0]*v,E=[];if(m>20){for(var S=0;S<3;S++){var k=(A=S*I)+I;E.push.apply(E,c(l.slice(A,k),_,f,M,p,!1))}for(E.push("..."),S=m-3;S<m;S++)k=(A=S*I)+I,E.push.apply(E,c(l.slice(A,k),_,f,M,p,S===m-1))}else for(S=0;S<m;S++){var A;k=(A=S*I)+I,E.push.apply(E,c(l.slice(A,k),_,f,M,p,S===m-1))}var U=2===b?",":"";for(E[0]="["+E[0]+U,S=1;S<E.length-1;S++)E[S]=" "+E[S]+U;var B=",\n";for(S=2;S<b;S++)B+="\n";return E[E.length-1]=" "+E[E.length-1]+"]"+(g?"":B),E}(t,n,e,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+a),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,n)},t.prototype.tile=function(n){return this.throwIfDisposed(),O.tile(this,n)},t.prototype.gather=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),O.gather(this,n,e)},t.prototype.matMul=function(n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.throwIfDisposed(),O.matMul(this,n,e,r)},t.prototype.dot=function(n){return this.throwIfDisposed(),O.dot(this,n)},t.prototype.norm=function(n,e,r){return void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1),this.throwIfDisposed(),O.norm(this,n,e,r)},t.prototype.slice=function(n,e){return this.throwIfDisposed(),O.slice(this,n,e)},t.prototype.reverse=function(n){return this.throwIfDisposed(),O.reverse(this,n)},t.prototype.concat=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),n instanceof t&&(n=[n]),O.concat([this].concat(n),e)},t.prototype.split=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),O.split(this,n,e)},t.prototype.stack=function(n,e){return void 0===e&&(e=0),O.stack([this,n],e)},t.prototype.unstack=function(n){return void 0===n&&(n=0),O.unstack(this,n)},t.prototype.pad=function(n,e){return void 0===e&&(e=0),O.pad(this,n,e)},t.prototype.batchNormalization=function(n,e,r,o,i){return void 0===r&&(r=.001),b2("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,e,i,o,r)},t.prototype.batchNorm=function(n,e,r,o,i){return void 0===i&&(i=.001),this.throwIfDisposed(),O.batchNorm(this,n,e,r,o,i)},t.prototype.all=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.all(this,n,e)},t.prototype.any=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.any(this,n,e)},t.prototype.logSumExp=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.logSumExp(this,n,e)},t.prototype.sum=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.sum(this,n,e)},t.prototype.prod=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.prod(this,n,e)},t.prototype.mean=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.mean(this,n,e)},t.prototype.min=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.min(this,n,e)},t.prototype.max=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),O.max(this,n,e)},t.prototype.argMin=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),O.argMin(this,n)},t.prototype.argMax=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),O.argMax(this,n)},t.prototype.cast=function(n){return this.throwIfDisposed(),O.cast(this,n)},t.prototype.add=function(n){return this.throwIfDisposed(),O.add(this,n)},t.prototype.addStrict=function(n){return this.throwIfDisposed(),O.addStrict(this,n)},t.prototype.atan2=function(n){return this.throwIfDisposed(),O.atan2(this,n)},t.prototype.sub=function(n){return this.throwIfDisposed(),O.sub(this,n)},t.prototype.subStrict=function(n){return this.throwIfDisposed(),O.subStrict(this,n)},t.prototype.pow=function(n){return this.throwIfDisposed(),O.pow(this,n)},t.prototype.powStrict=function(n){return this.throwIfDisposed(),O.powStrict(this,n)},t.prototype.mul=function(n){return this.throwIfDisposed(),O.mul(this,n)},t.prototype.mulStrict=function(n){return this.throwIfDisposed(),O.mulStrict(this,n)},t.prototype.div=function(n){return this.throwIfDisposed(),O.div(this,n)},t.prototype.divNoNan=function(n){return this.throwIfDisposed(),O.divNoNan(this,n)},t.prototype.floorDiv=function(n){return this.throwIfDisposed(),O.floorDiv(this,n)},t.prototype.divStrict=function(n){return this.throwIfDisposed(),O.divStrict(this,n)},t.prototype.minimum=function(n){return this.throwIfDisposed(),O.minimum(this,n)},t.prototype.minimumStrict=function(n){return this.throwIfDisposed(),O.minimumStrict(this,n)},t.prototype.maximum=function(n){return this.throwIfDisposed(),O.maximum(this,n)},t.prototype.maximumStrict=function(n){return this.throwIfDisposed(),O.maximumStrict(this,n)},t.prototype.mod=function(n){return this.throwIfDisposed(),O.mod(this,n)},t.prototype.modStrict=function(n){return this.throwIfDisposed(),O.modStrict(this,n)},t.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),O.squaredDifferenceStrict(this,n)},t.prototype.transpose=function(n){return this.throwIfDisposed(),O.transpose(this,n)},t.prototype.notEqual=function(n){return this.throwIfDisposed(),O.notEqual(this,n)},t.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),O.notEqualStrict(this,n)},t.prototype.less=function(n){return this.throwIfDisposed(),O.less(this,n)},t.prototype.lessStrict=function(n){return this.throwIfDisposed(),O.lessStrict(this,n)},t.prototype.equal=function(n){return this.throwIfDisposed(),O.equal(this,n)},t.prototype.equalStrict=function(n){return this.throwIfDisposed(),O.equalStrict(this,n)},t.prototype.lessEqual=function(n){return this.throwIfDisposed(),O.lessEqual(this,n)},t.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),O.lessEqualStrict(this,n)},t.prototype.greater=function(n){return this.throwIfDisposed(),O.greater(this,n)},t.prototype.greaterStrict=function(n){return this.throwIfDisposed(),O.greaterStrict(this,n)},t.prototype.greaterEqual=function(n){return this.throwIfDisposed(),O.greaterEqual(this,n)},t.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),O.greaterEqualStrict(this,n)},t.prototype.logicalAnd=function(n){return this.throwIfDisposed(),O.logicalAnd(this,n)},t.prototype.logicalOr=function(n){return this.throwIfDisposed(),O.logicalOr(this,n)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),O.logicalNot(this)},t.prototype.logicalXor=function(n){return this.throwIfDisposed(),O.logicalXor(this,n)},t.prototype.where=function(n,e){return this.throwIfDisposed(),O.where(n,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),O.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),O.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),O.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),O.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),O.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),O.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),O.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),O.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),O.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),O.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),O.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),O.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),O.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),O.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),O.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),O.abs(this)},t.prototype.clipByValue=function(n,e){return this.throwIfDisposed(),O.clipByValue(this,n,e)},t.prototype.relu=function(){return this.throwIfDisposed(),O.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),O.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),O.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),O.selu(this)},t.prototype.leakyRelu=function(n){return void 0===n&&(n=.2),this.throwIfDisposed(),O.leakyRelu(this,n)},t.prototype.prelu=function(n){return this.throwIfDisposed(),O.prelu(this,n)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),O.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),O.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),O.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),O.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),O.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),O.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),O.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),O.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),O.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),O.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),O.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),O.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),O.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),O.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),O.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),O.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),O.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),O.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),O.round(this)},t.prototype.step=function(n){return void 0===n&&(n=0),this.throwIfDisposed(),O.step(this,n)},t.prototype.softmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),O.softmax(this,n)},t.prototype.logSoftmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),O.logSoftmax(this,n)},t.prototype.resizeBilinear=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),O.image.resizeBilinear(this,n,e)},t.prototype.resizeNearestNeighbor=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),O.image.resizeNearestNeighbor(this,n,e)},t.prototype.conv1d=function(n,e,r,o,i,a){return void 0===o&&(o="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),O.conv1d(this,n,e,r,o,i,a)},t.prototype.conv2d=function(n,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),O.conv2d(this,n,e,r,o,i,a)},t.prototype.conv2dTranspose=function(n,e,r,o,i){return this.throwIfDisposed(),O.conv2dTranspose(this,n,e,r,o,i)},t.prototype.depthwiseConv2D=function(n,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),O.depthwiseConv2d(this,n,e,r,o,i,a)},t.prototype.separableConv2d=function(n,e,r,o,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),O.separableConv2d(this,n,e,r,o,i,a)},t.prototype.avgPool=function(n,e,r,o){return this.throwIfDisposed(),O.avgPool(this,n,e,r,o)},t.prototype.maxPool=function(n,e,r,o){return this.throwIfDisposed(),O.maxPool(this,n,e,r,o)},t.prototype.localResponseNormalization=function(n,e,r,o){return void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5),O.localResponseNormalization(this,n,e,r,o)},t.prototype.pool=function(n,e,r,o,i){return this.throwIfDisposed(),O.pool(this,n,e,r,o,i)},t.prototype.variable=function(n,e,r){return void 0===n&&(n=!0),this.throwIfDisposed(),io().makeVariable(this,n,e,r)},t.prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),O.unsortedSegmentSum(this,n,e)},t.prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),O.batchToSpaceND(this,n,e)},t.prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),O.spaceToBatchND(this,n,e)},t.prototype.topk=function(n,e){return void 0===n&&(n=1),void 0===e&&(e=!0),this.throwIfDisposed(),O.topk(this,n,e)},t.prototype.stridedSlice=function(n,e,r,o,i,a,s,u){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.throwIfDisposed(),O.stridedSlice(this,n,e,r,o,i,a,s,u)},t.prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),O.depthToSpace(this,n,e)},t.prototype.fft=function(){return this.throwIfDisposed(),O.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),O.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),O.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),O.spectral.irfft(this)},t}();Object.defineProperty(rt,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var w2,nm,rm,om,im,t,Cs=function(t){function n(e,r,o,i){var a=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return a.trainable=r,a.name=o,a}return Rr(n,t),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ft(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");io().disposeTensor(this),this.dataId=e.dataId,io().incRef(this,null)},n.prototype.dispose=function(){io().disposeVariable(this),this.isDisposedInternal=!0},n}(rt);Object.defineProperty(Cs,Symbol.hasInstance,{value:function(t){return t instanceof rt&&null!=t.assign&&t.assign instanceof Function}}),(t=w2||(w2={})).R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(nm||(nm={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(rm||(rm={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(om||(om={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(im||(im={}));var b5={float32:om,int32:nm,bool:rm,complex64:im};function Qt(t,n){if("string"===t||"string"===n){if("string"===t&&"string"===n)return"string";throw new Error("Can not upcast "+t+" with "+n)}return b5[t][n]}function am(t){return Qt(t,"int32")}function pt(t,n){if(t.dtype===n.dtype)return[t,n];var e=Qt(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function x2(t,n){D(t.dtype===n.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+n.dtype+") input must match"})}function sm(t){var n=[];return function e(r,o,i){if(null!=r){if(r instanceof rt)return void o.push(r);if(a=r,Array.isArray(a)||"object"==typeof a){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),e(c,o,i))}}}}(t,n,new Set),n}Object.freeze({makeTypesMatch:pt,assertTypesMatch:x2,isTensorInList:function(t,n){return n.some(function(e){return e.id===t.id})},getTensorsInContainer:sm});var um,_2=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},t}(),w5=function(){function t(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new _2}return t.prototype.ready=function(){return oe(this,void 0,void 0,function(){var n,e,r;return ie(this,function(o){switch(o.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];n=this.getSortedBackends(),e=0,o.label=1;case 1:return e<n.length?[4,this.initializeBackend(r=n[e]).success]:[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var n=this.initializeBackendsAndReturnBest(),e=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(n){return n in this.registry||n in this.registryFactory&&!this.initializeBackend(n).asyncInit?this.registry[n]:null},t.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},t.prototype.registerBackend=function(n,e,r){return void 0===r&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:e,priority:r},!0)},t.prototype.setBackend=function(n){return oe(this,void 0,void 0,function(){var e,r,o;return ie(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[n])throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,null!=this.registry[n]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(n),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new v5(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var n=this;r2(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(n.backendInstance)})},t.prototype.disposeRegisteredKernels=function(n){var e=this;r2(n).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(e.registry[n])})},t.prototype.initializeBackend=function(n){var e=this,r=this.registryFactory[n];if(null==r)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<e.pendingBackendInitId||(e.registry[n]=s,e.pendingBackendInit=null,0))}).catch(function(s){return!(i<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),1))});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[n]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var n=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return n.registryFactory[r].priority-n.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),e=0;e<n.length;e++){var r=n[e],o=this.initializeBackend(r),a=o.asyncInit;if(a||o.success)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(n,e){var r=this.state.tensorInfo.get(e),o=r.backend,i=this.readSync(e);o.disposeData(e),r.backend=n,n.move(e,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(n,e){var r,o=this,i=null;if(null==e){if("function"!=typeof n)throw new Error("Please provide a function to tidy()");e=n}else{if("string"!=typeof n&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(n,e,r){n();try{var o=r();return e(),o}catch(i){throw e(),i}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(n){var e=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype);return this.addTapeNode(this.state.activeScope.name,{x:n},[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},t.prototype.runKernel=function(n,e,r,o,i){return this.runKernelFunc(null,e,null,n,r,o,i)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(n,e,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+="complex64"===u.dtype?3:1});var s=o-e-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},t.prototype.runKernelFunc=function(n,e,r,o,i,a,s){var u,c=this;void 0===a&&(a=[]),void 0===s&&(s=[]);var l=[],d=this.isTapeOn();null==o&&(o=null!=this.state.activeScope?this.state.activeScope.name:"");var f,h=function(b){d&&(l=b.map(function(y){return c.keep(c.clone(y))}))},p=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,m=n2(o,this.backendName);return f=null!=m?function(){var b=c.backend.numDataIds();v=m.kernelFunc({inputs:e,attrs:i,backend:c.backend});var y=Array.isArray(v)?v:[v];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,y);var w=y.map(function(_){return c.makeTensorFromDataId(_.dataId,_.shape,_.dtype)}),x=w.filter(function(_,M){return s[M]});return h((a||[]).slice().concat(x)),w}:function(){var b=c.backend.numDataIds();v=c.tidy(function(){return n(c.backend,h)});var y=Array.isArray(v)?v:[v];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,y),y},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,e,function(){return f()}):f()}),d&&this.addTapeNode(o,e,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(b){return e[b].shape}),outputShapes:u.map(function(b){return b.shape})}),Array.isArray(v)?u:u[0]},t.prototype.makeTensor=function(n,e,r,o){if(null==n)throw new Error("Values passed to engine.makeTensor() are null");o=o||this.backend;var i=n;"string"===(r=r||"float32")&&_i(n[0])&&(i=n.map(function(l){return g2(l)}));var a=o.write(i,e,r),s=new rt(e,r,a,this.nextTensorId());if(this.incRef(s,o),"string"===r){var u=this.state.tensorInfo.get(a),c=f2(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},t.prototype.makeTensorFromDataId=function(n,e,r,o){var i=new rt(e,r=r||"float32",n,this.nextTensorId());return this.incRef(i,o),i},t.prototype.makeVariable=function(n,e,r,o){void 0===e&&(e=!0),r=r||this.nextVariableId().toString(),null!=o&&o!==n.dtype&&(n=n.asType(o));var i=new Cs(n,e,r,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.incRef=function(n,e){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,"string"===n.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var o=0;"complex64"!==n.dtype&&"string"!==n.dtype&&(o=n.size*Xv(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:e||this.backend,dtype:n.dtype,shape:n.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Cs||this.track(n)},t.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,"string"===n.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(n.dataId);e.refCount<=1?("complex64"!==n.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[n])},t.prototype.disposeVariable=function(n){this.disposeTensor(n),null!=this.state.registeredVariables[n.name]&&delete this.state.registeredVariables[n.name]},t.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,null==n.reasons&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},t.prototype.profile=function(n){return oe(this,void 0,void 0,function(){var e,r;return ie(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(n,e,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:e,outputs:r,saved:i},u=function p5(t){return oc.get(t)}(n);null!=u&&(o=u.gradFunc),null!=o&&(s.gradient=function(c){return c=c.map(function(l,d){if(null==l){var f=r[d],h=_s(f.size,f.dtype);return a.makeTensor(h,f.shape,f.dtype)}return l}),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},t.prototype.keep=function(n){return n.kept=!0,n},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(n){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(e.name=n),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(n){for(var e=this,r=sm(n),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},t.prototype.gradients=function(n,e,r,o){var i=this;if(void 0===o&&(o=!1),D(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",n)});D(a instanceof rt,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var d={},f={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(_=u[h]).inputs;for(var g in p){for(var v=p[g],m=!1,b=0;b<c.length;b++)if(d[v.id]){_.outputs.forEach(function(S){return d[S.id]=!0}),m=!0,f[_.id]=!0;break}if(m)break}}var y={};y[l.id]=!0;var w={};for(h=u.length-1;h>=0;h--)for(p=(_=u[h]).inputs,b=0;b<_.outputs.length;b++)if(y[_.outputs[b].id]){for(var g in p)y[p[g].id]=!0,w[_.id]=!0;break}var x=[];for(h=0;h<u.length;h++){var _;if(f[(_=u[h]).id]&&w[_.id]){var M={};for(var g in _.inputs){var I=_.inputs[g];d[I.id]&&(M[g]=I)}var E=Object.assign({},_);E.inputs=M,E.outputs=_.outputs,x.push(E)}}return x}(this.state.activeTape,e,a);if(!o&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=r??(c=Jv(ae(u=a.shape),"float32"),R.makeTensor(c,u,"float32")),function(f,h,p){for(var g=function(m){var b=h[m],y=[];if(b.outputs.forEach(function(M){var I=f[M.id];y.push(null!=I?I:null)}),null==b.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var w=b.gradient(y),x=function(M){if(!(M in w))throw new Error("Cannot backprop through input "+M+". Available gradients found: "+Object.keys(w)+".");var I=i.tidy(function(){return w[M]()});if("float32"!==I.dtype)throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+M+" must have 'float32' dtype, but has '"+I.dtype+"'");var E=b.inputs[M];if(!Ft(I.shape,E.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+M+"' has shape '"+I.shape+"', which does not match the shape of the input '"+E.shape+"'");if(null==f[E.id])f[E.id]=I;else{var S=f[E.id];f[E.id]=S.add(I),S.dispose()}};for(var _ in b.inputs)x(_)},v=h.length-1;v>=0;v--)g(v)}(l,s);var d=e.map(function(f){return l[f.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:d}})},t.prototype.customGrad=function(n){var e=this;return D(Ci(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];D(o.every(function(s){return s instanceof rt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),e.runKernelFunc(function(s,u){return D((r=n.apply(void 0,o.concat([u]))).value instanceof rt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),D(Ci(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];D(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),D(l.every(function(f){return f instanceof rt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(f,h){d[h]=function(){return f}}),d})}},t.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},t.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},t.prototype.time=function(n){return oe(this,void 0,void 0,function(){var e,r;return ie(this,function(o){switch(o.label){case 0:return e=Ar(),[4,this.backend.time(n)];case 1:return(r=o.sent()).wallMs=Ar()-e,[2,r]}})})},t.prototype.track=function(n){return null!=this.state.activeScope&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new _2,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),R=function(){var t=function(){if(null==um){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}um=e}return um}();if(null==t._tfengine){var n=new f5(t);t._tfengine=new w5(n)}return t2=t._tfengine.ENV,io=function(){return t._tfengine},t._tfengine}();function C2(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var zo=F();zo.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),zo.registerFlag("IS_BROWSER",function(){return C2()}),zo.registerFlag("IS_NODE",function(){return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node}),zo.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),zo.registerFlag("PROD",function(){return!1}),zo.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return zo.getBool("DEBUG")}),zo.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),zo.registerFlag("IS_TEST",function(){return!1});var dc,Yn,Jn,aa={},cm={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function D2(t,n){aa[t]=n}function ao(t){t in aa||(aa[t]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&2===o)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete aa[e]},!1),1===e?r.getContext("webgl",cm)||r.getContext("experimental-webgl",cm):r.getContext("webgl2",cm)}(t));var n=aa[t];return n.isContextLost()?(delete aa[t],ao(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),aa[t])}function Kd(t,n){return[n,t]}function fc(t){var n=ae(t);return Gd(Math.ceil(n/4))}function hc(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function lm(t,n){var e,r,o,i,a,s,u,c,l,d=t;return 2===F().getNumber("WEBGL_VERSION")?(e=d.R32F,r=d.R16F,o=d.RGBA16F,i=d.RGBA32F,a=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(e=t.RGBA,r=t.RGBA,o=t.RGBA,i=d.RGBA,a=t.RGBA,s=4,u=4,c=null!=n?n.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function ne(t,n,e){var r=e();return n&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+S2(o,i))}(t),r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(dc||(dc={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Yn||(Yn={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Jn||(Jn={}));var x5=5.96e-8,_5=65504;function E2(t){return!!(F().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||x5<Math.abs(t)&&Math.abs(t)<_5)}function S2(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function pc(t,n,e){return $o(t,n,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function I2(t,n,e){var r=$o(t,n,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ne(t,n,function(){return t.shaderSource(r,e)}),ne(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function M2(t,n,e){var r=$o(t,n,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ne(t,n,function(){return t.shaderSource(r,e)}),ne(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(o,i){var a=C5.exec(i);if(null==a)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split("\n"),c=u.length.toString().length+2,l=u.map(function(v,m){return ia((m+1).toString(),c)+v}),d=0,f=0;f<l.length;f++)d=Math.max(l[f].length,d);var h=l.slice(0,s-1),p=l.slice(s-1,s),g=l.slice(s);console.log(h.join("\n")),console.log(i.split("\n")[0]),console.log("%c "+ia(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join("\n"))}(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Xd,Qd,C5=/ERROR: [0-9]+:([0-9]+):/g;function R2(t,n){return $o(t,n,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function T2(t,n,e){if(ne(t,n,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Yd(t,n,e){if(ne(t,n,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function A2(t,n,e){var r=$o(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ne(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),ne(t,n,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function k2(t,n,e){var r=$o(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ne(t,n,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),ne(t,n,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function P2(t,n){return $o(t,n,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function O2(t,n){var e=F().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){var r="["+t+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e)throw r="["+t+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+e+"x"+e+"].")}function N2(t,n){return $o(t,n,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function dm(t,n,e,r,o,i,a,s){var u=t.getAttribLocation(e,r);return-1!==u&&(ne(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),ne(t,n,function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)}),ne(t,n,function(){return t.enableVertexAttribArray(u)}),!0)}function F2(t,n,e,r){j2(t,r),ne(t,n,function(){return t.activeTexture(t.TEXTURE0+r)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function L2(t,n,e,r){return $o(t,n,function(){return t.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function B2(t,n,e){return t.getUniformLocation(n,e)}function U2(t,n,e,r,o,i){ne(t,n,function(){return F2(t,n,r,i)}),ne(t,n,function(){return t.uniform1i(o,i)})}function Jd(t,n,e,r){ne(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),ne(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function fm(t,n,e){ne(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),ne(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function gc(t){var n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+V2(t,n))}function V2(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function $o(t,n,e,r){var o=ne(t,n,function(){return e()});if(null==o)throw new Error(r);return o}function j2(t,n){var e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+e+"].")}function vc(t,n){return void 0===n&&(n=2),ae(t.slice(0,t.length-n))}function mc(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Zd(t){var n=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(n=[vc(t)].concat(mc(t))),n}function H2(t,n){var e;void 0===n&&(n=!1);var r=F().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,1===(t=t.map(function(c,l){return l>=t.length-2?qv(t[l]):t[l]})).length&&(t=[2,t[0]])),2!==t.length){var o=xi(t);t=o.newShape}var i=ae(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(n){var a=vc(t),s=2,u=2;return t.length&&(s=(e=mc(t))[0],u=e[1]),Gd(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return Gd(i)}function ef(t){return t%2==0}function yc(t,n){if(Ft(t=t.slice(-2),n=n.slice(-2))||!t.length||!n.length||0===t[0]||0===t[1]||0===n[0]||0===n[1])return!0;if(t.length!==n.length){var e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||ef(e)&&ef(r)&&(1===t[0]||1===n[0]))return!0}return t[1]===n[1]&&ef(t[0])&&ef(n[0])}function W2(t){if(null==Xd){var n=ao(t);Xd=n.getParameter(n.MAX_TEXTURE_SIZE)}return Xd}function z2(t){if(null==Qd){var n=ao(t);Qd=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Qd)}function $2(t){if(0===t)return 0;var n=ao(t);return Zn(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:Zn(n,"EXT_disjoint_timer_query")?1:0}function Zn(t,n){return null!=t.getExtension(n)}function hm(t){try{if(null!=ao(t))return!0}catch{return!1}return!1}function G2(t){if(0===t)return!1;var n=ao(t);if(1===t){if(!Zn(n,"OES_texture_float"))return!1}else if(!Zn(n,"EXT_color_buffer_float"))return!1;return pm(n)}function q2(t){if(0===t)return!1;var n=ao(t);if(1!==t){if(Zn(n,"EXT_color_buffer_float"))return pm(n);if(Zn(n,"EXT_color_buffer_half_float")){var e=n.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=lm(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(n,e)}return!1}return!!Zn(n,"OES_texture_float")&&!!Zn(n,"WEBGL_color_buffer_float")&&pm(n)}function pm(t){var n=lm(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(r),o}function K2(t){return 2===t&&null!=ao(t).fenceSync}var D5=Object.freeze({callAndCheck:ne,canBeRepresented:E2,getWebGLErrorMessage:S2,getExtensionOrThrow:pc,createVertexShader:I2,createFragmentShader:M2,createProgram:R2,linkProgram:T2,validateProgram:Yd,createStaticVertexBuffer:A2,createStaticIndexBuffer:k2,getNumChannels:function(){return 2===F().getNumber("WEBGL_VERSION")?1:4},createTexture:P2,validateTextureSize:O2,createFramebuffer:N2,bindVertexBufferToProgramAttribute:dm,bindTextureUnit:F2,unbindTextureUnit:function(t,n,e){j2(t,e),ne(t,n,function(){return t.activeTexture(t.TEXTURE0+e)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:L2,getProgramUniformLocation:B2,bindTextureToProgramUniformSampler:U2,bindCanvasToFramebuffer:function(t,n){ne(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),ne(t,n,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),ne(t,n,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:Jd,unbindColorTextureFromFramebuffer:fm,validateFramebuffer:gc,getFramebufferErrorMessage:V2,getBatchDim:vc,getRowsCols:mc,getShapeAs3D:Zd,getTextureShapeFromLogicalShape:H2,isReshapeFree:yc,getWebGLMaxTextureSize:W2,resetMaxTextureSize:function(){Xd=null},resetMaxTexturesInShader:function(){Qd=null},getMaxTexturesInShader:z2,getWebGLDisjointQueryTimerVersion:$2,hasExtension:Zn,isWebGLVersionEnabled:hm,isCapableOfRenderingToFloatTexture:G2,isDownloadFloatTextureEnabled:q2,isWebGLFenceEnabled:K2}),xe=F();function X2(t){F().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function te(t,n){return R.tidy(t,n)}function Ln(t){sm(t).forEach(function(n){return n.dispose()})}function tf(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];F().getBool("IS_TEST")||console.warn.apply(console,t)}function so(t,n){var e=t;if(rn(t))return"string"===n?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(e)||rn(e)&&"string"!==n;)r.push(e.length),e=e[0];return Array.isArray(t)&&F().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],Array.isArray(i)||rn(i)){D(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),D(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))}else D(0===a.length,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"})}(t,r,[]),r}function Q2(t,n,e,r){if(null!=t&&("numeric"!==t&&t!==n||"numeric"===t&&"string"===n))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+t+" tensor, but got "+n+" tensor")}function C(t,n,e,r){if(void 0===r&&(r="numeric"),t instanceof rt)return Q2(r,t.dtype,n,e),t;var o=xs(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Q2(r,o,n,e),null==t||!rn(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+n+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+(null==t?"null":t.constructor.name)+"'");var a=so(t,o);rn(t)||Array.isArray(t)||(t=[t]);var s="string"!==o?Qv(t,o,F().getBool("DEBUG")):Wo(t,[],!0);return R.makeTensor(s,a,o)}function bc(t,n,e,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+n+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(o,i){return C(o,n+"["+i+"]",e)},r)}function gm(t,n){for(var e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function Y2(t,n,e){for(var r=t.length+n.length,o=[],i=0,a=0,s=0;s<r;s++)-1===e.indexOf(s)?o.push(t[i++]):o.push(n[a++]);return o}function on(t,n){for(var e=[],r=t.length,o=0;o<r;o++)-1===n.indexOf(o)&&e.push(t[o]);return[e,n.map(function(i){return t[i]})]}function Mn(t,n){return Y2(t,n.map(function(e){return 1}),n)}function Bn(t,n,e){D(gm(n,e),function(){return t+" supports only inner-most axes for now. Got axes "+n+" and rank-"+e+" input."})}function kr(t,n){if(gm(t,n))return null;for(var e=[],r=0;r<n;++r)-1===t.indexOf(r)&&e.push(r);return t.forEach(function(o){return e.push(o)}),e}function nf(t){return t.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function Pr(t,n){for(var e=[],r=n-t;r<n;++r)e.push(r);return e}function J2(t,n){var e=t[0].length;t.forEach(function(o,i){D(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),D(n>=0&&n<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=t[0];t.forEach(function(o,i){for(var a=0;a<e;a++)D(a===n||o[a]===r[a],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function sa(t,n){for(var e=t[0].slice(),r=1;r<t.length;r++)e[n]+=t[r][n];return e}function T(t){var n=Object.keys(t);if(1!==n.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];R.startScope(e);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),R.endScope(s),s}catch(u){throw R.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}xe.registerFlag("HAS_WEBGL",function(){return xe.getNumber("WEBGL_VERSION")>0}),xe.registerFlag("WEBGL_VERSION",function(){return hm(2)?2:hm(1)?1:0}),xe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===xe.get("WEBGL_VERSION")}),xe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),xe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),xe.registerFlag("WEBGL_PACK",function(){return xe.getBool("HAS_WEBGL")}),xe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_CLIP",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),xe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_PACK_REDUCE",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_CONV_IM2COL",function(){return xe.getBool("WEBGL_PACK")}),xe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return W2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return z2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=xe.getNumber("WEBGL_VERSION");return 0===t?0:$2(t)}),xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return xe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),xe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return G2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!xe.getBool("WEBGL_FORCE_F16_TEXTURES")&&xe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),xe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return q2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return K2(xe.getNumber("WEBGL_VERSION"))}),xe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return xe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),b2=X2;var an=T({complex_:function(t,n){var e=C(t,"real","complex"),r=C(n,"imag","complex");return ze(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),R.runKernelFunc(function(o){return o.complex(e,r)},{$real:e,$imag:r})}}),pr=T({real_:function(t){var n=C(t,"input","real");return R.runKernelFunc(function(e){return e.real(n)},{$input:n})}}),uo=T({imag_:function(t){var n=C(t,"input","imag");return R.runKernelFunc(function(e){return e.imag(n)},{$input:n})}});function sn(t,n,e){return Di(t,n,so(t,e),e)}function Di(t,n,e,r){if(null==r&&(r=xs(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!rn(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=n){Zv(n);var o=ae(n),i=ae(e);D(o===i,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<e.length;++a){var u=a!==e.length-1||e[a]!==ae(n.slice(a));D(e[a]===n[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+n+"). "})}}return rn(t)||Array.isArray(t)||(t=[t]),n=n||e,t="string"!==r?Qv(t,r,F().getBool("DEBUG")):Wo(t,[],!0),R.makeTensor(t,n,r)}function Y(t,n){if((rn(t)&&"string"!==n||Array.isArray(t))&&"complex64"!==n)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===n&&rn(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Di(t,[],[],n)}function Bt(t,n){oa(t);var e=so(t,n);if(1!==e.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Di(t,null,e,n)}function Ei(t,n,e){if(oa(t),null!=n&&2!==n.length)throw new Error("tensor2d() requires shape to have two numbers");var r=so(t,e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Di(t,n,r,e)}function vm(t,n,e){if(oa(t),null!=n&&3!==n.length)throw new Error("tensor3d() requires shape to have three numbers");var r=so(t,e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Di(t,n,r,e)}function Un(t,n,e){if(oa(t),null!=n&&4!==n.length)throw new Error("tensor4d() requires shape to have four numbers");var r=so(t,e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Di(t,n,r,e)}function Ds(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=Ds(t,"float32"),r=ft(t,"float32");return an(e,r)}var o=Jv(ae(t),n);return R.makeTensor(o,t,n)}function ft(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=ft(t,"float32"),r=ft(t,"float32");return an(e,r)}var o=_s(ae(t),n);return R.makeTensor(o,t,n)}function co(t,n,e){return R.runKernelFunc(function(r){return r.fill(t,n,e)},{})}function rf(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r="float32"),0===e)throw new Error("Cannot have a step of zero");if(t===n||t<n&&e<0||n<t&&e>1)return ft([0],r);var o=_s(Math.abs(Math.ceil((n-t)/e)),r);n<t&&1===e&&(e=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+e;return Bt(o,r)}var Z2=T({onesLike_:function(t){var n=C(t,"x","onesLike");if("complex64"===n.dtype){var e=Z2(pr(n)),r=$e(uo(n));return an(e,r)}return R.runKernelFunc(function(o){return o.onesLike(n)},{$x:n},function(o,i){return{$x:function(){return $e(o)}}})}}),$e=T({zerosLike_:function(t){var n=C(t,"x","zerosLike");return R.runKernelFunc(function(e){return e.zerosLike(n)},{$x:n},function(e,r){return{$x:function(){return $e(e)}}})}}),zt=T({concat_:function(t,n){void 0===n&&(n=0),D(t.length>=1,function(){return"Pass at least one tensor to concat"});var e=bc(t,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(s){if("complex64"!==s.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+s.dtype+". ")}),n=Lt(n,e[0].shape)[0];var r=sa(e.map(function(s){return s.shape}),n);if(0===ae(r))return sn([],r);if(1===(e=e.filter(function(s){return s.size>0})).length)return e[0];var o=e.map(function(s){return s.shape});return J2(o,n),R.runKernelFunc(function(s){return s.concat(e,n)},e,function(s){var u=o.map(function(c){return c[n]});return mm(s,u,n).map(function(c){return function(){return c}})},"Concat",{axis:n})}}),T5=T({concat1d_:function(t){return zt(t,0)}}),A5=T({concat2d_:function(t,n){return zt(t,n)}}),k5=T({concat3d_:function(t,n){return zt(t,n)}}),P5=T({concat4d_:function(t,n){return zt(t,n)}}),mm=T({split_:function(t,n,e){void 0===e&&(e=0);var r,o=C(t,"x","split");return e=Lt(e,o.shape)[0],"number"==typeof n?(D(o.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(n).fill(o.shape[e]/n)):(D(o.shape[e]===n.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=n),R.runKernelFunc(function(i){return i.split(o,r,e)},{$x:o},function(i){return{$x:function(){return zt(i,e)}}})}});function ua(t,n){return t(n={exports:{}},n.exports),n.exports}typeof globalThis<"u"||typeof window<"u"||typeof global<"u"&&global;var O5=ua(function(t){!function(n,e,r){function o(s){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var d=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.alea=a}(0,t)}),N5=ua(function(t){!function(n,e,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor128=a}(0,t)}),F5=ua(function(t){!function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorwow=a}(0,t)}),L5=ua(function(t){!function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.x,f=u.i;return c=d[f],l=(c^=c>>>7)^c<<24,l^=(c=d[f+1&7])^c>>>10,l^=(c=d[f+3&7])^c>>>3,l^=(c=d[f+4&7])^c<<7,c=d[f+7&7],l^=(c^=c<<13)^c<<9,d[f]=l,u.i=f+1&7,l},function(c,l){var d,f=[];if(l===(0|l))f[0]=l;else for(l=""+l,d=0;d<l.length;++d)f[7&d]=f[7&d]<<15^l.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&0===f[d];++d);for(8==d&&(f[7]=-1),c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.x&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorshift7=a}(0,t)}),B5=ua(function(t){!function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,l=f[h+34&127],c=f[h=h+1&127],l^=l<<13,c^=c<<17,l=f[h]=(l^=l>>>15)^(c^=c>>>12),u.i=h,l+(d^d>>>16)|0},function(c,l){var d,f,h,p,g,v=[],m=128;for(l===(0|l)?(f=l,l=null):(l+="\0",f=0,m=Math.max(m,l.length)),h=0,p=-32;p<m;++p)l&&(f^=l.charCodeAt((p+32)%l.length)),0===p&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(h=0==(d=v[127&p]^=f+(g=g+1640531527|0))?h+1:0);for(h>=128&&(v[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)f=v[h+34&127],d=v[h=h+1&127],f^=f<<13,d^=d<<17,v[h]=(f^=f>>>15)^(d^=d>>>12);c.w=g,c.X=v,c.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.X&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor4096=a}(0,t)}),U5=ua(function(t){!function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.tychei=a}(0,t)}),ca=ua(function(t){!function(n,e){var r,o=this,i=256,a=6,s="random",u=e.pow(i,a),c=e.pow(2,52),l=2*c,d=i-1;function f(m,b,y){var w=[],x=g(function I(E,S){var k,A=[],U=typeof E;if(S&&"object"==U)for(k in E)try{A.push(I(E[k],S-1))}catch{}return A.length?A:"string"==U?E:E+"\0"}((b=1==b?{entropy:!0}:b||{}).entropy?[m,v(n)]:m??function(){try{var I;return r&&(I=r.randomBytes)?I=I(i):(I=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(I)),v(I)}catch{var E=o.navigator,S=E&&E.plugins;return[+new Date,o,S,o.screen,v(n)]}}(),3),w),_=new h(w),M=function(){for(var I=_.g(a),E=u,S=0;I<c;)I=(I+S)*i,E*=i,S=_.g(1);for(;I>=l;)I/=2,E/=2,S>>>=1;return(I+S)/E};return M.int32=function(){return 0|_.g(4)},M.quick=function(){return _.g(4)/4294967296},M.double=M,g(v(_.S),n),(b.pass||y||function(I,E,S,k){return k&&(k.S&&p(k,_),I.state=function(){return p(_,{})}),S?(e[s]=I,E):I})(M,x,"global"in b?b.global:this==e,b.state)}function h(m){var b,y=m.length,w=this,x=0,_=w.i=w.j=0,M=w.S=[];for(y||(m=[y++]);x<i;)M[x]=x++;for(x=0;x<i;x++)M[x]=M[_=d&_+m[x%y]+(b=M[x])],M[_]=b;(w.g=function(I){for(var E,S=0,k=w.i,A=w.j,U=w.S;I--;)E=U[k=d&k+1],S=S*i+U[d&(U[k]=U[A=d&A+E])+(U[A]=E)];return w.i=k,w.j=A,S})(i)}function p(m,b){return b.i=m.i,b.j=m.j,b.S=m.S.slice(),b}function g(m,b){for(var y,w=m+"",x=0;x<w.length;)b[d&x]=d&(y^=19*b[d&x])+w.charCodeAt(x++);return v(b)}function v(m){return String.fromCharCode.apply(0,m)}if(e["seed"+s]=f,g(e.random(),n),t.exports){t.exports=f;try{r=zs(369)}catch{}}}([],Math)});ca.alea=O5,ca.xor128=N5,ca.xorwow=F5,ca.xorshift7=L5,ca.xor4096=B5,ca.tychei=U5;var af=ca.alea,ym=function(){function t(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=af(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var e,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do{s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(s>=1||0===s);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},t.prototype.convertValue=function(n){return null==this.dtype||"float32"===this.dtype?n:Math.round(n)},t.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},t}(),V5=function(){function t(n,e,r,o){this.alpha=n,this.beta=1/e,this.dtype=r;var i=o||Math.random();this.randu=af(i.toString()),this.randn=new ym(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var n,e,r,o,i,a;;){do{o=this.randn.nextValue(),a=1+this.c*o}while(a<=0);if(e=1-.331*(n=o*o)*n,r=.5*n+this.d*(1-(a*=a*a)+Math.log(a)),(i=this.randu())<e||Math.log(i)<r)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(n){return"float32"===this.dtype?n:Math.round(n)},t}(),j5=function(){function t(n,e,r,o){var i=this;if(void 0===n&&(n=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=n,this.range=e-n,this.dtype=r,null==o&&(o=Math.random()),"number"==typeof o&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+e+" <= 1 and dtype is not float");this.random=af(o)}return t.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Se(t,n,e){return void 0===n&&(n="float32"),n=n||"float32",Zv(t),new lc(t,n,e)}var eS=T({batchToSpaceND_:function(t,n,e){var r=C(t,"x","batchToSpaceND"),o=n.reduce(function(i,a){return i*a});return D(r.rank>=1+n.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length}),D(e.length===n.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+n.length}),D(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o}),R.runKernelFunc(function(i){return i.batchToSpaceND(r,n,e)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(n,e)}}})}}),W5=T({broadcastTo_:function(t,n){var e=C(t,"broadcastTo","x"),r=e.shape;if(n.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<e.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+e.rank+".");if(n.length>e.rank){for(var o=e.shape.slice();o.length<n.length;)o.unshift(1);e=e.reshape(o)}for(var i=Array.from(n),a=n.length-1;a>=0;a--)if(e.shape[a]===n[a])i[a]=1;else if(1!==e.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var s=i.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return 0===s.length?e.clone():R.runKernelFunc(function(u){return u.tile(e,i)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),z5=T({cast_:function(t,n){var e=C(t,"x","cast");if(!l2(n))throw new Error("Failed to cast to unknown dtype "+n);if("string"===n&&"string"!==e.dtype||"string"!==n&&"string"===e.dtype)throw new Error("Only strings can be casted to strings");return R.runKernelFunc(function(o){return o.cast(e,n)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",{dtype:n})}}),$5=T({clone_:function(t){var n=C(t,"x","clone",null);return R.runKernelFunc(function(){return R.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(e){return{$x:function(){return e.toFloat()}}})}}),G5=T({cumsum_:function(t,n,e,r){void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1);var o=C(t,"x","cumsum"),i=kr([n|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Pr(1,o.rank)[0],u=R.runKernelFunc(function(c){return c.cumsum(a,s,e,r)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(n,e,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),q5=T({depthToSpace_:function(t,n,e){void 0===e&&(e="NHWC");var r=C(t,"x","depthToSpace"),o="NHWC"===e?r.shape[1]:r.shape[2],i="NHWC"===e?r.shape[2]:r.shape[3],a="NHWC"===e?r.shape[3]:r.shape[1];return D(o*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+n+"  for depthToSpace with input shape\n      "+r.shape}),D(i*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+n+" for depthToSpace with input shape\n          "+r.shape}),D(a%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape}),R.runKernelFunc(function(s){return s.depthToSpace(r,n,e)},{$x:r})}}),gr=T({expandDims_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","expandDims",null);D(n<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return n<0&&(D(-(e.rank+1)<=n,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),n=e.rank+n+1),r.splice(n,0,1),Or(e,r)}}),tS=T({eye_:function(t,n,e,r){void 0===r&&(r="float32"),null==n&&(n=t);for(var o=Se([t,n],r),i=t<=n?t:n,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,n);if(null==e)return s;if(1===e.length)return Es(gr(s,0),[e[0],1,1]);if(2===e.length)return Es(gr(gr(s,0),0),[e[0],e[1],1,1]);if(3===e.length)return Es(gr(gr(gr(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),K5=T({multinomial_:function(t,n,e,r){void 0===r&&(r=!1);var o=C(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);e=e||Math.random();var s=1===a?o.as2D(1,-1):o,u=R.runKernelFunc(function(c){return c.multinomial(s,r,n,e)},{logits2D:s});return 1===a?u.as1D():u}}),bm=T({oneHot_:function(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var o=C(t,"indices","oneHot","int32"),i=o.shape.concat([n]);return o=o.flatten(),R.runKernelFunc(function(a){return a.oneHot(o,n,e,r)},{$indices:o},function(a){return{$indices:function(){return ft(o.shape,"float32")}}}).reshape(i)}}),la=T({pad_:function(t,n,e){void 0===e&&(e=0);var r=C(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return R.runKernelFunc(function(i){return i.pad(r,n,e)},{x:r},function(i){var a=n.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",{paddings:n,constantValue:e})}}),X5=T({pad1d_:function(t,n,e){return void 0===e&&(e=0),D(2===n.length,function(){return"Invalid number of paddings. Must be length of 2."}),la(t,[n],e)}}),Q5=T({pad2d_:function(t,n,e){return void 0===e&&(e=0),D(2===n.length&&2===n[0].length&&2===n[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),la(t,n,e)}}),Y5=T({pad3d_:function(t,n,e){return void 0===e&&(e=0),D(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),la(t,n,e)}}),J5=T({pad4d_:function(t,n,e){return void 0===e&&(e=0),D(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),la(t,n,e)}}),Z5=T({rand_:function(t,n,e){var r=ae(t),o=null;if(null==e||"float32"===e)o=new Float32Array(r);else if("int32"===e)o=new Int32Array(r);else{if("bool"!==e)throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=n();return R.makeTensor(o,t,e)}}),eH=T({randomNormal_:function(t,n,e,r,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new ym(n,e,r,!1,o),a=Se(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),tH=T({randomGamma_:function(t,n,e,r,o){if(void 0===e&&(e=1),void 0===r&&(r="float32"),null==e&&(e=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new V5(n,e,r,o),a=Se(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),nS=T({randomUniform_:function(t,n,e,r,o){void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r="float32");for(var i=Se(t,r),a=new j5(n,e,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Or=T({reshape_:function(t,n){var e=C(t,"x","reshape",null);return n=u2(n,e.size),D(e.size===ae(n),function(){return"new shape and old shape must have the same number of elements."}),R.runKernelFunc(function(o){return o.reshape(e,n)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",{shape:n})}}),rS=T({spaceToBatchND_:function(t,n,e){var r=C(t,"x","spaceToBatchND");return D(r.rank>=1+n.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length}),D(e.length===n.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+n.length}),D(r.shape.reduce(function(o,i,a){return a>0&&a<=n.length?o&&(i+e[a-1][0]+e[a-1][1])%n[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+n.toString()}),R.runKernelFunc(function(o){return o.spaceToBatchND(r,n,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(n,e)}}})}}),oS=T({squeeze_:function(t,n){var e=C(t,"x","squeeze");return Or(e,xi(e.shape,n).newShape)}}),er=T({stack_:function(t,n){void 0===n&&(n=0);var e=bc(t,"tensors","stack");if(D(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(n);var o=e[0].shape,i=e[0].dtype;D(n<=e[0].rank,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){ze(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){D(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(s){return s.expandDims(n)});return zt(a,n)}}),Es=T({tile_:function(t,n){var e=C(t,"x","tile",null);return D(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."}),R.runKernelFunc(function(i,a){var s=i.tile(e,n);return a([e]),s},{x:e},function(i,a){var s=a[0];return{x:function(){var u=$e(s);if(1===s.rank)for(var c=0;c<n[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(2===s.rank)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(3===s.rank)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var d=0;d<n[2];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(4!==s.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(d=0;d<n[2];++d)for(var f=0;f<n[3];++f)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",{reps:n},[e])}}),nH=T({truncatedNormal_:function(t,n,e,r,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new ym(n,e,r,!0,o),a=Se(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),$t=T({unstack_:function(t,n){void 0===n&&(n=0),n=n||0;var e=C(t,"x","unstack");return D(n>=-e.shape.length&&n<e.shape.length,function(){return"Axis = "+n+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),n<0&&(n+=e.shape.length),R.runKernelFunc(function(o){return o.unstack(e,n)},{x:e},function(o){return{x:function(){return er(o,n)}}},"Unpack",{axis:n})}});function sf(t,n,e,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(n.slice(0))).push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=n.length,a=0;a<i;++a)o=o.concat([t[a+1]/n[a],n[a]]);o=o.concat(t.slice(i+1))}return o}function uf(t,n,e){void 0===e&&(e=!0);var r=[];if(e){r.push(n);for(var o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*n+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function cf(t,n,e,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/e:t[0]*e);for(var i=1;i<t.length;++i)o.push(i<=n.length?r?n[i-1]*t[i]:t[i]/n[i-1]:t[i]);return o}function iS(t,n){for(var e=[0],r=0;r<n;++r)e.push(t[r][0]);return e}function aS(t,n,e){for(var r=t.slice(0,1),o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}function wm(t,n){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==n.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var e=n.shape,r=e[e.length-1],o=1,i=0;i<e.length-1;++i)o*=e[i];var a=t.shape,s=e.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var c=Tr(t.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[s,o,u,c]}Object.freeze({prepareAndValidate:wm});var xm=30;function lf(t){return t<=xm?t:qd(t,Math.floor(Math.sqrt(t)))}function sS(t,n,e){var r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+n.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(e.rank-o))throw new Error(i+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(e.shape[a]!==n.shape[a])throw new Error(i+" updates.shape["+a+"] ("+e.shape[a]+") != indices.shape["+a+"] ("+n.shape[a]+").");for(a=0;a<e.rank-o;++a)if(e.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+e.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}function uS(t,n,e){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==n.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(0===e.length){if(0===n.size)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}sS(e,n,t)}function wc(t,n,e){for(var r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,a=1,s=o;s<i;++s)a*=e[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ae(n.shape)/u,sliceSize:a,strides:Tr(e.slice(0,o)).concat([1]),outputSize:ae(e)}}function cS(t,n,e){D(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+n+" must match the rank of the array ("+t.rank+")."}),D(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of size "+e+" must match the rank of the array ("+t.rank+")."});for(var r=function(i){D(n[i]+e[i]<=t.shape[i],function(){return"Error in slice"+t.rank+"D: begin["+i+"] + size["+i+"] ("+(n[i]+e[i])+") would overflow input.shape["+i+"] ("+t.shape[i]+")"})},o=0;o<t.rank;++o)r(o)}function _m(t){for(var n=[],e=0;t>0;)1&t&&n.push(e),t/=2,e++;return n}function df(t,n,e){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function lS(t,n,e,r,o){var i=n[o];(t&1<<o||null==i)&&(i=(e[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),$d(0,i,s-1)}function dS(t,n,e,r,o){var i=n[o],a=e[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?$d(0,i,s):$d(-1,i,s-1)}function Cm(t,n,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function Dm(t,n){for(var e=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function ff(t){return R.customGrad(t)}Object.freeze({validateUpdateShape:sS,validateInput:uS,calculateShapes:wc}),Object.freeze({assertParamsValid:cS,maskToAxes:_m,computeOutShape:df,startForAxis:lS,stopForAxis:dS,isSliceContinous:Cm,computeFlatOffset:Dm});var Go=T({softmax_:function(t,n){void 0===n&&(n=-1);var e=C(t,"logits","softmax","float32");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+n);return R.runKernelFunc(function(r,o){var i=r.softmax(e,n);return o([i]),i},{logits:e},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([n],!0).mul(i))}}},"Softmax",{dim:n},[],[!0])}}),iH=T({logSoftmax_:function(t,n){void 0===n&&(n=-1);var e=C(t,"logits","logSoftmax");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+n);return ff(function(r,o){var i=r.max(n,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(n,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}})(e)}}),fS=function(){function t(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},t.prototype.set=function(n,e){this.dataIdsCount++,this.data.set(n,e)},t.prototype.has=function(n){return this.data.has(n)},t.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),hS=function(){function t(){}return t.prototype.time=function(n){return P("time")},t.prototype.read=function(n){return P("read")},t.prototype.readSync=function(n){return P("readSync")},t.prototype.numDataIds=function(){return P("numDataIds")},t.prototype.disposeData=function(n){return P("disposeData")},t.prototype.write=function(n,e,r){return P("write")},t.prototype.move=function(n,e,r,o){return P("move")},t.prototype.memory=function(){return P("memory")},t.prototype.floatPrecision=function(){return P("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(n,e,r,o){return P("batchMatMul")},t.prototype.fusedBatchMatMul=function(n){return P("fusedBatchMatMul")},t.prototype.slice=function(n,e,r){return P("slice")},t.prototype.stridedSlice=function(n,e,r,o){return P("stridedSlice")},t.prototype.unstack=function(n,e){return P("unstack")},t.prototype.reverse=function(n,e){return P("reverse")},t.prototype.concat=function(n,e){return P("concat")},t.prototype.neg=function(n){return P("neg")},t.prototype.add=function(n,e){return P("add")},t.prototype.addN=function(n){return P("addN")},t.prototype.subtract=function(n,e){return P("subtract")},t.prototype.multiply=function(n,e){return P("multiply")},t.prototype.realDivide=function(n,e){return P("realDivide")},t.prototype.floorDiv=function(n,e){return P("floorDiv")},t.prototype.sum=function(n,e){return P("sum")},t.prototype.prod=function(n,e){return P("prod")},t.prototype.unsortedSegmentSum=function(n,e,r){return P("unsortedSegmentSum")},t.prototype.argMin=function(n,e){return P("argMin")},t.prototype.argMax=function(n,e){return P("argMax")},t.prototype.equal=function(n,e){return P("equal")},t.prototype.notEqual=function(n,e){return P("notEqual")},t.prototype.less=function(n,e){return P("less")},t.prototype.lessEqual=function(n,e){return P("lessEqual")},t.prototype.greater=function(n,e){return P("greater")},t.prototype.greaterEqual=function(n,e){return P("greaterEqual")},t.prototype.logicalNot=function(n){return P("logicalNot")},t.prototype.logicalAnd=function(n,e){return P("logicalAnd")},t.prototype.logicalOr=function(n,e){return P("logicalOr")},t.prototype.where=function(n){return P("where")},t.prototype.select=function(n,e,r){return P("select")},t.prototype.topk=function(n,e,r){return P("topk")},t.prototype.min=function(n,e){return P("min")},t.prototype.minimum=function(n,e){return P("minimum")},t.prototype.mod=function(n,e){return P("mod")},t.prototype.max=function(n,e){return P("max")},t.prototype.maximum=function(n,e){return P("maximum")},t.prototype.all=function(n,e){return P("all")},t.prototype.any=function(n,e){return P("any")},t.prototype.squaredDifference=function(n,e){return P("squaredDifference")},t.prototype.ceil=function(n){return P("ceil")},t.prototype.floor=function(n){return P("floor")},t.prototype.round=function(n){return P("round")},t.prototype.sign=function(n){return P("sign")},t.prototype.isNaN=function(n){return P("isNaN")},t.prototype.isInf=function(n){return P("isInf")},t.prototype.isFinite=function(n){return P("isFinite")},t.prototype.pow=function(n,e){return P("pow")},t.prototype.exp=function(n){return P("exp")},t.prototype.expm1=function(n){return P("expm1")},t.prototype.softmax=function(n,e){return P("softmax")},t.prototype.log=function(n){return P("log")},t.prototype.log1p=function(n){return P("log1p")},t.prototype.sqrt=function(n){return P("sqrt")},t.prototype.rsqrt=function(n){return P("rsqrt")},t.prototype.square=function(n){return P("square")},t.prototype.reciprocal=function(n){return P("reciprocal")},t.prototype.relu=function(n){return P("relu")},t.prototype.relu6=function(n){return P("relu6")},t.prototype.prelu=function(n,e){return P("prelu")},t.prototype.elu=function(n){return P("elu")},t.prototype.eluDer=function(n,e){return P("eluDer")},t.prototype.selu=function(n){return P("selu")},t.prototype.int=function(n){return P("int")},t.prototype.clip=function(n,e,r){return P("clip")},t.prototype.abs=function(n){return P("abs")},t.prototype.complexAbs=function(n){return P("complexAbs")},t.prototype.sigmoid=function(n){return P("sigmoid")},t.prototype.softplus=function(n){return P("softplus")},t.prototype.sin=function(n){return P("sin")},t.prototype.cos=function(n){return P("cos")},t.prototype.tan=function(n){return P("tan")},t.prototype.asin=function(n){return P("asin")},t.prototype.acos=function(n){return P("acos")},t.prototype.atan=function(n){return P("atan")},t.prototype.atan2=function(n,e){return P("atan2")},t.prototype.sinh=function(n){return P("sinh")},t.prototype.cosh=function(n){return P("cosh")},t.prototype.tanh=function(n){return P("tanh")},t.prototype.asinh=function(n){return P("asinh")},t.prototype.acosh=function(n){return P("acosh")},t.prototype.atanh=function(n){return P("atanh")},t.prototype.erf=function(n){return P("erf")},t.prototype.step=function(n,e){return P("step")},t.prototype.fusedConv2d=function(n){return P("fusedConv2d")},t.prototype.conv2d=function(n,e,r){return P("conv2d")},t.prototype.conv2dDerInput=function(n,e,r){return P("conv2dDerInput")},t.prototype.conv2dDerFilter=function(n,e,r){return P("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(n){return P("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(n,e,r){return P("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(n,e,r){return P("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(n,e,r){return P("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(n,e,r){return P("conv3d")},t.prototype.conv3dDerInput=function(n,e,r){return P("conv3dDerInput")},t.prototype.conv3dDerFilter=function(n,e,r){return P("conv3dDerFilter")},t.prototype.maxPool=function(n,e){return P("maxPool")},t.prototype.maxPoolBackprop=function(n,e,r,o){return P("maxPoolBackprop")},t.prototype.avgPool=function(n,e){return P("avgPool")},t.prototype.avgPoolBackprop=function(n,e,r){return P("avgPoolBackprop")},t.prototype.avgPool3d=function(n,e){return P("avgPool3d")},t.prototype.avgPool3dBackprop=function(n,e,r){return P("avgPool3dBackprop")},t.prototype.maxPool3d=function(n,e){return P("maxPool3d")},t.prototype.maxPool3dBackprop=function(n,e,r,o){return P("maxPool3dBackprop")},t.prototype.reshape=function(n,e){return P("reshape")},t.prototype.cast=function(n,e){return P("cast")},t.prototype.tile=function(n,e){return P("tile")},t.prototype.pad=function(n,e,r){return P("pad")},t.prototype.transpose=function(n,e){return P("transpose")},t.prototype.gather=function(n,e,r){return P("gather")},t.prototype.gatherND=function(n,e){return P("gatherND")},t.prototype.scatterND=function(n,e,r){return P("scatterND")},t.prototype.batchToSpaceND=function(n,e,r){return P("batchToSpaceND")},t.prototype.spaceToBatchND=function(n,e,r){return P("spaceToBatchND")},t.prototype.resizeBilinear=function(n,e,r,o){return P("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(n,e,r){return P("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(n,e,r,o){return P("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(n,e,r){return P("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(n,e,r,o,i,a){return P("batchNormalization")},t.prototype.localResponseNormalization4D=function(n,e,r,o,i){return P("localResponseNormalization4D")},t.prototype.LRNGrad=function(n,e,r,o,i,a,s){return P("LRNGrad")},t.prototype.multinomial=function(n,e,r,o){return P("multinomial")},t.prototype.oneHot=function(n,e,r,o){return P("oneHot")},t.prototype.cumsum=function(n,e,r,o){return P("cumsum")},t.prototype.nonMaxSuppression=function(n,e,r,o,i){return P("nonMaxSuppression")},t.prototype.fft=function(n){return P("fft")},t.prototype.ifft=function(n){return P("ifft")},t.prototype.complex=function(n,e){return P("complex")},t.prototype.real=function(n){return P("real")},t.prototype.imag=function(n){return P("imag")},t.prototype.cropAndResize=function(n,e,r,o,i,a){return P("cropAndResize")},t.prototype.depthToSpace=function(n,e,r){return P("depthToSpace")},t.prototype.split=function(n,e,r){return P("split")},t.prototype.sparseToDense=function(n,e,r,o){return P("sparseToDense")},t.prototype.diag=function(n){return P("diag")},t.prototype.fill=function(n,e,r){return P("fill")},t.prototype.onesLike=function(n){return P("onesLike")},t.prototype.zerosLike=function(n){return P("zerosLike")},t.prototype.linspace=function(n,e,r){return P("linspace")},t.prototype.dispose=function(){return P("dispose")},t}();function P(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function qo(t,n){for(var e=t.length,r=[],o=0;o<e;o++){var i=e-1-o;(n[n.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function Ut(t,n){for(var e=[],r=0;r<n.length;r++){var o=t[t.length-r-1],i=n.length-r-1;(null==o||1===o&&n[i]>1)&&e.unshift(i)}return e}function Le(t,n){for(var e=[],r=Math.max(t.length,n.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=n[n.length-o-1];if(null==a&&(a=1),1===i)e.unshift(a);else if(1===a)e.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+n+".");e.unshift(i)}}return e}function Ss(t,n,e,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=pf(n),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return Si(t,s,e,r,o,i,!1,a)}function xc(t,n,e,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=Sm(n),l=c[0],d=c[1],f=c[2];if("NDHWC"===a)u="channelsLast",s=[l,d,f,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,d,f,t[1],t[1]]}return _c(t,s,e,r,o,!1,u,i)}function Si(t,n,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3];if("channelsLast"===s)c=t[0],l=t[1],d=t[2],f=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],f=t[1],l=t[2],d=t[3]}var h,p=n[0],g=n[1],v=n[3],m=pf(e),b=m[0],y=m[1],w=pf(r),x=w[0],_=w[1],M=Is(p,x),I=Is(g,_),E=function(B,N,W,H,j,q,K,Z){var le,pe,Pe;if("number"==typeof B){le={top:B,bottom:B,left:B,right:B,type:0===B?"VALID":"NUMBER"};var Oe=function(He,tt,Qe,Dt,bt){null==Dt&&(Dt=Em(He,tt,Qe));var mo=He[1],yo=Cc((He[0]-tt+2*Dt)/Qe+1,bt);D(mt(yo),function(){return"The output # of rows ("+yo+") must be an integer. Change the stride and/or zero pad parameters"});var rr=Cc((mo-tt+2*Dt)/Qe+1,bt);return D(mt(rr),function(){return"The output # of columns ("+rr+") must be an integer. Change the stride and/or zero pad parameters"}),[yo,rr]}([N,W],q,H,B,Z);pe=Oe[0],Pe=Oe[1]}else if("same"===B){pe=Math.ceil(N/H),Pe=Math.ceil(W/j);var Ve=Math.max(0,(pe-1)*H+q-N),Ge=Math.max(0,(Pe-1)*j+K-W),je=Math.floor(Ve/2),qe=Ve-je,Tt=Math.floor(Ge/2);le={top:je,bottom:qe,left:Tt,right:Ge-Tt,type:"SAME"}}else{if("valid"!==B)throw Error("Unknown padding parameter: "+B);le={top:0,bottom:0,left:0,right:0,type:"VALID"},pe=Math.ceil((N-q+1)/H),Pe=Math.ceil((W-K+1)/j)}return{padInfo:le,outHeight:pe,outWidth:Pe}}(o,l,d,b,y,M,I,i),k=E.outHeight,A=E.outWidth,U=a?v*f:v;return"channelsFirst"===s?h=[c,U,k,A]:"channelsLast"===s&&(h=[c,k,A,U]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:d,inChannels:f,outHeight:k,outWidth:A,outChannels:U,padInfo:E.padInfo,strideHeight:b,strideWidth:y,filterHeight:p,filterWidth:g,effectiveFilterHeight:M,effectiveFilterWidth:I,dilationHeight:x,dilationWidth:_,inShape:t,outShape:h,filterShape:n}}function _c(t,n,e,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3],h=u[4];if("channelsLast"===a)c=t[0],l=t[1],d=t[2],f=t[3],h=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],h=t[1],l=t[2],d=t[3],f=t[4]}var p,g=n[0],v=n[1],m=n[2],b=n[4],y=Sm(e),w=y[0],x=y[1],_=y[2],M=Sm(r),I=M[0],E=M[1],S=M[2],k=Is(g,I),A=Is(v,E),U=Is(m,S),B=function(K,Z,le,pe,Pe,Oe,Ve,Ge,je,qe,Tt){var He,tt,Qe,Dt;if("number"==typeof K){He={top:K,bottom:K,left:K,right:K,front:K,back:K,type:0===K?"VALID":"NUMBER"};var bt=function(Hs,oi,n0,Ws,bo,r0){null==bo&&(bo=Em(Hs,oi,Ws));var JG=Hs[1],ZG=Hs[2],o0=Cc((Hs[0]-oi+2*bo)/Ws+1,r0);D(mt(o0),function(){return"The output # of depths ("+o0+") must be an integer. Change the stride and/or zero pad parameters"});var a0=Cc((JG-oi+2*bo)/Ws+1,r0);D(mt(a0),function(){return"The output # of rows ("+a0+") must be an integer. Change the stride and/or zero pad parameters"});var s0=Cc((ZG-oi+2*bo)/Ws+1,r0);return D(mt(s0),function(){return"The output # of columns ("+s0+") must be an integer. Change the stride and/or zero pad parameters"}),[o0,a0,s0,1]}([Z,le,pe,1],Ge,0,Pe,K,Tt);tt=bt[0],Qe=bt[1],Dt=bt[2]}else if("same"===K){var wt=((tt=Math.ceil(Z/Pe))-1)*Pe+Ge-Z,mo=((Qe=Math.ceil(le/Oe))-1)*Oe+je-le,yo=((Dt=Math.ceil(pe/Ve))-1)*Ve+qe-pe,rr=Math.floor(wt/2),js=wt-rr,ni=Math.floor(mo/2),Ni=mo-ni,ri=Math.floor(yo/2);He={top:ni,bottom:Ni,left:ri,right:yo-ri,front:rr,back:js,type:"SAME"}}else{if("valid"!==K)throw Error("Unknown padding parameter: "+K);He={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},tt=Math.ceil((Z-Ge+1)/Pe),Qe=Math.ceil((le-je+1)/Oe),Dt=Math.ceil((pe-qe+1)/Ve)}return{padInfo:He,outDepth:tt,outHeight:Qe,outWidth:Dt}}(o,l,d,f,w,x,_,k,A,U,s),W=B.outDepth,H=B.outHeight,j=B.outWidth,q=i?b*h:b;return"channelsFirst"===a?p=[c,q,W,H,j]:"channelsLast"===a&&(p=[c,W,H,j,q]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:W,outHeight:H,outWidth:j,outChannels:q,padInfo:B.padInfo,strideDepth:w,strideHeight:x,strideWidth:_,filterDepth:g,filterHeight:v,filterWidth:m,effectiveFilterDepth:k,effectiveFilterHeight:A,effectiveFilterWidth:U,dilationDepth:I,dilationHeight:E,dilationWidth:S,inShape:t,outShape:p,filterShape:n}}function Em(t,n,e,r){void 0===r&&(r=1);var o=Is(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function pf(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Sm(t){return"number"==typeof t?[t,t,t]:t}function Is(t,n){return n<=1?t:t+(t-1)*(n-1)}function Cc(t,n){if(!n)return t;switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+n)}}function da(t){var n=pf(t);return 1===n[0]&&1===n[1]&&1===n[2]}function Rn(t,n){return da(t)||da(n)}function gf(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function Im(t,n,e){if("complex64"===n){if("complex64"===t.dtype)return t.clone();var r=ft(t.shape),o=t.toFloat(),i=e.complex(o,r);return r.dispose(),o.dispose(),i}if(!d2(t.dtype,n))return R.makeTensorFromDataId(t.dataId,t.shape,n);if("complex64"===t.dtype){var a=e.real(t);return i=a.cast(n),a.dispose(),i}if("int32"===n)return e.int(t);if("bool"===n){var s=Y(0,t.dtype);return i=e.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+n)}function vf(t,n){return R.makeTensorFromDataId(t.dataId,n,t.dtype)}function Mm(t,n,e){var r=(n-t)/(e-1),o=_s(e,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return Bt(o,"float32")}function Rm(t,n){if(t.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+n.length+".");for(var e=new Float32Array(2*t.length),r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function pS(t,n){return{real:t[2*n],imag:t[2*n+1]}}function aH(t,n,e,r){t[2*r]=n,t[2*r+1]=e}function sH(t,n,e){var r=(e?2:-2)*Math.PI*(t/n);return{real:Math.cos(r),imag:Math.sin(r)}}function uH(t,n,e){var r=function(u,c,l){for(var d=0,f=u.length,h=0,p=!1;d<f;){var g=l(c,u[h=d+(f-d>>>1)]);g>0?d=h+1:(f=h,p=!g)}return p?d:-d-1}(t,n,e||cH);t.splice(r<0?-(r+1):r,0,n)}function cH(t,n){return t>n?1:t<n?-1:0}function Tm(t,n,e,r,o){return gS(t,n,e,r,o,0).selectedIndices}function Am(t,n,e,r,o,i){var a=gS(t,n,e,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function gS(t,n,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(n).map(function(w,x){return{score:w,boxIndex:x,suppressBeginIndex:0}}).filter(function(w){return w.score>o}).sort(vS),c=i>0?-.5/i:0,l=[],d=[];l.length<e&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,g=f.suppressBeginIndex;if(h<o)break;for(var v=!1,m=l.length-1;m>=g;--m){var b=lH(t,p,l[m]);if(b>=r){v=!0;break}if(f.score=f.score*dH(r,c,b),f.score<=o)break}f.suppressBeginIndex=l.length,v||(f.score===h?(l.push(p),d.push(f.score)):f.score>o&&uH(u,f,vS))}var y=l.length;return s&&(l.fill(0,y),d.fill(0,y)),{selectedIndices:Bt(l,"int32"),selectedScores:Bt(d,"float32"),numValidOutputs:Y(y,"int32")}}function lH(t,n,e){var r=t.subarray(4*n,4*n+4),o=t.subarray(4*e,4*e+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;var g=Math.max(i,c),v=Math.max(a,l),m=Math.min(s,d),b=Math.min(u,f),y=Math.max(m-g,0)*Math.max(b-v,0);return y/(h+p-y)}function dH(t,n,e){var r=Math.exp(n*e*e);return e<=t?r:0}function vS(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function mS(t,n,e){var r=new Array(t.rank).fill(0),o=t.shape.slice();return n.map(function(i){o[e]=i;var a=t.slice(r,o);return r[e]+=i,a})}function yS(t,n){for(var e=new Array(t.rank),r=0;r<e.length;r++)e[r]=t.shape[r]*n[r];var o=Se(e,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function bS(t,n,e,r,o){for(var i=n[n.length-1],a=[t.length/i,i],s=a[0],u=a[1],c=ws(e,s*r),l=ws("int32",s*r),d=0;d<s;d++){for(var f=d*u,h=t.subarray(f,f+u),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort(function(w,x){return x.value-w.value});var v=d*r,m=c.subarray(v,v+r),b=l.subarray(v,v+r);for(g=0;g<r;g++)m[g]=p[g].value,b[g]=p[g].index}var y=n.slice();return y[y.length-1]=r,[sn(c,y,e),sn(l,y,"int32")]}function km(t,n){for(var e=[],r=0;r<n.length;r++)n[r]&&e.push(r);var o=Se(t,"int32"),i=Se([e.length,t.length],"int32");for(r=0;r<e.length;r++){var a=o.indexToLoc(e[r]);i.values.set(a,r*t.length)}return i.toTensor()}Object.freeze({castTensor:Im,reshapeTensor:vf,linspaceImpl:Mm,upcastType:Qt,axesAreInnerMostDims:gm,combineLocations:Y2,computeOutAndReduceShapes:on,expandShapeToKeepDim:Mn,assertAxesAreInnerMostDims:Bn,getAxesPermutation:kr,getUndoAxesPermutation:nf,getInnerMostAxes:Pr,getBroadcastDims:qo,getReductionAxes:Ut,assertAndGetBroadcastShape:Le,assertParamsConsistent:J2,computeOutShape:sa,computePool2DInfo:Ss,computePool3DInfo:xc,computeConv2DInfo:Si,computeConv3DInfo:_c,computeDefaultPad:Em,tupleValuesAreOne:da,eitherStridesOrDilationsAreOne:Rn,convertConv2DDataFormat:gf,PARALLELIZE_THRESHOLD:xm,computeOptimalWindowSize:lf});var fH=function(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},hH=function(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},pH=function(t,n,e){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,a=Math.ceil(t.inSize/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===n?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function wS(t,n){return["x","y","z","w","u","v"].slice(0,n).map(function(e){return t+"."+e})}function Vn(t,n){return 1===n?[t]:wS(t,n)}function mn(){var t,n,e,r,o,i,a,s,u,c;return 2===F().getNumber("WEBGL_VERSION")?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function fa(t,n,e){void 0===e&&(e="index");var r=Tr(n);return r.map(function(o,i){return"int "+t[i]+" = "+e+" / "+o+"; "+(i===r.length-1?"int "+t[i+1]+" = "+e+" - "+t[i]+" * "+o:"index -= "+t[i]+" * "+o)+";"}).join("")}function Pm(t){var n=Tr(t).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+n[0]+" + coords.y * "+n[1]+" + coords.z;\n  }\n"}var xS="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function gH(t,n,e,r){var o=[];t.forEach(function(h){var p=ae(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,h,s=o.join("\n"),u=t.map(function(h){return function(p,g,v){void 0===v&&(v=!1);var m="";return m+=v?_S(p):Ms(p),p.shapeInfo.logicalShape.length<=g.logicalShape.length&&(m+=v?function(w,x){var _,W,M=w.name,I=M.charAt(0).toUpperCase()+M.slice(1),E="get"+I+"AtOutCoords",S=w.shapeInfo.logicalShape.length,k=x.logicalShape.length,A=qo(w.shapeInfo.logicalShape,x.logicalShape),U=ut(k),B=k-S,N=["x","y","z","w","u","v"];_=0===S?"":k<2&&A.length>=1?"coords = 0;":A.map(function(le){return"coords."+N[le+B]+" = 0;"}).join("\n"),W=k<2&&S>0?"coords":w.shapeInfo.logicalShape.map(function(le,pe){return"coords."+N[pe+B]}).join(", ");var H="return outputValue;",j=1===ae(w.shapeInfo.logicalShape),q=1===ae(x.logicalShape);if(1!==S||j||q){if(j&&!q)H=1===k?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(A.length){var K=S-2,Z=S-1;A.indexOf(K)>-1&&A.indexOf(Z)>-1?H="return vec4(outputValue.x);":A.indexOf(K)>-1?H="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":A.indexOf(Z)>-1&&(H="return vec4(outputValue.xx, outputValue.zz);")}}else H="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+E+"() {\n      "+U+" coords = getOutputCoords();\n      "+_+"\n      vec4 outputValue = get"+I+"("+W+");\n      "+H+"\n    }\n  "}(p,g):function(w,x){var _=w.name,M=_.charAt(0).toUpperCase()+_.slice(1),I="get"+M+"AtOutCoords",k=w.shapeInfo.logicalShape.length,A=x.logicalShape.length;if(!w.shapeInfo.isUniform&&k===A&&null==w.shapeInfo.flatOffset&&Ft(w.shapeInfo.texShape,x.texShape))return"\n      float "+I+"() {\n        return sampleTexture("+_+", resultUV);\n      }\n    ";var B=ut(A),N=qo(w.shapeInfo.logicalShape,x.logicalShape),W=A-k,H=["x","y","z","w","u","v"];return"\n    float "+I+"() {\n      "+B+" coords = getOutputCoords();\n      "+(0===k?"":A<2&&N.length>=1?"coords = 0;":N.map(function(q){return"coords."+H[q+W]+" = 0;"}).join("\n"))+"\n      return get"+M+"("+(A<2&&k>0?"coords":w.shapeInfo.logicalShape.map(function(q,K){return"coords."+H[K+W]}).join(", "))+");\n    }\n  "}(p,g)),m}(h,n,r)}).join("\n"),c=n.texShape,l=mn(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",f=(h=l).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+h.varyingFs+" vec2 resultUV;\n    "+h.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+h.defineSpecialNaN+"\n    "+h.defineSpecialInf+"\n    "+h.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+vH+"\n    "+mH+"\n    "+yH+"\n  ";return n.isPacked?(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return x=p,1===(_=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+_[1]+".0);\n      }\n    ":1===_[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+_[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      return 2 * (resTexRC.x * "+_[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(w,x){var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(Ft(w,x))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+_[0]+", "+_[1]+"));\n      }\n    ";var M=Math.ceil(w[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n      int r = 2 * (index / "+M+");\n      int c = imod(index, "+M+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=h,v=p,m=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],y=(b=Math.ceil(g[2]/2))*Math.ceil(g[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+m[0]+", "+m[1]+"));\n      int index = resTexRC.x * "+m[1]+" + resTexRC.y;\n\n      int b = index / "+y+";\n      index -= b * "+y+";\n\n      int r = 2 * (index / "+b+");\n      int c = imod(index, "+b+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(w,x){for(var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],M=Math.ceil(w[w.length-1]/2),I=M*Math.ceil(w[w.length-2]/2),E=I,S="",k="b, r, c",A=2;A<w.length-1;A++)S="\n      int b"+A+" = index / "+(E*=w[w.length-A-1])+";\n      index -= b"+A+" * "+E+";\n    "+S,k="b"+A+", "+k;return"\n    ivec"+w.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n\n      "+S+"\n\n      int b = index / "+I+";\n      index -= b * "+I+";\n\n      int r = 2 * (index / "+M+");\n      int c = imod(index, "+M+") * 2;\n\n      return ivec"+w.length+"("+k+");\n    }\n  "}(h,p)}var x,_,g,v,m,b,y}(n.logicalShape,c),a=function(h){return"\n    void setOutput(vec4 val) {\n      "+h.output+" = val;\n    }\n  "}(l)):(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(b=p)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+b[1]+".0);\n      }\n    ":1===b[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+b[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      return resTexRC.x * "+b[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(m,b){return Ft(m,b)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+b[0]+", "+b[1]+"));\n      }\n    ":1===m[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===m[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      int r = index / "+m[1]+";\n      int c = index - r * "+m[1]+";\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=p,v=fa(["r","c","d"],h),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+g[0]+", "+g[1]+"));\n      int index = resTexRC.x * "+g[1]+" + resTexRC.y;\n      "+v+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(m,b){var y=fa(["r","c","d","d2"],m);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      "+y+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(h,p);case 5:return function(m,b){var y=fa(["r","c","d","d2","d3"],m);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+b[0]+",\n                             "+b[1]+"));\n\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+y+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(h,p);case 6:return function(m,b){var y=fa(["r","c","d","d2","d3","d4"],m);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+y+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var b,g,v}(n.logicalShape,c),a=function(h){return"\n    void setOutput(float val) {\n      "+h.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=bH),[f,d,a,s,i,u,e].join("\n")}function Ms(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=e.shapeInfo.texShape;if(1===i[0]&&1===i[1])return"\n      float "+o+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=e.shapeInfo.texShape;return"\n    float "+o+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+ha(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 1:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+o+"(int index) {\n        "+Rs(e)+"\n      }\n    ";var i=e.shapeInfo.texShape,a=i[0],s=i[1];if(1===s&&1===a)return"\n      float "+o+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=ha(r);return 1===s?"\n      float "+o+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+a+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===a?"\n      float "+o+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+s+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+s+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 2:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=e.shapeInfo.texShape;if(null!=a&&Ft(r,a))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+a[0]+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ";var c=xi(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+Ms(Ts(e,l))+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+As(["row","col"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+Rs(e)+"\n      }\n    ";var p=a[0],g=a[1],v=ha(o);return 1===g?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+v+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":1===p?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+v+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+g+".0, 0.5);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+v+";\n    vec2 uv = uvFromFlat("+p+", "+g+", index);\n    return sampleTexture("+o+", uv);\n  }\n"}(t);case 3:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=xi(r),c=u.newShape,l=u.keptDims;if(c.length<r.length)return"\n        "+Ms(Ts(e,c))+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+As(["row","col","depth"],l)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+s+", 1)));\n        "+Rs(e)+"\n      }\n    ";var h=e.shapeInfo.texShape,p=h[0],g=h[1],v=e.shapeInfo.flatOffset;return g===a&&null==v?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+s+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+g+".0, "+p+".0);\n          return sampleTexture("+o+", uv);\n        }\n      ":g===s&&null==v?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+g+".0, "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+s+" + depth + "+ha(o)+";\n        vec2 uv = uvFromFlat("+p+", "+g+", index);\n        return sampleTexture("+o+", uv);\n      }\n  "}(t);case 4:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=xi(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+Ms(Ts(e,l))+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+As(["row","col","depth","depth2"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+s+", "+a+", 1)));\n        "+Rs(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,g=p[0],v=p[1];return v===u&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":v===a&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+g+", "+v+", index + "+ha(o)+");\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);case 5:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=xi(r),d=l.newShape,f=l.keptDims;if(d.length<r.length)return"\n      "+Ms(Ts(e,d))+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+As(["row","col","depth","depth2","depth3"],f)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+s+", "+a+")) +\n          depth3;\n        "+Rs(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,v=g[0],m=g[1];return m===c&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":m===a&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+s+" +\n          depth2 * "+a+" + depth3 + "+ha(o)+";\n      vec2 uv = uvFromFlat("+v+", "+m+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);case 6:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=xi(r),s=a.newShape,u=a.keptDims;if(s.length<r.length)return"\n      "+Ms(Ts(e,s))+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+As(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var l=r[5],d=r[4]*l,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+p+", "+h+", "+f+", "+d+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+Rs(e)+"\n      }\n    ";var g=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],b=v[1];return b===p&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+f+", "+d+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+b+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":b===l&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+b+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+p+" + col * "+h+" + depth * "+f+" +\n          depth2 * "+d+" + depth3 * "+l+" + depth4 + "+ha(o)+";\n      vec2 uv = uvFromFlat("+m+", "+b+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function _S(t){var n,o,i,a,s,u,c;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+mn().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return a="get"+(i=(o=t).name).charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=mn(),"\n    vec4 "+a+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+i+", uv);\n    }\n  ";case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],d=mn();if(null!=u&&Ft(i,u))return"\n      vec4 "+s+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+l+".0, "+c+".0);\n\n        return "+d.texture2D+"("+a+", uv);\n      }\n    ";var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+s+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(i[1]/2)+", "+f[0]+", "+f[1]+", row, col);\n      return "+d.texture2D+"("+a+", uv);\n    }\n  "}(t);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===i[0])return"\n        "+_S(Ts(o,i.slice(1)))+"\n        vec4 "+s+"(int b, int row, int col) {\n          return "+s+"("+As(["b","row","col"],[1,2])+");\n        }\n      ";var f=c[0],h=c[1],p=Math.ceil(i[2]/2);return"\n    vec4 "+s+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+f+", "+h+", "+p*Math.ceil(i[1]/2)+", "+p+", b, row, col);\n      return "+mn().texture2D+"("+a+", uv);\n    }\n  "}(t);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],f=l[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),g="int b, int row, int col",v="b * "+p+" + (row / 2) * "+h+" + (col / 2)",m=2;m<a-1;m++)g="int b"+m+", "+g,v="b"+m+" * "+(p*=i[a-m-1])+" + "+v;return"\n    vec4 "+u+"("+g+") {\n      int index = "+v+";\n      int texR = index / "+f+";\n      int texC = index - texR * "+f+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+", "+d+");\n      return "+mn().texture2D+"("+s+", uv);\n    }\n  "}(t)}}var vH="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",mH="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",yH="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",bH="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function ha(t){return"offset"+t}function Rs(t){var n=t.name,e=ae(t.shapeInfo.logicalShape);return e<2?"return "+n+";":"\n    for (int i = 0; i < "+e+"; i++) {\n      if (i == index) {\n        return "+n+"[i];\n      }\n    }\n  "}function ut(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Ts(t,n){var e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function As(t,n){return n.map(function(e){return t[e]}).join(", ")}var wH=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,D(t.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var i=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=ut(c),d=Vn("coords",c);if(1===i){var f=ut(s=c+1);a="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[c-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[c-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[c-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+d[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],g=h.map(function(I){return"int "+I}),v=Vn("sourceLocR",s-1).concat("inIdx.r"),m=Vn("sourceLocG",s-1).concat("inIdx.g"),b=Vn("sourceLocB",s-1).concat("inIdx.b"),y=Vn("sourceLocA",s-1).concat("inIdx.a"),w="max"===e?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+b.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",_="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+m.join()+") : 0.,\n            hasNextRow ? getAChannel("+b.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",M=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+M+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+d[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+n+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+n+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+w+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},xH=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var s=t.effectiveFilterHeight,u=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(s-1-t.padInfo.top)+", "+(u-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_H=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(l-1-t.padInfo.front)+", "+(d-1-t.padInfo.top)+", "+(f-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterDepth*t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},CH=function(t,n,e,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Le(t,n),Le(t,e);var a="0.0";null!=r&&(Le(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Le(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},DH=function(t,n,e,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Le(t,n),Le(t,e);var a="vec4(0.0)";null!=r&&(Le(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Le(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},CS=function(t,n,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Le(n,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Om="return a + b;",Nm="return a - b;",DS="return a * b;",ES="return (a < 0.) ? b * a : a;",Ct=function(t,n,e){this.variableNames=["A","B"],this.outputShape=Le(n,e),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},SS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Ko=function(t,n,e,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Le(n,e);var o=this.outputShape.length,i="";if(r)if(0===o||1===ae(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+ut(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=Vn("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},IH=function(){function t(n){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),MH=function(){function t(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),RH=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},TH=function(t){this.outputShape=[],this.outputShape=sa(t,1),this.variableNames=t.map(function(s,u){return"T"+u});var n=new Array(t.length-1);n[0]=t[0][1];for(var e=1;e<n.length;e++)n[e]=n[e-1]+t[e][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<n.length;e++)r.push("else if (yC < "+n[e]+") setOutput(getT"+e+"(yR, yC-"+n[e-1]+"));");r.push("else setOutput(getT"+n.length+"(yR, yC-"+n[n.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},AH=function(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=sa(t,n);var e=this.outputShape,r=e.length,o=ut(r),i=Vn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(v,m){return"T"+m});var s=new Array(t.length-1);s[0]=t[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][n];var c=a[n],l=a.slice(-2),d=a.join(),f="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];f+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+mf(a,c,h)+"),\n            vec2("+mf(l,c,h)+"));\n        }"}var g=s[s.length-1];f+="\n        return getChannel(\n          getT"+s.length+"("+mf(a,c,g)+"),\n          vec2("+mf(l,c,g)+"));",this.userCode="\n      float getValue("+a.map(function(v){return"int "+v})+") {\n        "+f+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+e[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+e[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+e[r-2]+" &&\n            "+i[r-1]+" < "+e[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function mf(t,n,e){var r=t.indexOf(n);return t.map(function(o,i){return i===r?o+" - "+e:o}).join()}var kH=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===t.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},PH=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,i="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(i?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(i?1:2)+"], coords["+(i?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},OH=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},NH=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,e=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(n-1-t.padInfo.front)+", "+(e-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+n+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+n+" - 1 - wF;\n\n          for (int wR = 0; wR < "+e+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+e+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},FH=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},LH=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},IS=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),h=t.inChannels%4,p="channelsLast"===t.dataFormat,g=p?1:2,v=p?2:3,m=p?3:1,b="",y="";e&&(b=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",y="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+m+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+g+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+y+"\n        setOutput(result);\n      }\n    "},BH=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,e=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+n+", "+e+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},MS=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=t.outChannels/t.inChannels,g="",v="";e&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",v="result = activation(result);");var m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+m+"\n        "+v+"\n        setOutput(result);\n      }\n    "},RS=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=h,g="int xR; int xC; int xCOffset;",v=0;v<f;v++)for(var m=0;m<h;m++)g+="\n          vec4 xTexelR"+v+"C"+2*m+" = vec4(0.);\n          vec4 wR"+v+"C"+m+" = vec4(0.);\n          vec4 xR"+v+"C"+m+" = vec4(0.);";for(v=0;v<f;v++)for(var b=0;b<p;b++){if(g+="\n          xR = xRCorner + "+v*l+";\n          xC = xCCorner + "+(m=2*b)*d+";\n        ",1===c){if(m<h&&(g+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+v+"C"+m+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+v+"C"+m+" = vec4(previous.zw, xTexelR"+v+"C"+m+".xy);\n                } else {\n                  xR"+v+"C"+m+" = vec4(0, 0, xTexelR"+v+"C"+m+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                xR"+v+"C"+m+" = xTexelR"+v+"C"+m+";\n              ",m+1<h)){var y=s%2==0?qv(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(g+="\n                  xCOffset = xC + "+s%2+" + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+v+"C"+m+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+m+" = vec4(0.);\n                    }\n                  "),g+="\n                  xR"+v+"C"+(m+1)+" = vec4(\n                    xTexelR"+v+"C"+m+".zw, xTexelR"+v+"C"+(m+2)+".xy);\n                "):g+="\n                  xCOffset = xC + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(m+1)+" = xTexelR"+v+"C"+(m+2)+";\n                "}}else m<h&&(g+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(g+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(m+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+m+" = vec4(\n                  xTexelR"+v+"C"+m+".zw, xTexelR"+v+"C"+(m+2)+".zw);\n              ",m+1<h&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(m+1)+" = vec4(xTexelR"+v+"C"+(m+2)+".xy, final.xy);\n                ")):(g+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+v+"C"+m+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+m+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(m+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+m+" = vec4(\n                  xTexelR"+v+"C"+m+".xy, xTexelR"+v+"C"+(m+2)+".xy);\n              ",m+1<h&&(g+="\n                  xR"+v+"C"+(m+1)+" = vec4(\n                    xTexelR"+v+"C"+m+".zw, xTexelR"+v+"C"+(m+2)+".zw);\n                ")),g+="}");m<h&&(g+="\n            vec4 wTexelR"+v+"C"+m+" = getW("+v+", "+m+", d1, q);\n            wR"+v+"C"+m+" = vec4(wTexelR"+v+"C"+m+".xz, wTexelR"+v+"C"+m+".xz);\n          ",m+1<h&&(g+="\n              vec4 wTexelR"+v+"C"+(m+1)+" = getW("+v+", "+(m+1)+", d1, q);\n              wR"+v+"C"+(m+1)+" =\n                vec4(wTexelR"+v+"C"+(m+1)+".xz, wTexelR"+v+"C"+(m+1)+".xz);"))}for(v=0;v<f;v++)for(m=0;m<h;m++)g+="dotProd += xR"+v+"C"+m+" * wR"+v+"C"+m+";";var w="",x="";e&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"vec4 activation(vec4 x) {\n          "+e+"\n        }",x="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+g+"\n\n        vec4 result = dotProd;\n        "+_+"\n        "+x+"\n        setOutput(result);\n      }\n    "},UH=function(t,n,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],l=e[0],d=e[1];this.outputShape=[n[0],l,d,t[3]];var h=[a-1+".0",s-1+".0"],p=h[0],g=h[1],v=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],w=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g];this.userCode="\n      const float height_ratio = float("+v[0]+");\n      const float width_ratio = float("+w[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+v[1]+";\n        float width_scale = "+w[1]+";\n\n        float in_y = "+v[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+w[2]+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},VH=function(t,n,e){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=e?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(e?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ut(r)+" coords = getOutputCoords();\n        int end = "+TS(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+n+") {\n            continue;\n          }\n          "+TS(r,"coords")+" = idx;\n          val += getX("+function(a,s){if(1===a)return""+s;if(2===a)return s+".x, "+s+".y";if(3===a)return s+".x, "+s+".y, "+s+".z";if(4===a)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function TS(t,n){if(1===t)return""+n;if(2===t)return n+".y";if(3===t)return n+".z";if(4===t)return n+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var jH=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=dc.DENSE;var n=fc(t),e=mn();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fa(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+e.output+" = result;\n      }\n    "},HH=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=dc.DENSE;var n=fc(t),e=mn();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fa(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+e.output+" = result;\n      }\n    "},WH=function(){function t(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),zH=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},$H=function(t){this.variableNames=["A"],this.outTexUsage=Yn.DOWNLOAD;var n=mn();this.outputShape=t,this.userCode="\n      "+xS+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+n.output+" = encode_float(x);\n      }\n    "},GH=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Yn.DOWNLOAD;var n=mn();this.outputShape=t,this.userCode="\n      "+xS+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+n.output+" = encode_float(x);\n      }\n    "},qH=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"];var r=mn(),o=n[0],i=n[1];this.outputShape=t;var a="result";e&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+Pm(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},KH=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=mn(),o=n[0],i=n[1];this.outputShape=t;var a="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Pm(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},AS=function(t,n,e){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(e?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},YH=function(){function t(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){null==e.valueLoc&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,n)}},t}(),JH=function(t,n,e){this.variableNames=["A","indices"];var r=t.slice();r[e]=n,this.outputShape=r,this.rank=r.length;var o=ut(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<a.length;d++)l.push(d===s?"int(getIndices("+c[d]+"))":""+c[d]);return l.join()}(t,e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},ZH=function(t,n,e){this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=e;var r=ut(n.length),o=ut(e.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function kS(t,n){var e=mn();return I2(t,n,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function PS(t,n){return A2(t,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function OS(t,n){return k2(t,n,new Uint16Array([0,1,2,2,1,3]))}function Dc(t,n,e,r,o,i,a){O2(e,r);var s=P2(t,n),u=t.TEXTURE_2D;return ne(t,n,function(){return t.bindTexture(u,s)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),ne(t,n,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),ne(t,n,function(){return t.texImage2D(u,0,o,e,r,0,i,a,null)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function NS(t,n,e,r,o){var i=Kd(e,r);return Dc(t,n,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function FS(t,n,e,r,o){var i=Kd(e,r);return Dc(t,n,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function LS(t,n,e,r,o){var i=Kd(e,r);return Dc(t,n,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function BS(t,n,e,r,o){var i=hc(e,r);return Dc(t,n,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function US(t,n,e,r,o){var i=hc(e,r);return Dc(t,n,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function VS(t,n,e,r){return ne(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),dm(t,n,e,"clipSpacePos",r,3,20,0)&&dm(t,n,e,"uv",r,2,20,12)}function jS(t,n,e,r,o,i,a){var s,u,c;ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=a.internalFormatPackedFloat),s.set(i),ne(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function HS(t,n,e,r){ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),r.data instanceof Uint8Array?ne(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):ne(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),ne(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function WS(t,n,e,r,o){var i=t.createBuffer();ne(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var a=16*e*r;return ne(t,n,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),ne(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,0)}),ne(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}function zS(t,n,e){var r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function $S(t,n,e,r,o){var i=Kd(e,r),a=i[0],s=i[1],u=new Uint8Array(e*r*4);return ne(t,n,function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function GS(t,n,e,r,o,i,a,s){var f,u=t,c=new Float32Array((f=hc(i,a))[0]*f[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function qS(t,n,e,r){var o=new Float32Array(e*r*4);return ne(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,o)}),o}var eW=Object.freeze({createVertexShader:kS,createVertexBuffer:PS,createIndexBuffer:OS,createFloat32MatrixTexture:NS,createFloat16MatrixTexture:FS,createUnsignedBytesMatrixTexture:LS,createPackedMatrixTexture:BS,createFloat16PackedMatrixTexture:US,bindVertexProgramAttributeStreams:VS,uploadDenseMatrixToTexture:jS,uploadPixelDataToTexture:HS,createBufferFromOutputTexture:WS,downloadFloat32MatrixFromBuffer:zS,downloadByteEncodedFloatMatrixFromOutputTexture:$S,downloadPackedMatrixFromBuffer:GS,downloadMatrixFromPackedOutputTexture:qS}),KS=function(){function t(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=F().getNumber("WEBGL_VERSION");null!=n?(this.gl=n,D2(e,n)):this.gl=ao(e);var r="WEBGL_color_buffer_float";if(1===F().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=pc(this.gl,this.debug,"OES_texture_float"),Zn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=pc(this.gl,this.debug,"OES_texture_half_float");else if(F().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Zn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=pc(this.gl,this.debug,"EXT_color_buffer_half_float");else if(F().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(Zn(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Zn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=PS(this.gl,this.debug),this.indexBuffer=OS(this.gl,this.debug),this.framebuffer=N2(this.gl,this.debug),this.textureConfig=lm(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return F().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var n=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;ne(e,this.debug,function(){return e.finish()}),ne(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),ne(e,this.debug,function(){return e.deleteFramebuffer(n.framebuffer)}),ne(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),ne(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),ne(e,this.debug,function(){return e.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(n,e){return this.throwIfDisposed(),NS(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(n,e){return this.throwIfDisposed(),FS(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(n,e){return this.throwIfDisposed(),LS(this.gl,this.debug,n,e)},t.prototype.uploadPixelDataToTexture=function(n,e){this.throwIfDisposed(),HS(this.gl,this.debug,n,e)},t.prototype.uploadDenseMatrixToTexture=function(n,e,r,o){this.throwIfDisposed(),jS(this.gl,this.debug,n,e,r,o,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(n,e){return this.throwIfDisposed(),US(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(n,e){return this.throwIfDisposed(),BS(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(n){var e=this;this.throwIfDisposed(),this.outputTexture===n&&(fm(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ne(this.gl,this.debug,function(){return e.gl.deleteTexture(n)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return $S(o.gl,o.debug,e,r,o.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(n,e,r,o,i,a){return GS(this.gl,n,0,0,0,i,a)},t.prototype.downloadFloat32MatrixFromBuffer=function(n,e){return zS(this.gl,n,e)},t.prototype.createBufferFromTexture=function(n,e,r){this.bindTextureToFrameBuffer(n);var o=WS(this.gl,this.debug,e,r);return this.unbindTextureToFrameBuffer(),o},t.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},t.prototype.createFence=function(n){var e,r,o=this;if(F().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},e=a}else F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return qS(o.gl,o.debug,e,r)})},t.prototype.createProgram=function(n){this.throwIfDisposed();var e=this.gl,r=M2(e,this.debug,n),o=kS(e,this.debug),i=R2(e,this.debug);return ne(e,this.debug,function(){return e.attachShader(i,o)}),ne(e,this.debug,function(){return e.attachShader(i,r)}),T2(e,this.debug,i),this.debug&&Yd(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=VS(e,this.debug,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(n){var e=this;this.throwIfDisposed(),n===this.program&&(this.program=null),null!=n&&ne(this.gl,this.debug,function(){return e.gl.deleteProgram(n)})},t.prototype.setProgram=function(n){var e=this;this.throwIfDisposed(),this.program=n,null!=this.program&&this.debug&&Yd(this.gl,this.debug,this.program),ne(this.gl,this.debug,function(){return e.gl.useProgram(n)})},t.prototype.getUniformLocation=function(n,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?L2(this.gl,this.debug,n,e):B2(this.gl,n,e)},t.prototype.getAttributeLocation=function(n,e){var r=this;return this.throwIfDisposed(),ne(this.gl,this.debug,function(){return r.gl.getAttribLocation(n,e)})},t.prototype.getUniformLocationNoThrow=function(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)},t.prototype.setInputMatrixTexture=function(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),U2(this.gl,this.debug,0,n,e,r)},t.prototype.setOutputMatrixTexture=function(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)},t.prototype.setOutputPackedMatrixTexture=function(n,e,r){this.throwIfDisposed();var o=hc(e,r);this.setOutputMatrixTextureDriver(n,o[0],o[1])},t.prototype.setOutputMatrixWriteRegion=function(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Yd(this.gl,this.debug,this.program),gc(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),ne(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),ne(this.gl,this.debug,function(){return n.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=pc(this.gl,this.debug,2===F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2!==F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(n){return oe(this,void 0,void 0,function(){var e=this;return ie(this,function(r){switch(r.label){case 0:return[4,Kv(function(){return e.disposed||e.isQueryAvailable(n,F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(n,F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(n,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(n,e){if(0===e)return!0;if(2===e){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,o.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollFence=function(n){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return n.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var n=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=n;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},t.prototype.addItemToPoll=function(n,e){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1||Kv(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Jd(this.gl,this.debug,n,this.framebuffer),this.debug&&gc(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Jd(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&gc(this.gl)):fm(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(n,e){this.bindTextureToFrameBuffer(n);var r=e();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(n,e,r){this.throwIfDisposed();var o=this.gl;Jd(o,this.debug,n,this.framebuffer),this.debug&&gc(o),this.outputTexture=n,ne(o,this.debug,function(){return o.viewport(0,0,e,r)}),ne(o,this.debug,function(){return o.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(n,e,r,o){var i=this;this.throwIfDisposed(),ne(this.gl,this.debug,function(){return i.gl.scissor(n,e,r,o)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function XS(t,n){if(t.length!==n.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+n.length+" inputs");t.forEach(function(e,r){var o=e.logicalShape,i=n[r],a=i.shape;if(!Ft(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!Ft(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var tW=function(t,n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var o=e.inChannels,i=e.strideWidth,a=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,l=e.dilationHeight,d=e.dataFormat,f=s.left,h=s.top,p=o*e.filterWidth,g=mn(),v="channelsLast"===d,m=v?0:1,b=v?1:2,y="",w=0;w<=1;w++)for(var x=0;x<=1;x++)y+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+w+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+n[m]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+f+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+n[b]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+g.output+" = result;\n      }\n    "},nW=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[];var a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},rW=function(t,n,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=e,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+n+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+n+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},oW=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},iW=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var o=t.effectiveFilterHeight,i=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(o-1-t.padInfo.top)+", "+(i-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(o*i-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},aW=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(s-1-t.padInfo.front)+", "+(u-1-t.padInfo.top)+", "+(c-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(s*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Fm=function(t,n,e,r,o,i,a){void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var u=Math.ceil((e?t[1]:t[2])/2),c=e?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+f[0]+");\n          result += ("+d[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+g+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},sW=function(){function t(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,n)}},t}(),uW=function(t,n,e,r){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+e+"),\n                      float(index == coords.y)));\n      }\n    "},cW=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var s,c,l,n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var e=Vn("rc",n),r=ut(n),o=function(s,u,c){if(1===s)return"rc > "+u[0];for(var l="",d=s-2;d<s;d++)l+=c[d]+" >= "+u[d],d<s-1&&(l+="||");return l}(n,t,e),i=function(s,u,c,l){if(1===s)return"";var d=l.slice(-2);return"\n    int r = "+d[0]+";\n    int c = "+d[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(n,t[t.length-1],t[t.length-2],e),a=(l=function(d,f){for(var h=[],p=0;p<=1;p++)for(var g=0;g<=1;g++){for(var v=(0===p?"r":"rp1")+", "+(0===g?"c":"cp1"),m=2;m<d;m++)v=f[f.length-1-m]+","+v;h.push(v)}return h}(c=(s=t).length,e),1===c?"getA(rc),\n            rc + 1 >= "+s[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+l[0]+"),\n          cEdge ? 0. : getA("+l[1]+"),\n          rEdge ? 0. : getA("+l[2]+"),\n          rEdge || cEdge ? 0. : getA("+l[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},lW=function(t,n,e){this.variableNames=["x"],this.outputShape=n.map(function(u,c){return u[0]+t[c]+u[1]});var r=t.length,o=ut(r),i=n.map(function(u){return u[0]}).join(","),a=n.map(function(u,c){return u[0]+t[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},dW=function(t,n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(v,m){return v[0]+t[m]+v[1]});for(var r=t.length,o=ut(r),i=n.map(function(v){return v[0]}).join(","),a=n.map(function(v,m){return v[0]+t[m]}).join(","),s=Vn("rc",r),u=Vn("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=1===r?2:4;p<g;p++)h+="\n        "+d[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+e+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Lm=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var f="avg"===n,h="0.0";if(f||(h="-1.0 / 1e-20"),e)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(p="avgValue / count");var g=4*Math.floor(r/4),v=r%4,m="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+d+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+m+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+m+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+m+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+m+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Bm=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,m="0.0";if(v||(m="-1.0 / 1e-20"),e)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(b="avgValue / count");var y=4*Math.floor(r/4),w=r%4,x="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n      const float initializationValue = "+m+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+m+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+y+";\n            if ("+(1===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},fW=function(t,n){this.variableNames=["x"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/e);this.outputShape=[r,i];var a="0.0",s="";"prod"===n?a="1.0":"min"===n?(a="1.0 / 1e-20",s="min"):"max"===n&&(a="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?u="sumValue":"prod"===n?u="prodValue":"all"===n?u="allValue":"any"===n&&(u="anyValue");var c=4*Math.floor(e/4),l=e%4,d="\n      if ("+("sum"===n)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===n)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===n?(a="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(a="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";o%e>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},hW=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+fa(["r","c","d"],n)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Pm(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+e+"\n\n        setOutput(result);\n      }\n    "},pW=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},gW=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var i=t[1],a=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},vW=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[1],a=t[2],s=t[3];this.outputShape=[t[0],n,e,s];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(e-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},mW=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+e+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+e+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},yW=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var i=t[1],a=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},bW=function(t,n){this.variableNames=["x"];var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=t,1!==e){var r=t.map(function(i,a){return-1!==n.indexOf(s=a)&&1!==t[s]?t[s]+" - coords["+s+"] - 1":"coords["+s+"]";var s}).join(","),o=ut(e);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},wW=function(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=t;var u,r=Vn("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],i=r[e-2]+" + 1 < "+this.outputShape[e-2],a=ut(e);function s(u){var c=t.map(function(l,d){return h=u,-1!==n.indexOf(f=d)&&1!==t[f]?t[f]+" - "+h[f]+" - 1":""+h[f];var f,h});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===e?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+((u=r.slice())[e-1]="("+u[e-1]+" + 1)",s(u)+";\n          }\n          if(")+i+") {\n            result.b = "+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},QS=function(t,n,e,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=ut(o.length),u=ut(i.length),c="";1===e?c="i":2===e&&(c="i, j");var d="";1===r?d="i":2===r&&(d="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+n+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(n>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+d+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},xW=function(t,n){this.variableNames=["x","segmentIds"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/e);this.outputShape=[r,a];var s=4*Math.floor(e/4),u=e%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%e>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var d="";o%e>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},_W=function(t,n,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=n,e>4)throw Error("Where for rank "+e+" is not yet supported");if(1===e)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<n.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=ut(e);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},CW=function(){function t(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var e,r=ut(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(1===a)return"sourceLoc";if(a<=6)return Um.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);e="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+n.map(function(a,s){return"sourceLoc."+Um[s]+" = start["+s+"] + coords."+Um[s]+";"}).join("\n")+"\n      ",this.userCode="\n      "+o+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+i+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),Um=["x","y","z","w","u","v"],DW=function(){function t(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var e=ut(this.rank),r=Vn("coords",this.rank),o=Vn("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s="\n      result.x = "+a+";\n      if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n        ++"+o[this.rank-1]+";\n        result.y = "+a+";\n        --"+o[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+n[this.rank-2]+") {\n        ++"+o[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n          ++"+o[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+n.map(function(l,d){return"start["+d+"]"}).join()+");":n.map(function(l,d){return o[d]+" = "+r[d]+" + start["+d+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+s+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),EW=function(t,n,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=ut(e.length),i=ut(e.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=e.map(function(u,c){return s++,1===e.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+n+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},SW=function(){function t(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(n,e,r){var o,i=YS(e,r),a=JS(n,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===Jn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===Jn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===Jn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===Jn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===Jn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[a].push(o),o},t.prototype.releaseTexture=function(n,e,r,o){if(null!=this.freeTextures){var i=JS(e,YS(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var n=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){n.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){n.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function YS(t,n){if(t===Yn.UPLOAD)return Jn.PACKED_2X2_FLOAT32;if(t===Yn.RENDER||null==t)return e=n,F().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Jn.PACKED_2X2_FLOAT32:Jn.UNPACKED_FLOAT32:e?Jn.PACKED_2X2_FLOAT16:Jn.UNPACKED_FLOAT16;var e;if(t===Yn.DOWNLOAD||t===Yn.PIXELS)return Jn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function JS(t,n,e){return t[0]+"_"+t[1]+"_"+n+"_"+e}var IW=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[r]*n[r];this.outputShape=e,this.rank=e.length;var o=ut(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(1===s)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},MW=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];this.outputShape=e,this.rank=e.length;var o=ut(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(n);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},RW=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=ut(this.rank),i=wS("rc",this.rank),a=new Array(this.rank);for(r=0;r<n.length;r++)a[n[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+e[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Vm=1.7580993408473768,jm=1.0507009873554805,Te=function(t,n){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+n+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Nr="if (isnan(x)) return x;",TW="return x;",ZS="return abs(x);",eI=Nr+"\n  return (x < 0.0) ? 0.0 : x;\n",tI=Nr+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",nI="return (x >= 0.0) ? x : (exp(x) - 1.0);",AW="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+Vm+";\n  float scale = "+jm+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",rI="return -x;",oI="return ceil(x);",iI="return floor(x);",aI="return exp(x);",sI="return exp(x) - 1.0;",kW=Nr+"\n  return sin(x);\n",PW=Nr+"\n  return cos(x);\n",OW=Nr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",NW=Nr+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",FW=Nr+"\n  return atan(x);\n",LW=Nr+"return log(x + sqrt(x * x + 1.0));",BW=Nr+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",UW=Nr+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",yf="return x;",VW="return x;",uI="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cI="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",lI="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Ec=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},jW=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,e=Vn("rc",n),r=ut(n),o=function(s,u){if(1===s)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(n,e),i=e.slice(-2),a=n<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},bf={};function wf(t,n){if(void 0===n&&(n=!1),"linear"===t)return n?VW:TW;if("relu"===t)return n?uI:eI;if("elu"===t)return n?lI:nI;if("relu6"===t)return n?cI:tI;if("prelu"===t)return n?SS:ES;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var HW=600,dI=function(t){function n(e){var r,o=t.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!F().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=ao(F().getNumber("WEBGL_VERSION"));o.binaryCache=((r=F().getNumber("WEBGL_VERSION"))in bf||(bf[r]={}),bf[r]),o.gpgpu=new KS(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new SW(o.gpgpu),o.numMBBeforeWarning=null==F().global.screen?1024:F().global.screen.height*F().global.screen.width*window.devicePixelRatio*HW/1024/1024,o.texData=new fS(o,R),o}return Rr(n,t),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(e,r,o){if(F().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===o&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:Yn.UPLOAD}),i},n.prototype.move=function(e,r,o,i){if(F().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:Yn.UPLOAD})},n.prototype.readSync=function(e){var r=this.texData.get(e),o=r.values,i=r.dtype,a=r.complexTensors,u=r.shape;if(null!=r.slice){var l;l=r.isPacked?new Ec(u,yf):new Te(u,yf);var d=this.runWebGLProgram(l,[{dataId:e,shape:u,dtype:i}],i),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(null!=o)return this.convertAndCacheOnCPU(e);if("string"===i)return o;var h,p,g=null!=this.activeTimers;return g&&(h=Ar()),p="complex64"===i?Rm(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),g&&(this.downloadWaitMs+=Ar()-h),this.convertAndCacheOnCPU(e,p)},n.prototype.read=function(e){return oe(this,void 0,void 0,function(){var r,o,i,a,u,c,l,d,f,h,p,g,v,m,b,x,_,M,I;return ie(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(S){return r.push(S)})];if(o=this.texData.get(e),i=o.values,a=o.shape,u=o.dtype,c=o.complexTensors,l=o.isPacked,null!=o.slice)return d=l?new Ec(a,yf):new Te(a,yf),f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(null!=i)return[2,this.convertAndCacheOnCPU(e)];if(!F().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===F().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&F().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(e),v=this.texData.get(g.dataId),p=(I=this.gpgpu).createBufferFromTexture.apply(I,[v.texture].concat(fc(a)))),this.pendingRead.set(e,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return b=E.sent(),m=Rm(b[0],b[1]),[3,5];case 4:null==p?m=this.getValuesFromTexture(e):(x=ae(a),m=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),E.label=5;case 5:return null!=g&&this.disposeData(g.dataId),_=this.convertAndCacheOnCPU(e,m),M=this.pendingRead.get(e),this.pendingRead.delete(e),M.forEach(function(S){return S(_)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,_]}})})},n.prototype.checkNumericalProblems=function(e){if(null!=e)for(var r=0;r<e.length;r++){var o=e[r];if(!E2(o))throw F().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.isPacked,u=ae(i);if(F().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),l=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(fc(i))).subarray(0,u);return this.disposeData(c.dataId),d}var f=F().getBool("WEBGL_PACK")&&!0===s,h=f?Zd(i):i,p=f?new GH(h):new $H(h),g=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:e}],"float32"),v=this.texData.get(g.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),m},n.prototype.time=function(e){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c;return ie(this,function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,null==this.programTimersStack?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e(),a=Wo(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),s=Wo(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=a2(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ar(),endMs:null}},n.prototype.endTimer=function(e){return F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ar(),e)},n.prototype.getQueryTime=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){return F().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var r=this.texData.get(e),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||e,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),null!=o&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getDataInfo=function(e){return this.texData.get(e)},n.prototype.getCPUBackend=function(){return F().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=R.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,r){var o=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&e.every(function(i){return null==o.texData.get(i.dataId).texture&&i.size<r})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,r){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(r.clone())},o},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,o);if(0===ae(o))return sn([],o,e.dtype);var i=this.texData.get(e.dataId).isPacked,a=Cm(e.shape,r,o);if(i||!a){var s=F().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DW(o):new CW(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,o)},n.prototype.shallowSlice=function(e,r,o){var i=this.texData.get(e.dataId),a=this.makeOutput(o,e.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=e.dtype;var u=Dm(r,e.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},n.prototype.stridedSlice=function(e,r,o,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,o,i);var a=df(r,o,i);if(a.some(function(u){return 0===u}))return sn([],a);var s=new EW(r,i,a);return this.compileAndRun(s,[e])},n.prototype.reverse=function(e,r){var o=F().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wW(e.shape,r):new bW(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.concat=function(e,r){if("complex64"===e[0].dtype){var o=e.map(function(h){return pr(h)}),i=e.map(function(h){return uo(h)});return an(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(1===e.length)return e[0];if(e.length>F().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),s=this.concat(e.slice(0,a),r),u=this.concat(e.slice(a),r);return this.concat([s,u],r)}if(F().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new AH(e.map(function(h){return h.shape}),r);return this.compileAndRun(c,e)}var l=sa(e.map(function(h){return h.shape}),r),d=e.map(function(h){return h.as2D(-1,ae(h.shape.slice(r)))}),f=new TH(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(l)},n.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,rI,e.dtype);var r=new Te(e.shape,rI);return this.compileAndRun(r,[e])},n.prototype.batchMatMul=function(e,r,o,i){var a=o?e.shape[2]:e.shape[1],s=i?r.shape[1]:r.shape[2],u=o?e.shape[1]:e.shape[2],c=e.shape[0];if((1===a||1===s)&&u>1e3){o&&(e=e.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var l=1===s?e:e.as3D(c,u,1),d=1===s?2:1,f=1===s?r.as3D(c,1,u):r;return this.multiply(l,f).sum(d,!0)}var h=Qt(e.dtype,r.dtype),p=new Fm(e.shape,[c,a,s],o,i);return this.compileAndRun(p,[e,r],h)},n.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=i?r.shape[2]:r.shape[1],d=a?o.shape[1]:o.shape[2],f=r.shape[0],h=Qt(r.dtype,o.dtype),p=null!=s,g=null!=c,v=u?wf(u,!0):null,m=new Fm(r.shape,[f,l,d],i,a,p,v,g),b=[r,o];return s&&b.push(s),c&&b.push(c),this.compileAndRun(m,b,h)},n.prototype.multiply=function(e,r){if("complex64"===e.dtype){var o=this.texData.get(e.dataId),i=this.texData.get(r.dataId),a=new CS("return areal * breal - aimag * bimag;",e.shape,r.shape),s=new CS("return areal * bimag + aimag * breal;",e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,DS,e.dtype);var f=new Ct(DS,e.shape,r.shape);return this.compileAndRun(f,[e,r],e.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){var u=[e,r,o],c=null;null!=s&&(c=s.shape,u.push(s));var l=null;if(null!=a&&(l=a.shape,u.push(a)),F().getBool("WEBGL_PACK_NORMALIZATION")){var d=new DH(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(d,u)}var f=new CH(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){var s=F().getBool("WEBGL_PACK_NORMALIZATION")?new oW(e.shape,r,o,i,a):new nW(e.shape,r,o,i,a);return this.compileAndRun(s,[e])},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){var c=new rW(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,e])},n.prototype.tile=function(e,r){if("string"===e.dtype){var o=this.readSync(e.dataId).map(function(a){return ac(a)});return yS(Se(e.shape,e.dtype,o),r)}var i=new IW(e.shape,r);return this.compileAndRun(i,[e])},n.prototype.pad=function(e,r,o){var i=F().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dW(e.shape,r,o):new lW(e.shape,r,o);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var o=F().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RW(e.shape,r):new MW(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.gather=function(e,r,o){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,o);var i=new JH(e.shape,r.size,o);return this.compileAndRun(i,[e,r])},n.prototype.batchToSpaceND=function(e,r,o){D(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,f){return d*f}),a=sf(e.shape,r,i),s=uf(a.length,r.length),u=cf(e.shape,r,i),c=iS(o,r.length),l=aS(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){D(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=sf(u.shape,r,i,!1),l=uf(c.length,r.length,!1),d=cf(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.reduce=function(e,r,o){var i=e.shape[0],a=e.shape[1],s=lf(a),u=new fW({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[e],o);return 1===c.shape[1]?c:this.reduce(c,r,o)},n.prototype.argReduce=function(e,r,o){void 0===o&&(o=null);var i=e.shape[0],a=e.shape[1];null!=o&&(i=o.shape[0],a=o.shape[1]);var s=lf(a),u=new pH({windowSize:s,inSize:a,batchSize:i},r,null==o),c=[e];null!=o&&c.push(o);var l=this.compileAndRun(u,c,"int32");return 1===l.shape[1]?l:this.argReduce(e,r,l)},n.prototype.argReducePacked=function(e,r,o){void 0===o&&(o=null);var i=null!=o?o.shape:e.shape,a=lf(i[i.length-1]),s=new wH(i,a,r,null==o),c=this.compileAndRun(s,null==o?[e]:[e,o],"int32");return c.rank===e.rank?this.argReducePacked(e,r,c):c},n.prototype.sum=function(e,r){Bn("sum",r,e.rank);var o=on(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a),u=am(e.dtype);return this.reduce(s,"sum",u).reshape(i)},n.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var o=on(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a),u=am(e.dtype);return this.reduce(s,"prod",u).reshape(i)},n.prototype.unsortedSegmentSum=function(e,r,o){var i=0,a=kr([i],e.rank),s=e;null!=a&&(s=e.transpose(a),i=Pr(1,e.rank)[0]);var u=function(h,p,g){for(var v=[],m=h.length,b=0;b<m;b++)v.push(b!==p?h[b]:g);return v}(s.shape,i,o),c=ae([s.shape[i]]),l=s.as2D(-1,c),d=am(e.dtype),f=this.segOpCompute(l,"unsortedSegmentSum",r,d,o).reshape(u);return null!=a&&(f=f.transpose(nf(a))),f},n.prototype.segOpCompute=function(e,r,o,i,a){var s=e.shape[0],u=e.shape[1],c=function(f,h){var p,g=!1;for(f<=xm?(p=f,g=!0):p=qd(f,Math.floor(Math.sqrt(f)));!g;)p>h||p===f?g=!0:p=qd(f,p+1);return p}(u,a),l=new xW({windowSize:c,inSize:u,batchSize:s,numSegments:a},r),d=this.compileAndRun(l,[e,o],i);return d.shape[1]===a?d:(o=rf(0,a).tile([u/c]),this.segOpCompute(d,r,o,i,a))},n.prototype.argMinMaxReduce=function(e,r,o){var i=[r];if(Bn("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,e.rank),!F().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=on(e.shape,i),s=a[0],u=ae(a[1]),c=e.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(e,o)},n.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},n.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},n.prototype.cumsum=function(e,r,o,i){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var a=new VH(e.shape,o,i);return this.compileAndRun(a,[e])},n.prototype.equal=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(equal(a, b));\n","bool");var o=new Ct("return float(a == b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.notEqual=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(notEqual(a, b));\n","bool");var o=new Ct("return float(a != b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThan(a, b));\n","bool");var o=new Ct("return float(a < b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.lessEqual=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var o=new Ct("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThan(a, b));\n","bool");var o=new Ct("return float(a > b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greaterEqual=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var o=new Ct("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalNot=function(e){var r=new Te(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},n.prototype.logicalAnd=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var o=new Ct("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalOr=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var o=new Ct("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.select=function(e,r,o){var i=new _W(e.rank,r.shape,r.rank);return this.compileAndRun(i,[e,r,o],Qt(r.dtype,o.dtype))},n.prototype.where=function(e){tf("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return km(e.shape,r)},n.prototype.topk=function(e,r,o){return bS(e.dataSync(),e.shape,e.dtype,r)},n.prototype.min=function(e,r){Bn("min",r,e.rank);var o=on(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var o=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.mod=function(e,r){var o=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);Bn("max",r,e.rank);var o=on(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var o=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.all=function(e,r){Bn("all",r,e.rank);var o=on(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(e,r){Bn("any",r,e.rank);var o=on(e.shape,r),i=o[0],a=ae(o[1]),s=e.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.realDivide=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var o=new Ct("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,r.shape);return this.compileAndRun(o,[e,r],"float32")},n.prototype.floorDiv=function(e,r){if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var o=new Ct("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,r.shape);return this.compileAndRun(o,[e,r],"int32")},n.prototype.add=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,Om);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var o=Qt(e.dtype,r.dtype);if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,Om,o);var i=new Ct(Om,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.packedUnaryOp=function(e,r,o){var i=new Ec(e.shape,r);return this.compileAndRun(i,[e],o)},n.prototype.packedBinaryOp=function(e,r,o,i,a){void 0===a&&(a=!1);var s=new Ko(o,e.shape,r.shape,a);return this.compileAndRun(s,[e,r],i)},n.prototype.complexSeparableBinaryOp=function(e,r,o){var i=this,a=this.texData.get(e.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],g=i.makeComplexComponentTensorInfo(e,h),v=i.makeComplexComponentTensorInfo(r,p),m=new Ct(o,e.shape,r.shape);return i.compileAndRun(m,[g,v],Qt(h.dtype,p.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},n.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>F().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.addN(e.slice(0,r)),i=this.addN(e.slice(r));return this.addN([o,i])}var a=e.map(function(c){return c.dtype}).reduce(function(c,l){return Qt(c,l)}),s=e.map(function(c){return c.shape}),u=F().getBool("WEBGL_PACK")?new hH(e[0].shape,s):new fH(e[0].shape,s);return this.compileAndRun(u,e,a)},n.prototype.subtract=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,Nm);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var o=Qt(e.dtype,r.dtype);if(F().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,Nm,e.dtype);var i=new Ct(Nm,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.pow=function(e,r){var o=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,r.shape),i=Qt(e.dtype,r.dtype);return this.compileAndRun(o,[e,r],i)},n.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,oI,e.dtype);var r=new Te(e.shape,oI);return this.compileAndRun(r,[e])},n.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,iI,e.dtype);var r=new Te(e.shape,iI);return this.compileAndRun(r,[e])},n.prototype.sign=function(e){var r=new Te(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[e])},n.prototype.isNaN=function(e){var r=new Te(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isInf=function(e){var r=new Te(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isFinite=function(e){var r=new Te(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.round=function(e){var r=new Te(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[e])},n.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,aI,e.dtype);var r=new Te(e.shape,aI);return this.compileAndRun(r,[e])},n.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sI,e.dtype);var r=new Te(e.shape,sI);return this.compileAndRun(r,[e])},n.prototype.softmax=function(e,r){var o=Lt([r],e.shape),i=this.max(e,o),a=Mn(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var r=new Te(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[e])},n.prototype.log1p=function(e){var r=new Te(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},n.prototype.sqrt=function(e){var r=new Te(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new Te(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},n.prototype.reciprocal=function(e){var r=new Te(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},n.prototype.relu=function(e){var r;return r=F().getBool("WEBGL_PACK")?new Ec(e.shape,uI):new Te(e.shape,eI),this.compileAndRun(r,[e])},n.prototype.relu6=function(e){var r;return r=F().getBool("WEBGL_PACK")?new Ec(e.shape,cI):new Te(e.shape,tI),this.compileAndRun(r,[e])},n.prototype.prelu=function(e,r){var o=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko(SS,e.shape,r.shape):new Ct(ES,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.elu=function(e){if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,lI,e.dtype);var r=new Te(e.shape,nI);return this.compileAndRun(r,[e])},n.prototype.eluDer=function(e,r){var o=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,r.shape):new Ct("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.selu=function(e){var r=new Te(e.shape,AW);return this.compileAndRun(r,[e])},n.prototype.int=function(e){var r=new Te(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},n.prototype.clip=function(e,r,o){var i,a=(i=F().getBool("WEBGL_PACK_CLIP")?new MH(e.shape):new IH(e.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[e],null,a)},n.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(F().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ZS,e.dtype);var r=new Te(e.shape,ZS);return this.compileAndRun(r,[e])},n.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),o=new RH(e.shape),i=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(o,i)},n.prototype.sigmoid=function(e){var r=new Te(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},n.prototype.softplus=function(e){var r=new Te(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[e])},n.prototype.sin=function(e){var r=new Te(e.shape,kW);return this.compileAndRun(r,[e])},n.prototype.cos=function(e){var r=new Te(e.shape,PW);return this.compileAndRun(r,[e])},n.prototype.tan=function(e){var r=new Te(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},n.prototype.asin=function(e){var r=new Te(e.shape,OW);return this.compileAndRun(r,[e])},n.prototype.acos=function(e){var r=new Te(e.shape,NW);return this.compileAndRun(r,[e])},n.prototype.atan=function(e){var r=new Te(e.shape,FW);return this.compileAndRun(r,[e])},n.prototype.atan2=function(e,r){var o=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new Ct("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.sinh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.cosh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.tanh=function(e){var r=new Te(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[e])},n.prototype.asinh=function(e){var r=new Te(e.shape,LW);return this.compileAndRun(r,[e])},n.prototype.acosh=function(e){var r=new Te(e.shape,BW);return this.compileAndRun(r,[e])},n.prototype.atanh=function(e){var r=new Te(e.shape,UW);return this.compileAndRun(r,[e])},n.prototype.erf=function(e){var r=new Te(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[e])},n.prototype.step=function(e,r){var i,o=new Te(e.shape,(void 0===(i=r)&&(i=0),Nr+"\n    return x > 0.0 ? 1.0 : float("+i+");\n  "));return this.compileAndRun(o,[e])},n.prototype.conv2dByMatMul=function(e,r,o,i,a,s){var u=e.shape,c=this.texData.get(e.dataId),h="channelsLast"===o.dataFormat,g=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===o.outChannels)&&o.inChannels>1e3||!F().getBool("WEBGL_LAZILY_UNPACK")||!F().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var m=this.reshape(e,[1,h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],o.inChannels]),b=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var w={dataId:e.dataId,shape:[1,h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),o.inChannels],dtype:e.dtype},x=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,D(yc(c.shape,w.shape),function(){return"packed reshape "+c.shape+" to "+w.shape+" isn't free"});var _=this.reshape(r,[1,o.inChannels,o.outChannels]),M=this.fusedBatchMatMul({a:w,b:_,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),I=this.texData.get(M.dataId);return D(I.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=x,I.shape=o.outShape,R.makeTensorFromDataId(M.dataId,o.outShape,M.dtype)},n.prototype.conv2dWithIm2Row=function(e,r,o,i,a,s){var d=o.outWidth,f=o.outHeight,h="channelsLast"===o.dataFormat,p=o.filterWidth*o.filterHeight*o.inChannels,g=f*d,v=[p,g],m=e.squeeze([0]),b=r.reshape([1,p,-1]),y=new tW(v,m.shape,o),w=this.compileAndRun(y,[m]).reshape([1,v[0],v[1]]),x=null!=i,_=null!=s,M=a?wf(a,!0):null,I=new Fm(w.shape,[1,g,o.outChannels],!0,!1,x,M,_),E=[w,b];return i&&E.push(i),_&&E.push(s),this.compileAndRun(I,E).reshape(h?[1,f,d,o.outChannels]:[1,o.outChannels,f,d])},n.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights;if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(r,o,i,a,s,u);if(F().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=null!=a,l=null!=u,d=s?wf(s,!1):null,f=new IS(i,c,d,l),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(f,h)},n.prototype.conv2d=function(e,r,o){if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(e,r,o);if(F().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,r,o);var i=new IS(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerInput=function(e,r,o){var i=new PH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerFilter=function(e,r,o){var i=new kH(o);return this.compileAndRun(i,[e,r])},n.prototype.fusedDepthwiseConv2D=function(e){var r,o=e.input,i=e.filter,a=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=F().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=u?wf(u,l):null,f=[o,i],h=null!=s,p=null!=c;return h&&f.push(s),p&&f.push(c),l?(r=new RS(a,h,d,p),this.compileAndRun(r,f)):(r=new MS(a,h,d,p),this.compileAndRun(r,f))},n.prototype.depthwiseConv2D=function(e,r,o){var i;return F().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new RS(o),this.compileAndRun(i,[e,r])):(i=new MS(o),this.compileAndRun(i,[e,r]))},n.prototype.depthwiseConv2DDerInput=function(e,r,o){var i=new LH(o);return this.compileAndRun(i,[e,r])},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){var i=new FH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3d=function(e,r,o){var i=new BH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerInput=function(e,r,o){var i=new NH(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerFilter=function(e,r,o){var i=new OH(o);return this.compileAndRun(i,[e,r])},n.prototype.maxPool=function(e,r){var o=new Lm(r,"max",!1);return this.compileAndRun(o,[e])},n.prototype.avgPool=function(e,r){var o=new Lm(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPoolBackprop=function(e,r,o,i){var a=new Lm(i,"max",!0),s=this.compileAndRun(a,[r]),u=new iW(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(e,r,o){var i=new xH(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.cast=function(e,r){return Im(e,r,this)},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.avgPool3d=function(e,r){var o=new Bm(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.avgPool3dBackprop=function(e,r,o){var i=new _H(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.maxPool3d=function(e,r){var o=new Bm(r,"max",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPool3dBackprop=function(e,r,o,i){var a=new Bm(i,"max",!0),s=this.compileAndRun(a,[r]),u=new aW(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.reshape=function(e,r){var o=this.texData.get(e.dataId);if(o.isPacked&&!yc(e.shape,r)&&(null===o.texture||!yc(o.shape,r))){var i=this.packedReshape(e,r);return R.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return vf(e,r)},n.prototype.resizeBilinear=function(e,r,o,i){var a=F().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new vW(e.shape,r,o,i):new gW(e.shape,r,o,i);return this.compileAndRun(a,[e],"float32")},n.prototype.resizeBilinearBackprop=function(e,r,o){var i=new pW(e,r,o);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,r,o,i){var a=new yW(e.shape,r,o,i);return this.compileAndRun(a,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){var i=new mW(e,r,o);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,r,o,i){var a=r?e:Go(e),c=new sW(a.shape[0],a.shape[1],o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},n.prototype.oneHot=function(e,r,o,i){var a=new uW(e.size,r,o,i);return this.compileAndRun(a,[e])},n.prototype.diag=function(e){var r=new zH(e.size);return this.compileAndRun(r,[e])},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return tf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Tm(e.dataSync(),r.dataSync(),o,i,a)},n.prototype.cropAndResize=function(e,r,o,i,a,s){var u=new UH(e.shape,r.shape,i,a,s);return this.compileAndRun(u,[e,r,o],"float32")},n.prototype.depthToSpace=function(e,r,o){D(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=e.shape[0],c=("NHWC"===o?e.shape[1]:e.shape[2])*r,l=("NHWC"===o?e.shape[2]:e.shape[3])*r,d=("NHWC"===o?e.shape[3]:e.shape[1])/(r*r),f=new WH("NHWC"===o?[i,c,l,d]:[i,d,c,l],r,o);return this.compileAndRun(f,[e])},n.prototype.split=function(e,r,o){return mS(e,r,o)},n.prototype.scatterND=function(e,r,o){var i=wc(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=[l/u,u],f=e.reshape([s,a]),h=r.reshape([s,u]);if(0===l)return vf(sn([]),o);var p=Y(0),g=new QS(s,a,f.rank,h.rank,c,d);return this.compileAndRun(g,[h,f,p]).reshape(o)},n.prototype.sparseToDense=function(e,r,o,i){var a=wc(0,e,o),d=new QS(a.numUpdates,a.sliceRank,e.rank,r.rank,a.strides,[a.outputSize,1],!1);return this.compileAndRun(d,[r,e,i]).reshape(o)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,r){var o=this.texData.get(e.dataId),i=new AS("return real * expR - imag * expI;",e.shape,r),a=new AS("return real * expI + imag * expR;",e.shape,r),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=wm(e,r),s=a[0],u=a[1],c=a[2],l=a[3],d=r.reshape([u,i]),f=e.reshape([e.size/c,c]),h=new ZH(i,l,[u,c]);return this.compileAndRun(h,[f,d]).reshape(s)},n.prototype.fill=function(e,r,o){if("string"===(o=o||xs(r))){var i=ic(o,ae(e));return i.fill(r),R.makeTensor(i,e,o,this)}var a=new YH(e,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},n.prototype.linspace=function(e,r,o){return Mm(e,r,o)},n.prototype.makeTensorInfo=function(e,r){var o=this.write(null,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}},n.prototype.makeOutput=function(e,r){var o=this.makeTensorInfo(e,r).dataId;return R.makeTensorFromDataId(o,e,r,this)},n.prototype.unpackTensor=function(e){var r=new jW(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},n.prototype.packTensor=function(e){var r=new cW(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},n.prototype.packedReshape=function(e,r){var o=[vc(e.shape)].concat(mc(e.shape)),i={dtype:e.dtype,shape:o,dataId:e.dataId},a=[vc(r)].concat(mc(r)),s=new hW(a,o),u=this.runWebGLProgram(s,[i],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},n.prototype.decode=function(e){var r,o=this.texData.get(e),i=o.isPacked,a=o.shape,s=o.dtype,u=Zd(a);return r=i?new HH(u):new jH(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(e,r,o,i,a){var s=this;void 0===a&&(a=!1);var u=this.makeTensorInfo(e.outputShape,o),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===dc.DENSE){var l=fc(e.outputShape);c.texShape=l.map(function(y){return 2*y})}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===ae(u.shape))return c.values=ws(u.dtype,0),u;var d=[],f=r.map(function(y){if("complex64"===y.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(y.dataId);if(null==w.texture){if(!e.packedInputs&&ae(y.shape)<=F().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=y.shape)}else if(!!w.isPacked!=!!e.packedInputs)y=w.isPacked?s.unpackTensor(y):s.packTensor(y),d.push(y),w=s.texData.get(y.dataId);else if(w.isPacked&&!yc(w.shape,y.shape)){var x=y,_=y.shape;y.shape=w.shape,y=s.packedReshape(y,_),d.push(y),w=s.texData.get(y.dataId),x.shape=_}return s.uploadToGPU(y.dataId),{shape:y.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var h,y,_,p={shape:u.shape,texData:c,isUniform:!1},g=(y=e,_="",f.concat(p).forEach(function(E){_+=E.shape+"_"+(E.isUniform?"uniform":E.texData.texShape)+"_"+(null!=E.texData&&null!=E.texData.slice&&E.texData.slice.flatOffset>0)}),y.constructor.name+"_"+_+"_"+y.userCode),v=this.getAndSaveBinary(g,function(){return function(y,w,x,_){var M=w.userCode,I=x.map(function(j,q){var K={logicalShape:j.shape,texShape:j.isUniform?null:j.texData.texShape,isUniform:j.isUniform,isPacked:!j.isUniform&&j.texData.isPacked,flatOffset:null};return null!=j.texData&&null!=j.texData.slice&&j.texData.slice.flatOffset>0&&(K.flatOffset=j.texData.slice.flatOffset),{name:w.variableNames[q],shapeInfo:K}}),E=I.map(function(j){return j.shapeInfo}),S={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},k=gH(I,S,M,w.packedInputs),A=y.createProgram(k),U=null,B=y.getUniformLocation(A,"NAN",!1);1===F().getNumber("WEBGL_VERSION")&&(U=y.getUniformLocation(A,"INFINITY",!1));for(var N={},W=0;W<w.variableNames.length;W++){var H=w.variableNames[W];N[H]=y.getUniformLocation(A,H,!1),N["offset"+H]=y.getUniformLocation(A,"offset"+H,!1)}return{program:w,source:k,webGLProgram:A,uniformLocations:N,inShapeInfos:E,outShapeInfo:S,infLoc:U,nanLoc:B}}(s.gpgpu,e,f,p)}),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(y,w,x,_,M){XS(w.inShapeInfos,x),XS([w.outShapeInfo],[_]);var I=_.texData.texture,E=_.texData.texShape;_.texData.isPacked?y.setOutputPackedMatrixTexture(I,E[0],E[1]):y.setOutputMatrixTexture(I,E[0],E[1]),y.setProgram(w.webGLProgram),1===F().getNumber("WEBGL_VERSION")&&null!==w.infLoc&&y.gl.uniform1f(w.infLoc,1/0),null!==w.nanLoc&&y.gl.uniform1f(w.nanLoc,NaN),x.forEach(function(S,k){var A=w.program.variableNames[k],U=w.uniformLocations[A],B=w.uniformLocations["offset"+A];if(null!=U)if(S.isUniform)if(ae(S.shape)<2)y.gl.uniform1f(U,S.uniformValues[0]);else{var N=S.uniformValues;N instanceof Float32Array||(N=new Float32Array(N)),y.gl.uniform1fv(U,N)}else null!=S.texData.slice&&null!=B&&y.gl.uniform1i(B,S.texData.slice.flatOffset),y.setInputMatrixTexture(S.texData.texture,U,k)}),M?.(y,w.webGLProgram),y.executeProgram()}(this.gpgpu,v,f,p,i),d.forEach(function(y){return s.disposeData(y.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!F().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===a){var b=this.unpackTensor(u);return this.disposeData(u.dataId),b}return u},n.prototype.compileAndRun=function(e,r,o,i,a){void 0===a&&(a=!1);var s=this.runWebGLProgram(e,r,o=o||r[0].dtype,i,a);return R.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var e=this;this.disposed||(F().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=te(function(){if(!F().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=F().getBool("DEBUG");F().set("DEBUG",!1);var o=e.abs(Y(1e-8)).dataSync()[0];if(F().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.values,c=o.usage,l=o.isPacked;if(null==o.texture){var d,f=null!=this.activeTimers;f&&(d=Ar());var h=o.texShape;if(null==h&&(h=H2(i,l),o.texShape=h),null!=s){var p=Zd(i),g=void 0,v=h[1],m=h[0],b=s instanceof Uint8Array;l?(v=(r=hc(h[0],h[1]))[0],g=new KH(p,[m=r[1],v],b)):g=new qH(p,[m,v],b);var y=this.makeTensorInfo([m,v],a);this.texData.get(y.dataId).usage=b?Yn.PIXELS:Yn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),v,m,s);var w=this.runWebGLProgram(g,[y],a,null,!0),x=this.texData.get(w.dataId);o.texture=x.texture,o.texShape=x.texShape,o.isPacked=x.isPacked,o.usage=x.usage,this.disposeData(y.dataId),this.texData.delete(w.dataId),o.values=null,f&&(this.uploadWaitMs+=Ar()-d)}else{var _=this.acquireTexture(h,c,a,l);o.texture=_}}},n.prototype.convertAndCacheOnCPU=function(e,r){var o=this.texData.get(e),i=o.dtype;return this.releaseGPUData(e),null!=r&&(o.values=function(a,s){if("float32"===s||"complex64"===s)return a;if("int32"===s||"bool"===s){for(var u="int32"===s?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},n.prototype.acquireTexture=function(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,i)},n.prototype.computeBytes=function(e,r){return e[0]*e[1]*Xv(r)},n}(hS);C2()&&R.registerBackend("webgl",function(){return new dI},2);var WW=T({square_:function(t){var n=C(t,"x","square");return R.runKernelFunc(function(r,o){return o([n]),r.square(n)},{x:n},null,"Square",{},[n],[])}}),Sc="SquaredDifference",fI=T({squaredDifference_:function(t,n){var e,r=C(t,"a","squaredDifference"),o=C(n,"b","squaredDifference");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=Y(2);return{a:function(){return s.mul(c.sub(l).mul(d))},b:function(){return s.mul(l.sub(c).mul(d))}}},Sc,{},[r,o],[])}}),zW=T({abs_:function(t){var n=C(t,"x","abs");return"complex64"===n.dtype?R.runKernelFunc(function(e){return e.complexAbs(n)},{$x:n}):R.runKernelFunc(function(e,r){var o=e.abs(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),$W=T({acos_:function(t){var n=C(t,"x","acos");return R.runKernelFunc(function(e,r){var o=e.acos(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Y(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),GW=T({acosh_:function(t){var n=C(t,"x","acosh");return R.runKernelFunc(function(e,r){var o=e.acosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),qW=T({asin_:function(t){var n=C(t,"x","asin");return R.runKernelFunc(function(e,r){var o=e.asin(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Y(1).sub(o.toFloat().square()).sqrt())}}})}}),KW=T({asinh_:function(t){var n=C(t,"x","asinh");return R.runKernelFunc(function(e,r){var o=e.asinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Y(1).add(o.toFloat().square()).sqrt())}}})}}),XW=T({atan_:function(t){var n=C(t,"x","atan");return R.runKernelFunc(function(e,r){var o=e.atan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),QW=T({atanh_:function(t){var n=C(t,"x","atanh");return R.runKernelFunc(function(e,r){var o=e.atanh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(Y(1).sub(o.toFloat().square()))}}})}}),YW=T({ceil_:function(t){var n=C(t,"x","ceil");return R.runKernelFunc(function(e){return e.ceil(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),Hm=T({clipByValue_:function(t,n,e){var r=C(t,"x","clipByValue");return D(n<=e,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+e+")."}),R.runKernelFunc(function(a,s){var u=a.clip(r,n,e);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(n).logicalAnd(u.lessEqual(e)),$e(a))}}},"ClipByValue",{min:n,max:e},[r])}}),JW=T({cos_:function(t){var n=C(t,"x","cos");return R.runKernelFunc(function(r,o){var i=r.cos(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},[n])}}),ZW=T({cosh_:function(t){var n=C(t,"x","cosh");return R.runKernelFunc(function(e,r){var o=e.cosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),ez=T({erf_:function(t){var n=C(t,"x","erf");return D("int32"===n.dtype||"float32"===n.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===n.dtype&&(n=n.toFloat()),R.runKernelFunc(function(e,r){var o=e.erf(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Wm=T({exp_:function(t){var n=C(t,"x","exp");return R.runKernelFunc(function(e,r){var o=e.exp(n);return r([o]),o},{x:n},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),tz=T({expm1_:function(t){var n=C(t,"x","expm1");return R.runKernelFunc(function(e,r){var o=e.expm1(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}}),nz=T({floor_:function(t){var n=C(t,"x","floor");return R.runKernelFunc(function(e){return e.floor(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),rz=T({log_:function(t){var n=C(t,"x","log");return R.runKernelFunc(function(r,o){var i=r.log(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},[n])}}),oz=T({log1p_:function(t){var n=C(t,"x","log1p");return R.runKernelFunc(function(e,r){var o=e.log1p(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}}),iz=T({logSigmoid_:function(t){var n=C(t,"x","logSigmoid");return R.runKernelFunc(function(e,r){var o=e.softplus(n.neg()).neg();return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),xf=T({neg_:function(t){var n=C(t,"x","neg");return R.runKernelFunc(function(r){return r.neg(n)},{x:n},function(r){return{x:function(){return r.neg()}}},"Neg",{},[n])}}),az=T({reciprocal_:function(t){var n=C(t,"x","reciprocal");return R.runKernelFunc(function(e,r){var o=e.reciprocal(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}}),sz=T({round_:function(t){var n=C(t,"x","round");return R.runKernelFunc(function(e){return e.round(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),hI=T({rsqrt_:function(t){var n=C(t,"x","rsqrt");return R.runKernelFunc(function(r,o){var i=r.rsqrt(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[n])}}),pI=T({sigmoid_:function(t){var n=C(t,"x","sigmoid");return R.runKernelFunc(function(e,r){var o=e.sigmoid(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.mul(Y(1).sub(o)))}}},"Sigmoid")}}),uz=T({sign_:function(t){var n=C(t,"x","sign");return R.runKernelFunc(function(e){return e.sign(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),cz=T({isNaN_:function(t){var n=C(t,"x","isNaN");return R.runKernelFunc(function(e){return e.isNaN(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),lz=T({isInf_:function(t){var n=C(t,"x","isInf");return R.runKernelFunc(function(e){return e.isInf(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),dz=T({isFinite_:function(t){var n=C(t,"x","isFinite");return R.runKernelFunc(function(e){return e.isFinite(n)},{$x:n},function(e){return{$x:function(){return $e(e)}}})}}),fz=T({sin_:function(t){var n=C(t,"x","sin");return R.runKernelFunc(function(r,o){var i=r.sin(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},[n])}}),hz=T({sinh_:function(t){var n=C(t,"x","sinh");return R.runKernelFunc(function(e,r){var o=e.sinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),pz=T({softplus_:function(t){var n=C(t,"x","softplus");return R.runKernelFunc(function(e,r){var o=e.softplus(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),gz=T({sqrt_:function(t){var n=C(t,"x","sqrt");return R.runKernelFunc(function(e,r){var o=e.sqrt(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),vz=T({step_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","step");return R.runKernelFunc(function(r){return r.step(e,n)},{$x:e},function(r){return{$x:function(){return $e(r)}}})}}),mz=T({tan_:function(t){var n=C(t,"x","tan");return R.runKernelFunc(function(e,r){var o=e.tan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}}),yz=T({tanh_:function(t){var n=C(t,"x","tanh");return R.runKernelFunc(function(e,r){var o=e.tanh(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return Y(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function gI(t,n,e,r,o,i){var a,s,u=C(t,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),D(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),D(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&D(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&D(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Ic(u,c,l,s,a,i)}function vI(t,n,e,r,o,i){var a,s,u=C(t,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),D(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),D(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&D(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&D(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Ic(u,c,l,s,a,i)}function mI(t,n,e,r,o,i){var a,s,u=C(t,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),D(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),D(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&D(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&D(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Ic(u,c,l,s,a,i)}function Ic(t,n,e,r,o,i){null==i&&(i=.001);var a,s,u,c=C(t,"x","batchNorm"),l=C(n,"mean","batchNorm"),d=C(e,"variance","batchNorm");return null!=o&&(a=C(o,"scale","batchNorm")),null!=r&&(s=C(r,"offset","batchNorm")),D(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),D(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),D(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,R.runKernelFunc(function(h,p){var g=h.batchNormalization(u,_f(l),_f(d),i,_f(a),_f(s));return p([c,l,d,a]),g},{x:c,mean:l,variance:d,scale:a,offset:s},function(h,p){var v=p[0],m=p[1],b=p[2],w=p[3]??Y(1),x=Ut(m.shape,u.shape),_=[];if(1===m.rank){for(var M=0;M<u.shape.length-1;++M)_.push(u.shape[M]);_.push(1)}var I=v.sub(m),E=h.mul(w),S=hI(b.add(Y(i))),k=S.mul(S).mul(S).mul(Y(-.5));return{x:function(){return 1===m.rank?h.mul(Es(S.as4D(1,1,1,m.shape[0]),_)).mul(w).reshape(v.shape):h.mul(S).mul(w).reshape(v.shape)},mean:function(){var A=S.mul(Y(-1)).mul(E);return 1===m.rank&&(A=A.sum(x)),A.reshape(m.shape)},variance:function(){var A=k.mul(I).mul(E);return 1===m.rank&&(A=A.sum(x)),A.reshape(m.shape)},scale:function(){var A=I.mul(S),U=h.mul(A);return 1===m.rank&&(U=U.sum(x)),U.reshape(m.shape)},offset:function(){var A=h;return 1===m.rank&&(A=A.sum(x)),A.reshape(m.shape)}}},"BatchNormalization",{varianceEpsilon:i},[c,l,d,a]).reshape(c.shape)}function _f(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Cf(){X2("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var bz=T({batchNormalization2d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Cf(),gI(t,n,e,i,o,r)}}),wz=T({batchNormalization3d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Cf(),vI(t,n,e,i,o,r)}}),xz=T({batchNormalization4d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Cf(),mI(t,n,e,i,o,r)}}),_z=T({batchNormalization_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),Cf(),Ic(t,n,e,i,o,r)}}),yI=T({batchNorm_:Ic}),Cz=T({batchNorm2d_:gI}),Dz=T({batchNorm3d_:vI}),Ez=T({batchNorm4d_:mI}),Df=T({logicalAnd_:function(t,n){var e=C(t,"a","logicalAnd","bool"),r=C(n,"b","logicalAnd","bool");return Le(e.shape,r.shape),R.runKernelFunc(function(o){return o.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),Sz=T({logicalNot_:function(t){var n=C(t,"x","logicalNot","bool");return R.runKernelFunc(function(e){return e.logicalNot(n)},{$x:n})}}),bI=T({logicalOr_:function(t,n){var e=C(t,"a","logicalOr","bool"),r=C(n,"b","logicalOr","bool");return Le(e.shape,r.shape),R.runKernelFunc(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}}),Iz=T({logicalXor_:function(t,n){var e=C(t,"a","logicalXor","bool"),r=C(n,"b","logicalXor","bool");return Le(e.shape,r.shape),bI(t,n).logicalAnd(Df(t,n).logicalNot())}}),pa=T({where_:function(t,n,e){var r=C(n,"a","where"),o=C(e,"b","where"),i=C(t,"condition","where","bool");return ze(r.shape,o.shape,"Error in where: "),1===i.rank?D(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):ze(i.shape,o.shape,"Error in where: "),R.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return $e(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),wI=function(t){return oe(this,void 0,void 0,function(){var n,e,r;return ie(this,function(o){switch(o.label){case 0:return[4,(n=C(t,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=km(n.shape,e),t!==n&&n.dispose(),[2,r]}})})},Be=T({add_:function(t,n){var e,r=C(t,"a","add"),o=C(n,"b","add");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=Ut(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Ut(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),Mz=T({addN_:function(t){D(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),D(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var n=t.map(function(o,i){return C(o,"tensors"+i,"addN")}),e=n[0];return n.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(o){if(!Ft(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),R.runKernelFunc(function(o){return o.addN(n)},n,function(o){var i={};return n.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),Rz=T({addStrict_:function(t,n){var e=C(t,"a","addStrict"),r=C(n,"b","addStrict");return ze(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),Tz=T({atan2_:function(t,n){var e,r=C(t,"a","atan2"),o=C(n,"b","atan2");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Be(u.square(),c.square()),d=a.mul(c.div(l)),f=Ut(u.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var l=Be(u.square(),c.square()),d=xf(a.mul(u.div(l))),f=Ut(c.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),Fr=T({div_:function(t,n){var e,r=C(t,"a","div"),o=C(n,"b","div");if(e=pt(r,o),o=e[1],"int32"===(r=e[0]).dtype&&"int32"===o.dtype)return xI(r,o);var i=Le(r.shape,o.shape);return R.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=Ut(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=Ut(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"Div")}}),Az=T({divNoNan_:function(t,n){var e,r=C(t,"a","div"),o=C(n,"b","div");r=(e=pt(r,o))[0];var i=Fr(r,o=e[1]),a=$e(i),s=o.equal(a);return pa(s,a,i)}}),kz=T({divStrict_:function(t,n){var e=C(t,"a","div"),r=C(n,"b","div");return ze(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),xI=T({floorDiv_:function(t,n){var e,r=C(t,"a","floorDiv"),o=C(n,"b","floorDiv");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=Ut(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=Ut(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"FloorDiv")}}),zm=T({maximum_:function(t,n){var e,r=C(t,"a","maximum"),o=C(n,"b","maximum");return e=pt(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Le(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),Pz=T({maximumStrict_:function(t,n){var e=C(t,"a","maximumStrict"),r=C(n,"b","maximumStrict");return ze(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),_I=T({minimum_:function(t,n){var e,r=C(t,"a","minimum"),o=C(n,"b","minimum");return e=pt(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Le(r.shape,o.shape),R.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),Oz=T({minimumStrict_:function(t,n){var e=C(t,"a","minimumStrict"),r=C(n,"b","minimumStrict");return ze(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),Nz=T({mod_:function(t,n){var e,r=C(t,"a","mod"),o=C(n,"b","mod");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Ut(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),d=Ut(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),Fz=T({modStrict_:function(t,n){var e=C(t,"a","modStrict"),r=C(n,"b","modStrict");return ze(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),yn=T({mul_:function(t,n){var e,r=C(t,"a","mul"),o=C(n,"b","mul");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),d=Ut(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=Ut(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),Lz=T({mulStrict_:function(t,n){var e=C(t,"a","mul"),r=C(n,"b","mul");return ze(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),Ef=T({pow_:function(t,n){var e,r=C(t,"base","pow"),o=C(n,"exp","pow");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(s,u){var c=s.pow(r,o);return u([r,o,c]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var f=l.toFloat(),h=s.mul(f.mul(c.pow(f.sub(Y(1))))),p=Ut(c.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var f=c.greater(0),h=c.log().where(f,$e(c)),p=s.mul(d.mul(h)),g=Ut(l.shape,i);return g.length>0&&(p=p.sum(g)),p.reshape(l.shape)}}},"Pow",{},[r,o],[!0])}}),Bz=T({powStrict_:function(t,n){return ze(t.shape,n.shape,"Error in powStrict: "),t.pow(n)}}),Uz=T({squaredDifferenceStrict_:function(t,n){var e=C(t,"a","squaredDifferenceStrict"),r=C(n,"b","squaredDifferenceStrict");return ze(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),Gt=T({sub_:function(t,n){var e,r=C(t,"a","sub"),o=C(n,"b","sub");e=pt(r,o);var i=Le((r=e[0]).shape,(o=e[1]).shape);return R.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=Ut(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Ut(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),Vz=T({subStrict_:function(t,n){var e=C(t,"a","subStrict"),r=C(n,"b","subStrict");return ze(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),CI=T({equal_:function(t,n){var e,r=C(t,"a","equal"),o=C(n,"b","equal");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),jz=T({equalStrict_:function(t,n){var e=C(t,"a","equalStrict"),r=C(n,"b","equalStrict");return ze(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),Hz=T({greater_:function(t,n){var e,r=C(t,"a","greater"),o=C(n,"b","greater");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),DI=T({greaterEqual_:function(t,n){var e,r=C(t,"a","greaterEqual"),o=C(n,"b","greaterEqual");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return $e(s)},b:function(){return $e(u)}}},"GreaterEqual")}}),Wz=T({greaterEqualStrict_:function(t,n){var e=C(t,"a","greaterEqualStrict"),r=C(n,"b","greaterEqualStrict");return ze(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),zz=T({greaterStrict_:function(t,n){var e=C(t,"a","greaterStrict"),r=C(n,"b","greaterStrict");return ze(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),$z=T({less_:function(t,n){var e,r=C(t,"a","less"),o=C(n,"b","less");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),Gz=T({lessEqual_:function(t,n){var e,r=C(t,"a","lessEqual"),o=C(n,"b","lessEqual");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),qz=T({lessEqualStrict_:function(t,n){var e=C(t,"a","lessEqualStrict"),r=C(n,"b","lessEqualStrict");return ze(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),Kz=T({lessStrict_:function(t,n){var e=C(t,"a","lessStrict"),r=C(n,"b","lessStrict");return ze(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),Xz=T({notEqual_:function(t,n){var e,r=C(t,"a","notEqual"),o=C(n,"b","notEqual");return e=pt(r,o),Le((r=e[0]).shape,(o=e[1]).shape),R.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),Qz=T({notEqualStrict_:function(t,n){var e=C(t,"a","notEqualStrict"),r=C(n,"b","notEqualStrict");return ze(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function EI(t,n){for(var e=[],r=t;r<n;++r)e.push(r);return e}function SI(t){for(var n=[],e=0;e<t.length;++e)for(var r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var $m=T({gather_:function(t,n,e){void 0===e&&(e=0);var r=C(t,"x","gather"),o=C(n,"indices","gather","int32");e=Lt(e,r.shape)[0];var i=function(a,s,u){for(var c=a.shape[u],l=[],d=1,f=1,h=0;h<u;h++)l.push(a.shape[h]),d*=a.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<a.rank;h++)l.push(a.shape[h]),f*=a.shape[h];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:l}}(r,o,e);return R.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),e);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,d=c.slice(0,e),f=d.length,h=c.slice(e,c.length).slice(1),p=h.length,g=EI(0,f),v=EI(f+1,f+1+p),m=SI([d,[l],h]),b=a.reshape(m),y=u.reshape([l]),w=SI([[f],g,v]),x=b.transpose(w),_=II(x,y,r.shape[e]),M=nf(w);return _.transpose(M)},indices:function(){return u}}},"Gather",{axis:e}).reshape(i.outputShape)}}),II=T({unsortedSegmentSum_:function(t,n,e){var r=C(t,"x","unsortedSegmentSum"),o=C(n,"segmentIds","unsortedSegmentSum","int32");return D(mt(e),function(){return"numSegments must be of dtype int"}),R.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,e);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=zm(c,$e(c)),d=$m(u,l),f=DI(c,Y(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=gr(f,p+1);f=Df(f,Ds(d.shape,"bool"));var g=$e(d);return pa(f,d,g)}(i,s)}}})}});function MI(t,n,e,r,o,i,a){void 0===i&&(i="NHWC"),D(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var s=t,u=n,c=!1;3===n.rank&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,t[0],t[1],t[2]]),D(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),D(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),D(4===e.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var l="NHWC"===i?s[3]:s[1],d="NHWC"===i?u.shape[3]:u.shape[1];D(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),D(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),null!=a&&D(mt(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=gf(i),h=Si(s,e.shape,r,1,o,a,!1,f),p=R.runKernelFunc(function(g,v){var m=g.conv2dDerInput(u,e,h);return v([e,u]),m},{dy4D:u,filter:e},function(g,v){var m=v[0],b=v[1];return{dy4D:function(){return vr(g,m,r,o,i,1,a)},filter:function(){return qm(g,b,m.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Gm(t){var i,n="number"==typeof(i=t)?[i,i,i]:2===i.length?[i[0],i[1],1]:i;return 1===n[0]&&1===n[1]&&1===n[2]}function RI(t,n,e,r,o){D(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var i=t,a=n,s=!1;4===n.rank&&(s=!0,a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],c=a.shape[4];D(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),D(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),D(5===e.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),D(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),D(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var l=_c(i,e.shape,r,1,o),d=R.runKernelFunc(function(f){return f.conv3dDerInput(a,e,l)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var Jz=T({conv1d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=C(t,"x","conv1d"),u=C(n,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),D(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),D(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&D(mt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),D(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),D(Rn(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),D("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=vr(f,d,[1,e],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),vr=T({conv2d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=C(t,"x","conv2d"),u=C(n,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),D(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),D(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&D(mt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d="NHWC"===o?c.shape[3]:c.shape[1];D(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),D(Rn(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"});var f=gf(o),h=Si(c.shape,u.shape,e,i,r,a,!1,f),g=R.runKernelFunc(function(v,m){var b=v.conv2d(c,u,h);return m([u,c]),b},{x:c,filter:u},function(v,m){var y=m[0],w=m[1];return D(da(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return TI(w.shape,v,y,e,r,o)},filter:function(){return qm(w,v,y.shape,e,r,o)}}},"Conv2D",h,[u,c]);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),Zz=T({conv3d_:function(t,n,e,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var h,a=C(t,"x","conv3d"),s=C(n,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),D(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),D(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),D(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),D((h=i,Gm(e)||Gm(h)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),D("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=_c(u.shape,s.shape,e,i,r),d=R.runKernelFunc(function(f,h){var p=f.conv3d(u,s,l);return h([u,s]),p},{x:u,$filter:s},function(f,h){D(Gm(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],g=h[1];return{x:function(){return RI(p.shape,f,g,e,r)},$filter:function(){return function(v,m,b,y,w){var x=v;4===v.rank&&(x=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var _=m;4===_.rank&&(_=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),D(5===x.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."}),D(5===_.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),D(5===b.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),D(x.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+b[3]+"."}),D(_.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+b[4]+")."});var M=_c(x.shape,b,y,1,w);return R.runKernelFunc(function(I){return I.conv3dDerFilter(x,_,M)},{x5D:x,dy5D:_})}(p,f,g.shape,e,r)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),qm=T({conv2dDerFilter_:function(t,n,e,r,o,i,a){void 0===i&&(i="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=n;3===u.rank&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),D(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),D(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),D(4===e.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];D(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),D(l===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+e[3]+")."}),null!=a&&D(mt(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=gf(i),f=Si(s.shape,e,r,1,o,a,!1,d);return R.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),TI=T({conv2dDerInput_:MI}),Sf=T({depthwiseConv2d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=C(t,"x","depthwiseConv2d"),u=C(n,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),D(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),D(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),D(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),D(Rn(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),null!=a&&D(mt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=Si(c.shape,u.shape,e,i,r,a,!0),h=R.runKernelFunc(function(p,g){var v=p.depthwiseConv2D(c,u,d);return g([c,u]),v},{x:c,filter:u},function(p,g){D(da(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var v=g[0],m=g[1];return{x:function(){return AI(v.shape,p,m,d)},filter:function(){return kI(v,p,m.shape,d)}}},"DepthwiseConv2dNative",d,[c,u]);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),AI=T({depthwiseConv2dDerInput_:function(t,n,e,r){var o=n,i=!1;3===n.rank&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=R.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),kI=T({depthwiseConv2dDerFilter_:function(t,n,e,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=n;return 3===i.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),R.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),Km=T({separableConv2d_:function(t,n,e,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=C(t,"x","separableConv2d"),u=C(n,"depthwiseFilter","separableConv2d"),c=C(e,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),D(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),D(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),D(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),D(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],h=u.shape[3];D(c.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+c.shape[2]+"."});var p=Sf(l,u,r,o,a,i),g=vr(p,c,1,"valid",a);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),e6=T({conv2dTranspose_:function(t,n,e,r,o,i){return MI(e,C(t,"x","conv2dTranspose"),C(n,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),t6=T({conv3dTranspose_:function(t,n,e,r,o){return RI(e,C(t,"x","conv3dTranspose"),C(n,"filter","conv3dTranspose"),r,o)}}),If=T({matMul_:function(t,n,e,r){var o;void 0===e&&(e=!1),void 0===r&&(r=!1);var i=C(t,"a","matMul"),a=C(n,"b","matMul");o=pt(i,a),i=o[0],a=o[1];var s=e?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=e?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=i.shape.slice(0,-2),f=a.shape.slice(0,-2),h=ae(d),p=ae(f);D(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),D(Ft(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),D(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var g=i.shape.slice(0,-2).concat([c,l]),v=e?i.as3D(h,s,c):i.as3D(h,c,s),m=r?a.as3D(p,l,u):a.as3D(p,u,l);return R.runKernelFunc(function(y,w){var x=y.batchMatMul(v,m,e,r);return w([v,m]),x},{a:v,b:m},function(y,w){var _=w[0],M=w[1];return e||r?!e&&r?{a:function(){return y.matMul(M,!1,!1)},b:function(){return y.matMul(_,!0,!1)}}:e&&!r?{a:function(){return M.matMul(y,!1,!0)},b:function(){return _.matMul(y,!1,!1)}}:{a:function(){return M.matMul(y,!0,!0)},b:function(){return y.matMul(_,!0,!0)}}:{a:function(){return y.matMul(M,!1,!0)},b:function(){return _.matMul(y,!0,!1)}}},"BatchMatMul",{transposeA:e,transposeB:r}).reshape(g)}}),n6=T({dot_:function(t,n){var e=C(t,"t1","dot"),r=C(n,"t2","dot");D(!(1!==e.rank&&2!==e.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=1===e.rank?e.size:e.shape[1],i=1===r.rank?r.size:r.shape[0];return D(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===e.rank&&1===r.rank?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===e.rank&&2===r.rank?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===e.rank&&1===r.rank?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),r6=T({outerProduct_:function(t,n){var e=C(t,"v1","outerProduct"),r=C(n,"v2","outerProduct");return D(1===e.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),Mc=T({reverse_:function(t,n){var e=C(t,"x","reverse");if(0===e.rank)return e.clone();var r=Lt(n,e.shape);return R.runKernelFunc(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}}),o6=T({reverse1d_:function(t){var n=C(t,"x","reverse");return D(1===n.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),Mc(n,0)}}),i6=T({reverse2d_:function(t,n){var e=C(t,"x","reverse");return D(2===e.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Mc(e,n)}}),a6=T({reverse3d_:function(t,n){var e=C(t,"x","reverse");return D(3===e.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Mc(e,n)}}),s6=T({reverse4d_:function(t,n){var e=C(t,"x","reverse");return D(4===e.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Mc(e,n)}});function PI(t,n,e,r,o,i){var a=C(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),D(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),D(Rn(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),null!=i&&D(mt(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Ss(s.shape,n,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&Ft(c.inShape,c.outShape))return a.clone();var d=R.runKernelFunc(function(f,h){var p=f.maxPool(s,c);return h([s,p]),p},{x:s},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(v,m,b,y,w,x,_,M){var I=C(v,"dy","maxPoolBackprop"),E=C(m,"input","maxPoolBackprop"),S=C(b,"output","maxPoolBackprop");D(E.rank===I.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+I.rank+")"}),null==x&&(x=[1,1]),D(Rn(w,x),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+x+"'"}),D(4===I.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+I.rank+"."}),D(4===E.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+E.rank+"."});var k=Ss(E.shape,y,w,x,_,void 0);return R.runKernelFunc(function(A){return A.maxPoolBackprop(I,E,S,k)},{$dy:I,$input:E})}(f,p,g,n,e,r,o)}}},"MaxPool",c,[s]);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function OI(t,n,e,r,o,i){var a=C(t,"x","avgPool","float32");null==r&&(r=[1,1]),D(Rn(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),D(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&D(mt(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Ss(s.shape,n,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&Ft(c.inShape,c.outShape))return a.clone();var l=R.runKernelFunc(function(d){return d.avgPool(s,c)},{x:s},function(d){return{x:function(){return function(f,h,p,g,v,m){var b=C(f,"dy","avgPoolBackprop"),y=C(h,"input","avgPoolBackprop");D(y.rank===b.rank,function(){return"Rank of input ("+y.rank+") does not match rank of dy ("+b.rank+")"}),null==v&&(v=[1,1]),D(Rn(g,v),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"});var w=y,x=b,_=!1;3===y.rank&&(_=!0,w=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]),x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),D(4===x.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."}),D(4===w.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var M=Ss(w.shape,p,g,v,m),I=R.runKernelFunc(function(E){return E.avgPoolBackprop(x,w,M)},{dy4D:x,input4D:w});return _?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}(d,s,n,e,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Yt=T({maxPool_:function(t,n,e,r,o){return PI(t,n,e,1,r,o)}}),Rc=T({avgPool_:function(t,n,e,r,o){return OI(t,n,e,1,r,o)}}),u6=T({pool_:function(t,n,e,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=C(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),D(Rn(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,x,_,M,I,l=Ss(s.shape,n,i,o,r),d=[l.dilationHeight,l.dilationWidth];c="same"===r?(x=d,_=[l.filterHeight,l.filterWidth].map(function(E,S){return E+(E-1)*(x[S]-1)}).map(function(E){return E-1}),M=_.map(function(E){return Math.floor(E/2)}),I=_.map(function(E,S){return E-M[S]}),_.map(function(E,S){return[M[S],I[S]]})):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(w,x,_){var M=_.map(function(B){return B[0]}),I=_.map(function(B){return B[1]}),E=w.concat(M,I),S=x.map(function(B,N){return(B-E[N]%B)%B}),k=I.map(function(B,N){return B+S[N]});return[x.map(function(B,N){return[M[N],k[N]]}),x.map(function(B,N){return[0,S[N]]})]}([l.inHeight,l.inWidth],d,c),g=h[1],v=f?r:"valid",m=f?s:rS(s,d,h[0]),b=("avg"===e?function(){return OI(m,n,i,1,v)}:function(){return PI(m,n,i,1,v)})(),y=f?b:eS(b,d,g);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),c6=T({maxPool3d_:function(t,n,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=C(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),D(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),D("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),D(Rn(e,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&D(mt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=xc(u.shape,n,e,a,r,o,i),d=R.runKernelFunc(function(f,h){var p=f.maxPool3d(u,l);return h([u,p]),p},{x:u},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(v,m,b,y,w,x,_,M){var I=C(v,"dy","maxPool3dBackprop"),E=C(m,"input","maxPool3dBackprop"),S=C(b,"output","maxPool3dBackprop"),k=I,A=E,U=S,B=!1;4===E.rank&&(B=!0,k=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),A=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),U=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),D(5===k.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+k.rank+"."}),D(5===A.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),D(5===U.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+U.rank+"."}),null==x&&(x=[1,1,1]),D(Rn(w,x),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+x+"'"}),null!=M&&D(mt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+M+" but got pad "+_+"."});var N=xc(A.shape,y,w,x,_,M),W=R.runKernelFunc(function(H){return H.maxPool3dBackprop(k,A,U,N)},{dy5D:k,input5D:A});return B?W.as4D(W.shape[1],W.shape[2],W.shape[3],W.shape[4]):W}(f,p,g,n,e,a,r,o)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),l6=T({avgPool3d_:function(t,n,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=C(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),D(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),D("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),D(Rn(e,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&D(mt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=xc(u.shape,n,e,a,r,o,i),d=R.runKernelFunc(function(f){return f.avgPool3d(u,l)},{x:u},function(f){return{x:function(){return function(h,p,g,v,m,b,y){var w=C(h,"dy","avgPool3dBackprop"),x=C(p,"input","avgPool3dBackprop"),_=w,M=x,I=!1;4===x.rank&&(I=!0,_=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),M=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),D(5===_.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),D(5===M.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),null==m&&(m=[1,1,1]),D(Rn(v,m),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+m+"'"}),null!=y&&D(mt(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+b+"."});var E=xc(M.shape,g,v,m,b,y),S=R.runKernelFunc(function(k){return k.avgPool3dBackprop(_,M,E)},{dy5D:_,input5D:M});return I?S.as4D(S.shape[1],S.shape[2],S.shape[3],S.shape[4]):S}(f,u,n,e,a,r,o)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),lo=T({slice_:function(t,n,e){var r,o,i=C(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof n?[n].concat(new Array(i.rank-1).fill(0)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(0)):n.slice()).forEach(function(u){D(-1!==u,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==e?new Array(i.rank).fill(-1):"number"==typeof e?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(D(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-r[c])}),cS(i,r,o);var a=i.shape;return R.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return u.pad(c)}}},"Slice",{begin:r,size:o})}}),d6=T({slice1d_:function(t,n,e){var r=C(t,"x","slice1d");return D(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),lo(r,[n],[e])}}),f6=T({slice2d_:function(t,n,e){var r=C(t,"x","slice2d");return D(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),lo(r,n,e)}}),NI=T({slice3d_:function(t,n,e){var r=C(t,"x","slice3d");return D(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),lo(r,n,e)}}),h6=T({slice4d_:function(t,n,e){var r=C(t,"x","slice4d");return D(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),lo(r,n,e)}});function FI(t,n,e,r,o){return n.rank<e.rank&&(n=n.reshape(Mn(n.shape,r))),t.rank<e.rank&&(t=t.reshape(Mn(t.shape,r))),{x:function(){var i=t.mul(e.equal(n).cast(t.dtype));return null==o?i:i.transpose(o)}}}var p6=T({all_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","all","bool"),o=Lt(n,r.shape),i=o,a=kr(i,r.rank);null!=a&&(r=r.transpose(a),i=Pr(i.length,r.rank));var s=R.runKernelFunc(function(c){return c.all(r,i)},{$x:r});if(e){var u=Mn(s.shape,o);return s.reshape(u)}return s}}),g6=T({any_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","any","bool"),o=Lt(n,r.shape),i=o,a=kr(i,r.rank);null!=a&&(r=r.transpose(a),i=Pr(i.length,r.rank));var s=R.runKernelFunc(function(c){return c.any(r,i)},{$x:r});if(e){var u=Mn(s.shape,o);return s.reshape(u)}return s}}),v6=T({argMax_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","argMax");null==n&&(n=0);var r=Lt(n,e.shape),o=kr(r,e.rank);return null!=o&&(e=e.transpose(o),r=Pr(r.length,e.rank)),R.runKernelFunc(function(s,u){var c=s.argMax(e,r[0]);return u([e]),c},{x:e},function(s,u){var c=u[0];return{x:function(){return $e(c)}}},"ArgMax",{axis:r[0]},[e])}}),m6=T({argMin_:function(t,n){void 0===n&&(n=0);var e=C(t,"x","argMin");null==n&&(n=0);var r=Lt(n,e.shape),o=kr(r,e.rank);return null!=o&&(e=e.transpose(o),r=Pr(r.length,e.rank)),R.runKernelFunc(function(i,a){var s=i.argMin(e,r[0]);return a([e]),s},{$x:e},function(i,a){var s=a[0];return{$x:function(){return $e(s)}}})}}),y6=T({logSumExp_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","logSumExp"),o=Lt(n,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(e){var u=Mn(s.shape,o);return s.reshape(u)}return s}}),Mf=T({max_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","max"),o=r,i=Lt(n,r.shape),a=i,s=kr(a,r.rank);null!=s&&(r=r.transpose(s),a=Pr(a.length,r.rank));var c=R.runKernelFunc(function(d,f){var h=d.max(r,a);return f([o,h]),h},{x:r},function(d,f){return FI(d,f[1],f[0],i,s)},"Max",{axes:a},[r],[!0]);if(e){var l=Mn(c.shape,i);c=c.reshape(l)}return c}}),b6=T({mean_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","mean"),o=Lt(n,r.shape),i=ae(on(r.shape,o)[1]);return ff(function(a){var s=Y(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(n,e),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(Ds(a.shape,"float32")).div(i)}}})(r)}}),w6=T({min_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","min"),o=r,i=Lt(n,r.shape),a=i,s=kr(a,r.rank);null!=s&&(r=r.transpose(s),a=Pr(a.length,r.rank));var c=R.runKernelFunc(function(d,f){var h=d.min(r,a);return f([o,h]),h},{x:r},function(d,f){return FI(d,f[1],f[0],i,s)},"Min",{axes:a},[r],[!0]);if(e){var l=Mn(c.shape,i);c=c.reshape(l)}return c}}),x6=T({moments_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=Lt(n,(t=C(t,"x","moments")).shape),o=t.mean(r,e),i=o.shape;e||(i=Mn(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,e)}}}),LI=T({sum_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=Lt(n,r.shape);return ff(function(i){var a=kr(o,i.rank),s=o,u=i;null!=a&&(u=i.transpose(a),s=Pr(s.length,i.rank));var c=function(h){var p=i.shape.slice();return o.forEach(function(g){p[g]=1}),h.reshape(p).mul(Ds(i.shape,"float32"))},d=R.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",{axes:s});if(e){var f=Mn(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:c}})(r)}}),_6=T({prod_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=C(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=Lt(n,r.shape),i=kr(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Pr(a.length,r.rank));var u=R.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(e){var c=Mn(u.shape,o);u=u.reshape(c)}return u}}),BI=T({elu_:function(t){var n=C(t,"x","elu");return R.runKernelFunc(function(e,r){var o=e.elu(n);return r([o]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return R.runKernelFunc(function(i){return i.eluDer(e,o)},{dy:e,y:o})}}})}}),C6=T({leakyRelu_:function(t,n){void 0===n&&(n=.2);var e=C(t,"x","leakyRelu");return zm(Y(n).mul(e),e)}}),UI=T({prelu_:function(t,n){var e=C(t,"x","prelu"),r=C(n,"alpha","prelu");return R.runKernelFunc(function(o,i){var a=o.prelu(e,r);return i([e,r]),a},{x:e,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return pa(u,o,o.mul(s))},alpha:function(){var c=pa(u,$e(o),o.mul(a)),l=Ut(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),yt=T({relu_:function(t){var n=C(t,"x","relu");return"bool"===n.dtype?n.toInt():R.runKernelFunc(function(e,r){var o=e.relu(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),VI=T({relu6_:function(t){var n=C(t,"x","relu6");return"bool"===n.dtype?n.toInt():R.runKernelFunc(function(e,r){var o=e.relu6(n);return r([n]),o},{x:n},function(e,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(i.toFloat())}}},"Relu6")}}),D6=T({selu_:function(t){var n=C(t,"x","selu");return R.runKernelFunc(function(e,r){var o=e.selu(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){var i=o.greater(Y(0)),a=Y(Vm),s=Y(jm),u=e.mul(s),c=e.mul(a).mul(o.toFloat().exp());return pa(i,u,c)}}})}}),Ii=T({transpose_:function(t,n){var e=C(t,"x","transpose");return null==n&&(n=e.shape.map(function(o,i){return i}).reverse()),D(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+n+"."}),n.forEach(function(o){D(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+n})}),e.rank<=1?e.clone():R.runKernelFunc(function(o){return o.transpose(e,n)},{x:e},function(o){var i=nf(n);return{x:function(){return o.transpose(i)}}},"Transpose",{perm:n})}}),E6=T({localResponseNormalization_:function(t,n,e,r,o){void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=C(t,"x","localResponseNormalization");D(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),D(mt(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=R.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(a,n,e,r,o);return l([a,d]),d},{x4D:a},function(c,l){var d=l[0],f=l[1];return{x4D:function(){return R.runKernelFunc(function(h){return h.LRNGrad(c,d,f,n,e,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),jI=T({norm_:function(t,n,e,r){void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1);var o=function s(u,c,l){if(void 0===l&&(l=null),0===u.rank)return u.abs();if(1!==u.rank&&null===l)return s(u.reshape([-1]),c,l);if(1===u.rank||"number"==typeof l||Array.isArray(l)&&1===l.length){if(1===c)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if("euclidean"===c||2===c)return u.abs().pow(Y(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&2===l.length){if(1===c)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if("fro"===c||"euclidean"===c)return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(t=C(t,"x","norm"),n,e),i=o.shape;if(r){var a=Lt(e,t.shape);i=Mn(o.shape,a)}return o.reshape(i)}}),S6=T({basicLSTMCell_:function(t,n,e,r,o,i){var a=C(t,"forgetBias","basicLSTMCell"),s=C(n,"lstmKernel","basicLSTMCell"),u=C(e,"lstmBias","basicLSTMCell"),c=C(r,"data","basicLSTMCell"),l=C(o,"c","basicLSTMCell"),d=C(i,"h","basicLSTMCell"),f=c.concat(d,1).matMul(s).add(u),p=f.shape[1]/4,g=[f.shape[0],p],v=f.slice([0,0],g),m=f.slice([0,p],g),b=f.slice([0,2*p],g),y=f.slice([0,3*p],g),w=v.sigmoid().mulStrict(m.tanh()).addStrict(l.mulStrict(a.add(b).sigmoid())),x=w.tanh().mulStrict(y.sigmoid());return[w,x]}}),I6=T({multiRNNCell_:function(t,n,e,r){for(var o=C(n,"data","multiRNNCell"),i=bc(e,"c","multiRNNCell"),a=bc(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),M6=T({movingAverage_:function(t,n,e,r,o){void 0===o&&(o=!0);var i=C(t,"v","movingAverage"),a=C(n,"x","movingAverage"),s=C(e,"decay","movingAverage");x2(i,a),D(Ft(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Y(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){D(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=C(r,"step","movingAverage");l=l.div(u.sub(Ef(s,d)))}return i.add(l)}}),R6=T({stridedSlice_:function(t,n,e,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(n.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=C(t,"x","stridedSlice"),l=_m(s),d=c.shape.slice();l.forEach(function(v){n[v]=0,e[v]=1,d.splice(v,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)n[f]=lS(o,n,r,c.shape,f),e[f]=dS(i,e,r,c.shape,f),r[f]=r[f]||1;var h=_m(u);h.forEach(function(v){e[v]=n[v]+1,r[v]=1});var p=df(n,e,r),g=p.filter(function(v,m){return-1===h.indexOf(m)});return r.every(function(v){return 1===v})?lo(c,n,p).reshape(g):R.runKernelFunc(function(v){return v.stridedSlice(c,n,e,r)},{$x:c}).reshape(g)}}),T6=T({topk_:function(t,n,e){void 0===n&&(n=1),void 0===e&&(e=!0);var r=C(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(n>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+n);var i=R.runKernelFunc(function(a){return a.topk(r,n,e)},{$x:r});return{values:i[0],indices:i[1]}}}),A6=T({scatterND_:function(t,n,e){var r=C(t,"indices","scatterND","int32"),o=C(n,"updates","scatterND");return uS(o,r,e),R.runKernelFunc(function(i){return i.scatterND(r,o,e)},{indices:r,updates:o},null,"ScatterNd",{shape:e})}}),Xm=T({fft_:function(t){D("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return R.runKernelFunc(function(o){return o.fft(r)},{input:t}).reshape(t.shape)}}),Rf=T({ifft_:function(t){D("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return R.runKernelFunc(function(o){return o.ifft(r)},{input:t}).reshape(t.shape)}}),Qm=T({rfft_:function(t,n){D("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var e,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=n&&n<r){var i=t.shape.map(function(m){return 0}),a=t.shape.map(function(m){return m});a[t.shape.length-1]=n,e=t.slice(i,a),r=n}else if(null!=n&&n>r){var s=t.shape.map(function(m){return m});s[t.shape.length-1]=n-r,e=t.concat(ft(s),t.shape.length-1),r=n}else e=t;var u=e.zerosLike(),c=an(e,u).as2D(o,r),l=Xm(c),d=Math.floor(r/2)+1,f=pr(l),h=uo(l),p=f.split([d,r-d],f.shape.length-1),g=h.split([d,r-d],h.shape.length-1),v=e.shape.slice();return v[e.shape.length-1]=d,an(p[0],g[0]).reshape(v)}}),HI=T({irfft_:function(t){var n=t.shape[t.shape.length-1],e=t.size/n;if(n<=2){var r=t.as2D(e,n),o=Rf(r);return pr(o)}var i=[e,2*(n-1)],a=pr(t).as2D(e,n),s=uo(t).as2D(e,n),u=a.slice([0,1],[e,n-2]).reverse(1),c=s.slice([0,1],[e,n-2]).reverse(1).mul(Y(-1)),l=a.concat(u,1),d=s.concat(c,1);return r=an(l,d).as2D(i[0],i[1]),o=Rf(r),pr(o)}}),k6=Object.freeze({fft:Xm,ifft:Rf,rfft:Qm,irfft:HI}),P6=T({sparseToDense_:function(t,n,e,r){void 0===r&&(r=0);var o=C(t,"sparseIndices","sparseToDense","int32"),i=C(n,"sparseValues","sparseToDense"),a=C(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");if(0!==u.rank&&(1!==u.rank||u.size!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,e,a),R.runKernelFunc(function(s){return s.sparseToDense(o,i,e,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),O6=T({gatherND_:function(t,n){var e=C(n,"indices","gatherND","int32"),r=C(t,"x","gatherND");return R.runKernelFunc(function(o){return o.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),N6=T({diag_:function(t){var n=C(t,"x","diag").flatten(),e=t.shape.concat(t.shape);return R.runKernelFunc(function(r){return r.diag(n)},{$x:n}).reshape(e)}}),F6=T({dropout_:function(t,n,e,r){var o=C(t,"x","dropout");if(D("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),D(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),0===n)return t instanceof rt?o.clone():o;var i=function(u,c){if(null==c)return u.shape.slice();if(Ft(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)l.push(null==c[d]&&null!=u.shape[d]?u.shape[d]:c[d]);return l}return c}(o,e),a=1-n,s=nS(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function WI(t,n,e){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=n-e*Math.cos(a)}return Bt(o,"float32")}var bn,Ym=T({hannWindow_:function(t){return WI(t,.5,.5)}}),zI=T({hammingWindow_:function(t){return WI(t,.54,.46)}}),Jm=T({frame_:function(t,n,e,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+n<=t.size;)a.push(lo(t,i,n)),i+=e;if(r)for(;i<t.size;){var s=i+n-t.size,u=zt([lo(t,i,n-s),co([s],o)]);a.push(u),i+=e}return 0===a.length?Ei([],[0,n]):zt(a).as2D(a.length,n)}}),$I=T({stft_:function(t,n,e,r,o){void 0===o&&(o=Ym),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))));for(var a=Jm(t,n,e),s=yn(a,o(n)),u=[],c=0;c<a.shape[0];c++)u.push(Qm(s.slice([c,0],[1,n]),r));return zt(u)}}),L6=Object.freeze({hannWindow:Ym,hammingWindow:zI,frame:Jm,stft:$I});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(bn||(bn={}));var U6=T({absoluteDifference_:function(t,n,e,r){void 0===r&&(r=bn.SUM_BY_NONZERO_WEIGHTS);var o=C(t,"labels","absoluteDifference"),i=C(n,"predictions","absoluteDifference"),a=null;null!=e&&(a=C(e,"weights","absoluteDifference")),ze(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Xo(s,a,r)}}),Xo=T({computeWeightedLoss_:function(t,n,e){void 0===e&&(e=bn.SUM_BY_NONZERO_WEIGHTS);var r=C(t,"losses","computeWeightedLoss"),o=null;null!=n&&(o=C(n,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(e===bn.NONE)return i;if(e===bn.SUM)return i.sum();if(e===bn.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(Y(a)):s}if(e===bn.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(Y(r.size));var u=o.mul(Ds(r.shape)).notEqual(Y(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+e)}}),V6=T({cosineDistance_:function(t,n,e,r,o){void 0===o&&(o=bn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"labels","cosineDistance"),a=C(n,"predictions","cosineDistance"),s=null;null!=r&&(s=C(r,"weights","cosineDistance")),ze(i.shape,a.shape,"Error in cosineDistance: ");var u=Y(1).sub(i.mul(a).sum(e,!0));return Xo(u,s,o)}}),j6=T({hingeLoss_:function(t,n,e,r){void 0===r&&(r=bn.SUM_BY_NONZERO_WEIGHTS);var o=C(t,"labels","hingeLoss"),i=C(n,"predictions","hingeLoss"),a=null;null!=e&&(a=C(e,"weights","hingeLoss")),ze(o.shape,i.shape,"Error in hingeLoss: ");var s=Y(1);o=Y(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Xo(u,a,r)}}),H6=T({huberLoss_:function(t,n,e,r,o){void 0===r&&(r=1),void 0===o&&(o=bn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"labels","huberLoss"),a=C(n,"predictions","huberLoss"),s=null;null!=e&&(s=C(e,"weights","huberLoss")),ze(i.shape,a.shape,"Error in huberLoss: ");var u=Y(r),c=a.sub(i).abs(),l=_I(c,u),d=c.sub(l),f=Y(.5).mul(l.square()).add(u.mul(d));return Xo(f,s,o)}}),W6=T({logLoss_:function(t,n,e,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=bn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"labels","logLoss"),a=C(n,"predictions","logLoss"),s=null;null!=e&&(s=C(e,"weights","logLoss")),ze(i.shape,a.shape,"Error in logLoss: ");var u=Y(1),c=Y(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return Xo(l,s,o)}}),z6=T({meanSquaredError_:function(t,n,e,r){void 0===r&&(r=bn.SUM_BY_NONZERO_WEIGHTS);var o=C(t,"labels","meanSquaredError"),i=C(n,"predictions","meanSquaredError"),a=null;null!=e&&(a=C(e,"weights","meanSquaredError")),ze(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Xo(s,a,r)}}),$6=T({sigmoidCrossEntropy_:function(t,n,e,r,o){void 0===r&&(r=0),void 0===o&&(o=bn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"multiClassLabels","sigmoidCrossEntropy"),a=C(n,"logits","sigmoidCrossEntropy"),s=null;if(null!=e&&(s=C(e,"weights","sigmoidCrossEntropy")),ze(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Y(r),c=Y(1),l=Y(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var d=function(f,h){var p=C(f,"labels","sigmoidCrossEntropyWithLogits"),g=C(h,"logits","sigmoidCrossEntropyWithLogits");ze(p.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=g.relu(),m=g.mul(p),b=g.abs().neg().exp().log1p();return v.sub(m).add(b)}(i,a);return Xo(d,s,o)}}),G6=T({softmaxCrossEntropy_:function(t,n,e,r,o){void 0===r&&(r=0),void 0===o&&(o=bn.SUM_BY_NONZERO_WEIGHTS);var i=C(t,"onehotLabels","softmaxCrossEntropy"),a=C(n,"logits","softmaxCrossEntropy"),s=null;if(null!=e&&(s=C(e,"weights","softmaxCrossEntropy")),ze(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Y(r),c=Y(1),l=Y(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var d=function(f,h,p){if(void 0===p&&(p=-1),-1===p&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return ff(function(g,v,m){var b=v.logSumExp([p],!0),y=v.toFloat().sub(b);return m([g,y]),{value:y.mul(g).neg().sum([p]),gradFunc:function(w,x){var _=x[0],M=x[1],I=Mn(w.shape,[p]);return[w.reshape(I).mul(_.toFloat().sub(M.exp())),w.reshape(I).mul(M.exp().sub(_.toFloat()))]}}})(f,h)}(i,a);return Xo(d,s,o)}}),q6=Object.freeze({get Reduction(){return bn},absoluteDifference:U6,computeWeightedLoss:Xo,cosineDistance:V6,hingeLoss:j6,huberLoss:H6,logLoss:W6,meanSquaredError:z6,sigmoidCrossEntropy:$6,softmaxCrossEntropy:G6});function GI(t,n){return void 0===n&&(n=!1),R.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var e=t.shape[0],r=t.shape[1],o=tS(e),i=t.clone(),a=Ei([[1]],[1,1]),s=a.clone(),u=e>=r?r:e,c=function(d){var f,h=i,p=s,g=o;f=R.tidy(function(){var v=i.slice([d,d],[e-d,1]),m=v.norm(),b=i.slice([d,d],[1,1]),y=Ei([[-1]]).where(b.greater(0),Ei([[1]])),w=b.sub(y.mul(m)),x=v.div(w);s=1===x.shape[0]?a.clone():a.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var _=y.matMul(w).div(m).neg(),M=i.slice([d,0],[e-d,r]),I=_.mul(s);if(0===d)i=M.sub(I.matMul(s.transpose().matMul(M)));else{var E=M.sub(I.matMul(s.transpose().matMul(M)));i=i.slice([0,0],[d,r]).concat(E,0)}var S=o.slice([0,d],[e,o.shape[1]-d]);if(0===d)o=S.sub(S.matMul(s).matMul(I.transpose()));else{var k=S.sub(S.matMul(s).matMul(I.transpose()));o=o.slice([0,0],[e,d]).concat(k,1)}return[s,i,o]}),s=f[0],i=f[1],o=f[2],Ln([h,p,g])},l=0;l<u;++l)c(l);return!n&&e>r&&(o=o.slice([0,0],[e,r]),i=i.slice([0,0],[r,r])),[o,i]})}var K6=T({bandPart_:function(t,n,e){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=C(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(n<=a))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+a+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");n<0&&(n=a),e<0&&(e=s);var u=rf(0,a,1,"int32").reshape([-1,1]),c=rf(0,s,1,"int32"),l=Gt(u,c),d=Df(l.lessEqual(Y(+n,"int32")),l.greaterEqual(Y(-e,"int32"))),f=ft([a,s],r.dtype);return er($t(r.reshape([-1,a,s])).map(function(h){return pa(d,h,f)})).reshape(o)}}),X6=T({gramSchmidt_:function(t){var n;if(Array.isArray(t)){n=!1,D(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=t[0].shape[0],r=function(u){D(t[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+e+")"})},o=1;o<t.length;++o)r(o)}else n=!0,t=mm(t,t.shape[0],0).map(function(u){return oS(u,[0])});D(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(u){i.push(R.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var d=LI(i[l].mulStrict(c)).mul(i[l]);c=c.sub(d)}return c.div(jI(c,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return n?er(i,0):i}}),Q6=T({qr_:function(t,n){if(void 0===n&&(n=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return GI(t,n);var e=t.shape.slice(0,t.shape.length-2).reduce(function(a,s){return a*s}),r=$t(t.reshape([e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=GI(a,n),c=s[1];o.push(s[0]),i.push(c)}),[er(o,0).reshape(t.shape),er(i,0).reshape(t.shape)]}}),Y6=Object.freeze({bandPart:K6,gramSchmidt:X6,qr:Q6});function Tf(t,n,e,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=t.shape[0];return e=Math.min(e,a),D(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),D(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),D(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),D(1===n.rank,function(){return"scores must be a 1D tensor"}),D(n.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+n.shape[0]}),D(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var J6=T({resizeBilinear_:function(t,n,e){void 0===e&&(e=!1);var r=C(t,"images","resizeBilinear");D(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),D(2===n.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([o]),c.resizeBilinear(o,a,s,e)},{x:o},function(c,l){return{x:function(){return R.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Z6=T({resizeNearestNeighbor_:function(t,n,e){void 0===e&&(e=!1);var r=C(t,"images","resizeNearestNeighbor");D(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),D(2===n.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),D("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,e)},{batchImages:o},function(c,l){return{batchImages:function(){return R.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],e)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),e8=T({nonMaxSuppression_:function(t,n,e,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=C(t,"boxes","nonMaxSuppression"),a=C(n,"scores","nonMaxSuppression"),s=Tf(i,a,e,r,o);return R.runKernelFunc(function(c){return c.nonMaxSuppression(i,a,e,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:e=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:o=s.scoreThreshold})}}),n8=T({nonMaxSuppressionWithScore_:function(t,n,e,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=C(t,"boxes","nonMaxSuppression"),s=C(n,"scores","nonMaxSuppression"),u=Tf(a,s,e,r,o,i),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=R.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),o8=T({cropAndResize_:function(t,n,e,r,o,i){var a=C(t,"image","cropAndResize"),s=C(n,"boxes","cropAndResize","float32"),u=C(e,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return D(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),D(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),D(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),D(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),D(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),D("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),R.runKernelFunc(function(l,d){return l.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Zm=Object.freeze({resizeBilinear:J6,resizeNearestNeighbor:Z6,nonMaxSuppression:e8,nonMaxSuppressionAsync:function(t,n,e,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),oe(this,void 0,void 0,function(){var i,a,s,u,d;return ie(this,function(f){switch(f.label){case 0:return i=C(t,"boxes","nonMaxSuppressionAsync"),a=C(n,"scores","nonMaxSuppressionAsync"),s=Tf(i,a,e,r,o),e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=f.sent(),d=Tm(u[0],u[1],e,r,o),i!==t&&i.dispose(),a!==n&&a.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:n8,nonMaxSuppressionWithScoreAsync:function(t,n,e,r,o,i){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),oe(this,void 0,void 0,function(){var a,s,u,c,f;return ie(this,function(h){switch(h.label){case 0:return a=C(t,"boxes","nonMaxSuppressionAsync"),s=C(n,"scores","nonMaxSuppressionAsync"),u=Tf(a,s,e,r,o,i),e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),f=Am(c[0],c[1],e,r,o,i),a!==t&&a.dispose(),s!==n&&s.dispose(),[2,f]}})})},cropAndResize:o8}),ey=function(t,n){return!(t>0)||"linear"===n},ty=function(t,n,e){if(null==e||"linear"===e)return t;if("relu"===e)return t.mul(n.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},ny=function(t,n){var e=n,r=Ut(t.shape,n.shape);return r.length>0&&(e=e.sum(r)),e.reshape(t.shape)},ry=function(t,n,e){if("linear"===n)return t;if("relu"===n)return yt(t);if("elu"===n)return BI(t);if("relu6"===n)return VI(t);if("prelu"===n)return UI(t,e);throw new Error("Unknown fused activation "+n+".")},i8=T({fusedMatMul_:function(t){var n,e=t.a,r=t.b,o=t.transposeA,i=void 0!==o&&o,a=t.transposeB,s=void 0!==a&&a,u=t.bias,c=t.activation,l=void 0===c?"linear":c,d=t.preluActivationWeights;if(!1===ey(R.state.gradientDepth,l)){var f=If(e,r,i,s);return null!=u&&(f=Be(f,u)),ry(f,l,d)}var h=C(e,"a","fused matMul"),p=C(r,"b","fused matMul");n=pt(h,p),h=n[0],p=n[1];var g=i?h.shape[h.rank-2]:h.shape[h.rank-1],v=s?p.shape[p.rank-1]:p.shape[p.rank-2],m=i?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=h.shape.slice(0,-2),w=p.shape.slice(0,-2),x=ae(y),_=ae(w);D(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),D(Ft(y,w),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+w+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),D(g===v,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+v+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var M,I,E=h.shape.slice(0,-2).concat([m,b]),S=i?h.as3D(x,g,m):h.as3D(x,m,g),k=s?p.as3D(_,b,v):p.as3D(_,v,b);null!=u&&Le(E,(M=pt(M=C(u,"bias","fused matMul"),h)[0]).shape),null!=d&&(I=C(d,"prelu weights","fused matMul"));var A={a:S,b:k};return null!=u&&(A.bias=M),null!=d&&(A.preluActivationWeights=I),R.runKernelFunc(function(B,N){var W=B.fusedBatchMatMul({a:S,b:k,transposeA:i,transposeB:s,bias:M,activation:l,preluActivationWeights:I});return N([S,k,W]),W},A,function(B,N){var W=N[0],H=N[1],q=ty(B,N[2],l),K={};return null!=u&&(K={bias:function(){return ny(M,q)}}),Object.assign(i||s?!i&&s?{a:function(){return q.matMul(H,!1,!1)},b:function(){return q.matMul(W,!0,!1)}}:i&&!s?{a:function(){return H.matMul(q,!1,!0)},b:function(){return W.matMul(q,!1,!1)}}:{a:function(){return H.matMul(q,!0,!0)},b:function(){return q.matMul(W,!0,!0)}}:{a:function(){return q.matMul(H,!1,!0)},b:function(){return W.matMul(q,!0,!1)}},K)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},[S,k],[!0]).reshape(E)}}),a8=T({fusedConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===ey(R.state.gradientDepth,f=f||"linear")){var p=vr(n,e,r,o,a,u,c);return null!=l&&(p=Be(p,l)),ry(p,f,h)}var g=C(n,"x","conv2d"),v=C(e,"filter","conv2d"),m=g,b=!1;3===g.rank&&(b=!0,m=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),D(4===m.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),D(4===v.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),null!=c&&D(mt(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),D(m.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),D(Rn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),D("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var y,w,x=Si(m.shape,v.shape,r,u,o,c);null!=l&&(y=pt(y=C(l,"bias","fused conv2d"),g)[0],Le(x.outShape,y.shape)),null!=h&&(w=C(h,"prelu weights","fused conv2d"));var _={x:m,filter:v};null!=l&&(_.bias=y),null!=h&&(_.preluActivationWeights=w);var I=R.runKernelFunc(function(E,S){var k=E.fusedConv2d({input:m,filter:v,convInfo:x,bias:y,activation:f,preluActivationWeights:w});return S([v,m,k]),k},_,function(E,S){var A=S[0],U=S[1],N=ty(E,S[2],f);D(da(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var W={};return null!=l&&(W={bias:function(){return ny(y,N)}}),Object.assign({x:function(){return TI(U.shape,N,A,r,o)},filter:function(){return qm(U,N,A.shape,r,o)}},W)},"FusedConv2D",{convInfo:x,activation:f},[v,m],[!0]);return b?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),s8=T({fusedDepthwiseConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===ey(R.state.gradientDepth,f)){var p=Sf(n,e,r,o,a,u,c);return null!=l&&(p=Be(p,l)),ry(p,f,h)}var g=C(n,"x","depthwiseConv2d"),v=C(e,"filter","depthwiseConv2d"),m=g,b=!1;3===g.rank&&(b=!0,m=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),D(4===m.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),D(4===v.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),D(m.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),null==u&&(u=[1,1]),D(Rn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&D(mt(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var y,w,x=Si(m.shape,v.shape,r,u,o,c,!0);null!=l&&(y=pt(y=C(l,"bias","fused conv2d"),g)[0],Le(x.outShape,y.shape)),null!=h&&(w=C(h,"prelu weights","fused depthwiseConv2d"));var _={x:m,filter:v};null!=l&&(_.bias=y),null!=h&&(_.preluActivationWeights=w);var I=R.runKernelFunc(function(E,S){var k=E.fusedDepthwiseConv2D({input:m,filter:v,convInfo:x,bias:y,activation:f,preluActivationWeights:w});return S([v,m,k]),k},_,function(E,S){D(da(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var k=S[0],A=S[1],B=ty(E,S[2],f),N={};return null!=l&&(N={bias:function(){return ny(y,B)}}),Object.assign({x:function(){return AI(A.shape,B,k,x)},filter:function(){return kI(A,B,k.shape,x)}},N)},"FusedDepthwiseConv2D",{convInfo:x,activation:f},[v,m],[!0]);return b?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),u8=Object.freeze({matMul:i8,conv2d:a8,depthwiseConv2d:s8}),c8=Object.freeze({image:Zm,linalg:Y6,losses:q6,spectral:k6,fused:u8,signal:L6,square:WW,squaredDifference:fI,conv1d:Jz,conv2d:vr,conv3d:Zz,depthwiseConv2d:Sf,separableConv2d:Km,conv2dTranspose:e6,conv3dTranspose:t6,op:T,batchNormalization2d:bz,batchNormalization3d:wz,batchNormalization4d:xz,batchNormalization:_z,batchNorm:yI,batchNorm2d:Cz,batchNorm3d:Dz,batchNorm4d:Ez,booleanMaskAsync:function(t,n,e){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,g;return ie(this,function(v){switch(v.label){case 0:for(r=C(t,"tensor","boolMask"),o=C(n,"mask","boolMask","bool"),i=e??0,s=r.shape,D((a=o.rank)>0,function(){return"mask cannot be scalar"}),ze(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),d=r.reshape(l),f=o.reshape([-1]),[4,wI(f)];case 1:return h=v.sent(),p=h.squeeze([1]),g=$m(d,p,i),t!==r&&r.dispose(),n!==o&&o.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,g]}})})},complex:an,real:pr,imag:uo,concat:zt,concat1d:T5,concat2d:A5,concat3d:k5,concat4d:P5,split:mm,matMul:If,dot:n6,outerProduct:r6,reverse:Mc,reverse1d:o6,reverse2d:i6,reverse3d:a6,reverse4d:s6,maxPool:Yt,avgPool:Rc,pool:u6,maxPool3d:c6,avgPool3d:l6,slice:lo,slice1d:d6,slice2d:f6,slice3d:NI,slice4d:h6,abs:zW,acos:$W,acosh:GW,asin:qW,asinh:KW,atan:XW,atanh:QW,ceil:YW,clipByValue:Hm,cos:JW,cosh:ZW,erf:ez,exp:Wm,expm1:tz,floor:nz,log:rz,log1p:oz,logSigmoid:iz,neg:xf,reciprocal:az,round:sz,rsqrt:hI,sigmoid:pI,sign:uz,isNaN:cz,isInf:lz,isFinite:dz,sin:fz,sinh:hz,softplus:pz,sqrt:gz,step:vz,tan:mz,tanh:yz,all:p6,any:g6,argMax:v6,argMin:m6,logSumExp:y6,max:Mf,mean:b6,min:w6,moments:x6,sum:LI,prod:_6,equal:CI,equalStrict:jz,greater:Hz,greaterEqual:DI,greaterEqualStrict:Wz,greaterStrict:zz,less:$z,lessEqual:Gz,lessEqualStrict:qz,lessStrict:Kz,notEqual:Xz,notEqualStrict:Qz,add:Be,addN:Mz,addStrict:Rz,atan2:Tz,div:Fr,divNoNan:Az,divStrict:kz,floorDiv:xI,maximum:zm,maximumStrict:Pz,minimum:_I,minimumStrict:Oz,mod:Nz,modStrict:Fz,mul:yn,mulStrict:Lz,pow:Ef,powStrict:Bz,squaredDifferenceStrict:Uz,sub:Gt,subStrict:Vz,elu:BI,leakyRelu:C6,prelu:UI,relu:yt,relu6:VI,selu:D6,logicalAnd:Df,logicalNot:Sz,logicalOr:bI,logicalXor:Iz,where:pa,whereAsync:wI,buffer:Se,print:function H5(t,n){void 0===n&&(n=!1),console.log(t.toString(n))},batchToSpaceND:eS,broadcastTo:W5,cast:z5,clone:$5,cumsum:G5,depthToSpace:q5,expandDims:gr,eye:tS,multinomial:K5,oneHot:bm,pad:la,pad1d:X5,pad2d:Q5,pad3d:Y5,pad4d:J5,rand:Z5,randomNormal:eH,randomGamma:tH,randomUniform:nS,reshape:Or,spaceToBatchND:rS,squeeze:oS,stack:er,tile:Es,truncatedNormal:nH,unstack:$t,setdiff1dAsync:function(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d;return ie(this,function(f){switch(f.label){case 0:return e=C(t,"x","setdiff1d"),r=C(n,"y","setdiff1d"),D(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),D(1===e.rank,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),D(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(i=f.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new lc([s],e.dtype),c=new lc([s],"int32"),l=0,d=0;l<o.length;l++)a.has(o[l])||(u.values[d]=o[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:co,linspace:function R5(t,n,e){if(e<=0)throw new Error("The number of values should be positive.");return R.runKernelFunc(function(r){return r.linspace(t,n,e)},{})},ones:Ds,range:rf,scalar:Y,tensor:sn,tensor1d:Bt,tensor2d:Ei,tensor3d:vm,tensor4d:Un,tensor5d:function S5(t,n,e){if(oa(t),null!=n&&5!==n.length)throw new Error("tensor5d() requires shape to have five numbers");var r=so(t,e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Di(t,n,r,e)},tensor6d:function I5(t,n,e){if(oa(t),null!=n&&6!==n.length)throw new Error("tensor6d() requires shape to have six numbers");var r=so(t,e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Di(t,n=n||r,r,e)},variable:function M5(t,n,e,r){return void 0===n&&(n=!0),R.makeVariable(t,n,e,r)},zeros:ft,onesLike:Z2,zerosLike:$e,transpose:Ii,softmax:Go,logSoftmax:iH,localResponseNormalization:E6,norm:jI,gather:$m,unsortedSegmentSum:II,basicLSTMCell:S6,multiRNNCell:I6,movingAverage:M6,stridedSlice:R6,topk:T6,scatterND:A6,fft:Xm,ifft:Rf,rfft:Qm,irfft:HI,sparseToDense:P6,gatherND:O6,diag:N6,dropout:F6,hannWindow:Ym,hammingWindow:zI,frame:Jm,stft:$I,inTopKAsync:function(t,n,e){return void 0===e&&(e=1),oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,g,v;return ie(this,function(m){switch(m.label){case 0:return r=C(t,"predictions","inTopK"),o=C(n,"targets","inTopK"),D(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),D(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),ze(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],D(e>0&&e<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e}),[4,r.data()];case 1:return a=m.sent(),[4,o.data()];case 2:for(s=m.sent(),l=(u=[a.length/i,i])[1],d=ws("bool",c=u[0]),f=0;f<c;f++){for(p=a.subarray(h=f*l,h+l),g=[],v=0;v<p.length;v++)g.push({value:p[v],index:v});for(g.sort(function(b,y){return y.value-b.value}),d[f]=0,v=0;v<e;v++)if(g[v].index===s[f]){d[f]=1;break}}return t!==r&&r.dispose(),n!==o&&o.dispose(),[2,sn(d,o.shape,"bool")]}})})}});function z(t,n){Array.isArray(t)||(t=[t]),t.forEach(function(e){null!=e&&D("complex64"!==e.dtype,function(){return n+" does not support complex64 tensors."})})}function oy(t,n,e,r){if("linear"===e)return t.linear(n);if("relu"===e)return t.relu(n);if("elu"===e)return t.elu(n);if("relu6"===e)return t.relu6(n);if("prelu"===e)return t.prelu(n,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var l8=function(t){function n(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new fS(e,R),e}return Rr(n,t),n.prototype.write=function(e,r,o){this.firstUse&&(this.firstUse=!1,F().get("IS_NODE")&&tf("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var i={};return this.data.set(i,{values:e,dtype:o}),i},n.prototype.move=function(e,r,o,i){this.data.set(e,{values:r,dtype:i})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var r=this.data.get(e),i=r.complexTensors;return"complex64"===r.dtype?Rm(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),o=r;if("string"===e.dtype)try{o=r.map(function(i){return ac(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Se(e.shape,e.dtype,o)},n.prototype.makeOutput=function(e,r,o){var i=this.write(e,r,o);return R.makeTensorFromDataId(i,r,o,this)},n.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){return r=Ar(),e(),[2,{kernelMs:Ar()-r}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,r){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(r.clone())},o},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(z(e,"slice"),Cm(e.shape,r,o)){var i=Dm(r,e.strides),a=ae(o);return sn(this.readSync(e.dataId).subarray(i,i+a),o,e.dtype)}for(var s=Se(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(d,f){return d+r[f]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},n.prototype.stridedSlice=function(e,r,o,i){z(e,"stridedSlice");var a=df(r,o,i);if(a.some(function(h){return 0===h}))return sn([],a);for(var s=Se(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),d=new Array(l.length),f=0;f<d.length;f++)d[f]=l[f]*i[f]+r[f];s.set.apply(s,[u.get.apply(u,d)].concat(l))}return s.toTensor()},n.prototype.diag=function(e){for(var r=this.readSync(e.dataId),o=Se([e.size,e.size],e.dtype),i=o.values,a=0;a<r.length;a++)i[a*e.size+a]=r[a];return o.toTensor()},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.reverse=function(e,r){z(e,"reverse");for(var o=Se(e.shape,e.dtype),i=this.bufferSync(e),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach(function(d){return l[d]=e.shape[d]-1-l[d]}),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},n.prototype.concat=function(e,r){var o=this;if("complex64"===e[0].dtype){var i=e.map(function(h){return pr(h)}),a=e.map(function(h){return uo(h)});return an(this.concat(i,r),this.concat(a,r))}var s=e.map(function(h){var p=ae(h.shape.slice(r));return h.as2D(-1,p)}),u=sa(s.map(function(h){return h.shape}),1),c=Se(u,e[0].dtype).values;if(1===s[0].shape[0]){var l=0;s.forEach(function(h){c.set(o.readSync(h.dataId),l),l+=h.size})}else{var d=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),g=0,v=0;v<h.shape[0];++v)for(var m=v*u[1]+d,b=0;b<h.shape[1];++b)c[m+b]=p[g++];d+=h.shape[1]})}var f=sa(e.map(function(h){return h.shape}),r);return sn(c,f,e[0].dtype)},n.prototype.neg=function(e){return z(e,"neg"),this.multiply(Y(-1),e)},n.prototype.add=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(e,r,Qt(e.dtype,r.dtype),function(o,i){return o+i})},n.prototype.addN=function(e){var r=this;z(e,"addN");for(var o=e.map(function(l){return r.readSync(l.dataId)}),i=Se(e[0].shape,e[0].dtype),a=i.values,s=0;s<e.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},n.prototype.softmax=function(e,r){var o=Lt([r],e.shape),i=this.max(e,o),a=Mn(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.subtract=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(e,r,Qt(e.dtype,r.dtype),function(o,i){return o-i})},n.prototype.pow=function(e,r){return z([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.pow(o,i)})},n.prototype.batchMatMul=function(e,r,o,i){z([e,r],"matMul");for(var a=o?e.shape[1]:e.shape[2],s=o?e.shape[2]:e.shape[1],u=i?r.shape[1]:r.shape[2],c=e.shape[0],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=f[0],p=f[1],g=f[2],v=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],m=v[0],b=v[1],y=v[2],w=s*u,x=Se([c,s,u],e.dtype),_=x.values,M=this.blockSize,I=0;I<c;I++)for(var E=0;E<s;E+=M)for(var S=0;S<u;S+=M)for(var k=0;k<a;k+=M)for(var A=Math.min(E+M,s),U=Math.min(S+M,u),B=Math.min(k+M,a),N=E;N<A;N++)for(var W=S;W<U;W++){for(var H=0,j=k;j<B;j++)H+=l[I*h+N*p+j*g]*d[j*m+W*b+I*y];_[I*w+(N*u+W)]+=H}return x.toTensor()},n.prototype.fusedBatchMatMul=function(e){var s=e.bias,u=e.activation,c=e.preluActivationWeights,l=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return s&&(l=this.add(l,s)),u&&(l=oy(this,l,u,c)),l},n.prototype.multiply=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(e,r,Qt(e.dtype,r.dtype),function(o,i){return o*i})},n.prototype.realDivide=function(e,r){return z([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(o,i){return o/i})},n.prototype.floorDiv=function(e,r){return z([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(o,i){return Math.floor(o/i)})},n.prototype.sum=function(e,r){z(e,"sum"),Bn("sum",r,e.rank);for(var o=on(e.shape,r),a=o[1],s=ft(o[0],Qt(e.dtype,"int32")),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=l[f+p];c[d]=h}return s},n.prototype.prod=function(e,r){z(e,"sum");for(var o=on(e.shape,r),a=o[1],s=ft(o[0],Qt(e.dtype,"int32")),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=l[f+p];c[d]=h}return s},n.prototype.unsortedSegmentSum=function(e,r,o){z(e,"unsortedSegmentSum");for(var i=[],a=e.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=Y(s,"int32"),c=CI(u,r).asType("float32").mul(e).sum(0);i.push(c)}return er(i)},n.prototype.argMin=function(e,r){z(e,"argMin");var o=[r];Bn("argMin",o,e.rank);for(var i=on(e.shape,o),s=i[1],u=ft(i[0],"int32"),c=ae(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,v=0;v<c;++v){var m=d[h+v];m<p&&(p=m,g=v)}l[f]=g}return u},n.prototype.argMax=function(e,r){z(e,"argMax");var o=[r];Bn("argMax",o,e.rank);for(var i=on(e.shape,o),s=i[1],u=ft(i[0],"int32"),c=ae(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,v=0;v<c;++v){var m=d[h+v];m>p&&(p=m,g=v)}l[f]=g}return u},n.prototype.cumsum=function(e,r,o,i){if(z(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var a=Qt(e.dtype,"int32"),s=ft(e.shape,a),u=this.readSync(s.dataId),c=this.readSync(e.dataId),l=e.shape[e.rank-1],d=i?function(v,m){return v+l-m-1}:function(v,m){return v+m},f=0;f<c.length;f+=l)for(var h=0;h<l;h++){var p=d(f,h);if(0===h)u[p]=o?0:c[p];else{var g=d(f,h-1);u[p]=o?c[g]+u[g]:c[p]+u[g]}}return s},n.prototype.equal=function(e,r){return z([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o===i?1:0})},n.prototype.notEqual=function(e,r){return z([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o!==i?1:0})},n.prototype.less=function(e,r){return z([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<i?1:0})},n.prototype.lessEqual=function(e,r){return z([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<=i?1:0})},n.prototype.greater=function(e,r){return z([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>i?1:0})},n.prototype.greaterEqual=function(e,r){return z([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>=i?1:0})},n.prototype.logicalNot=function(e){z(e,"logicalNot");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,e.shape,"bool")},n.prototype.logicalAnd=function(e,r){return z([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o&&i})},n.prototype.logicalOr=function(e,r){return z([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o||i})},n.prototype.select=function(e,r,o){z([e,r,o],"select");for(var i=this.readSync(e.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=ft(r.shape,Qt(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,d=0===e.rank||e.rank>1||1===r.rank?1:ae(r.shape.slice(1)),f=0;f<i.length;f++)for(var h=0;h<d;h++)c[l++]=1===i[f]?a[f]:s[f];return u},n.prototype.where=function(e){z([e],"where");var r=this.readSync(e.dataId);return km(e.shape,r)},n.prototype.topk=function(e,r,o){return z(e,"topk"),bS(this.readSync(e.dataId),e.shape,e.dtype,r)},n.prototype.min=function(e,r){z(e,"min"),Bn("min",r,e.rank);for(var o=on(e.shape,r),a=o[1],s=ft(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g<h&&(h=g)}c[d]=h}return s},n.prototype.minimum=function(e,r){return z([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.min(o,i)})},n.prototype.mod=function(e,r){return z([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},n.prototype.max=function(e,r){z(e,"max"),Bn("max",r,e.rank);for(var o=on(e.shape,r),a=o[1],s=ft(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g>h&&(h=g)}c[d]=h}return s},n.prototype.maximum=function(e,r){return z([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.max(o,i)})},n.prototype.all=function(e,r){z(e,"all"),Bn("all",r,e.rank);for(var o=on(e.shape,r),a=o[1],s=ft(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h&&l[f+p];c[d]=h}return s},n.prototype.any=function(e,r){z(e,"any"),Bn("any",r,e.rank);for(var o=on(e.shape,r),a=o[1],s=ft(o[0],e.dtype),u=ae(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h||l[f+p];c[d]=h}return s},n.prototype.squaredDifference=function(e,r){return z([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o-i;return a*a})},n.prototype.ceil=function(e){z(e,"ceil");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.floor=function(e){z(e,"floor");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sign=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=r[i]<0?-1:r[i]>0?1:0;return this.makeOutput(o,e.shape,"float32")},n.prototype.isNaN=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isInf=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isFinite=function(e){z(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.round=function(e){z(e,"round");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);o[i]=r[i]-a<.5?Math.floor(r[i]):r[i]-a>.5?Math.ceil(r[i]):a%2==0?a:a+1}return this.makeOutput(o,e.shape,"float32")},n.prototype.exp=function(e){z(e,"exp");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.expm1=function(e){z(e,"expm1");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log=function(e){z(e,"log");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log1p=function(e){z(e,"log1p");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log1p(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sqrt=function(e){z(e,"sqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.rsqrt=function(e){z(e,"rsqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.reciprocal=function(e){z(e,"reciprocal");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,e.shape,"float32")},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){z(e,"relu");for(var r=ft(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},n.prototype.relu6=function(e){z(e,"relu");for(var r=ft(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},n.prototype.prelu=function(e,r){return z([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return o<0?i*o:o})},n.prototype.elu=function(e){z(e,"elu");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,e.shape,"float32")},n.prototype.eluDer=function(e,r){z([e,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},n.prototype.selu=function(e){z(e,"selu");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(i,e.shape,"float32")},n.prototype.clip=function(e,r,o){z(e,"clip");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,e.shape,"float32")},n.prototype.abs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<e.size;++i)r[i]=Math.hypot(o[2*i],o[2*i+1]);return this.makeOutput(r,e.shape,"float32")},n.prototype.int=function(e){z(e,"int");for(var r=new Int32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,e.shape,"int32")},n.prototype.sigmoid=function(e){z(e,"sigmoid");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,e.shape,"float32")},n.prototype.softplus=function(e){z(e,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var l,s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]);l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,e.shape,"float32")},n.prototype.sin=function(e){z(e,"sin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cos=function(e){z(e,"cos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tan=function(e){z(e,"tan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asin=function(e){z(e,"asin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acos=function(e){z(e,"acos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan=function(e){z(e,"atan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan2=function(e,r){return z([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.atan2(o,i)})},n.prototype.sinh=function(e){z(e,"sinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cosh=function(e){z(e,"cosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tanh=function(e){z(e,"tanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=s2(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asinh=function(e){z(e,"asinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acosh=function(e){z(e,"acosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atanh=function(e){z(e,"atanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.erf=function(e){z(e,"erf");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,e.shape,"float32")},n.prototype.step=function(e,r){void 0===r&&(r=0),z(e,"step");for(var o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a];o[a]=isNaN(s)?NaN:s>0?1:r}return this.makeOutput(o,e.shape,"float32")},n.prototype.fusedConv2d=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=oy(this,c,s,u)),c},n.prototype.conv2d=function(e,r,o){z([e,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d="channelsLast"===o.dataFormat,f=Se(o.outShape,e.dtype),h=e.strides[0],p=d?e.strides[1]:e.strides[2],g=d?e.strides[2]:1,v=d?1:e.strides[1],m=f.strides[0],b=d?f.strides[1]:f.strides[2],y=d?f.strides[2]:1,w=d?1:f.strides[1],x=this.readSync(e.dataId),_=this.readSync(r.dataId),M=f.values,I=0;I<o.batchSize;++I)for(var E=I*h,S=I*m,k=0;k<o.outHeight;++k)for(var A=S+k*b,U=k*o.strideHeight-l,B=0;B<i;B++){var N=U+B*s;if(!(N<0||N>=o.inHeight))for(var W=B*r.strides[0],H=E+N*p,j=0;j<o.outWidth;++j)for(var q=A+j*y,K=j*o.strideWidth-c,Z=0;Z<a;Z++){var le=K+Z*u;if(!(le<0||le>=o.inWidth))for(var pe=H+le*g,Pe=W+Z*r.strides[1],Oe=0;Oe<o.inChannels;++Oe){for(var Ve=x[pe+Oe*v],Ge=0;Ge<o.outChannels;++Ge)M[q+Ge*w]+=Ve*_[Pe+Ge];Pe+=o.outChannels}}}return f.toTensor()},n.prototype.conv3d=function(e,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,h=o.padInfo.top,p=Se(o.outShape,e.dtype),g=this.readSync(e.dataId),v=this.readSync(r.dataId),m=p.values,b=0;b<o.batchSize;++b)for(var y=b*e.strides[0],w=b*p.strides[0],x=0;x<o.outDepth;++x)for(var _=w+x*p.strides[1],M=x*o.strideDepth-d,I=0;I<i;I++){var E=M+I*u;if(!(E<0||E>=o.inDepth))for(var S=I*r.strides[0],k=y+E*e.strides[1],A=0;A<o.outHeight;++A)for(var U=_+A*p.strides[2],B=A*o.strideHeight-h,N=0;N<a;N++){var W=B+N*c;if(!(W<0||W>=o.inHeight))for(var H=S+N*r.strides[1],j=k+W*e.strides[2],q=0;q<o.outWidth;++q)for(var K=U+q*o.outChannels,Z=q*o.strideWidth-f,le=0;le<s;le++){var pe=Z+le*l;if(!(pe<0||pe>=o.inWidth))for(var Oe=j+pe*o.inChannels,Ve=H+le*r.strides[2],Ge=0;Ge<o.inChannels;++Ge){for(var je=g[Oe+Ge],qe=0;qe<o.outChannels;++qe)m[K+qe]+=je*v[Ve+qe];Ve+=o.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(e,r,o){z([e,r],"conv2dDerInput");for(var i=Se(o.inShape,"float32"),a=i.values,s=this.readSync(e.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],d=c[1],f=c[2],h=o.batchSize,p=o.filterHeight,g=o.filterWidth,v=o.inChannels,m=o.inHeight,b=o.inWidth,y=o.outChannels,w=o.outHeight,x=o.outWidth,_=o.strideHeight,M=o.strideWidth,E=p-1-o.padInfo.top,S=g-1-o.padInfo.left,k="channelsLast"===o.dataFormat,A=i.strides[0],U=k?i.strides[1]:i.strides[2],B=k?i.strides[2]:1,N=k?1:i.strides[1],W=e.strides[0],H=k?e.strides[1]:e.strides[2],j=k?e.strides[2]:1,q=k?1:e.strides[1],K=0;K<h;++K)for(var Z=0;Z<v;++Z)for(var le=0;le<m;++le)for(var pe=le-E,Pe=Math.max(0,Math.ceil(pe/_)),Oe=Math.min(w,(p+pe)/_),Ve=0;Ve<b;++Ve){for(var Ge=Ve-S,je=Math.max(0,Math.ceil(Ge/M)),qe=Math.min(x,(g+Ge)/M),Tt=0,He=Pe;He<Oe;++He)for(var tt=He*_-pe,Qe=je;Qe<qe;++Qe)for(var Dt=W*K+H*He+j*Qe,bt=l*(p-1-tt)+d*(g-1-(Qe*M-Ge))+f*Z,wt=0;wt<y;++wt)Tt+=s[Dt+q*wt]*u[bt+wt];a[A*K+U*le+B*Ve+N*Z]=Tt}return i.toTensor()},n.prototype.conv3dDerInput=function(e,r,o){for(var i=Se(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=s[3],f=this.readSync(e.dataId),h=e.strides,p=h[0],g=h[1],v=h[2],m=h[3],b=this.readSync(r.dataId),y=r.strides,w=y[0],x=y[1],_=y[2],M=y[3],I=o.batchSize,E=o.filterDepth,S=o.filterHeight,k=o.filterWidth,A=o.inChannels,U=o.inDepth,B=o.inHeight,N=o.inWidth,W=o.outChannels,H=o.outDepth,j=o.outHeight,q=o.outWidth,K=o.strideDepth,Z=o.strideHeight,le=o.strideWidth,pe=E-1-o.padInfo.front,Pe=S-1-o.padInfo.top,Oe=k-1-o.padInfo.left,Ve=0;Ve<I;++Ve)for(var Ge=0;Ge<A;++Ge)for(var je=0;je<U;++je)for(var qe=je-pe,Tt=Math.max(0,Math.ceil(qe/K)),He=Math.min(H,(E+qe)/K),tt=0;tt<B;++tt)for(var Qe=tt-Pe,Dt=Math.max(0,Math.ceil(Qe/Z)),bt=Math.min(j,(S+Qe)/Z),wt=0;wt<N;++wt){for(var mo=wt-Oe,yo=Math.max(0,Math.ceil(mo/le)),rr=Math.min(q,(k+mo)/le),js=0,ni=Tt;ni<He;++ni)for(var Ni=ni*K-qe,ri=Dt;ri<bt;++ri)for(var Hs=ri*Z-Qe,oi=yo;oi<rr;++oi)for(var n0=p*Ve+g*ni+v*ri+m*oi,Ws=w*(E-1-Ni)+x*(S-1-Hs)+_*(k-1-(oi*le-mo))+M*Ge,bo=0;bo<W;++bo)js+=f[n0+bo]*b[Ws+bo];a[u*Ve+c*je+l*tt+d*wt+Ge]=js}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,r,o){z([e,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c="channelsLast"===o.dataFormat,l=Se(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<s;++g)for(var v=Math.max(0,Math.ceil((f-g)/i)),m=Math.min(o.outHeight,(o.inHeight+f-g)/i),b=0;b<u;++b)for(var y=Math.max(0,Math.ceil((d-b)/a)),w=Math.min(o.outWidth,(o.inWidth+d-b)/a),x=0;x<o.inChannels;++x)for(var _=0;_<o.outChannels;++_){for(var M=0,I=0;I<o.batchSize;++I)for(var E=v;E<m;++E)for(var S=g+E*i-f,k=y;k<w;++k){var A=b+k*a-d;M+=c?h.get(I,S,A,x)*p.get(I,E,k,_):h.get(I,x,S,A)*p.get(I,_,E,k)}l.set(M,g,b,x,_)}return l.toTensor()},n.prototype.conv3dDerFilter=function(e,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=Se(o.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],g=h[1],v=h[2],m=h[3],b=this.readSync(r.dataId),y=r.strides,w=y[0],x=y[1],_=y[2],M=y[3],I=this.readSync(e.dataId),E=e.strides,S=E[0],k=E[1],A=E[2],U=E[3],B=o.padInfo.front,N=o.padInfo.left,W=o.padInfo.top,H=0;H<u;++H)for(var j=Math.max(0,Math.ceil((B-H)/i)),q=Math.min(o.outDepth,(o.inDepth+B-H)/i),K=H*p,Z=0;Z<c;++Z)for(var le=Math.max(0,Math.ceil((W-Z)/a)),pe=Math.min(o.outHeight,(o.inHeight+W-Z)/a),Pe=Z*g+K,Oe=0;Oe<l;++Oe)for(var Ve=Math.max(0,Math.ceil((N-Oe)/s)),Ge=Math.min(o.outWidth,(o.inWidth+N-Oe)/s),je=Oe*v+Pe,qe=0;qe<o.inChannels;++qe)for(var Tt=qe*m+je,He=0;He<o.outChannels;++He){for(var tt=0,Qe=0;Qe<o.batchSize;++Qe)for(var Dt=Qe*S,bt=Qe*w,wt=j;wt<q;++wt)for(var mo=(H+wt*i-B)*k+Dt,yo=wt*x+bt,rr=le;rr<pe;++rr)for(var js=(Z+rr*a-W)*A+mo,ni=rr*_+yo,Ni=Ve;Ni<Ge;++Ni)tt+=I[(Oe+Ni*s-N)*U+js+qe]*b[Ni*M+ni+He];f[Tt+He]=tt}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=oy(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(e,r,o){z([e,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d=o.outChannels/o.inChannels,f=Se(o.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(r.dataId),g=f.values,v=0;v<o.batchSize;++v)for(var m=v*e.strides[0],b=v*f.strides[0],y=0;y<o.outHeight;++y)for(var w=b+y*f.strides[1],x=y*o.strideHeight-c,_=0;_<i;++_){var M=x+_*s;if(!(M<0||M>=o.inHeight))for(var I=_*r.strides[0],E=m+M*e.strides[1],S=0;S<o.outWidth;++S)for(var k=w+S*f.strides[2],A=S*o.strideWidth-l,U=0;U<a;++U){var B=A+U*u;if(!(B<0||B>=o.inWidth))for(var W=E+B*o.inChannels,H=k,j=I+U*r.strides[1],q=0;q<o.inChannels;++q){for(var K=h[W+q],Z=0;Z<d;++Z)g[H+Z]+=K*p[j+Z];H+=d,j+=d}}}return f.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,r,o){z([e,r],"depthwiseConv2DDerInput");for(var i=Se(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=this.readSync(e.dataId),f=e.strides,h=f[0],p=f[1],g=f[2],v=this.readSync(r.dataId),m=r.strides,b=m[0],y=m[1],w=m[2],x=o.batchSize,_=o.filterHeight,M=o.filterWidth,I=o.inChannels,E=o.inHeight,S=o.inWidth,A=o.outHeight,U=o.outWidth,B=o.strideHeight,N=o.strideWidth,W=_-1-o.padInfo.top,H=M-1-o.padInfo.left,j=o.outChannels/I,q=0;q<x;++q)for(var K=0;K<I;++K)for(var Z=0;Z<E;++Z)for(var le=Z-W,pe=Math.max(0,Math.ceil(le/B)),Pe=Math.min(A,(_+le)/B),Oe=0;Oe<S;++Oe){for(var Ve=Oe-H,Ge=Math.max(0,Math.ceil(Ve/N)),je=Math.min(U,(M+Ve)/N),qe=0,Tt=pe;Tt<Pe;++Tt)for(var He=Tt*B-le,tt=Ge;tt<je;++tt)for(var Qe=h*q+p*Tt+g*tt,Dt=b*(_-1-He)+y*(M-1-(tt*N-Ve))+w*K,bt=0;bt<j;++bt)qe+=d[Qe+(K*j+bt)]*v[Dt+bt];a[u*q+c*Z+l*Oe+K]=qe}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){z([e,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=Se(o.filterShape,"float32"),l=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<s;++g)for(var v=Math.max(0,Math.ceil((d-g)/i)),m=Math.min(o.outHeight,(o.inHeight+d-g)/i),b=0;b<u;++b)for(var y=Math.max(0,Math.ceil((l-b)/a)),w=Math.min(o.outWidth,(o.inWidth+l-b)/a),x=0;x<o.outChannels;++x){for(var _=Math.trunc(x/f),M=x%f,I=0,E=0;E<o.batchSize;++E)for(var S=v;S<m;++S)for(var k=g+S*i-d,A=y;A<w;++A)I+=h.get(E,k,b+A*a-l,_)*p.get(E,S,A,x);c.set(I,g,b,_,M)}return c.toTensor()},n.prototype.tile=function(e,r){return z(e,"tile"),yS(this.bufferSync(e),r)},n.prototype.pad=function(e,r,o){z(e,"pad");var i=r.map(function(f,h){return f[0]+e.shape[h]+f[1]}),a=r.map(function(f){return f[0]}),s=this.bufferSync(e),u=Se(i,e.dtype);0!==o&&u.values.fill(o);for(var c=0;c<e.size;c++){var l=s.indexToLoc(c),d=l.map(function(f,h){return f+a[h]});u.set.apply(u,[s.get.apply(s,l)].concat(d))}return u.toTensor()},n.prototype.transpose=function(e,r){z(e,"transpose");for(var o=new Array(e.rank),i=0;i<o.length;i++)o[i]=e.shape[r[i]];var a=this.readSync(e.dataId),s=Se(o,e.dtype),u=this.bufferSync(e);for(i=0;i<e.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[r[d]];var f=s.locToIndex(l);s.values[f]=a[i]}return s.toTensor()},n.prototype.gather=function(e,r,o){z([e,r],"gather");var i=e.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=Se(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c),d=l.slice();d[o]=a[l[o]];var f=u.locToIndex(d);s.values[c]=u.values[f]}return s.toTensor()},n.prototype.batchToSpaceND=function(e,r,o){z([e],"batchToSpaceND");var i=r.reduce(function(d,f){return d*f}),a=sf(e.shape,r,i),s=uf(a.length,r.length),u=cf(e.shape,r,i),c=iS(o,r.length),l=aS(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){z([e],"spaceToBatchND");var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=sf(u.shape,r,i,!1),l=uf(c.length,r.length,!1),d=cf(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.pool=function(e,r,o){z(e,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),g=Se(r.outShape,e.dtype),v=g.values,m=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],y=r.outShape[3],w=0;w<r.batchSize;++w)for(var x=w*m,_=w*e.strides[0],M=0;M<r.inChannels;++M)for(var I=0;I<r.outHeight;++I)for(var E=I*i-d,S=Math.max(0,E),k=Math.min(r.inHeight,c+E),A=x+I*b,U=0;U<r.outWidth;++U){for(var B=U*a-f,N=Math.max(0,B),W=Math.min(r.inWidth,l+B),H=h,j=0,q=0,K=S;K<k;K+=s){for(var Z=_+K*e.strides[1],le=N;le<W;le+=u){var pe=p[Z+le*e.strides[2]+M];"max"===o&&pe>H?H=pe:"avg"===o&&(j+=pe,q++)}if(isNaN(H))break}v[A+U*y+M]="avg"===o?j/q:H}return g.toTensor()},n.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},n.prototype.maxPoolPositions=function(e,r){for(var o=Se(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(e),p=0;p<r.batchSize;++p)for(var g=0;g<r.inChannels;++g)for(var v=0;v<r.outHeight;++v){for(var m=v*i-d,b=m;b<0;)b+=s;for(var y=Math.min(r.inHeight,c+m),w=0;w<r.outWidth;++w){for(var x=w*a-f,_=x;_<0;)_+=u;for(var M=Math.min(r.inWidth,l+x),I=Number.NEGATIVE_INFINITY,E=-1,S=b;S<y;S+=s)for(var k=S-m,A=_;A<M;A+=u){var U=A-x,B=h.get(p,S,A,g);B>I&&(I=B,E=k*l+U)}o.set(E,p,v,w,g)}}return o.toTensor()},n.prototype.maxPoolBackprop=function(e,r,o,i){z([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,g=Se(r.shape,"float32"),v=this.bufferSync(a),m=this.bufferSync(e),b=0;b<i.batchSize;++b)for(var y=0;y<i.inChannels;++y)for(var w=0;w<i.inHeight;++w)for(var x=0;x<i.inWidth;++x){for(var _=w-p,M=x-h,I=0,E=0;E<d;E+=c){var S=(_+E)/s;if(!(S<0||S>=i.outHeight||Math.floor(S)!==S))for(var k=0;k<f;k+=l){var A=(M+k)/u;if(!(A<0||A>=i.outWidth||Math.floor(A)!==A)){var U=d*f-1-v.get(b,S,A,y)===E*f+k?1:0;0!==U&&(I+=m.get(b,S,A,y)*U)}}}g.set(I,b,w,x,y)}return g.toTensor()},n.prototype.avgPoolBackprop=function(e,r,o){z([e,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,g=Se(r.shape,"float32"),v=1/(s*u),m=this.bufferSync(e),b=0;b<o.batchSize;++b)for(var y=0;y<o.inChannels;++y)for(var w=0;w<o.inHeight;++w)for(var x=0;x<o.inWidth;++x){for(var _=w-p,M=x-h,I=0,E=0;E<d;E+=c){var S=(_+E)/i;if(!(S<0||S>=o.outHeight||Math.floor(S)!==S))for(var k=0;k<f;k+=l){var A=(M+k)/a;A<0||A>=o.outWidth||Math.floor(A)!==A||(I+=m.get(b,S,A,y))}}g.set(I*v,b,w,x,y)}return g.toTensor()},n.prototype.pool3d=function(e,r,o){z(e,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,v=r.padInfo.left,m="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(e.dataId),y=Se(r.outShape,e.dtype),w=y.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],M=r.outShape[3]*r.outShape[4],I=r.outShape[4],E=0;E<r.batchSize;++E)for(var S=E*x,k=E*e.strides[0],A=0;A<r.inChannels;++A)for(var U=0;U<r.outDepth;++U){for(var B=U*i-p,N=B;N<0;)N+=u;for(var W=Math.min(r.inDepth,d+B),H=S+U*_,j=0;j<r.outHeight;++j){for(var q=j*a-g,K=q;K<0;)K+=c;for(var Z=Math.min(r.inHeight,f+q),le=H+j*M,pe=0;pe<r.outWidth;++pe){for(var Pe=pe*s-v,Oe=Pe;Oe<0;)Oe+=l;for(var Ve=Math.min(r.inWidth,h+Pe),Ge=le+pe*I,je=m,qe=0,Tt=0,He=N;He<W;He+=u){for(var tt=k+He*e.strides[1],Qe=K;Qe<Z;Qe+=c){for(var Dt=tt+Qe*e.strides[2],bt=Oe;bt<Ve;bt+=l){var wt=b[Dt+bt*e.strides[3]+A];if("max"===o&&wt>je?je=wt:"avg"===o&&(qe+=wt,Tt++),isNaN(je))break}if(isNaN(je))break}if(isNaN(je))break}w[Ge+A]="avg"===o?qe/Tt:je}}}return y.toTensor()},n.prototype.avgPool3d=function(e,r){return z(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(e,r,o){z([e,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,g=o.effectiveFilterHeight,v=o.effectiveFilterWidth,m=p-1-o.padInfo.front,b=v-1-o.padInfo.left,y=g-1-o.padInfo.top,w=Se(r.shape,"float32"),x=1/(u*c*l),_=this.bufferSync(e),M=0;M<o.batchSize;++M)for(var I=0;I<o.inChannels;++I)for(var E=0;E<o.inDepth;++E)for(var S=0;S<o.inHeight;++S)for(var k=0;k<o.inWidth;++k){for(var A=E-m,U=S-y,B=k-b,N=0,W=0;W<p;W+=d){var H=(A+W)/i;if(!(H<0||H>=o.outDepth||Math.floor(H)!==H))for(var j=0;j<g;j+=f){var q=(U+j)/a;if(!(q<0||q>=o.outHeight||Math.floor(q)!==q))for(var K=0;K<v;K+=h){var Z=(B+K)/s;Z<0||Z>=o.outWidth||Math.floor(Z)!==Z||(N+=_.get(M,H,q,Z,I))}}}w.set(N*x,M,E,S,k,I)}return w.toTensor()},n.prototype.maxPool3d=function(e,r){return z(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(e,r){for(var o=Se(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,v=r.padInfo.left,m=this.bufferSync(e),b=0;b<r.batchSize;++b)for(var y=0;y<r.inChannels;++y)for(var w=0;w<r.outDepth;++w){for(var x=w*i-p,_=x;_<0;)_+=u;for(var M=Math.min(r.inDepth,d+x),I=0;I<r.outHeight;++I){for(var E=I*a-g,S=E;S<0;)S+=c;for(var k=Math.min(r.inHeight,f+E),A=0;A<r.outWidth;++A){for(var U=A*s-v,B=U;B<0;)B+=l;for(var N=Math.min(r.inWidth,h+U),W=Number.NEGATIVE_INFINITY,H=-1,j=_;j<M;j+=u)for(var q=j-x,K=S;K<k;K+=c)for(var Z=K-E,le=B;le<N;le+=l){var pe=le-U,Pe=m.get(b,j,K,le,y);Pe>=W&&(W=Pe,H=q*f*h+Z*f+pe)}o.set(H,b,w,I,A,y)}}}return o.toTensor()},n.prototype.maxPool3dBackprop=function(e,r,o,i){z([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=h-1-i.padInfo.front,m=g-1-i.padInfo.left,b=p-1-i.padInfo.top,y=Se(r.shape,"float32"),w=this.bufferSync(a),x=this.bufferSync(e),_=0;_<i.batchSize;++_)for(var M=0;M<i.inChannels;++M)for(var I=0;I<i.inDepth;++I)for(var E=0;E<i.inHeight;++E)for(var S=0;S<i.inWidth;++S){for(var k=I-v,A=E-b,U=S-m,B=0,N=0;N<h;N+=l){var W=(k+N)/s;if(!(W<0||W>=i.outDepth||Math.floor(W)!==W))for(var H=0;H<p;H+=d){var j=(A+H)/u;if(!(j<0||j>=i.outHeight||Math.floor(j)!==j))for(var q=0;q<g;q+=f){var K=(U+q)/c;if(!(K<0||K>=i.outWidth||Math.floor(K)!==K)){var Z=h*p*g-1-w.get(_,W,j,K,M)===N*p*g+H*g+q?1:0;0!==Z&&(B+=x.get(_,W,j,K,M)*Z)}}}}y.set(B,_,I,E,S,M)}return y.toTensor()},n.prototype.cast=function(e,r){return Im(e,r,this)},n.prototype.reshape=function(e,r){return vf(e,r)},n.prototype.avgPool=function(e,r){return z(e,"avgPool"),this.pool(e,r,"avg").toFloat()},n.prototype.resizeBilinear=function(e,r,o,i){z(e,"resizeBilinear");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(ae([s,r,o,l])),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=0,v=h[0]/p[0],m=h[1]/p[1],b=0;b<s;b++)for(var y=0;y<r;y++)for(var w=v*y,x=Math.floor(w),_=w-x,M=Math.min(u-1,Math.ceil(w)),I=b*e.strides[0]+x*e.strides[1],E=b*e.strides[0]+M*e.strides[1],S=0;S<o;S++)for(var k=m*S,A=Math.floor(k),U=k-A,B=Math.min(c-1,Math.ceil(k)),N=I+A*e.strides[2],W=E+A*e.strides[2],H=I+B*e.strides[2],j=E+B*e.strides[2],q=0;q<l;q++){var K=d[N+q],Z=d[W+q],le=K+(d[H+q]-K)*U;f[g++]=le+(Z+(d[j+q]-Z)*U-le)*_}return sn(f,[s,r,o,l])},n.prototype.resizeBilinearBackprop=function(e,r,o){z([e,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=[o&&d>1?s-1:s,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],v=p[0]/g[0],m=p[1]/g[1],b=this.readSync(e.dataId),y=0,w=0;w<a;w++)for(var x=w*r.strides[0],_=0;_<d;_++)for(var M=_*v,I=Math.floor(M),E=Math.min(Math.ceil(M),s-1),S=x+I*r.strides[1],k=x+E*r.strides[1],A=M-I,U=1-A,B=0;B<f;B++)for(var N=B*m,W=Math.floor(N),H=Math.min(Math.ceil(N),u-1),j=N-W,q=1-j,K=S+W*r.strides[2],Z=S+H*r.strides[2],le=k+W*r.strides[2],pe=k+H*r.strides[2],Pe=U*q,Oe=U*j,Ve=A*q,Ge=A*j,je=0;je<c;je++){var qe=b[y++];h[K+je]+=qe*Pe,h[Z+je]+=qe*Oe,h[le+je]+=qe*Ve,h[pe+je]+=qe*Ge}return Un(h,[a,u,s,c],r.dtype)},n.prototype.resizeNearestNeighbor=function(e,r,o,i){z(e,"resizeNearestNeighbor");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(s*r*o*l),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=h[0]/p[0],v=h[1]/p[1],m=0,b=0;b<s;b++)for(var y=b*e.strides[0],w=0;w<r;w++)for(var x=g*w,_=y+Math.min(u-1,i?Math.round(x):Math.floor(x))*e.strides[1],M=0;M<o;M++)for(var I=v*M,E=_+Math.min(c-1,i?Math.round(I):Math.floor(I))*e.strides[2],S=0;S<l;S++)f[m++]=d[E+S];return sn(f,[s,r,o,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){z([e,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=this.readSync(e.dataId),g=[o&&d>1?s-1:s,o&&f>1?u-1:u],v=[o&&d>1?d-1:d,o&&f>1?f-1:f],m=g[0]/v[0],b=g[1]/v[1],y=1/m,w=1/b,x=2*Math.ceil(y)+2,_=2*Math.ceil(w)+2,M=0;M<a;M++)for(var I=M*r.strides[0],E=0;E<s;E++)for(var S=I+E*r.strides[1],k=Math.floor(E*y),A=Math.floor(k-x/2),U=0;U<u;U++)for(var B=S+U*r.strides[2],N=Math.floor(U*w),W=Math.floor(N-_/2),H=0;H<c;H++){for(var j=0,q=0;q<x;q++){var K=q+A;if(!(K<0||K>=d)){var Z=I+K*e.strides[1],le=K*m;if(E===Math.min(s-1,o?Math.round(le):Math.floor(le)))for(var pe=0;pe<_;pe++){var Pe=pe+W;if(!(Pe<0||Pe>=f)){var Oe=Z+Pe*e.strides[2],Ve=Pe*b;U===Math.min(u-1,o?Math.round(Ve):Math.floor(Ve))&&(j+=p[Oe+H])}}}}h[B+H]=j}return Un(h,r.shape,r.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){z([e,r,o,a,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,g=d.length,v=l.length,m=c.length,b=0,y=0,w=0,x=0,_=0;_<u.length;++_)h[_]=f[b++]+(u[_]-c[y++])*d[w++]/Math.sqrt(l[x++]+i),b>=p&&(b=0),y>=m&&(y=0),w>=g&&(w=0),x>=v&&(x=0);return Un(h,e.shape)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){z(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),l=e.size,d=new Float32Array(l);function f(v){for(var m=v%s,b=v-m+Math.max(0,m-r),y=v-m+Math.min(m+r,u),w=0;b<=y;b++){var x=c[b];w+=x*x}return w}for(var h=0;h<l;h++){var p=f(h),g=c[h]*Math.pow(o+i*p,-a);d[h]=g}return Un(d,e.shape)},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){z(e,"LRNGrad");for(var c=e.shape[3],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=this.readSync(o.dataId),h=new Float32Array(e.size),p=e.size,g=0;g<p;g++){for(var v=g%c,m=g-v+Math.max(0,v-i),b=g-v+Math.min(c,v+i+1),y=0,w=m;w<b;w++)y+=Math.pow(d[w],2);for(y=s*y+a,w=m;w<b;w++){var x=-2*s*u*d[w]*f[g]/y;g===w&&(x+=Math.pow(y,-u)),h[w]+=x*=l[g]}}return Un(h,e.shape)},n.prototype.multinomial=function(e,r,o,i){z(e,"multinomial");for(var a=r?e:Go(e),s=a.shape[0],u=a.shape[1],c=ft([s,o],"int32"),l=this.readSync(c.dataId),d=this.readSync(a.dataId),f=0;f<s;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var g=1;g<p.length;++g)p[g]=p[g-1]+d[h+g];for(var v=af(i.toString()),m=f*o,b=0;b<o;++b){var y=v();l[m+b]=p.length;for(var w=0;w<p.length;w++)if(y<p[w]){l[m+b]=w;break}}}return c},n.prototype.oneHot=function(e,r,o,i){z(e,"oneHot");var a=new Float32Array(e.size*r);a.fill(i);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return Ei(a,[e.size,r],"int32")},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return z(e,"nonMaxSuppression"),Tm(this.readSync(e.dataId),this.readSync(r.dataId),o,i,a)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,r){for(var o=e.shape[0],i=e.shape[1],a=Se(e.shape,"float32"),s=Se(e.shape,"float32"),u=pr(e).as2D(o,i),c=uo(e).as2D(o,i),l=0;l<o;l++)for(var d=u.slice([l,0],[1,i]),f=c.slice([l,0],[1,i]),h=an(d,f),p=this.readSync(this.fftImpl(h,r).dataId),g=0;g<i;g++){var v=pS(p,g);a.values[l*i+g]=v.real,s.values[l*i+g]=v.imag}return an(a.toTensor(),s.toTensor()).as2D(o,i)},n.prototype.fftImpl=function(e,r){var o=e.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(e.shape[0],e.shape[1]);return r&&(a=an(pr(a).div(Y(i)),uo(a).div(Y(i)))),a}var s=this.readSync(e.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)l[f/2]=c[f],d[f/2]=c[f+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,i,r));return an(u.real,u.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return 0==(e&e-1)},n.prototype.fftRadix2=function(e,r,o){if(1===r)return e;var i=this.readSync(e.dataId),a=r/2,s=function(m){for(var b=Math.ceil(m.length/4),y=new Float32Array(b),w=new Float32Array(b),x=0;x<m.length;x+=4)y[Math.floor(x/4)]=m[x],w[Math.floor(x/4)]=m[x+1];return{real:y,imag:w}}(i),u=an(s.real,s.imag).as1D(),c=function(m){for(var b=Math.floor(m.length/4),y=new Float32Array(b),w=new Float32Array(b),x=2;x<m.length;x+=4)y[Math.floor(x/4)]=m[x],w[Math.floor(x/4)]=m[x+1];return{real:y,imag:w}}(i),l=an(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var d=function(m,b){for(var y=new Float32Array(m/2),w=new Float32Array(m/2),x=0;x<Math.ceil(m/2);x++){var _=(b?2:-2)*Math.PI*(x/m);y[x]=Math.cos(_),w[x]=Math.sin(_)}return{real:y,imag:w}}(r,o),f=an(d.real,d.imag).mul(l),h=u.add(f),p=u.sub(f),g=pr(h).concat(pr(p)),v=uo(h).concat(uo(p));return an(g,v).as1D()},n.prototype.fourierTransformByMatmul=function(e,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=sH(a*c,r,o),d=pS(e,c);s+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}o&&(s/=r,u/=r),aH(i,s,u,a)}return i},n.prototype.depthToSpace=function(e,r,o){D("NHWC"===o,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),D(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=e.shape[0],a=e.shape[1],s=e.shape[2],u=e.shape[3],c=a*r,l=s*r,d=u/(r*r),f=this.readSync(e.dataId),h=new Float32Array(i*c*l*d),p=0,g=0;g<i;++g)for(var v=0;v<c;++v)for(var m=Math.floor(v/r),b=v%r,y=0;y<l;++y)for(var w=Math.floor(y/r),x=(b*r+y%r)*d,_=0;_<d;++_)h[p++]=f[_+x+u*(w+s*(m+a*g))];return Un(h,[i,c,l,d])},n.prototype.broadcastedBinaryOp=function(e,r,o,i){var a=Le(e.shape,r.shape),s=Se(a,o),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=qo(e.shape,a),d=qo(r.shape,a),f=s.values;if(l.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=i(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(e),g=this.bufferSync(r),v=function(m){var b=s.indexToLoc(m),y=b.slice(-e.rank);l.forEach(function(M){return y[M]=0});var w=p.locToIndex(y),x=b.slice(-r.rank);d.forEach(function(M){return x[M]=0});var _=g.locToIndex(x);f[m]=i(u[w],c[_])};for(h=0;h<f.length;++h)v(h)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,r,o){var i=Le(e.shape,r.shape),a=Se(i,"float32"),s=Se(i,"float32"),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=qo(e.shape,i),d=qo(r.shape,i),f=a.values,h=s.values;if(l.length+d.length===0)for(var p=0;p<f.length;p++){var g=p%u.length,v=p%c.length,m=o(u[2*g],u[2*g+1],c[2*v],c[2*v+1]);f[p]=m.real,h[p]=m.imag}else{var b=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(x){var _=a.indexToLoc(x),M=_.slice(-e.rank);l.forEach(function(A){return M[A]=0});var I=b.locToIndex(M),E=_.slice(-r.rank);d.forEach(function(A){return E[A]=0});var S=y.locToIndex(E),k=o(u[2*I],u[2*I+1],c[2*S],c[2*S+1]);f[x]=k.real,h[x]=k.imag};for(p=0;p<f.length;p++)w(p)}return this.complex(a.toTensor(),s.toTensor())},n.prototype.split=function(e,r,o){return mS(e,r,o)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,r,o,i,a,s){for(var u=e.shape,c=u[0],l=u[1],d=u[2],f=u[3],h=r.shape[0],p=i[0],g=i[1],v=Se([h,p,g,f],"float32"),m=this.readSync(r.dataId),b=this.readSync(o.dataId),y=this.readSync(e.dataId),w=e.strides,x=v.strides,_=0;_<h;_++){var M=4*_,I=m[M],E=m[M+1],S=m[M+2],k=m[M+3],A=b[_];if(!(A>=c))for(var U=p>1?(S-I)*(l-1)/(p-1):0,B=g>1?(k-E)*(d-1)/(g-1):0,N=0;N<p;N++){var W=p>1?I*(l-1)+N*U:.5*(I+S)*(l-1);if(W<0||W>l-1)for(var H=0;H<g;H++)for(var j=0;j<f;j++){var q=j+H*x[2]+N*x[1]+_*x[0];v.values[q]=s}else if("bilinear"===a){var K=Math.floor(W),Z=Math.ceil(W),le=W-K;for(H=0;H<g;H++)if((He=g>1?E*(d-1)+H*B:.5*(E+k)*(d-1))<0||He>d-1)for(j=0;j<f;j++)v.values[q=j+H*x[2]+N*x[1]+_*x[0]]=s;else{var pe=Math.floor(He),Pe=Math.ceil(He),Oe=He-pe;for(j=0;j<f;j++){var Ve=y[q=j+pe*w[2]+K*w[1]+A*w[0]],Ge=y[q=j+Pe*w[2]+K*w[1]+A*w[0]],je=y[q=j+pe*w[2]+Z*w[1]+A*w[0]],qe=Ve+(Ge-Ve)*Oe,Tt=je+(y[q=j+Pe*w[2]+Z*w[1]+A*w[0]]-je)*Oe;v.values[q=j+H*x[2]+N*x[1]+_*x[0]]=qe+(Tt-qe)*le}}}else for(H=0;H<g;++H){var He;if((He=g>1?E*(d-1)+H*B:.5*(E+k)*(d-1))<0||He>d-1)for(j=0;j<f;j++)v.values[q=j+H*x[2]+N*x[1]+_*x[0]]=s;else{var tt=Math.round(He),Qe=Math.round(W);for(j=0;j<f;j++)v.values[j+H*x[2]+N*x[1]+_*x[0]]=y[j+tt*w[2]+Qe*w[1]+A*w[0]]}}}}return v.toTensor()},n.prototype.sparseToDense=function(e,r,o,i){var a=wc(0,e,o);return this.scatter(e,r,o,a.outputSize,a.sliceSize,a.numUpdates,a.sliceRank,a.strides,i,!1)},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=wm(e,r),s=a[0],u=a[1],c=a[2],l=a[3];if(0===u)return sn([],s,e.dtype);for(var d=new lc([u,c],e.dtype),f=this.readSync(r.dataId),h=this.readSync(e.dataId),p=0;p<u;p++){for(var g=[],v=0,m=0;m<i;m++){var b=f[p*i+m];v+=b*l[m],g.push(b)}if(v<0||v>=e.size/c)throw new Error("Invalid indices: "+g+" does not index into "+e.shape);for(var y=0;y<c;y++)d.values[p*c+y]=h[v*c+y]}return d.toTensor().reshape(s)},n.prototype.scatterND=function(e,r,o){var i=wc(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=Y(0);return this.scatter(e,r,o,l,u,s,a,c,d,!0)},n.prototype.fill=function(e,r,o){var i=ic(o=o||xs(r),ae(e));return i.fill(r),R.makeTensor(i,e,o,this)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var r=ic(e.dtype,ae(e.shape));return this.makeOutput(r,e.shape,e.dtype)},n.prototype.linspace=function(e,r,o){return Mm(e,r,o)},n.prototype.scatter=function(e,r,o,i,a,s,u,c,l,d){var f=[i/a,a],h=this.readSync(e.dataId),p=this.readSync(r.dataId);if(0===i)return sn([],o,r.dtype);var g=new lc(f,r.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var v=0;v<s;v++){for(var m=[],b=0,y=0;y<u;y++){var w=h[v*u+y];m.push(w),b+=w*c[y]}if(b<0||b>=i/a)throw new Error("Invalid indices: "+m+" does not index into "+o);for(var x=0;x<a;x++)d?g.values[b*a+x]+=p[v*a+x]:g.values[b*a+x]=0===r.rank?p[0]:p[v*a+x]}return g.toTensor().reshape(o)},n}(hS);R.registerBackend("cpu",function(){return new l8},1);for(var iy=0,qI=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var n=t.inputs,r=t.attrs,i=n.boxes,a=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=t.backend;z(i,"NonMaxSuppressionWithScore");var h=Am(f.data.get(i.dataId).values,f.data.get(a.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var r=t.inputs.x,o=t.backend;z(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Sc,backendName:"cpu",kernelFunc:function(t){var n=t.inputs,o=n.a,i=n.b,a=t.backend;z([o,i],Sc);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(f,h,p,g,v,m){var b=Le(f,h),y=b.length,w=Tr(b),x=ws(v,ae(b)),_=f.length,M=h.length,I=Tr(f),E=Tr(h),S=qo(f,b),k=qo(h,b);if(S.length+k.length===0)for(var A=0;A<x.length;++A)x[A]=m(p[A%p.length],g[A%g.length]);else{var U=function(B){var N=v2(B,y,w),W=N.slice(-_);S.forEach(function(K){return W[K]=0});var H=em(W,_,I),j=N.slice(-M);k.forEach(function(K){return j[K]=0});var q=em(j,M,E);x[B]=m(p[H],g[q])};for(A=0;A<x.length;++A)U(A)}return[x,b]}(o.shape,i.shape,s,u,o.dtype,function(f,h){var p=f-h;return p*p}),d=c[1];return{dataId:a.write(c[0],d,o.dtype),shape:d,dtype:o.dtype}}}];iy<qI.length;iy++)o2(qI[iy]);for(var ks,d8=function(t){this.variableNames=["A"];var n=mn(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+e+".0);\n\n        vec4 values = "+n.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},f8=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=mn(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+e+".0);\n            vec4 values = "+n.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+n.output+" = result;\n      }\n    "},ay=0,KI=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.backend,o=t.inputs.pixels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],d=[l,c],f=[l,c,t.attrs.numChannels];(s||a)&&(null==ks&&(ks=document.createElement("canvas").getContext("2d")),ks.canvas.width=c,ks.canvas.height=l,ks.drawImage(o,0,0,c,l),o=ks.canvas);var h=e.makeTensorInfo(d,"int32");e.texData.get(h.dataId).usage=Yn.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(h.dataId),o);var p=F().getBool("WEBGL_PACK")?new f8(f):new d8(f),g=e.runWebGLProgram(p,[h],"int32");return e.disposeData(h.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=t.attrs;tf("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=e,h=Am(f.readSync(n.boxes.dataId),f.readSync(a.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var r=t.inputs.x,o=t.backend,i=new Te(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Sc,backendName:"webgl",kernelFunc:function(t){var n=t.inputs,o=n.a,i=n.b,a=t.backend,s=F().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ko("return (a - b) * (a - b);",o.shape,i.shape):new Ct("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];ay<KI.length;ay++)o2(KI[ay]);for(var sy=0,XI=[{kernelName:"Square",gradFunc:function(t,n){var e=n[0];return{x:function(){return t.mul(e.toFloat().mul(2))}}}},{kernelName:Sc,gradFunc:function(t,n){var e=n[0],r=n[1],o=Y(2);return{a:function(){return yn(t,yn(o,Gt(e,r)))},b:function(){return yn(t,yn(o,Gt(r,e)))}}}}];sy<XI.length;sy++)g5(XI[sy]);var h8=function(){function t(){}return t.prototype.fetch=function(n,e){return fetch(n,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return new TextDecoder(e).decode(n)},t}();F().get("IS_BROWSER")&&F().setPlatform("browser",new h8);var uy,g8=function(){function t(){this.util=zs(118),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(n,e){return null!=F().global.fetch?F().global.fetch(n,e):(null==uy&&(uy=zs(655)),uy(n,e))},t.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return 0===n.length?"":new this.util.TextDecoder(e).decode(n)},t}();F().get("IS_NODE")&&F().setPlatform("node",new g8);var cy={float32:4,int32:4,uint16:2,uint8:1,bool:1},Af=4;function QI(t,n){for(var e={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,d=ae(l),f=void 0;if("quantization"in s){var h=s.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=cy[h.dtype],g=t.slice(r,r+d*p),v="uint8"===h.dtype?new Uint8Array(g):new Uint16Array(g);if("float32"===c)f=Float32Array.from(v,function(_){return _*h.scale+h.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(v,function(_){return Math.round(_*h.scale+h.min)})}r+=d*p}else if("string"===c){var m=ae(s.shape);f=[];for(var b=0;b<m;b++){var y=new Uint32Array(t.slice(r,r+Af))[0];r+=Af;var w=new Uint8Array(t.slice(r,r+y));f.push(w),r+=y}}else{var x=cy[c];if(g=t.slice(r,r+d*x),"float32"===c)f=new Float32Array(g);else if("int32"===c)f=new Int32Array(g);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(g)}r+=d*x}e[u]=sn(f,l,c)},i=0,a=n;i<a.length;i++)o(a[i]);return e}function v8(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var n=0,e=[];t.forEach(function(i){if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(n),o=0;return e.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var ly=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function YI(t){return ly?Buffer.byteLength(t):new Blob([t]).size}function dy(t){var n=0;t.forEach(function(o){n+=o.byteLength});var e=new Uint8Array(n),r=0;return t.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function JI(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var n=t.split("/");return n[n.length-1]}function Tc(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:YI(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:YI(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var tr=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(n){t.getInstance().saveRouters.push(n)},t.registerLoadRouter=function(n){t.getInstance().loadRouters.push(n)},t.getSaveHandlers=function(n){return t.getHandlers(n,"save")},t.getLoadHandlers=function(n,e){return t.getHandlers(n,"load",e)},t.getHandlers=function(n,e,r){var o=[];return("load"===e?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(i){var a=i(n,r);null!==a&&o.push(a)}),o},t}(),Ps="://",Mi=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(n,e){D(null!=n,function(){return"scheme must not be undefined or null."}),n.endsWith(Ps)&&(n=n.slice(0,n.indexOf(Ps))),D(n.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();D(null==r.managers[n],function(){return"A model store manager is already registered for scheme '"+n+"'."}),r.managers[n]=e},t.getManager=function(n){var e=this.getInstance().managers[n];if(null==e)throw new Error("Cannot find model manager for scheme '"+n+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function kf(t){if(-1===t.indexOf(Ps))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Mi.getSchemes().join(","));return{scheme:t.split(Ps)[0],path:t.split(Ps)[1]}}function ZI(t,n,e){return void 0===e&&(e=!1),oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d;return ie(this,function(f){switch(f.label){case 0:return D(t!==n,function(){return"Old path and new path are the same: '"+t+"'"}),D((r=tr.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),D(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],D((i=tr.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),D(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."}),a=i[0],s=kf(t).scheme,u=kf(t).path,c=s===kf(t).scheme,[4,o.load()];case 1:return l=f.sent(),e&&c?[4,Mi.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(l)];case 4:return d=f.sent(),!e||c?[3,6]:[4,Mi.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var ga="models_store",Ri="model_info_store";function eM(){if(!F().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==n)throw new Error("The current browser does not appear to support IndexedDB.");return n}function fy(t){var n=t.result;n.createObjectStore(ga,{keyPath:"modelPath"}),n.createObjectStore(Ri,{keyPath:"modelPath"})}var Os=function(){function t(n){if(this.indexedDB=eM(),null==n||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(e){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},t.prototype.load=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(n,e){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return fy(a)},a.onsuccess=function(){var s=a.result;if(null==e){var u=s.transaction(ga,"readonly"),c=u.objectStore(ga).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(g){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,d=Tc(e),f=s.transaction(Ri,"readwrite"),h=f.objectStore(Ri),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var g=(l=s.transaction(ga,"readwrite")).objectStore(ga).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:d});g.onsuccess=function(){return o({modelArtifactsInfo:d})},g.onerror=function(v){var m=(h=f.objectStore(Ri)).delete(r.modelPath);m.onsuccess=function(){return s.close(),i(g.error)},m.onerror=function(b){return s.close(),i(g.error)}}},p.onerror=function(g){return s.close(),i(p.error)},f.oncomplete=function(){null==l?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},t.URL_SCHEME="indexeddb://",t}(),tM=function(t){return F().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Os.URL_SCHEME)?(n=t.slice(Os.URL_SCHEME.length),new Os(n)):null;var n};tr.registerSaveRouter(tM),tr.registerLoadRouter(tM);var m8=function(){function t(){this.indexedDB=eM()}return t.prototype.listModels=function(){return oe(this,void 0,void 0,function(){var n=this;return ie(this,function(e){return[2,new Promise(function(r,o){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return fy(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Ri,"readonly"),u=s.objectStore(Ri).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var f=d[l];c[f.modelPath]=f.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},t.prototype.removeModel=function(n){return oe(this,void 0,void 0,function(){var e=this;return ie(this,function(r){var o;return n=(o=n).startsWith(Os.URL_SCHEME)?o.slice(Os.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return fy(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(Ri,"readwrite"),d=l.objectStore(Ri),f=d.get(n);f.onsuccess=function(){if(null==f.result)return c.close(),a(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var h=d.delete(n),p=function(){var g=(u=c.transaction(ga,"readwrite")).objectStore(ga).delete(n);g.onsuccess=function(){return i(f.result.modelArtifactsInfo)},g.onerror=function(v){return a(f.error)}};h.onsuccess=p,h.onerror=function(g){return p(),c.close(),a(f.error)}},f.onerror=function(h){return c.close(),a(f.error)},l.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},t}();if(F().getBool("IS_BROWSER"))try{Mi.registerManager(Os.URL_SCHEME,new m8)}catch{}var Qo="/",Ns="tensorflowjs_models",nM="info",y8="model_topology",b8="weight_specs",w8="weight_data",x8="model_metadata";function rM(t){return{info:[Ns,t,nM].join(Qo),topology:[Ns,t,y8].join(Qo),weightSpecs:[Ns,t,b8].join(Qo),weightData:[Ns,t,w8].join(Qo),modelMetadata:[Ns,t,x8].join(Qo)}}function _8(t){var n=t.split(Qo);if(n.length<3)throw new Error("Invalid key format: "+t);return n.slice(1,n.length-1).join(Qo)}var Fs=function(){function t(n){if(!F().getBool("IS_BROWSER")||typeof window>"u"||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==n||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=rM(this.modelPath)}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){var e,r,o;return ie(this,function(i){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),o=Tc(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(ly)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return oe(this,void 0,void 0,function(){var n,e,r,o,i,a,s;return ie(this,function(u){if(null==(n=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==n.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,null==(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,e.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(ly){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(s),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),oM=function(t){return F().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Fs.URL_SCHEME)?(n=t.slice(Fs.URL_SCHEME.length),new Fs(n)):null;var n};tr.registerSaveRouter(oM),tr.registerLoadRouter(oM);var C8=function(){function t(){D(F().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),D(typeof window>"u"||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return oe(this,void 0,void 0,function(){var n,e,r,o,i,a;return ie(this,function(s){for(n={},e=Ns+Qo,r=Qo+nM,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(e)&&i.endsWith(r)&&(a=_8(i),n[a]=JSON.parse(this.LS.getItem(i)));return[2,n]})})},t.prototype.removeModel=function(n){return oe(this,void 0,void 0,function(){var e,r;return ie(this,function(o){var i;if(n=(i=n).startsWith(Fs.URL_SCHEME)?i.slice(Fs.URL_SCHEME.length):i,e=rM(n),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},t}();if(F().getBool("IS_BROWSER"))try{Mi.registerManager(Fs.URL_SCHEME,new C8)}catch{}var D8="model",E8=".json",S8=".weights.bin";function iM(t){return new Promise(function(n){return setTimeout(n)}).then(t)}var hy=function(){function t(n){if(!F().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(t.URL_SCHEME)&&(n=n.slice(t.URL_SCHEME.length)),null!=n&&0!==n.length||(n=D8),this.modelTopologyFileName=n+E8,this.weightDataFileName=n+S8}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){var e,i,a,s;return ie(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return i=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,iM(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==n.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,iM(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Tc(n)}]}})})},t.URL_SCHEME="downloads://",t}(),I8=function(){function t(n){if(null==n||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return t.prototype.load=function(){return oe(this,void 0,void 0,function(){var n,e,r=this;return ie(this,function(o){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(null!=l){0===e.length&&i({modelTopology:l});var d=c.weightsManifest;if(null!=d){var f;try{f=r.checkManifestAndWeightFiles(d,e)}catch(v){return void a(v)}var h=[],p=[],g=[];d.forEach(function(v){v.paths.forEach(function(m){p.push(m),g.push(null)}),h.push.apply(h,v.weights)}),d.forEach(function(v){v.paths.forEach(function(m){var b=new FileReader;b.onload=function(y){var w=y.target.result,x=p.indexOf(m);g[x]=w,-1===g.indexOf(null)&&i({modelTopology:l,weightSpecs:h,weightData:dy(g),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},b.onerror=function(y){return a("Failed to weights data from file of path '"+m+"'.")},b.readAsArrayBuffer(f[m])})})}else a(new Error("weightManifest field is missing from file "+n.name))}else a(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},t.prototype.checkManifestAndWeightFiles=function(n,e){for(var r=[],o=e.map(function(u){return JI(u.name)}),i={},a=0,s=n;a<s.length;a++)s[a].paths.forEach(function(u){var c=JI(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===o.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=e[o.indexOf(c)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return i},t}();function aM(t,n,e,r){var i;D(null!=(i=t)&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"}),function(i,a){D(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),D(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),D(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(e=e??0,r=r??1);var o=0;return Promise.all(t.map(function(i){return i.then(function(a){var s=e+ ++o/t.length*(r-e);return n(s),a}),i}))}function sM(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l;return ie(this,function(d){switch(d.label){case 0:return null==n&&(n={}),e=null==n.fetchFunc?F().platform.fetch:n.fetchFunc,r=t.map(function(f){return e(f,n.requestInit,{isBinary:!0})}),o=0,i=.5,null!=n.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,aM(r,n.onProgress,o,i)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,c=1,null!=n.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,aM(s,n.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function uM(t){var n=this;return function(e,r,o){return void 0===r&&(r=""),oe(n,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p;return ie(this,function(g){switch(g.label){case 0:if(i=e.map(function(){return!1}),a={},s=null!=o?o.map(function(){return!1}):[],u=[],e.forEach(function(v,m){var b=0;v.weights.forEach(function(y){var x=cy["quantization"in y?y.quantization.dtype:y.dtype]*ae(y.shape),_=function(){i[m]=!0,null==a[m]&&(a[m]=[]),a[m].push({manifestEntry:y,groupOffset:b,sizeBytes:x})};null!=o?o.forEach(function(M,I){M===y.name&&(_(),s[I]=!0)}):_(),u.push(y.name),b+=x})}),!s.every(function(v){return v}))throw c=o.filter(function(v,m){return!s[m]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=i.reduce(function(v,m,b){return m&&v.push(b),v},[]),d=[],l.forEach(function(v){e[v].paths.forEach(function(m){var b=r+(r.endsWith("/")?"":"/")+m;d.push(b)})}),[4,t(d)];case 1:return f=g.sent(),h={},p=0,l.forEach(function(v){for(var m=e[v].paths.length,b=0,y=0;y<m;y++)b+=f[p+y].byteLength;for(var w=new ArrayBuffer(b),x=new Uint8Array(w),_=0,M=0;M<m;M++){var I=new Uint8Array(f[p+M]);x.set(I,_),_+=I.byteLength}a[v].forEach(function(E){var S=QI(w.slice(E.groupOffset,E.groupOffset+E.sizeBytes),[E.manifestEntry]);for(var k in S)h[k]=S[k]}),p+=m}),[2,h]}})})}}tr.registerSaveRouter(function(t){return F().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hy.URL_SCHEME)?(void 0===(n=t.slice(hy.URL_SCHEME.length))&&(n="model"),new hy(n)):null;var n});var cM=function(){function t(n,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(D("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=F().platform.fetch,D(null!=n&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&D(2===n.length,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){var e,i;return ie(this,function(a){switch(a.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:n.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=n.weightData&&e.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:Tc(n),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},t.prototype.load=function(){return oe(this,void 0,void 0,function(){var n,e,r,o,i,a,s,u,c,l,d,f;return ie(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,n.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=e.weightsManifest,a=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,null==(o=e.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:f=h.sent(),l=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},t.prototype.loadWeights=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,c,d,f;return ie(this,function(h){switch(h.label){case 0:for(void 0,void 0,g=(p=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),v=p.lastIndexOf("?"),r=[p.substring(0,g)+"/",v>g?p.substring(v):""],o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=n;u<c.length;u++)s.push.apply(s,c[u].weights);return d=[],n.forEach(function(p){p.paths.forEach(function(g){d.push(a+g+i)})}),[4,sM(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[s,dy(f)]]}var p,g,v})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function py(t){return null!=t.match(cM.URL_SCHEME_REGEX)}var lM=function(t,n){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(e){return py(e)}):py(t))?gy(t,{onProgress:n}):null};function gy(t,n){return new cM(t,n)}tr.registerSaveRouter(lM),tr.registerLoadRouter(lM);var Ls,vy=function(){function t(n){this.modelArtifacts=n}return t.prototype.load=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){return[2,this.modelArtifacts]})})},t}(),M8=function(){function t(n){this.saveHandler=n}return t.prototype.save=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(e){return[2,this.saveHandler(n)]})})},t}(),dM=Object.freeze({browserFiles:function(t){return new I8(t)},browserHTTPRequest:function(t,n){return gy(t,n)},concatenateArrayBuffers:dy,decodeWeights:QI,encodeWeights:function(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return ie(this,function(u){switch(u.label){case 0:for(e=[],r=[],o=Array.isArray(t)?t.map(function(c){return c.name}):Object.keys(t),i=function(c){var l=o[c],d=Array.isArray(t)?t[c].tensor:t[l];if("float32"!==d.dtype&&"int32"!==d.dtype&&"bool"!==d.dtype&&"string"!==d.dtype)throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var f={name:l,shape:d.shape,dtype:d.dtype};if("string"===d.dtype){var h=new Promise(function(p){return oe(s,void 0,void 0,function(){var g,v,m,b,y,w,x;return ie(this,function(_){switch(_.label){case 0:return[4,d.bytes()];case 1:for(g=_.sent(),v=g.reduce(function(M,I){return M+I.length},0)+Af*g.length,m=new Uint8Array(v),b=0,y=0;y<g.length;y++)w=g[y],x=new Uint8Array(new Uint32Array([w.length]).buffer),m.set(x,b),m.set(w,b+=Af),b+=w.length;return p(m),[2]}})})});r.push(h)}else r.push(d.data());null!=n&&(f.group=n),e.push(f)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:v8(u.sent()),specs:e}]}})})},fromMemory:function(t,n,e,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new vy(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new vy({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new vy({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))},getLoadHandlers:function(t,n){return tr.getLoadHandlers(t,n)},getModelArtifactsInfoForJSON:Tc,getSaveHandlers:function(t){return tr.getSaveHandlers(t)},http:gy,isHTTPScheme:py,loadWeights:function(t,n,e,r){return void 0===n&&(n=""),oe(this,void 0,void 0,function(){return ie(this,function(o){return[2,uM(function(i){return sM(i,{requestInit:r})})(t,n,e)]})})},registerLoadRouter:function(t){return tr.registerLoadRouter(t)},registerSaveRouter:function(t){return tr.registerSaveRouter(t)},weightsLoaderFactory:uM,withSaveHandler:function(t){return new M8(t)},copyModel:function(t,n){return oe(this,void 0,void 0,function(){return ie(this,function(e){return[2,ZI(t,n,!1)]})})},listModels:function(){return oe(this,void 0,void 0,function(){var t,n,e,r,o,i,a;return ie(this,function(s){switch(s.label){case 0:t=Mi.getSchemes(),n={},e=0,r=t,s.label=1;case 1:return e<r.length?[4,Mi.getManager(o=r[e]).listModels()]:[3,4];case 2:for(a in i=s.sent())n[o+Ps+a]=i[a];s.label=3;case 3:return e++,[3,1];case 4:return[2,n]}})})},moveModel:function(t,n){return oe(this,void 0,void 0,function(){return ie(this,function(e){return[2,ZI(t,n,!0)]})})},removeModel:function(t){return oe(this,void 0,void 0,function(){var n;return ie(this,function(e){return n=kf(t),[2,Mi.getManager(n.scheme).removeModel(n.path)]})})}}),R8=T({confusionMatrix_:function(t,n,e){var r=C(t,"labels","confusionMatrix"),o=C(n,"predictions","confusionMatrix");D(null==e||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),D(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),D(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),D(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),D(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=bm(r.asType("int32"),e),a=bm(o.asType("int32"),e);return i.transpose().matMul(a).asType("int32")}}),T8=(Object.freeze({confusionMatrix:R8}),T({fromPixels_:function(t,n){if(void 0===n&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=n2("FromPixels",R.backendName))return R.runKernel("FromPixels",{pixels:t},{numChannels:n});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],d=c[1];if(a?s=t.getContext("2d").getImageData(0,0,l,d).data:r||e?s=t.data:(i||o)&&(null==Ls&&(Ls=document.createElement("canvas").getContext("2d")),Ls.canvas.width=l,Ls.canvas.height=d,Ls.drawImage(t,0,0,l,d),s=Ls.getImageData(0,0,l,d).data),4===n)u=new Int32Array(s);else{var f=l*d;u=new Int32Array(f*n);for(var h=0;h<f;h++)for(var p=0;p<n;++p)u[h*n+p]=s[4*h+p]}return vm(u,[d,l,n],"int32")}})),my=Object.freeze({toPixels:function(t,n){return oe(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,h,p,g,v,m,b,y,w,x,_,M,I;return ie(this,function(E){switch(E.label){case 0:if(e=C(t,"img","toPixels"),t instanceof rt||(e=e.toInt()),2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],i=r[1],(a=2===e.rank?1:e.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,e.data()];case 1:return s=E.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=E.sent(),h=l[0][0],p=l[1][0],u.dispose(),c.dispose(),"float32"===e.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==e.dtype)throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(g="float32"===e.dtype?255:1,v=new Uint8ClampedArray(i*o*4),m=0;m<o*i;++m)b=void 0,y=void 0,w=void 0,x=void 0,1===a?(b=s[m]*g,y=s[m]*g,w=s[m]*g,x=255):3===a?(b=s[3*m]*g,y=s[3*m+1]*g,w=s[3*m+2]*g,x=255):4===a&&(b=s[4*m]*g,y=s[4*m+1]*g,w=s[4*m+2]*g,x=s[4*m+3]*g),v[0+(_=4*m)]=Math.round(b),v[_+1]=Math.round(y),v[_+2]=Math.round(w),v[_+3]=Math.round(x);return null!=n&&(n.width=i,n.height=o,M=n.getContext("2d"),I=new ImageData(v,i,o),M.putImageData(I,0,0)),e!==t&&e.dispose(),[2,v]}})})},fromPixels:T8}),fM=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(n,e){return new n(e)},t}(),hM=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]},t}();function Ti(t){D(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),D("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),D(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),hM.register(t)}Object.freeze({Serializable:fM,SerializationMap:hM,registerClass:Ti});var A8=.001,pM=.1;function yy(){return 32===R.backend.floatPrecision()?A8:pM}function by(t,n,e){var r=!0;if((rn(t)||rn(n))&&(r=!1),rn(t)&&rn(n)&&(r=!0),r){var o=t.constructor.name,i=n.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(n)){var a=so(t),s=so(n);if(!Ft(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=rn(t)?t:Wo(t),c=rn(n)?n:Wo(n);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var d=u[l],f=c[l];if(!e(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function wy(t,n,e){return!isFinite(t)&&!isFinite(n)||!(isNaN(t)||isNaN(n)||Math.abs(t-n)>e)}Object.freeze({TEST_EPSILON_FLOAT16:pM,expectArraysClose:function(t,n,e){return null==e&&(e=yy()),by(t,n,function(r,o){return wy(r,o,e)})},testEpsilon:yy,expectPromiseToFail:function(t,n){t().then(function(){return n.fail()},function(){return n()})},expectArraysEqual:function(t,n){var e="string"==typeof n||"number"==typeof n||"boolean"==typeof n?[n]:n;return _i(t)||_i(t[0])||_i(n)||_i(n[0])?by(t,e,function(r,o){return r==o}):by(t,n,function(r,o){return wy(r,o,0)})},expectNumbersClose:function(t,n,e){if(null==e&&(e=yy()),!wy(t,n,e))throw new Error("Numbers differ: actual === "+t+", expected === "+n)},expectValuesInRange:function(t,n,e){for(var r=0;r<t.length;r++)if(t[r]<n||t[r]>e)throw new Error("Value out of range:"+t[r]+" low: "+n+", high: "+e)},expectArrayBuffersEqual:function(t,n){expect(new Float32Array(t)).toEqual(new Float32Array(n))}}),Object.freeze({gpgpu_util:eW,webgl_util:D5,forceHalfFloat:function(){F().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:dI,setWebGLContext:D2,GPGPUContext:KS});var va=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Rr(n,t),n.prototype.minimize=function(e,r,o){void 0===r&&(r=!1);var i=this.computeGradients(e,o),a=i.value,s=i.grads;if(null!=o){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Ln(s),r?a:(a.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(e,r){return function oH(t,n){D(Ci(t),function(){return"The f passed in variableGrads(f) must be a function"}),D(null==n||Array.isArray(n)&&n.every(function(l){return l instanceof Cs}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=null!=n;if(!e)for(var r in n=[],R.registeredVariables)n.push(R.registeredVariables[r]);var o=e?n.filter(function(l){return!l.trainable}):null,i=n.length;D((n=n.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=R.gradients(t,n,null,!0),s=a.value,u=a.grads;D(u.some(function(l){return null!=l}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),D(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return n.forEach(function(l,d){null!=u[d]&&(c[l.name]=u[d])}),o?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}(e,r)},n.prototype.dispose=function(){null!=this.iterations_&&Ln(this.iterations_)},n.prototype.saveIterations=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Y(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,e.slice(1)]}})})},n}(fM);Object.defineProperty(va,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var gM=function(t){function n(e,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==o&&(i.epsilon=R.backend.epsilon()),i}return Rr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:te(function(){return $e(a).variable(!1)})}),null==r.accumulatedUpdates[i]&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:te(function(){return $e(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;te(function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=c.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(l),c.assign(f);var h=d.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Ln(this.accumulatedGrads.map(function(e){return e.variable})),Ln(this.accumulatedUpdates.map(function(e){return e.variable})))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var e;return ie(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedGrads=e.slice(0,r=e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n}(va);Ti(gM);var vM=function(t){function n(e,r){void 0===r&&(r=.1);var o=t.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return Rr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:te(function(){return co(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable;te(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(R.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedGrads&&Ln(this.accumulatedGrads.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n}(va);Ti(vM);var mM=function(t){function n(e,r,o,i){void 0===i&&(i=null);var a=t.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],te(function(){a.accBeta1=Y(r).variable(),a.accBeta2=Y(o).variable()}),null==i&&(a.epsilon=R.backend.epsilon()),a}return Rr(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);te(function(){var i=Gt(1,r.accBeta1),a=Gt(1,r.accBeta2);o.forEach(function(s,u){var c=R.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:te(function(){return $e(c).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:te(function(){return $e(c).variable(!1)})});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2).add(l.square().mul(1-r.beta2)),g=h.div(i),v=p.div(a);d.assign(h),f.assign(p);var m=g.div(v.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ln(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Ln(this.accumulatedSecondMoment.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var e;return ie(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){var r,o=this;return ie(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),te(function(){o.accBeta1.assign(Ef(o.beta1,o.iterations_+1)),o.accBeta2.assign(Ef(o.beta2,o.iterations_+1))}),this.accumulatedFirstMoment=e.slice(0,r=e.length/2).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n}(va);Ti(mM);var yM=function(t){function n(e,r,o,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var s=t.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],te(function(){s.iteration=Y(0).variable(),s.accBeta1=Y(r).variable()}),null==i&&(s.epsilon=R.backend.epsilon()),s}return Rr(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);te(function(){var i=Gt(1,r.accBeta1),a=Fr(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var c=R.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:$e(c).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:$e(c).variable(!1)});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2),g=l.abs(),v=p.maximum(g);d.assign(h),f.assign(v);var m=a.div(i).mul(h.div(v.add(r.epsilon))).add(c);c.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ln(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Ln(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n}(va);Ti(yM);var xy=function(t){function n(e){var r=t.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return Rr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=Array.isArray(e)?e[i].tensor:e[o];if(null!=a){var s=R.registeredVariables[o];te(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function E5(t){return R.keep(t)}(Y(-e))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(e,r){return new e(r.learningRate)},n.className="SGD",n}(va);Ti(xy);var bM=function(t){function n(e,r,o){void 0===o&&(o=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=Y(i.momentum),i}return Rr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulations[i]&&(r.accumulations[i]={originalName:o+"/momentum",variable:te(function(){return $e(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(e)?e[i].tensor:e[o];null!=u&&te(function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Ln(this.accumulations.map(function(e){return e.variable}))},n.prototype.setMomentum=function(e){this.momentum=e},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n}(xy);Ti(bM);var wM=function(t){function n(e,r,o,i,a){void 0===r&&(r=.9),void 0===o&&(o=0),void 0===i&&(i=null),void 0===a&&(a=!1);var s=t.call(this)||this;if(s.learningRate=e,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,null==i&&(s.epsilon=R.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Rr(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=R.registeredVariables[o];null==r.accumulatedMeanSquares[i]&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:te(function(){return $e(a).variable(!1)})}),null==r.accumulatedMoments[i]&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:te(function(){return $e(a).variable(!1)})}),null==r.accumulatedMeanGrads[i]&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:te(function(){return $e(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;te(function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[i].variable,f=d.mul(r.decay).add(s.mul(1-r.decay)),h=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(f.square().add(r.epsilon)).sqrt()));u.assign(l),d.assign(f),c.assign(h);var p=a.sub(h);a.assign(p)}else{var g=u.mul(r.decay).add(s.square().mul(1-r.decay));h=c.mul(r.momentum).add(s.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),u.assign(g),c.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Ln(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Ln(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Ln(this.accumulatedMoments.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var e;return ie(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedMeanSquares=e.slice(0,r=this.centered?e.length/3:e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n}(va);Ti(wM),function(){function t(){}t.sgd=function(n){return new xy(n)},t.momentum=function(n,e,r){return void 0===r&&(r=!1),new bM(n,e,r)},t.rmsprop=function(n,e,r,o,i){return void 0===e&&(e=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1),new wM(n,e,r,o,i)},t.adam=function(n,e,r,o){return void 0===n&&(n=.001),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),new mM(n,e,r,o)},t.adadelta=function(n,e,r){return void 0===n&&(n=.001),void 0===e&&(e=.95),void 0===r&&(r=null),new gM(n,e,r)},t.adamax=function(n,e,r,o,i){return void 0===n&&(n=.002),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),void 0===i&&(i=0),new yM(n,e,r,o,i)},t.adagrad=function(n,e){return void 0===e&&(e=.1),new vM(n,e)}}(),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate,rt.prototype.squaredDifference=function(t){return fI(this,t)},O=c8;var _y=function(t,n){return(_y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(t,n)};function _e(t,n){function e(){this.constructor=t}_y(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var wn=function(){return wn=Object.assign||function(n){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},wn.apply(this,arguments)};function se(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}function ue(t,n){var r,o,i,a,e={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,o=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(!(i=(i=e.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){e.label=c[1];break}if(6===c[0]&&e.label<i[1]){e.label=i[1],i=c;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(c);break}i[2]&&e.ops.pop(),e.trys.pop();continue}c=n.call(t,e)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function Ac(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var Bs=function(){function t(n,e){if(!ya(n)||!ya(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:e}));this._width=n,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function kc(t,n){return t instanceof rt&&t.shape.length===n}function Of(t){return kc(t,3)}function Ai(t){return kc(t,4)}function _M(t){return t%2==0}function CM(t){return t&&t.width&&t.height}function Cy(t){return t.reduce(function(n,e){return n.add(e)},new Xe(0,0)).div(new Xe(t.length,t.length))}function Pc(t,n,e){return Array(t).fill(0).map(function(r,o){return n+o*e})}function ya(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function DM(t){return ya(t)&&0<=t&&t<=1}var Xe=function(){function t(n,e){this._x=n,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y)},t.prototype.sub=function(n){return new t(this.x-n.x,this.y-n.y)},t.prototype.mul=function(n){return new t(this.x*n.x,this.y*n.y)},t.prototype.div=function(n){return new t(this.x/n.x,this.y/n.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),Yo=function(){function t(n,e){void 0===e&&(e=!0);var r=n||{},o=[r.left,r.top,r.right,r.bottom].every(ya),i=[r.x,r.y,r.width,r.height].every(ya);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",e),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(ya)},t.assertIsValidBox=function(n,e,r){if(void 0===r&&(r=!1),!t.isRect(n))throw new Error(e+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(e+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new Xe(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new Xe(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new Xe(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new Xe(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.toSquare=function(){var n=this,e=n.x,r=n.y,o=n.width,i=n.height,a=Math.abs(o-i);return o<i&&(e-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new t({x:e,y:r,width:o,height:i})},t.prototype.rescale=function(n){var e=CM(n)?n.width:n,r=CM(n)?n.height:n;return new t({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},t.prototype.pad=function(n,e){var r=[this.x-n/2,this.y-e/2,this.width+n,this.height+e];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(n,e){var r=this,i=r.y,a=r.right,s=r.bottom,u=Math.max(r.x,0),c=Math.max(i,0),d=s-c;return new t({x:u,y:c,width:Math.min(a-u,n-u),height:Math.min(d,e-c)}).floor()},t.prototype.shift=function(n,e){return new t({x:this.x+n,y:this.y+e,width:this.width,height:this.height})},t.prototype.padAtBorders=function(n,e){var r=this.width+1,o=this.height+1,s=r,u=o,c=this.left,l=this.top,d=this.right,f=this.bottom;return d>e&&(s=-d+e+r,d=e),f>n&&(u=-f+n+o,f=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:1,edy:u,dx:1,edx:s,y:l,ey:f,x:c,ex:d,w:r,h:o}},t.prototype.calibrate=function(n){return new t({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},t}(),Nf=function(t){function n(e,r,o,i,a){return void 0===a&&(a=!1),t.call(this,{left:e,top:r,right:o,bottom:i},a)||this}return _e(n,t),n}(Yo),EM=function(){function t(n,e,r,o,i){this._imageDims=new Bs(i.width,i.height),this._score=n,this._classScore=e,this._className=r,this._box=new Yo(o).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new Yo(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:e})},t}(),fo=function(t){function n(e,r,o){return t.call(this,e,e,"",r,o)||this}return _e(n,t),n.prototype.forSize=function(e,r){var o=t.prototype.forSize.call(this,e,r);return new n(o.score,o.relativeBox,o.imageDims)},n}(EM);function U8(t,n,e){void 0===e&&(e=!0);var i=Math.max(0,Math.min(t.right,n.right)-Math.max(t.left,n.left))*Math.max(0,Math.min(t.bottom,n.bottom)-Math.max(t.top,n.top));return e?i/(t.area+n.area-i):i/Math.min(t.area,n.area)}function Oc(t,n,e,r){void 0===r&&(r=!0);for(var o=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++)c.push(U8(t[s],t[u[l]],r));o=o.filter(function(p,g){return c[g]<=e})};o.length>0;)a();return i}function Nc(t,n){return te(function(){var e=n[0],r=n[1],o=n[2],i=co(Ac(t.shape.slice(0,3),[1]),e),a=co(Ac(t.shape.slice(0,3),[1]),r),s=co(Ac(t.shape.slice(0,3),[1]),o),u=zt([i,a,s],3);return Gt(t,u)})}function Dy(t){return 1/(1+Math.exp(-t))}var qt,Ey=function(t){function n(e,r,o,i,a){return void 0===a&&(a=!1),t.call(this,{x:e,y:r,width:o,height:i},a)||this}return _e(n,t),n}(Yo),Ff=function(){function t(n,e,r){void 0===r&&(r=new Xe(0,0));var o=e.width,i=e.height;this._imgDims=new Bs(o,i),this._shift=r,this._positions=n.map(function(a){return a.mul(new Xe(o,i)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new Xe(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(e){return e.sub(n._shift).div(new Xe(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new this.constructor(this.relativePositions,{width:n,height:e})},t.prototype.shiftBy=function(n,e){return new this.constructor(this.relativePositions,this._imgDims,new Xe(n,e))},t.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},t.prototype.align=function(n,e){if(void 0===e&&(e={}),n){var r=n instanceof fo?n.box.floor():new Yo(n);return this.shiftBy(r.x,r.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),a=o.minBoxPadding;return o.useDlibAlignment?this.alignDlib():this.alignMinBbox(a)},t.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),r=n[1],o=n[2],i=function(d){return o.sub(d).magnitude()},a=(i(n[0])+i(r))/2,s=Math.floor(a/.45),u=Cy(n),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new Ey(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},t.prototype.alignMinBbox=function(n){var e=function B8(t){var n=t.map(function(s){return s.x}),e=t.map(function(s){return s.y}),r=n.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return s<u?u:s},0),a=e.reduce(function(s,u){return s<u?u:s},0);return new Nf(r,o,i,a)}(this.positions);return e.pad(e.width*n,e.height*n)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),z8=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Cy([e[3],e[4]])]},n}(Ff),SM=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Cy)},n}(Ff),IM=function(){function t(n,e){this._label=n,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(n){return void 0===n&&(n=!0),this.label+(n?" ("+function F8(t,n){void 0===n&&(n=2);var e=Math.pow(10,n);return Math.floor(t*e)/e}(this.distance)+")":"")},t}(),MM=function(t){function n(e,r){var o=t.call(this,e)||this;return o._label=r,o}return _e(n,t),n.assertIsValidLabeledBox=function(e,r){if(Yo.assertIsValidBox(e,r),!ya(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(Yo),Lf=function(){function t(n,e){if("string"!=typeof n)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},t.fromJSON=function(n){var e=n.descriptors.map(function(r){return new Float32Array(r)});return new t(n.label,e)},t}();function Sy(t,n){return Object.assign({},t,{detection:n})}function RM(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function TM(t){var n="";if(!t)try{t=zs(Object(function(){var o=new Error("Cannot find module 'fs'");throw o.code="MODULE_NOT_FOUND",o}()))}catch(r){n=r.toString()}return{readFile:t?function(r){return new Promise(function(o,i){t.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)}}}function AM(){var t=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=TM();return wn({Canvas:t||function a(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function a(){},Image:n||function a(){},ImageData:global.ImageData||function a(){},Video:global.HTMLVideoElement||function a(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},i)}function kM(){return"object"==typeof window&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function PM(){return"object"==typeof global&&typeof process<"u"&&!!process.version}function Iy(t){qt=t}function My(){kM()&&Iy(RM()),PM()&&Iy(AM())}!function(t){function n(e,r,o,i){var a=t.call(this,e,r)||this;return a._score=o,a._classScore=i,a}_e(n,t),n.assertIsValidPredictedBox=function(e,r){if(MM.assertIsValidLabeledBox(e,r),!DM(e.score)||!DM(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(MM);var un={getEnv:function G8(){if(!qt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return qt},setEnv:Iy,initialize:My,createBrowserEnv:RM,createFileSystem:TM,createNodejsEnv:AM,monkeyPatch:function q8(t){if(qt||My(),!qt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=t.Canvas,e=void 0===n?qt.Canvas:n,r=t.Image,o=void 0===r?qt.Image:r;qt.Canvas=e,qt.Image=o,qt.createCanvasElement=t.createCanvasElement||function(){return new e},qt.createImageElement=t.createImageElement||function(){return new o},qt.ImageData=t.ImageData||qt.ImageData,qt.Video=t.Video||qt.Video,qt.fetch=t.fetch||qt.fetch,qt.readFile=t.readFile||qt.readFile},isBrowser:kM,isNodejs:PM};function Ry(t){return un.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function ho(t){var n=un.getEnv(),e=n.Canvas;if(t instanceof n.CanvasRenderingContext2D)return t;var o=Ry(t);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}My();var Jo=(()=>(function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Jo||(Jo={})),Jo))(),OM=function t(n){void 0===n&&(n={});var r=n.backgroundColor,o=n.fontColor,i=n.fontSize,a=n.fontStyle,s=n.padding;this.anchorPosition=n.anchorPosition||Jo.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4};!function(){function t(n,e,r){void 0===r&&(r={}),this.text="string"==typeof n?[n]:n instanceof t?n.text:n,this.anchor=e,this.options=new OM(r)}t.prototype.measureWidth=function(n){var e=this.options.padding;return this.text.map(function(r){return n.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*e},t.prototype.measureHeight=function(){var n=this.options;return this.text.length*n.fontSize+2*n.padding},t.prototype.getUpperLeft=function(n,e){var r=this.options.anchorPosition,o=r===Jo.BOTTOM_RIGHT||r===Jo.TOP_RIGHT,i=r===Jo.BOTTOM_LEFT||r===Jo.BOTTOM_RIGHT,a=this.measureWidth(n),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(e){var d=e.height;return{x:Math.max(Math.min(u,e.width-a),0),y:Math.max(Math.min(c,d-s),0)}}return{x:u,y:c}},t.prototype.draw=function(n){var e=Ry(n),r=ho(e),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,c=o.padding;r.font=s+"px "+o.fontStyle;var l=this.measureWidth(r),d=this.measureHeight();r.fillStyle=i;var f=this.getUpperLeft(r,e);r.fillRect(f.x,f.y,l,d),r.fillStyle=a,this.text.forEach(function(h,p){r.fillText(h,c+f.x,c+f.y+(p+1)*s)})}}();function NM(t){var n=un.getEnv();return t instanceof n.Image&&t.complete||t instanceof n.Video&&t.readyState>=3}function Y8(t){return new Promise(function(n,e){if(!(t instanceof Blob))return e("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!=typeof r.result)return e("bufferToImage - expected reader.result to be a string, in onload");var o=un.getEnv().createImageElement();o.onload=function(){return n(o)},o.onerror=e,o.src=r.result},r.onerror=e,r.readAsDataURL(t)})}function FM(t){var n=un.getEnv(),r=n.Video;return t instanceof n.Image?new Bs(t.naturalWidth,t.naturalHeight):t instanceof r?new Bs(t.videoWidth,t.videoHeight):new Bs(t.width,t.height)}function Bf(t){var n=t.width,e=t.height,o=(0,un.getEnv().createCanvasElement)();return o.width=n,o.height=e,o}function Ty(t,n){var e=un.getEnv().ImageData;if(!(t instanceof e||NM(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=n||FM(t),o=r.width,i=r.height,a=Bf({width:o,height:i});return t instanceof e?ho(a).putImageData(t,0,0):ho(a).drawImage(t,0,0,o,i),a}function J8(t,n){return se(this,void 0,void 0,function(){var e,r,o,i,a,s;return ue(this,function(u){switch(u.label){case 0:return e=n||un.getEnv().createCanvasElement(),r=t.shape.slice(Ai(t)?1:0),o=r[0],i=r[1],a=r[2],s=te(function(){return t.as3D(o,i,a).toInt()}),[4,my.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function LM(t){var n=un.getEnv();return t instanceof n.Image||t instanceof n.Canvas||t instanceof n.Video}var Uf=function(){function t(n,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=e,this._batchSize=n.length,n.forEach(function(o,i){if(Of(o))return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape);if(Ai(o)){var a=o.shape[0];if(1!==a)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape.slice(1))}var s=o instanceof un.getEnv().Canvas?o:Ty(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Pc(this.batchSize,0,1).map(function(e,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},t.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},t.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},t.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},t.prototype.getReshapedInputDimensions=function(n){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function L8(t,n){var e=t.width,r=t.height,o=n/Math.max(r,e);return new Bs(Math.round(e*o),Math.round(r*o))}({width:this.getInputWidth(n),height:this.getInputHeight(n)},this.inputSize)},t.prototype.toBatchTensor=function(n,e){var r=this;return void 0===e&&(e=!0),this._inputSize=n,te(function(){var o=Pc(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof rt){var u=Ai(s)?s:s.expandDims();return u=function V8(t,n){return void 0===n&&(n=!1),te(function(){var e=t.shape.slice(1),r=e[0],o=e[1];if(r===o)return t;var i=Math.abs(r-o),a=Math.round(i*(n?.5:1)),s=r>o?2:1,u=function(h){var p=t.shape.slice();return p[s]=h,co(p,0)},c=u(a),l=i-c.shape[s],f=[n&&l?u(l):null,t,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return zt(f,s)})}(u,e),(u.shape[1]!==n||u.shape[2]!==n)&&(u=Zm.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof un.getEnv().Canvas)return my.fromPixels(function Z8(t,n,e){void 0===e&&(e=!1);var r=un.getEnv(),i=r.Canvas;if(!(t instanceof r.Image||t instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=FM(t),s=n/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Bf({width:n,height:n}),d=t instanceof i?t:Ty(t),f=Math.abs(u-c)/2,h=e&&u<c?f:0,p=e&&c<u?f:0;return ho(l).drawImage(d,h,p,u,c),l}(s,n,e));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)});return er(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,n,n,3)})},t}();function Jt(t){return se(this,void 0,void 0,function(){var n,e,r;return ue(this,function(o){switch(o.label){case 0:if(t instanceof Uf)return[2,t];if(!(n=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(t)?" at input index "+i+":":""},(r=n.map(Ry)).forEach(function(i,a){if(!LM(i)&&!Of(i)&&!Ai(i))throw"string"==typeof n[a]?new Error("toNetInput -"+e(a)+" string passed, but could not resolve HTMLElement for element id "+n[a]):new Error("toNetInput -"+e(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Ai(i)){var s=i.shape[0];if(1!==s)throw new Error("toNetInput -"+e(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return LM(i)&&function Q8(t){return new Promise(function(n,e){if(t instanceof un.getEnv().Canvas||NM(t))return n();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),e(i))}t.addEventListener("load",r),t.addEventListener("error",o)})}(i)}))];case 1:return o.sent(),[2,new Uf(r,Array.isArray(t))]}})})}function Ay(t,n){return se(this,void 0,void 0,function(){var e,r,o,i,a,s;return ue(this,function(c){switch(c.label){case 0:return e=un.getEnv().Canvas,r=t,t instanceof e?[3,5]:[4,Jt(t)];case 1:if((o=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof e?(a=i,[3,4]):[3,2];case 2:return[4,J8(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=ho(r),[2,n.map(function(l){return l instanceof fo?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}).map(function(l){var d=l.x,f=l.y,h=l.width,p=l.height,g=Bf({width:h,height:p});return ho(g).putImageData(s.getImageData(d,f,h,p),0,0),g})]}})})}function ky(t,n){return se(this,void 0,void 0,function(){return ue(this,function(e){if(!Of(t)&&!Ai(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ai(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,te(function(){var r=t.shape.slice(Ai(t)?1:0),o=r[0],i=r[1],a=r[2];return n.map(function(c){return c instanceof fo?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}).map(function(c){var l=c.x,d=c.y,f=c.width,h=c.height;return NI(t.as3D(o,i,a),[d,l,0],[h,f,a])})})]})})}function BM(t,n){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return[4,(0,un.getEnv().fetch)(t,n)];case 1:if(!((r=o.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function t$(t){return se(this,void 0,void 0,function(){return ue(this,function(n){switch(n.label){case 0:return[4,BM(t)];case 1:return[2,n.sent().json()]}})})}function UM(t,n){var e=n+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:e};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+e};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter(function(s){return s}),i=t.endsWith(".json")?o[o.length-1]:e,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function n$(t,n){return se(this,void 0,void 0,function(){var e,o,i;return ue(this,function(a){switch(a.label){case 0:return e=UM(t,n),o=e.modelBaseUri,[4,t$(e.manifestUri)];case 1:return i=a.sent(),[2,dM.loadWeights(i,o)]}})})}var Zo=function(){function t(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(n){var e=this.traversePropertyPath(n);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(n,e){var r=this.traversePropertyPath(n),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=e},t.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Cs})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Cs)})},t.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(e){n.reassignParamFromPath(e.path,e.tensor.variable())})},t.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(e){var r=e.path,o=e.tensor,i=sn(o.dataSync());o.dispose(),n.reassignParamFromPath(r,i)})},t.prototype.dispose=function(n){void 0===n&&(n=!0),this.getParamList().forEach(function(e){if(n&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){return Array.from(n.tensor.dataSync())}).reduce(function(n,e){return n.concat(e)}))},t.prototype.load=function(n){return se(this,void 0,void 0,function(){return ue(this,function(e){switch(e.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(n){return se(this,void 0,void 0,function(){var e;return ue(this,function(r){switch(r.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromUri - expected model uri");return[4,n$(n,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(n){return se(this,void 0,void 0,function(){var e,r,o,i,s,u,c,l,d;return ue(this,function(f){switch(f.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromDisk - expected model file path");return e=un.getEnv().readFile,r=UM(n,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,s=dM.weightsLoaderFactory(function(h){return Promise.all(h.map(function(p){return e(p).then(function(g){return g.buffer})}))}),l=(c=JSON).parse,[4,e(o)];case 1:return u=l.apply(c,[f.sent().toString()]),[4,s(u,i)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},t.prototype.loadFromWeightMap=function(n){var e=this.extractParamsFromWeigthMap(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},t.prototype.extractWeights=function(n){var e=this.extractParams(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},t.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=n.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+n);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=e.obj,o=e.objProp;if(!(r&&o&&r[o]instanceof rt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:o}},t}();function nr(t,n,e){return te(function(){var r=Km(t,n.depthwise_filter,n.pointwise_filter,e,"same");return Be(r,n.bias)})}function Py(t,n,e){return void 0===e&&(e=!1),te(function(){var r=yt(e?Be(vr(t,n.conv0.filters,[2,2],"same"),n.conv0.bias):nr(t,n.conv0,[2,2])),o=nr(r,n.conv1,[1,1]),a=nr(yt(Be(r,o)),n.conv2,[1,1]);return yt(Be(r,Be(o,a)))})}function Vf(t,n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),te(function(){var o=yt(e?Be(vr(t,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):nr(t,n.conv0,r?[2,2]:[1,1])),i=nr(o,n.conv1,[1,1]),s=nr(yt(Be(o,i)),n.conv2,[1,1]),c=nr(yt(Be(o,Be(i,s))),n.conv3,[1,1]);return yt(Be(o,Be(i,Be(s,c))))})}function Lr(t,n,e,r){return void 0===e&&(e="same"),void 0===r&&(r=!1),te(function(){var o=Be(vr(t,n.filters,[1,1],e),n.bias);return r?yt(o):o})}function ei(t,n){Object.keys(t).forEach(function(e){n.some(function(r){return r.originalPath===e})||t[e].dispose()})}function jf(t,n){return function(e,r,o,i){var a=Un(t(e*r*o*o),[o,o,e,r]),s=Bt(t(r));return n.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function Oy(t,n){return function(e,r,o){var i=Ei(t(e*r),[e,r]),a=Bt(t(r));return n.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var VM=function t(n,e,r){this.depthwise_filter=n,this.pointwise_filter=e,this.bias=r};function Ny(t,n){return function(e,r,o){var i=Un(t(9*e),[3,3,e,1]),a=Un(t(e*r),[1,1,e,r]),s=Bt(t(r));return n.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new VM(i,a,s)}}function Fy(t){return function(n){var e=t(n+"/depthwise_filter",4),r=t(n+"/pointwise_filter",4),o=t(n+"/bias",1);return new VM(e,r,o)}}function ki(t,n){return function(e,r,o){var i=t[e];if(!kc(i,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+i);return n.push({originalPath:e,paramPath:o||e}),i}}function ti(t){var n=t;return{extractWeights:function e(o){var i=n.slice(0,o);return n=n.slice(o),i},getRemainingWeights:function r(){return n}}}function jM(t,n){var e=jf(t,n),r=Ny(t,n);function o(a,s,u,c){return void 0===c&&(c=!1),{conv0:c?e(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),conv1:r(s,s,u+"/conv1"),conv2:r(s,s,u+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function i(a,s,u,c){void 0===c&&(c=!1);var l=o(a,s,u,c);return{conv0:l.conv0,conv1:l.conv1,conv2:l.conv2,conv3:r(s,s,u+"/conv3")}}}}function HM(t){return function(n){return{filters:t(n+"/filters",4),bias:t(n+"/bias",1)}}}function WM(t,n){var e=ki(t,n),r=HM(e),o=Fy(e);return{extractDenseBlock3Params:function i(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2")}},extractDenseBlock4Params:function a(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2"),conv3:o(s+"/conv3")}}}}var zM=function(t){function n(){return t.call(this,"FaceFeatureExtractor")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return te(function(){var s=Vf(Nc(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Y(255)),r.dense0,!0);return s=Vf(s,r.dense1),s=Vf(s,r.dense2),s=Vf(s,r.dense3),Rc(s,[7,7],[2,2],"valid")})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function o$(t){var n=[],e=WM(t,n).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return ei(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function r$(t){var n=[],e=ti(t),o=e.getRemainingWeights,i=jM(e.extractWeights,n).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(e)},n}(Zo);function po(t,n){return te(function(){return Be(If(t,n.weights),n.bias)})}function $M(t){var n={},e={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?e:n)[r]=t[r]}),{featureExtractorMap:n,classifierMap:e}}var GM=function(t){function n(e,r){var o=t.call(this,e)||this;return o._faceFeatureExtractor=r,o}return _e(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return te(function(){var i=e instanceof Uf?r.faceFeatureExtractor.forwardInput(e):e;return po(i.as2D(i.shape[0],-1),o.fc)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return function i$(t,n,e){var r=[],o=ti(t),a=o.getRemainingWeights,u=Oy(o.extractWeights,r)(n,e,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(e){var r=$M(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function a$(t){var n=[],e=ki(t,n),o={fc:function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}("fc")};return ei(t,n),{params:o,paramMappings:n}}(i)},n.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=e.slice(0,e.length-i),s=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},n}(Zo),qM=["neutral","happy","sad","angry","fearful","disgusted","surprised"],s$=function(){function t(n){var e=this;if(7!==n.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);qM.forEach(function(r,o){e[r]=n[o]})}return t.prototype.asSortedArray=function(){var n=this;return qM.map(function(e){return{expression:e,probability:n[e]}}).sort(function(e,r){return r.probability-e.probability})},t}(),u$=function(t){function n(e){return void 0===e&&(e=new zM),t.call(this,"FaceExpressionNet",e)||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this;return te(function(){return Go(r.runNet(e))})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictExpressions=function(e){return se(this,void 0,void 0,function(){var r,o,i,a,s=this;return ue(this,function(u){switch(u.label){case 0:return[4,Jt(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all($t(o).map(function(c){return se(s,void 0,void 0,function(){var l;return ue(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new s$(c)}),[2,r.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(GM);function KM(t,n){return Object.assign({},t,{expressions:n})}function Ly(t,n){var e=t.detection.box,r=n.shiftBy(e.x,e.y),o=r.align(),i=t.detection.imageDims,a=new fo(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:r,unshiftedLandmarks:n,alignedRect:a})}function XM(t,n,e){return Be(vr(t,n.filters,e,"same"),n.bias)}function By(t,n,e){void 0===e&&(e=!0);var r=e?yt(t):t;return r=nr(r,n.separable_conv0,[1,1]),r=nr(yt(r),n.separable_conv1,[1,1]),r=Yt(r,[3,3],[2,2],"same"),Be(r,XM(t,n.expansion_conv,[2,2]))}var m$=function(t){function n(e){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return _e(n,t),n.prototype.forwardInput=function(e){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return te(function(){var s=Nc(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Y(256)),u=yt(XM(s,o.entry_flow.conv_in,[2,2]));return u=By(u,o.entry_flow.reduction_block_0,!1),u=By(u,o.entry_flow.reduction_block_1),Pc(r._numMainBlocks,0,1).forEach(function(c){u=function v$(t,n){var e=nr(yt(t),n.separable_conv0,[1,1]);return e=nr(yt(e),n.separable_conv1,[1,1]),e=nr(yt(e),n.separable_conv2,[1,1]),Be(e,t)}(u,o.middle_flow["main_block_"+c])}),u=By(u,o.exit_flow.reduction_block),u=yt(nr(u,o.exit_flow.separable_conv,[1,1]))})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function g$(t,n){var e=[],r=function p$(t,n){var e=ki(t,n),r=HM(e),o=Fy(e);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function i(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),expansion_conv:r(s+"/expansion_conv")}},extractMainBlockParams:function a(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),separable_conv2:o(s+"/separable_conv2")}}}}(t,e),i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,d={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},f={};Pc(n,0,1).forEach(function(v){f["main_block_"+v]=s("middle_flow/main_block_"+v)});var g={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return ei(t,e),{params:{entry_flow:d,middle_flow:f,exit_flow:g},paramMappings:e}}(e,this._numMainBlocks)},n.prototype.extractParams=function(e){return function h$(t,n){var e=[],r=ti(t),i=r.getRemainingWeights,a=function f$(t,n){var e=jf(t,n),r=Ny(t,n);return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:function o(a,s,u){return{separable_conv0:r(a,s,u+"/separable_conv0"),separable_conv1:r(s,s,u+"/separable_conv1"),expansion_conv:e(a,s,1,u+"/expansion_conv")}},extractMainBlockParams:function i(a,s){return{separable_conv0:r(a,a,s+"/separable_conv0"),separable_conv1:r(a,a,s+"/separable_conv1"),separable_conv2:r(a,a,s+"/separable_conv2")}}}}(r.extractWeights,e),u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,p={conv_in:(0,a.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},g={};Pc(n,0,1).forEach(function(y){g["main_block_"+y]=l(128,"middle_flow/main_block_"+y)});var b={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:g,exit_flow:b}}}(e,this._numMainBlocks)},n}(Zo),Fc=(()=>(function(t){t.FEMALE="female",t.MALE="male"}(Fc||(Fc={})),Fc))(),w$=function(t){function n(e){void 0===e&&(e=new m$(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return _e(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return te(function(){var i=e instanceof Uf?r.faceFeatureExtractor.forwardInput(e):e,a=Rc(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1);return{age:po(a,o.fc.age).as1D(),gender:po(a,o.fc.gender)}})},n.prototype.forwardInput=function(e){var r=this;return te(function(){var o=r.runNet(e);return{age:o.age,gender:Go(o.gender)}})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictAgeAndGender=function(e){return se(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return ue(this,function(l){switch(l.label){case 0:return[4,Jt(e)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=$t(o.age),a=$t(o.gender),s=i.map(function(d,f){return{ageTensor:d,genderTensor:a[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,h=d.genderTensor;return se(c,void 0,void 0,function(){var p,g,v,m,b;return ue(this,function(y){switch(y.label){case 0:return[4,f.data()];case 1:return p=y.sent()[0],[4,h.data()];case 2:return g=y.sent()[0],m=(v=g>.5)?Fc.MALE:Fc.FEMALE,b=v?g:1-g,f.dispose(),h.dispose(),[2,{age:p,gender:m,genderProbability:b}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return function y$(t){var n=[],e=ti(t),o=e.getRemainingWeights,i=Oy(e.extractWeights,n),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:{age:a,gender:s}}}}(e)},n.prototype.extractParamsFromWeigthMap=function(e){var r=$M(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function b$(t){var n=[],e=ki(t,n);function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return ei(t,n),{params:o,paramMappings:n}}(i)},n.prototype.extractParams=function(e){var o=e.slice(0,e.length-1539),i=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},n}(Zo),QM=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.postProcess=function(e,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return te(function(){var s=function(f,h){return er([co([68],f),co([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=i[f],g=p.width,v=p.height;return h(g,v)?Math.abs(g-v)/2:0};return e.mul(co([a,136],r)).sub(er(Array.from(Array(a),function(f,h){return s(function(f){return u(f,function(h,p){return h<p})}(h),function(f){return u(f,function(h,p){return p<h})}(h))}))).div(er(Array.from(Array(a),function(f,h){return s(i[h].width,i[h].height)})))})},n.prototype.forwardInput=function(e){var r=this;return te(function(){var o=r.runNet(e);return r.postProcess(o,e.inputSize,e.inputDimensions.map(function(i){return{height:i[0],width:i[1]}}))})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.detectLandmarks=function(e){return se(this,void 0,void 0,function(){var r,o,i,a=this;return ue(this,function(s){switch(s.label){case 0:return[4,Jt(e)];case 1:return r=s.sent(),o=te(function(){return $t(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return se(a,void 0,void 0,function(){var l,d,f,h,p;return ue(this,function(g){switch(g.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return l=f.apply(d,[g.sent()]),h=l.filter(function(v,m){return _M(m)}),p=l.filter(function(v,m){return!_M(m)}),[2,new SM(Array(68).fill(0).map(function(v,m){return new Xe(h[m],p[m])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(GM),YM=function(t){function n(e){return void 0===e&&(e=new zM),t.call(this,"FaceLandmark68Net",e)||this}return _e(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(QM),C$=function(t){function n(){return t.call(this,"TinyFaceFeatureExtractor")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return te(function(){var s=Py(Nc(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Y(255)),r.dense0,!0);return s=Py(s,r.dense1),s=Py(s,r.dense2),Rc(s,[14,14],[2,2],"valid")})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function x$(t){var n=[],e=WM(t,n).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return ei(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function _$(t){var n=[],e=ti(t),o=e.getRemainingWeights,i=jM(e.extractWeights,n).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u}}}(e)},n}(Zo),D$=function(t){function n(e){return void 0===e&&(e=new C$),t.call(this,"FaceLandmark68TinyNet",e)||this}return _e(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(QM);function Uy(t,n,e,r,o){void 0===o&&(o="same");var i=n.conv,s=i.bias,u=vr(t,i.filters,e,o);return u=function E$(t,n){return Be(yn(t,n.weights),n.biases)}(u=Be(u,s),n.scale),r?yt(u):u}function JM(t,n){return Uy(t,n,[1,1],!1)}function ZM(t,n){return Uy(t,n,[2,2],!0,"valid")}function I$(t,n){function i(s,u,c,l){var d=function r(s,u,c,l){var d=function e(s,u,c){var l=t(s),d=l.length/(u*c*c);if(function N8(t){return t%1!=0}(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return te(function(){return Ii(Un(l,[u,d,c,c]),[2,3,1,0])})}(s,u,c),f=Bt(t(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:f}}(s,u,c,l+"/conv"),f=function o(s,u){var c=Bt(t(s)),l=Bt(t(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}(u,l+"/scale");return{conv:d,scale:f}}return{extractConvLayerParams:i,extractResidualLayerParams:function a(s,u,c,l,d){return void 0===d&&(d=!1),{conv1:i((d?.5:1)*s,u,c,l+"/conv1"),conv2:i(s,u,c,l+"/conv2")}}}}function T$(t){var n=[],e=function R$(t,n){var e=ki(t,n);function o(a){var s=e(a+"/conv/filters",4),u=e(a+"/conv/bias",1),c=function r(a){return{weights:e(a+"/scale/weights",1),biases:e(a+"/scale/biases",1)}}(a);return{conv:{filters:s,bias:u},scale:c}}return{extractConvLayerParams:o,extractResidualLayerParams:function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}}}(t,n),o=e.extractResidualLayerParams,i=(0,e.extractConvLayerParams)("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),g=o("conv128_2"),v=o("conv256_down"),m=o("conv256_1"),b=o("conv256_2"),y=o("conv256_down_out"),w=t.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!function O8(t){return kc(t,2)}(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:g,conv256_down:v,conv256_1:m,conv256_2:b,conv256_down_out:y,fc:w};return ei(t,n),{params:x,paramMappings:n}}function go(t,n){var e=function S$(t,n){return Uy(t,n,[1,1],!0)}(t,n.conv1);return e=JM(e,n.conv2),e=Be(e,t),yt(e)}function Hf(t,n){var e=ZM(t,n.conv1);e=JM(e,n.conv2);var r=Rc(t,2,2,"valid"),o=ft(r.shape),i=r.shape[3]!==e.shape[3];if(r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2]){var s=Ac(e.shape);s[1]=1;var u=ft(s),c=Ac((e=zt([e,u],1)).shape);c[2]=1;var l=ft(c);e=zt([e,l],2)}return r=i?zt([r,o],3):r,e=Be(r,e),yt(e)}!function(t){_e(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(YM);var A$=function(t){function n(){return t.call(this,"FaceRecognitionNet")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return te(function(){var s=ZM(Nc(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Y(256)),r.conv32_down);s=go(s=Yt(s,3,2,"valid"),r.conv32_1),s=go(s,r.conv32_2),s=go(s,r.conv32_3),s=go(s=Hf(s,r.conv64_down),r.conv64_1),s=go(s,r.conv64_2),s=go(s,r.conv64_3),s=go(s=Hf(s,r.conv128_down),r.conv128_1),s=go(s,r.conv128_2),s=go(s=Hf(s,r.conv256_down),r.conv256_1);var u=(s=Hf(s=go(s,r.conv256_2),r.conv256_down_out)).mean([1,2]);return If(u,r.fc)})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.computeFaceDescriptor=function(e){return se(this,void 0,void 0,function(){var r,o,i,a=this;return ue(this,function(s){switch(s.label){case 0:return[4,Jt(e)];case 1:return r=s.sent(),o=te(function(){return $t(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(e){return T$(e)},n.prototype.extractParams=function(e){return function M$(t){var n=ti(t),e=n.extractWeights,r=n.getRemainingWeights,o=[],i=I$(e,o),s=i.extractResidualLayerParams,u=(0,i.extractConvLayerParams)(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),m=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),M=te(function(){return Ii(Ei(e(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:g,conv128_down:v,conv128_1:m,conv128_2:b,conv256_down:y,conv256_1:w,conv256_2:x,conv256_down_out:_,fc:M},paramMappings:o}}(e)},n}(Zo);function eR(t,n,e){return Object.assign({},t,{gender:n,genderProbability:e})}var tR=function(){function t(n){var e=void 0===n?{}:n,r=e.minFaceSize,o=e.scaleFactor,i=e.maxNumScales,a=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function vo(t,n,e){return te(function(){var r=vr(t,n.filters,e,"same");return r=Be(r,n.batch_norm_offset),Hm(r,0,6)})}var F$=.0010000000474974513;function j$(t,n,e){var r=t.arraySync(),o=Math.min(r[n][0],r[n][2]),i=Math.min(r[n][1],r[n][3]),a=Math.max(r[n][0],r[n][2]),s=Math.max(r[n][1],r[n][3]),u=Math.min(r[e][0],r[e][2]),c=Math.min(r[e][1],r[e][3]),l=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),f=(a-o)*(s-i),h=(l-u)*(d-c);if(f<=0||h<=0)return 0;var p=Math.max(o,u),g=Math.max(i,c),v=Math.min(a,l),m=Math.min(s,d),b=Math.max(v-p,0)*Math.max(m-g,0);return b/(f+h-b)}function Us(t,n){return te(function(){var e=t.shape[0];return{boxPredictionEncoding:Or(Lr(t,n.box_encoding_predictor),[e,-1,1,4]),classPrediction:Or(Lr(t,n.class_predictor),[e,-1,3])}})}var Wf=function(){function t(n){var e=void 0===n?{}:n,r=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),nR=function(t){function n(){return t.call(this,"SsdMobilenetv1")||this}return _e(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return te(function(){var o=e.toBatchTensor(512,!1).toFloat(),a=function U$(t,n){return te(function(){var e=null,r=vo(t,n.conv_0,[2,2]);if([n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13].forEach(function(i,a){var s=a+1,u=function B$(t){return[2,4,6,12].some(function(n){return n===t})?[2,2]:[1,1]}(s);r=function L$(t,n,e){return te(function(){var r=Sf(t,n.filters,e,"same");return r=yI(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,F$),Hm(r,0,6)})}(r,i.depthwise_conv,u),r=vo(r,i.pointwise_conv,[1,1]),11===s&&(e=r)}),null===e)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}(Gt(yn(o,Y(.007843137718737125)),Y(1)),r.mobilenetv1),s=function $$(t,n,e){return te(function(){var r=vo(t,e.conv_0,[1,1]),o=vo(r,e.conv_1,[2,2]),i=vo(o,e.conv_2,[1,1]),a=vo(i,e.conv_3,[2,2]),s=vo(a,e.conv_4,[1,1]),u=vo(s,e.conv_5,[2,2]),c=vo(u,e.conv_6,[1,1]),l=vo(c,e.conv_7,[2,2]),d=Us(n,e.box_predictor_0),f=Us(t,e.box_predictor_1),h=Us(o,e.box_predictor_2),p=Us(a,e.box_predictor_3),g=Us(u,e.box_predictor_4),v=Us(l,e.box_predictor_5);return{boxPredictions:zt([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:zt([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,v.classPrediction],1)}})}(a.out,a.conv11,r.prediction_layer);return function z$(t,n,e){return te(function(){var r=t.shape[0],o=function W$(t,n){var e=function H$(t){var n=$t(Ii(t,[1,0])),e=[Gt(n[2],n[0]),Gt(n[3],n[1])];return{sizes:e,centers:[Be(n[0],Fr(e[0],Y(2))),Be(n[1],Fr(e[1],Y(2)))]}}(t),r=e.sizes,o=e.centers,i=$t(Ii(n,[1,0])),a=Fr(yn(Wm(Fr(i[2],Y(5))),r[0]),Y(2)),s=Be(yn(Fr(i[0],Y(10)),r[0]),o[0]),u=Fr(yn(Wm(Fr(i[3],Y(5))),r[1]),Y(2)),c=Be(yn(Fr(i[1],Y(10)),r[1]),o[1]);return Ii(er([Gt(s,a),Gt(c,u),Be(s,a),Be(c,u)]),[1,0])}(Or(Es(e.extra_dim,[r,1,1]),[-1,4]),Or(t,[-1,4]));o=Or(o,[r,o.shape[0]/r,4]);var i=pI(lo(n,[0,0,1],[-1,-1,-1])),a=lo(i,[0,0,0],[-1,-1,1]);return a=Or(a,[r,a.shape[1]]),{boxes:$t(o),scores:$t(a)}})}(s.boxPredictions,s.classPredictions,r.output_layer)})},n.prototype.forward=function(e){return se(this,void 0,void 0,function(){var r;return ue(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Jt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.locateFaces=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,v,b,y,w,x,_,M,I;return ue(this,function(E){switch(E.label){case 0:return o=new Wf(r),i=o.maxResults,a=o.minConfidence,[4,Jt(e)];case 1:for(s=E.sent(),u=this.forwardInput(s),d=(c=u.boxes)[0],f=(l=u.scores)[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return v=(g=Array).from,[4,f.data()];case 2:return p=v.apply(g,[E.sent()]),b=function V$(t,n,e,r,o){var a=Math.min(e,t.shape[0]),s=n.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>o}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var d=l.score,f=c.length-1;f>=0;--f){var h=j$(t,l.boxIndex,c[f]);if(0!==h&&(l.score*=u(h),l.score<=o))break}d===l.score&&c.push(l.boxIndex)}}),c}(d,p,i,.5,a),y=s.getReshapedInputDimensions(0),x=(w=s.inputSize)/y.width,_=w/y.height,M=d.arraySync(),I=b.map(function(S){var k=[Math.max(0,M[S][0]),Math.min(1,M[S][2])].map(function(H){return H*_}),A=k[0],U=k[1],B=[Math.max(0,M[S][1]),Math.min(1,M[S][3])].map(function(H){return H*x}),N=B[0];return new fo(p[S],new Ey(N,A,B[1]-N,U-A),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,I]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function N$(t){var n=[],e=function O$(t,n){var e=ki(t,n);function r(c,l,d){return{filters:e(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:e(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function o(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=l+"/depthwise_conv",h=l+"/pointwise_conv";return{depthwise_conv:{filters:e(d+"/depthwise_weights",4,f+"/filters"),batch_norm_scale:e(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),batch_norm_offset:e(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),batch_norm_mean:e(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),batch_norm_variance:e(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",c,h)}}function a(c,l){return{filters:e(c+"/weights",4,l+"/filters"),bias:e(c+"/biases",1,l+"/bias")}}function s(c){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}(t,n),r=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,i=t["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Of(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return ei(t,n),{params:a,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function P$(t){var n=[],e=ti(t),r=e.extractWeights,o=e.getRemainingWeights,i=function k$(t,n){function r(u,c,l,d,f){var h=Un(t(u*c*l*l),[l,l,u,c]),p=Bt(t(c));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,c,l,d){var f=r(u,c,l,d,!0);return{filters:f.filters,batch_norm_offset:f.bias}}function i(u,c,l){var d=function e(u,c){var l=Un(t(9*u),[3,3,u,1]),d=Bt(t(u)),f=Bt(t(u)),h=Bt(t(u)),p=Bt(t(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}(u,l+"/depthwise_conv");return{depthwise_conv:d,pointwise_conv:o(u,c,1,l+"/pointwise_conv")}}return{extractMobilenetV1Params:function a(){return{conv_0:o(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function s(){return{conv_0:o(1024,256,1,"prediction_layer/conv_0"),conv_1:o(256,512,3,"prediction_layer/conv_1"),conv_2:o(512,128,1,"prediction_layer/conv_2"),conv_3:o(128,256,3,"prediction_layer/conv_3"),conv_4:o(256,128,1,"prediction_layer/conv_4"),conv_5:o(128,256,3,"prediction_layer/conv_5"),conv_6:o(256,64,1,"prediction_layer/conv_6"),conv_7:o(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,n),s=i.extractPredictionLayerParams,u=(0,i.extractMobilenetV1Params)(),c=s(),d={extra_dim:vm(r(20472),[1,5118,4])};if(n.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:n}}(e)},n}(Zo);!function(t){_e(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(nR);var q$=.4,K$=[new Xe(.738768,.874946),new Xe(2.42204,2.65704),new Xe(4.30971,7.04493),new Xe(10.246,4.59428),new Xe(12.6868,11.8741)],X$=[new Xe(1.603231,2.094468),new Xe(6.041143,7.080126),new Xe(2.882459,3.518061),new Xe(4.266906,5.178857),new Xe(9.041765,10.66308)],Q$=[117.001,114.697,97.404],zf=function(t){return"number"==typeof t};function Vy(t){return te(function(){var n=yn(t,Y(.10000000149011612));return Be(yt(Gt(t,n)),n)})}function Pi(t,n){return te(function(){var e=la(t,[[0,0],[1,1],[1,1],[0,0]]);return e=vr(e,n.conv.filters,[1,1],"valid"),e=Gt(e,n.bn.sub),e=yn(e,n.bn.truediv),Vy(e=Be(e,n.conv.bias))})}function Oi(t,n){return te(function(){var e=la(t,[[0,0],[1,1],[1,1],[0,0]]);return e=Km(e,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),Vy(e=Be(e,n.bias))})}var jy=function(){function t(n){var e=void 0===n?{}:n,r=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),rR=function(t){function n(e){var r=t.call(this,"TinyYolov2")||this;return function Z$(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!zf(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(n){return"string"==typeof n}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(n){return n||{}}).every(function(n){return zf(n.x)&&zf(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(zf)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),r._config=e,r}return _e(n,t),Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(e,r){var o=Pi(e,r.conv0);return o=Pi(o=Yt(o,[2,2],[2,2],"same"),r.conv1),o=Pi(o=Yt(o,[2,2],[2,2],"same"),r.conv2),o=Pi(o=Yt(o,[2,2],[2,2],"same"),r.conv3),o=Pi(o=Yt(o,[2,2],[2,2],"same"),r.conv4),o=Pi(o=Yt(o,[2,2],[2,2],"same"),r.conv5),o=Pi(o=Yt(o,[2,2],[1,1],"same"),r.conv6),Lr(o=Pi(o,r.conv7),r.conv8,"valid",!1)},n.prototype.runMobilenet=function(e,r){var o=this.config.isFirstLayerConv2d?Vy(Lr(e,r.conv0,"valid",!1)):Oi(e,r.conv0);return o=Oi(o=Yt(o,[2,2],[2,2],"same"),r.conv1),o=Oi(o=Yt(o,[2,2],[2,2],"same"),r.conv2),o=Oi(o=Yt(o,[2,2],[2,2],"same"),r.conv3),o=Oi(o=Yt(o,[2,2],[2,2],"same"),r.conv4),o=Oi(o=Yt(o,[2,2],[2,2],"same"),r.conv5),o=Yt(o,[2,2],[1,1],"same"),o=r.conv6?Oi(o,r.conv6):o,Lr(o=r.conv7?Oi(o,r.conv7):o,r.conv8,"valid",!1)},n.prototype.forwardInput=function(e,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return te(function(){var a=e.toBatchTensor(r,!1).toFloat();return a=(a=o.config.meanRgb?Nc(a,o.config.meanRgb):a).div(Y(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},n.prototype.forward=function(e,r){return se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Jt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},n.prototype.detect=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,b=this;return ue(this,function(y){switch(y.label){case 0:return o=new jy(r),i=o.inputSize,a=o.scoreThreshold,[4,Jt(e)];case 1:return s=y.sent(),[4,this.forwardInput(s,i)];case 2:return u=y.sent(),c=te(function(){return $t(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return d=y.sent(),u.dispose(),c.dispose(),f=d.map(function(w){return w.box}),h=d.map(function(w){return w.score}),p=d.map(function(w){return w.classScore}),g=d.map(function(w){return b.config.classes[w.label]}),[2,Oc(f.map(function(w){return w.rescale(i)}),h,this.config.iouThreshold,!0).map(function(w){return new EM(h[w],p[w],g[w],f[w],l)})]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(e){return function rG(t,n){var s,e=[],r=function nG(t,n){var e=ki(t,n);function o(s){return{filters:e(s+"/filters",4),bias:e(s+"/bias",1)}}return{extractConvParams:o,extractConvWithBatchNormParams:function i(s){var u=o(s+"/conv"),c=function r(s){return{sub:e(s+"/sub",1),truediv:e(s+"/truediv",1)}}(s+"/bn");return{conv:u,bn:c}},extractSeparableConvParams:Fy(e)}}(t,e),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return ei(t,e),{params:s,paramMappings:e}}(e,this.config)},n.prototype.extractParams=function(e){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(7!==o&&8!==o&&9!==o)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return function tG(t,n,e,r){var f,o=ti(t),a=o.getRemainingWeights,s=[],u=function eG(t,n){var e=jf(t,n),i=Ny(t,n);return{extractConvParams:e,extractConvWithBatchNormParams:function o(a,s,u){var c=e(a,s,3,u+"/conv"),l=function r(a,s){var u=Bt(t(a)),c=Bt(t(a));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}(s,u+"/bn");return{conv:c,bn:l}},extractSeparableConvParams:i}}(o.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(n.withSeparableConvs){var h=r[0],p=r[1],g=r[2],v=r[3],m=r[4],b=r[5],y=r[6],w=r[7],x=r[8];f={conv0:n.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,g,"conv1"),conv2:d(g,v,"conv2"),conv3:d(v,m,"conv3"),conv4:d(m,b,"conv4"),conv5:d(b,y,"conv5"),conv6:w?d(y,w,"conv6"):void 0,conv7:x?d(w,x,"conv7"):void 0,conv8:c(x||w||y,5*e,1,"conv8")}}else g=r[2],v=r[3],m=r[4],b=r[5],y=r[6],w=r[7],x=r[8],f={conv0:l(h=r[0],p=r[1],"conv0"),conv1:l(p,g,"conv1"),conv2:l(g,v,"conv2"),conv3:l(v,m,"conv3"),conv4:l(m,b,"conv4"),conv5:l(b,y,"conv5"),conv6:l(y,w,"conv6"),conv7:l(w,x,"conv7"),conv8:c(x,5*e,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}(e,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(e,r,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,v,m,b,y,w,x,_,M,I,E,S,k,A,U,B,N,W,H,j=this;return ue(this,function(q){switch(q.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=e.shape[1],d=this.config.anchors.length,f=te(function(){var K=e.reshape([l,l,d,j.boxEncodingSize]);return[K.slice([0,0,0,0],[l,l,d,4]),K.slice([0,0,0,4],[l,l,d,1]),j.withClassScores?Go(K.slice([0,0,0,5],[l,l,d,j.config.classes.length]),3):Y(0)]}),h=f[0],g=f[2],v=[],[4,(p=f[1]).array()];case 1:return m=q.sent(),[4,h.array()];case 2:b=q.sent(),y=0,q.label=3;case 3:if(!(y<l))return[3,12];w=0,q.label=4;case 4:if(!(w<l))return[3,11];x=0,q.label=5;case 5:return x<d?(_=Dy(m[y][w][x][0]),!o||_>o?(M=(w+Dy(b[y][w][x][0]))/l*u,I=(y+Dy(b[y][w][x][1]))/l*c,E=Math.exp(b[y][w][x][2])*this.config.anchors[x].x/l*u,S=Math.exp(b[y][w][x][3])*this.config.anchors[x].y/l*c,k=M-E/2,A=I-S/2,U={row:y,col:w,anchor:x},this.withClassScores?[4,this.extractPredictedClass(g,U)]:[3,7]):[3,9]):[3,10];case 6:return H=q.sent(),[3,8];case 7:H={classScore:1,label:0},q.label=8;case 8:N=(B=H).classScore,W=B.label,v.push(wn({box:new Nf(k,A,k+E,A+S),score:_,classScore:_*N,label:W},U)),q.label=9;case 9:return x++,[3,5];case 10:return w++,[3,4];case 11:return y++,[3,3];case 12:return h.dispose(),p.dispose(),g.dispose(),[2,v]}})})},n.prototype.extractPredictedClass=function(e,r){return se(this,void 0,void 0,function(){var o,i,a,s;return ue(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(Zo),oG=function(t){function n(e){void 0===e&&(e=!0);var o=Object.assign({},{withSeparableConvs:e,iouThreshold:q$,classes:["face"]},e?{anchors:X$,meanRgb:Q$}:{anchors:K$,withClassScores:!0});return t.call(this,o)||this}return _e(n,t),Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return se(this,void 0,void 0,function(){return ue(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new fo(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(rR),iG=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return _e(n,t),n}(jy),Lc=function(){function t(){}return t.prototype.then=function(n){return se(this,void 0,void 0,function(){var e;return ue(this,function(r){switch(r.label){case 0:return e=n,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return se(this,void 0,void 0,function(){return ue(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},t}();function oR(t,n){return Object.assign({},t,{descriptor:n})}function $f(t,n,e,r,o){return void 0===o&&(o=function(i){return i.alignedRect}),se(this,void 0,void 0,function(){var i,a,s,u,c;return ue(this,function(l){switch(l.label){case 0:return i=t.map(function(d){return function c$(t){return function $8(t){return t.detection instanceof fo}(t)&&t.landmarks instanceof Ff&&t.unshiftedLandmarks instanceof Ff&&t.alignedRect instanceof fo}(d)?o(d):d.detection}),(s=r)?[3,5]:n instanceof rt?[4,ky(n,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Ay(n,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,e(a=s)];case 6:return c=l.sent(),a.forEach(function(d){return d instanceof rt&&d.dispose()}),[2,c]}})})}function Hy(t,n,e,r,o){return se(this,void 0,void 0,function(){var i=this;return ue(this,function(a){return[2,$f([t],n,function(s){return se(i,void 0,void 0,function(){return ue(this,function(u){return[2,e(s[0])]})})},r,o)]})})}var Gf=2,qf=12;function Wy(t,n){var r=n[1];return{height:Math.floor(n[0]*t),width:Math.floor(r*t)}}var zy=function(t){function n(e,r,o,i){return t.call(this,{left:e,top:r,right:o,bottom:i},!0)||this}return _e(n,t),n}(Yo);function iR(t){return te(function(){return yn(Gt(t,Y(127.5)),Y(.0078125))})}function Vs(t,n){return te(function(){return Be(yt(t),yn(n,xf(yt(xf(t)))))})}function $y(t,n,e){return void 0===e&&(e=!1),te(function(){var r=Lr(t,n.conv1,"valid");return r=Vs(r,n.prelu1_alpha),r=Vs(r=Lr(r=Yt(r,e?[2,2]:[3,3],[2,2],"same"),n.conv2,"valid"),n.prelu2_alpha),Vs(r=Lr(r=e?r:Yt(r,[3,3],[2,2],"valid"),n.conv3,"valid"),n.prelu3_alpha)})}function gG(t,n,e,r,o){o.stage1=[];var i=n.map(function(f){return te(function(){var h={scale:f},p=function hG(t,n){return te(function(){var e=Wy(n,t.shape.slice(1)),a=iR(Zm.resizeBilinear(t,[e.height,e.width]));return Ii(a,[0,2,1,3])})}(t,f),g=Date.now(),v=function fG(t,n){return te(function(){var e=$y(t,n,!0),r=Lr(e,n.conv4_1,"valid"),o=gr(Mf(r,3),3);return{prob:Go(Gt(r,o),3),regions:Lr(e,n.conv4_2,"valid")}})}(p,r),m=v.prob,b=v.regions;return h.pnet=Date.now()-g,{scoresTensor:$t($t(m,3)[1])[0],regionsTensor:$t(b)[0],scale:f,statsForScale:h}})}),a=i.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,v=f.statsForScale,m=function pG(t,n,e,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=r&&o.push(new Xe(s,a));return o.map(function(c){var l=new Nf(Math.round((c.y*Gf+1)/e),Math.round((c.x*Gf+1)/e),Math.round((c.y*Gf+qf)/e),Math.round((c.x*Gf+qf)/e)),d=i[c.y][c.x],f=n.arraySync();return{cell:l,score:d,region:new zy(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3])}})}(h,p,f.scale,e);if(h.dispose(),p.dispose(),!m.length)return o.stage1.push(v),[];var b=Date.now(),y=Oc(m.map(function(w){return w.cell}),m.map(function(w){return w.score}),.5);return v.nms=Date.now()-b,v.numBoxes=y.length,o.stage1.push(v),y.map(function(w){return m[w]})}),s=a.reduce(function(f,h){return f.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),d=Oc(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-l,c=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var h=f.cell,p=f.region;return new Nf(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function aR(t,n,e){var r=e.width,o=e.height;return se(this,void 0,void 0,function(){var i,a,s,u=this;return ue(this,function(c){switch(c.label){case 0:return i=ho(t),[4,Promise.all(n.map(function(l){return se(u,void 0,void 0,function(){var d,v,m,b;return ue(this,function(y){return d=l.padAtBorders(t.height,t.width),b=i.getImageData(v=d.x-1,m=d.y-1,d.ex-v,d.ey-m),[2,un.isNodejs()?Ty(b):createImageBitmap(b)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var f=ho(Bf({width:r,height:o}));f.drawImage(l,0,0,r,o);for(var h=f.getImageData(0,0,r,o).data,p=[],g=0;g<h.length;g+=4)p.push(h[g+2]),p.push(h[g+1]),p.push(h[g]);s.push(p)}),[2,s.map(function(l){return te(function(){return iR(Ii(Un(l,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function mG(t,n,e,r,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,v,m,b;return ue(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,aR(t,n,{width:24,height:24})];case 1:return a=y.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var x=function vG(t,n){return te(function(){var e=$y(t,n),i=Vs(po(Or(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu4_alpha),a=po(i,n.fc2_1),s=gr(Mf(a,1),1),u=Go(Gt(a,s),1),c=po(i,n.fc2_2);return{scores:$t(u,1)[1],regions:c}})}(w,r);return w.dispose(),x}),o.stage2_rnet=Date.now()-i,u=s.length>1?zt(s.map(function(w){return w.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[y.sent()]),u.dispose(),f=c.map(function(w,x){return{score:w,idx:x}}).filter(function(w){return w.score>e}).map(function(w){return w.idx}),h=f.map(function(w){return n[w]}),p=f.map(function(w){return c[w]}),g=[],v=[],h.length>0&&(i=Date.now(),m=Oc(h,p,.7),o.stage2_nms=Date.now()-i,b=m.map(function(w){var x=s[f[w]].regions.arraySync();return new zy(x[0][0],x[0][1],x[0][2],x[0][3])}),v=m.map(function(w){return p[w]}),g=m.map(function(w,x){return h[w].calibrate(b[x])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:g,scores:v}]}})})}function bG(t,n,e,r,o){return se(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,v,m,b,y;return ue(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,aR(t,n,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(x){var _=function yG(t,n){return te(function(){var e=$y(t,n);e=Vs(e=Lr(e=Yt(e,[2,2],[2,2],"same"),n.conv4,"valid"),n.prelu4_alpha);var i=Vs(po(Or(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu5_alpha),a=po(i,n.fc2_1),s=gr(Mf(a,1),1),u=Go(Gt(a,s),1),c=po(i,n.fc2_2),l=po(i,n.fc2_3);return{scores:$t(u,1)[1],regions:c,points:l}})}(x,r);return x.dispose(),_}),o.stage3_onet=Date.now()-i,u=s.length>1?zt(s.map(function(x){return x.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[w.sent()]),u.dispose(),f=c.map(function(x,_){return{score:x,idx:_}}).filter(function(x){return x.score>e}).map(function(x){return x.idx}),h=f.map(function(x){var _=s[x].regions.arraySync();return new zy(_[0][0],_[0][1],_[0][2],_[0][3])}),p=f.map(function(x,_){return n[x].calibrate(h[_])}),g=f.map(function(x){return c[x]}),v=[],m=[],b=[],p.length>0&&(i=Date.now(),y=Oc(p,g,.7,!1),o.stage3_nms=Date.now()-i,v=y.map(function(x){return p[x]}),m=y.map(function(x){return g[x]}),b=y.map(function(x,_){return Array(5).fill(0).map(function(M,I){var E=s[x].points.arraySync();return new Xe(E[0][I]*(v[_].width+1)+v[_].left,E[0][I+5]*(v[_].height+1)+v[_].top)})})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:v,scores:m,points:b}]}})})}var wG=function(t){function n(){return t.call(this,"Mtcnn")||this}return _e(n,t),n.prototype.load=function(e){return se(this,void 0,void 0,function(){return ue(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},n.prototype.loadFromDisk=function(e){return se(this,void 0,void 0,function(){return ue(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},n.prototype.forwardInput=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,v,m,y,w,x,_,M,I;return ue(this,function(E){switch(E.label){case 0:if(!(o=this.params))throw new Error("Mtcnn - load model before inference");if(!(i=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=te(function(){return function aG(t){return te(function(){return er($t(t,3).reverse(),3)})}(gr(my.fromPixels(i)).toFloat())}),c=function(S){return u.dispose(),a.total=Date.now()-s,S},l=u.shape.slice(1),d=l[0],f=l[1],h=new tR(r),p=h.minFaceSize,g=h.scaleFactor,v=h.maxNumScales,m=h.scoreThresholds,y=(h.scaleSteps||function dG(t,n,e){for(var i=qf/t,a=[],s=Math.min(e[0],e[1])*i,u=0;s>=12;)a.push(i*Math.pow(n,u)),s*=n,u+=1;return a}(p,g,[d,f])).filter(function(S){var k=Wy(S,[d,f]);return Math.min(k.width,k.height)>qf}).slice(0,v),a.scales=y,a.pyramid=y.map(function(S){return Wy(S,[d,f])}),w=Date.now(),[4,gG(u,y,m[0],o.pnet,a)];case 1:return x=E.sent(),a.total_stage1=Date.now()-w,x.boxes.length?(a.stage2_numInputBoxes=x.boxes.length,w=Date.now(),[4,mG(i,x.boxes,m[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return _=E.sent(),a.total_stage2=Date.now()-w,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,w=Date.now(),[4,bG(i,_.boxes,m[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return M=E.sent(),a.total_stage3=Date.now()-w,I=M.boxes.map(function(S,k){return Ly(Sy({},new fo(M.scores[k],new Ey(S.left/f,S.top/d,S.width/f,S.height/d),{height:d,width:f})),new z8(M.points[k].map(function(A){return A.sub(new Xe(S.left,S.top)).div(new Xe(S.width,S.height))}),{width:S.width,height:S.height}))}),[2,c({results:I,stats:a})]}})})},n.prototype.forward=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Jt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},n.prototype.forwardWithStats=function(e,r){return void 0===r&&(r={}),se(this,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Jt(e)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function lG(t){var n=[],e=function cG(t,n){var e=ki(t,n);function r(l){return{filters:e(l+"/weights",4,l+"/filters"),bias:e(l+"/bias",1)}}function o(l){return{weights:e(l+"/weights",2),bias:e(l+"/bias",1)}}function i(l){return e(l,1)}function a(l){return{conv1:r(l+"/conv1"),prelu1_alpha:i(l+"/prelu1_alpha"),conv2:r(l+"/conv2"),prelu2_alpha:i(l+"/prelu2_alpha"),conv3:r(l+"/conv3"),prelu3_alpha:i(l+"/prelu3_alpha")}}return{extractPNetParams:function s(){var l=a("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return wn(wn({},l),{conv4_1:d,conv4_2:f})},extractRNetParams:function u(){var l=a("rnet"),d=o("rnet/fc1"),f=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return wn(wn({},l),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})},extractONetParams:function c(){var l=a("onet"),d=r("onet/conv4"),f=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),g=o("onet/fc2_1"),v=o("onet/fc2_2"),m=o("onet/fc2_3");return wn(wn({},l),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:g,fc2_2:v,fc2_3:m})}}}(t,n),o=e.extractRNetParams,i=e.extractONetParams,a=(0,e.extractPNetParams)(),s=o(),u=i();return ei(t,n),{params:{pnet:a,rnet:s,onet:u},paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function uG(t){var n=ti(t),r=n.getRemainingWeights,o=[],i=function sG(t,n){var e=jf(t,n),r=Oy(t,n);function o(c,l){var d=Bt(t(c));return n.push({paramPath:l}),d}function i(c,l,d){return void 0===d&&(d=!1),{conv1:e(c[0],c[1],3,l+"/conv1"),prelu1_alpha:o(c[1],l+"/prelu1_alpha"),conv2:e(c[1],c[2],3,l+"/conv2"),prelu2_alpha:o(c[2],l+"/prelu2_alpha"),conv3:e(c[2],c[3],d?2:3,l+"/conv3"),prelu3_alpha:o(c[3],l+"/prelu3_alpha")}}return{extractPNetParams:function a(){var c=i([3,10,16,32],"pnet"),l=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return wn(wn({},c),{conv4_1:l,conv4_2:d})},extractRNetParams:function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return wn(wn({},c),{fc1:l,prelu4_alpha:d,fc2_1:f,fc2_2:h})},extractONetParams:function u(){var c=i([3,32,64,64],"onet"),l=e(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),v=r(256,10,"onet/fc2_3");return wn(wn({},c),{conv4:l,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:g,fc2_3:v})}}}(n.extractWeights,o),s=i.extractRNetParams,u=i.extractONetParams,c=(0,i.extractPNetParams)(),l=s(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:o}}(e)},n}(Zo),xG=.4,_G=[new Xe(1.603231,2.094468),new Xe(6.041143,7.080126),new Xe(2.882459,3.518061),new Xe(4.266906,5.178857),new Xe(9.041765,10.66308)],CG=[117.001,114.697,97.404],DG=function(t){function n(){return t.call(this,{withSeparableConvs:!0,iouThreshold:xG,classes:["face"],anchors:_G,meanRgb:CG,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return _e(n,t),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return se(this,void 0,void 0,function(){return ue(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new fo(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(rR),et={ssdMobilenetv1:new nR,tinyFaceDetector:new DG,tinyYolov2:new oG,mtcnn:new wG,faceLandmark68Net:new YM,faceLandmark68TinyNet:new D$,faceRecognitionNet:new A$,faceExpressionNet:new u$,ageGenderNet:new w$},EG=function(t){return et.ssdMobilenetv1.load(t)},SG=function(t){return et.faceLandmark68Net.load(t)},IG=function(t){return et.faceRecognitionNet.load(t)};function sR(t,n){return Object.assign({},t,{age:n})}var uR=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return _e(n,t),n}(Lc),Gy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o=this;return ue(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,$f(e=i.sent(),this.input,function(a){return se(o,void 0,void 0,function(){return ue(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return et.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){return KM(a,r[s])})]}})})},n.prototype.withAgeAndGender=function(){return new Qy(this,this.input)},n}(uR),qy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,Hy(e,this.input,function(i){return et.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,KM(e,r)]}})})},n.prototype.withAgeAndGender=function(){return new Yy(this,this.input)},n}(uR),Ky=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withAgeAndGender=function(){return new Jy(this,this.input)},n.prototype.withFaceDescriptors=function(){return new e0(this,this.input)},n}(Gy),Xy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withAgeAndGender=function(){return new Zy(this,this.input)},n.prototype.withFaceDescriptor=function(){return new t0(this,this.input)},n}(qy),cR=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return _e(n,t),n}(Lc),Qy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o=this;return ue(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,$f(e=i.sent(),this.input,function(a){return se(o,void 0,void 0,function(){return ue(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return et.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){var u=r[s],c=u.age;return sR(eR(a,u.gender,u.genderProbability),c)})]}})})},n.prototype.withFaceExpressions=function(){return new Gy(this,this.input)},n}(cR),Yy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o;return ue(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?[4,Hy(e,this.input,function(u){return et.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,[2,sR(eR(e,r.gender,r.genderProbability),o)]}})})},n.prototype.withFaceExpressions=function(){return new qy(this,this.input)},n}(cR),Jy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withFaceExpressions=function(){return new Ky(this,this.input)},n.prototype.withFaceDescriptors=function(){return new e0(this,this.input)},n}(Qy),Zy=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.withFaceExpressions=function(){return new Xy(this,this.input)},n.prototype.withFaceDescriptor=function(){return new t0(this,this.input)},n}(Yy),lR=function(t){function n(e,r){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o}return _e(n,t),n}(Lc),e0=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,$f(e=o.sent(),this.input,function(i){return Promise.all(i.map(function(a){return et.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,o.sent().map(function(i,a){return oR(e[a],i)})]}})})},n.prototype.withFaceExpressions=function(){return new Ky(this,this.input)},n.prototype.withAgeAndGender=function(){return new Jy(this,this.input)},n}(lR),t0=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r;return ue(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,Hy(e,this.input,function(i){return et.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,oR(e,r)]}})})},n.prototype.withFaceExpressions=function(){return new Xy(this,this.input)},n.prototype.withAgeAndGender=function(){return new Zy(this,this.input)},n}(lR),dR=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.useTinyLandmarkNet=o,i}return _e(n,t),Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?et.faceLandmark68TinyNet:et.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(Lc),MG=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return ue(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(c){return c.detection}),this.input instanceof rt?[4,ky(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,Ay(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof rt&&c.dispose()}),[2,e.map(function(c,l){return Ly(c,a[l])})]}})})},n.prototype.withFaceExpressions=function(){return new Ky(this,this.input)},n.prototype.withAgeAndGender=function(){return new Jy(this,this.input)},n.prototype.withFaceDescriptors=function(){return new e0(this,this.input)},n}(dR),RG=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o,i,a;return ue(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?(r=e.detection,this.input instanceof rt?[4,ky(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,Ay(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((o=i)[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof rt&&u.dispose()}),[2,Ly(e,a)]}})})},n.prototype.withFaceExpressions=function(){return new Xy(this,this.input)},n.prototype.withAgeAndGender=function(){return new Zy(this,this.input)},n.prototype.withFaceDescriptor=function(){return new t0(this,this.input)},n}(dR),fR=function(t){function n(e,r){void 0===r&&(r=new Wf);var o=t.call(this)||this;return o.input=e,o.options=r,o}return _e(n,t),n}(Lc),hR=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r,o,i;return ue(this,function(a){switch(a.label){case 0:return r=(e=this).input,(o=e.options)instanceof tR?[4,et.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(!(i=o instanceof iG?function(s){return et.tinyFaceDetector.locateFaces(s,o)}:o instanceof Wf?function(s){return et.ssdMobilenetv1.locateFaces(s,o)}:o instanceof jy?function(s){return et.tinyYolov2.locateFaces(s,o)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return se(e,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return Sy({},a)}))]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new MG(this.runAndExtendWithFaceDetections(),this.input,e)},n.prototype.withFaceExpressions=function(){return new Gy(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new Qy(this.runAndExtendWithFaceDetections(),this.input)},n}(fR);function pR(t,n){return void 0===n&&(n=new Wf),new hR(t,n)}function gR(t,n){if(t.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(t),r=Array.from(n);return Math.sqrt(e.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}function AG(t,n){1&t&&(L(0,"div",1),fn(),L(1,"svg",2),re(2,"circle",3)(3,"circle",4),V()())}!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}_e(n,t),n.prototype.run=function(){return se(this,void 0,void 0,function(){var e,r;return ue(this,function(o){switch(o.label){case 0:return[4,new hR(this.input,this.options)];case 1:return e=o.sent(),r=e[0],e.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return se(e,void 0,void 0,function(){var o;return ue(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?Sy({},o):void 0)]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new RG(this.runAndExtendWithFaceDetection(),this.input,e)},n.prototype.withFaceExpressions=function(){return new qy(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new Yy(this.runAndExtendWithFaceDetection(),this.input)}}(fR),function(){function t(n,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof Lf)return a;if(a instanceof Float32Array)return new Lf(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Lf(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(n,e){return e.map(function(r){return gR(r,n)}).reduce(function(r,o){return r+o},0)/(e.length||1)},t.prototype.matchDescriptor=function(n){var e=this;return this.labeledDescriptors.map(function(r){return new IM(r.label,e.computeMeanDistance(n,r.descriptors))}).reduce(function(r,o){return r.distance<o.distance?r:o})},t.prototype.findBestMatch=function(n){var e=this.matchDescriptor(n);return e.distance<this.distanceThreshold?e:new IM("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},t.fromJSON=function(n){return new t(n.labeledDescriptors.map(function(r){return Lf.fromJSON(r)}),n.distanceThreshold)}}();let kG=(()=>{class t{constructor(){this.showCounting=!0}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ai({type:t,selectors:[["app-timers"]],decls:1,vars:1,consts:[["class","countdown","id","counting",4,"ngIf"],["id","counting",1,"countdown"],["viewBox","-50 -50 100 100","stroke-width","10"],["r","45"],["r","45","pathLength","1"]],template:function(e,r){1&e&&ci(0,AG,4,0,"div",0),2&e&&Nn("ngIf",r.showCounting)},dependencies:[dd],styles:['@property --t{syntax: "<number>"; initial-value: 3; inherits: true;}@property --s{syntax: "<integer>"; initial-value: 0; inherits: true;}.countdown[_ngcontent-%COMP%]{--s: calc(var(--t)/1);display:grid;margin:1em auto;width:10em;height:10em;animation:_ngcontent-%COMP%_t 3s linear infinite}.countdown[_ngcontent-%COMP%]:after{grid-column:1;grid-row:1;place-self:center;font:2.5em/2 ubuntu mono,consolas,monaco,monospace;counter-reset:s var(--s);content:"0:" counter(s,decimal-leading-zero);color:#fff}@keyframes _ngcontent-%COMP%_t{to{--t: 0}}svg[_ngcontent-%COMP%]{grid-column:1;grid-row:1}[r][_ngcontent-%COMP%]{fill:none;stroke:silver}[r][_ngcontent-%COMP%] + [r][_ngcontent-%COMP%]{--k: calc(var(--t)/3);transform:rotate(-90deg);stroke-linecap:round;stroke:color-mix(in hsl shorter hue,#8a9b0f calc(var(--k)*100%),#940a3d);stroke-dasharray:var(--k) 1}']}),t})();const PG=["action"],OG=["recogination"],NG=["videoElement"],FG=["canvasElement"],LG=["usermsg"];function BG(t,n){if(1&t&&(L(0,"span"),X(1),V()),2&t){const e=Ll();ht(1),di("",e.tries,"->left")}}function UG(t,n){1&t&&(L(0,"div",46),re(1,"app-timers"),V())}let VG=(()=>{class t{constructor(){this.show_timer=!0,this.flip_card=!1,this.cameraloading=!0,this.qrscanned=!1,this.roll=0,this.stream="CS",this.id="",this.modelloading=!0,this.message="Loading",this.faceRecoginising=!1,this.user_image="assets/needs/frame.png",this.user_name="Message",this.user_message="Scan ID Card Below",this.tries=3,this.users={"9155CS20":{user_name:"Imtiyaz-Ali",roll:27,stream:"CS",img:"assets/me.jpeg"},"9028CS20":{user_name:"Kashinath S",roll:30,stream:"CS",img:"assets/kashi.jpg"},"8842CS20":{user_name:"Govind P",roll:26,stream:"CS",img:"assets/govind.jpg"},"9094CS20":{user_name:"AlanSavio",roll:7,stream:"CS",img:"assets/savio.jpg"}}}ngOnInit(){var e=this;return rc(function*(){e.user_message="Model is Loading"})()}ngAfterViewInit(){var e=this;return rc(function*(){setTimeout(()=>{e.loadModels(),e.user_name="Message",e.user_message="Scan Your ID Card",e.show_timer=!1,e.playUserAnim()},3e3),e.scanner?.start()})()}ngOnDestroy(){this.scanner?.isStart&&(this.scanner?.stop(),this.modelloading=!0,this.cameraloading=!0)}loadModels(){console.log("Model");const e="./assets/models/",r=[EG(e),SG(e),IG(e)];Promise.all(r).then(()=>{this.user_message="Scan Your ID-Card",console.log("Model loaded successfully")}).catch(o=>{this.user_message="Error On Model Loading",this.message="Error: "+o})}checkUser(e){for(let r in this.users)if(e===r)return this.user_name=this.users[e].user_name,this.user_name=this.users[e].user_name,this.user_image=this.users[e].img,this.user_message="Complete Face Scanning",this.roll=this.users[e].roll,this.id=e,!0;return!1}scanSuccessHandler(e){const r=e[0].value;if(this.faceRecoginising)return this.user_message="Face Recogination Still Going On",void this.playUserAnim();this.scanner?.pause();const o=this.checkUser(r),i=document.getElementById("alerting"),a=document.getElementById("alertingfail");o?document.getElementById("buttonAnim"):document.getElementById("buttonAnim1"),o?(this.playUserAnim(),this.faceRecoginising=!0,i?.classList.add("showAlert"),setTimeout(()=>{i?.classList.remove("showAlert"),this.show_timer=!0,this.scanner?.play(),setTimeout(()=>{this.show_timer=!1},3e3)},2e3),setTimeout(()=>{try{const u=this.scanner?.video.nativeElement;this.startRecogination(u)}catch(u){console.log(u)}},5e3)):(a?.classList.add("showAlert"),this.user_message="Error!Try Again",this.playUserAnim(),setTimeout(()=>{a?.classList.remove("showAlert"),this.user_message="Scan ID Card",this.scanner?.play()},2e3))}startRecogination(e){var r=this;this.tries=3,this.face_scanning_interval=setInterval(rc(function*(){0==r.tries&&(r.user_message="Not Identified.Reported To Admin",r.faceRecoginising=!1,r.playUserAnim(),clearInterval(r.face_scanning_interval));const o=yield pR(e).withFaceLandmarks().withFaceDescriptors();o.length>0&&(r.scanner?.stop(),o.length>1?(console.log("Multiple Faces Detected"),r.user_message="Multiple Face Detected.Try Again",r.playUserAnim(),setTimeout(()=>{r.scanner?.start()},3e3)):(r.user_message="Comparing Faces",r.playUserAnim(),r.compareFaces(r.user_image,o)))}),1e3)}compareFaces(e,r){var o=this;return rc(function*(){const i=yield function e$(t){return se(this,void 0,void 0,function(){var n,e;return ue(this,function(r){switch(r.label){case 0:return[4,BM(t)];case 1:return[4,(n=r.sent()).blob()];case 2:if(!(e=r.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+e.type+", for url: "+n.url);return[2,Y8(e)]}})})}(e),a=yield pR(i).withFaceLandmarks().withFaceDescriptors();if(!(a.length>0&&r.length>0))return console.log("No faces detected in one or both images"),o.message="Error On Comparing.Contact Admin",void o.playUserAnim();gR(a[0].descriptor,r[0].descriptor)<.6?(o.faceRecoginising=!1,o.user_message="Faces Are Similar",o.playUserAnim(),clearInterval(o.face_scanning_interval),o.flip_card=!0,o.faceRecoginationSuccess(),setTimeout(()=>{o.flip_card=!1,o.user_name="Message",o.user_message="Scan You ID Card",o.user_image="assets/needs/frame.png",o.scanner?.start()},3e3)):(console.log("Faces are different.It Will Get Reported"),o.user_message="Face Not Matched.Try Again",o.tries=o.tries-1,o.playUserAnim(),setTimeout(()=>{o.scanner?.start()},3e3))})()}faceRecoginationSuccess(){console.log("ASdf")}playUserAnim(){this.usermsg.nativeElement.classList.add("blink"),setTimeout(()=>{this.usermsg.nativeElement.classList.remove("blink")},2e3)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ai({type:t,selectors:[["app-camera"]],viewQuery:function(e,r){if(1&e&&(Po(PG,5),Po(OG,5),Po(NG,5),Po(FG,5),Po(LG,5)),2&e){let o;Jr(o=Zr())&&(r.scanner=o.first),Jr(o=Zr())&&(r.recogination=o.first),Jr(o=Zr())&&(r.videoElement=o.first),Jr(o=Zr())&&(r.canvasElement=o.first),Jr(o=Zr())&&(r.usermsg=o.first)}},decls:97,vars:12,consts:[[1,"mainbody"],["id","usermsg"],["usermsg",""],[1,"user_detail"],[1,"img_pod"],["alt","random image",1,"user_img",2,"object-fit","cover",3,"src"],[1,"container_copy"],["id","studentName",2,"font-weight","bolder","padding","0px 35px","text-transform","capitalize","color","rgba(245, 235, 235, 0.829)"],[4,"ngIf"],["id","studentMessage",2,"font-size","smaller","font-weight","bolder","text-transform","uppercase","padding","0px 35px","color","#d4c9c9da"],[1,"anim-box","center","spacer"],["id","scanner",1,"scanner","startScan"],["id","response"],["type","checkbox","id","reg-log","name","reg-log",1,"checkbox",3,"checked"],[1,"card-3d-wrap","mx-auto"],[1,"card-3d-wrapper"],[1,"card-front"],["style","position:absolute;top: 20%;left:35%;z-index: 11;","class","timer",4,"ngIf"],[3,"event"],["action","scanner"],[1,"card-back"],[1,"card","profile-card-3"],[1,"background-block"],["src","https://images.pexels.com/photos/459225/pexels-photo-459225.jpeg?auto=compress&cs=tinysrgb&h=650&w=940","alt","profile-sample1",1,"background"],[1,"profile-thumb-block"],["alt","profile-image",1,"profile",2,"object-fit","cover",3,"src"],[1,"card-content"],[2,"font-weight","bold"],["id","buttonAnim",1,"btn-circle-download"],["id","arrow","width","27px","height","29px","viewBox","17 14 14 20"],["d","M24,15 L24,32"],["points","30 27 24 33 18 27"],["id","check","width","30px","height","30px","viewBox","13 17 21 15"],["points","32.5 18.5 20 31 14.5 25.5"],["id","border","width","60px","height","60px","viewBox","0 0 48 48"],["d","M24,1 L24,1 L24,1 C36.7025492,1 47,11.2974508 47,24 L47,24 L47,24 C47,36.7025492 36.7025492,47 24,47 L24,47 L24,47 C11.2974508,47 1,36.7025492 1,24 L1,24 L1,24 C1,11.2974508 11.2974508,1 24,1 L24,1 Z"],["id","alerting",1,"alerting"],[1,"blog_post"],[2,"color","#999","font-weight","bold","margin-top","1px","margin-bottom","2px"],[2,"margin","0em"],[2,"margin-bottom","-1px","font-weight","bold","background-color","rgb(35, 161, 35)"],[1,"typing"],["id","alertingfail",1,"alerting"],["id","buttonAnim1",1,"btn-circle-download"],["points","0 0 60 60 50 0 0 50"],[2,"margin-bottom","-1px","font-weight","bold","background-color","rgb(131, 33, 33)"],[1,"timer",2,"position","absolute","top","20%","left","35%","z-index","11"]],template:function(e,r){1&e&&(L(0,"div",0)(1,"div",1,2)(3,"div",3)(4,"div",4),re(5,"img",5),V(),L(6,"div",6)(7,"h3",7),X(8),ci(9,BG,2,1,"span",8),V(),re(10,"hr"),L(11,"p",9),X(12),V()()()(),L(13,"div",10),re(14,"div")(15,"div",11),L(16,"div",12),re(17,"input",13),L(18,"div",14)(19,"div",15)(20,"div",16),ci(21,UG,2,0,"div",17),L(22,"ngx-scanner-qrcode",18,19),Xi("event",function(i){return r.scanSuccessHandler(i)}),V()(),L(24,"div",20)(25,"div",21)(26,"div",22),re(27,"img",23),V(),L(28,"div",24),re(29,"img",25),V(),L(30,"div",26)(31,"h2"),X(32),V(),L(33,"h5",27),X(34,"[Attendence Marked]"),V(),L(35,"div",28),fn(),L(36,"svg",29),re(37,"path",30)(38,"polyline",31),V(),L(39,"svg",32),re(40,"polyline",33),V(),L(41,"svg",34),re(42,"path",35),V()()()()()()()()()(),kn(),L(43,"div",36)(44,"div",37)(45,"div",4)(46,"div",28),fn(),L(47,"svg",29),re(48,"path",30)(49,"polyline",31),V(),L(50,"svg",32),re(51,"polyline",33),V(),L(52,"svg",34),re(53,"path",35),V()()(),kn(),L(54,"div",6)(55,"p",38),X(56,"12 January 2019"),V(),re(57,"hr",39),L(58,"h3",40),X(59,"Success"),V(),re(60,"hr",39),L(61,"p"),X(62,"Name: "),L(63,"span",41),X(64),V()(),L(65,"p"),X(66,"Roll No: "),L(67,"span",41),X(68),V()(),L(69,"p"),X(70,"ID NO: "),L(71,"span",41),X(72),V()(),L(73,"p"),X(74,"Stream: "),L(75,"span",41),X(76),V()()()()(),L(77,"div",42)(78,"div",37)(79,"div",4)(80,"div",43),fn(),L(81,"svg",29),re(82,"path",30)(83,"polyline",31),V(),L(84,"svg",32),re(85,"polyline",44),V(),L(86,"svg",34),re(87,"path",35),V()()(),kn(),L(88,"div",6)(89,"p",38),X(90,"12 January 2019"),V(),re(91,"hr",39),L(92,"h3",45),X(93,"Failed"),V(),re(94,"hr",39),L(95,"p",41),X(96,"Unable To Find Your Data Please Make Sure You Are Registered First."),V()()()()),2&e&&(ht(5),Nn("src",r.user_image,Ua),ht(3),di(" ",r.user_name," "),ht(1),Nn("ngIf",r.faceRecoginising),ht(3),di(" Message: ",r.user_message,". "),ht(5),Nn("checked",r.flip_card),ht(4),Nn("ngIf",r.show_timer),ht(8),Nn("src",r.user_image,Ua),ht(3),Dr(r.user_name),ht(32),Dr(r.user_name),ht(4),Dr(r.roll),ht(4),Dr(r.id),ht(4),Dr(r.stream))},dependencies:[dd,rU,kG],styles:['@import"https://fonts.googleapis.com/css?family=Poppins:400,500,600,700,800,900";.center[_ngcontent-%COMP%]{margin:0 auto;text-align:center}.anim-box[_ngcontent-%COMP%]{position:relative;padding:25px 30px;transition:transform .6s ease-out}.anim-box[_ngcontent-%COMP%]:before, .anim-box[_ngcontent-%COMP%]:after, .anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:before, .anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:after{position:absolute;width:10%;height:15%;border-color:#c53d3d;border-style:solid;content:" "}.anim-box[_ngcontent-%COMP%]:before{top:0;left:0;border-width:2px 0 0 2px}.anim-box[_ngcontent-%COMP%]:after{top:0;right:0;border-width:2px 2px 0 0}.anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:before{bottom:0;right:0;border-width:0 2px 2px 0}.anim-box[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child:after{bottom:0;left:0;border-width:0 0 2px 2px}.anim-box[_ngcontent-%COMP%]:hover   .scanner[_ngcontent-%COMP%]{animation-play-state:running}.scanner[_ngcontent-%COMP%]{width:100%;height:3px;background-color:red;opacity:.7;position:relative;box-shadow:0 0 8px 10px #aa0b177d;top:50%}.startScan[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_scan;animation-duration:4s;animation-timing-function:linear;animation-iteration-count:infinite;z-index:10}@keyframes _ngcontent-%COMP%_scan{0%{box-shadow:0 0 8px 10px #aa0b177d;top:50%}25%{box-shadow:0 6px 8px 10px #aa0b177d;top:5px}75%{box-shadow:0 -6px 8px 10px #aa0b177d;top:98%}}#response[_ngcontent-%COMP%]{border:1px solid white;box-shadow:0 0 15px 7px #00f8d362}.camera[_ngcontent-%COMP%]{max-width:40vw;max-height:40vw}.mainbody[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;margin:2px;flex-direction:column;flex-wrap:wrap;align-content:center;justify-content:center;align-items:center}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_sparklyBits 1s infinite;position:absolute}#burrito[_ngcontent-%COMP%]{margin:5px}.message[_ngcontent-%COMP%]{margin-top:20px;font-size:15px;text-align:center;font-weight:700;color:#977e7e;font-family:Courier New,Courier,monospace;width:200px}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(1){animation-delay:35ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(2){animation-delay:70ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(3){animation-delay:105ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(4){animation-delay:.14s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(5){animation-delay:175ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(6){animation-delay:.21s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(7){animation-delay:245ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(8){animation-delay:.28s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(9){animation-delay:315ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(10){animation-delay:.35s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(11){animation-delay:385ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(12){animation-delay:.42s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(13){animation-delay:455ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(14){animation-delay:.49s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(15){animation-delay:525ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(16){animation-delay:.56s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(17){animation-delay:595ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(18){animation-delay:.63s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(19){animation-delay:665ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(20){animation-delay:.7s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(21){animation-delay:735ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(22){animation-delay:.77s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(23){animation-delay:805ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(24){animation-delay:.84s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(25){animation-delay:875ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(26){animation-delay:.91s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(27){animation-delay:945ms}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(28){animation-delay:.98s}#sparkles[_ngcontent-%COMP%] > path[_ngcontent-%COMP%]:nth-child(29){animation-delay:1015ms}@keyframes _ngcontent-%COMP%_sparklyBits{0%{opacity:0}to{opacity:1}}#sparkles[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], #burrito[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#9b8c8c}.btn-circle-download[_ngcontent-%COMP%]{position:relative;height:60px;width:60px;margin:auto;border-radius:100%;background:#E8EAED;cursor:pointer;overflow:hidden;transition:all .2s ease}.btn-circle-download[_ngcontent-%COMP%]:after{content:"";position:relative;display:block;width:200%;height:100%;background-image:linear-gradient(100deg,rgba(255,255,255,0),rgba(255,255,255,.25),rgba(255,255,255,0));transform:translate(-100%)}.btn-circle-download[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke-width:2;stroke-linecap:round;stroke-linejoin:round;fill:none}.btn-circle-download[_ngcontent-%COMP%]   svg#border[_ngcontent-%COMP%]{position:absolute;top:0;left:0;stroke:none;stroke-dasharray:144;stroke-dashoffset:144;transition:all .5s linear}.btn-circle-download[_ngcontent-%COMP%]   svg#arrow[_ngcontent-%COMP%]{position:absolute;top:14px;left:17px;stroke:#9098a9;transition:all .2s ease}.btn-circle-download[_ngcontent-%COMP%]   svg#check[_ngcontent-%COMP%]{position:absolute;top:17px;left:13px;stroke:#fff;transform:scale(0)}.btn-circle-download[_ngcontent-%COMP%]:hover{background:rgba(0,119,255,.2)}.btn-circle-download[_ngcontent-%COMP%]:hover   #arrow[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .btn-circle-download[_ngcontent-%COMP%]:hover   #arrow[_ngcontent-%COMP%]   polyline[_ngcontent-%COMP%]{stroke:#07f}.btn-circle-download.load[_ngcontent-%COMP%]{background:rgba(0,119,255,.2)}.btn-circle-download.load[_ngcontent-%COMP%]   #arrow[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .btn-circle-download.load[_ngcontent-%COMP%]   #arrow[_ngcontent-%COMP%]   polyline[_ngcontent-%COMP%]{stroke:#07f}.btn-circle-download.load[_ngcontent-%COMP%]   #border[_ngcontent-%COMP%]{stroke:#07f;stroke-dasharray:144;stroke-dashoffset:0}.btn-circle-download.done[_ngcontent-%COMP%]{background:#0077FF;animation:_ngcontent-%COMP%_rubberBand .8s}.btn-circle-download.done[_ngcontent-%COMP%]:after{transform:translate(50%);transition:transform .4s ease;transition-delay:.7s}.btn-circle-download.done[_ngcontent-%COMP%]   #border[_ngcontent-%COMP%], .btn-circle-download.done[_ngcontent-%COMP%]   #arrow[_ngcontent-%COMP%]{display:none}.btn-circle-download.done[_ngcontent-%COMP%]   #check[_ngcontent-%COMP%]{transform:scale(1);transition:all .2s ease;transition-delay:.2s}@keyframes _ngcontent-%COMP%_rubberBand{0%{transform:scale(1,1,1)}30%{transform:scale3d(1.15,.75,1)}40%{transform:scale3d(.75,1.15,1)}50%{transform:scale3d(1.1,.85,1)}65%{transform:scale3d(.95,1.05,1)}75%{transform:scale3d(1.05,.95,1)}to{transform:scaleZ(1)}}.credit[_ngcontent-%COMP%]{position:fixed;right:20px;bottom:20px;transition:all .2s ease;-webkit-user-select:none;user-select:none;opacity:.6}.credit[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:72px}.credit[_ngcontent-%COMP%]:hover{transform:scale(.95)}.blog_post[_ngcontent-%COMP%]{background:#fff;max-width:250px;border-radius:10px;box-shadow:1px 1px 2rem #0000004d;position:relative;text-align:center}.container_copy[_ngcontent-%COMP%]{padding:2px}.img_pod[_ngcontent-%COMP%]{height:60px;width:60px;background:rgb(66,52,52);z-index:10;box-shadow:1px 1px 2rem #0000004d;border-radius:100%;position:absolute;left:-10%;top:-13%;display:flex;align-items:center;justify-content:center}.date[_ngcontent-%COMP%]{font-weight:700;color:#999}.typing[_ngcontent-%COMP%]{position:relative}.typing[_ngcontent-%COMP%]:after{content:"|";position:absolute;right:0;width:100%;color:red;background:#ffffff;animation:_ngcontent-%COMP%_typing 1s steps(16) forwards,caret 1s infinite}@keyframes _ngcontent-%COMP%_typing{to{width:0}}@keyframes _ngcontent-%COMP%_caret{50%{color:transparent}}.alerting[_ngcontent-%COMP%]{width:350px;position:fixed;top:50%;left:50%;display:none}.showAlert[_ngcontent-%COMP%]{display:block;z-index:10}@media screen and (max-width: 512px){.mainbody[_ngcontent-%COMP%]{display:block}.loading[_ngcontent-%COMP%]{height:100%;display:flex;align-content:center;justify-content:center;align-items:center;justify-items:center;flex-direction:column;flex-wrap:wrap}.camera[_ngcontent-%COMP%]{max-width:auto;max-height:auto}.alerting[_ngcontent-%COMP%]{position:fixed;top:50%;left:30%;width:70vw}}[type=checkbox][_ngcontent-%COMP%]:checked, [type=checkbox][_ngcontent-%COMP%]:not(:checked){position:absolute;left:-9999px}.checkbox[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%], .checkbox[_ngcontent-%COMP%]:not(:checked) + label[_ngcontent-%COMP%]{position:relative;display:block;text-align:center;width:60px;height:16px;border-radius:8px;padding:0;margin:10px auto;cursor:pointer;background-color:#ffeba7}.checkbox[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:before, .checkbox[_ngcontent-%COMP%]:not(:checked) + label[_ngcontent-%COMP%]:before{position:absolute;display:block;width:36px;height:36px;border-radius:50%;color:#ffeba7;background-color:#102770;font-family:unicons;content:"\\eb4f";z-index:20;top:-10px;left:-10px;line-height:36px;text-align:center;font-size:24px;transition:all .5s ease}.checkbox[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:before{transform:translate(44px) rotate(-270deg)}.card-3d-wrap[_ngcontent-%COMP%]{position:relative;width:450px;height:50vh;transform-style:preserve-3d;perspective:800px}.card-3d-wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0;transform-style:preserve-3d;transition:all .6s ease-out}.card-front[_ngcontent-%COMP%], .card-back[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#2a2b38;background-image:url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/1462889/pat.svg);background-position:bottom center;background-repeat:no-repeat;background-size:300%;position:absolute;border-radius:6px;left:0;top:0;transform-style:preserve-3d;-webkit-backface-visibility:hidden;backface-visibility:hidden}.card-back[_ngcontent-%COMP%]{transform:rotateY(180deg)}.checkbox[_ngcontent-%COMP%]:checked ~ .card-3d-wrap[_ngcontent-%COMP%]   .card-3d-wrapper[_ngcontent-%COMP%]{transform:rotateY(180deg)}.center-wrap[_ngcontent-%COMP%]{position:absolute;width:100%;padding:0 35px;top:50%;left:0;transform:translate3d(0,-50%,35px) perspective(100px);z-index:20;display:block}.chekbox[_ngcontent-%COMP%]{display:none}.user_detail[_ngcontent-%COMP%]{background:#283030c7;max-width:380px;min-width:300px;border-radius:10px;border:2px solid rgba(255,0,0,.308);box-shadow:1px 1px 2rem #0000004d;text-align:center;position:absolute;top:14%;left:50%}.anim[_ngcontent-%COMP%]{position:inherit;animation:_ngcontent-%COMP%_moveFromRightToLeft 2s linear}@keyframes _ngcontent-%COMP%_moveFromRightToLeft{0%{max-width:400px;top:14%;left:100%}to{max-width:380px;top:14%;left:50%}}.blink[_ngcontent-%COMP%]{width:auto;animation:_ngcontent-%COMP%_blink 1s infinite}@keyframes _ngcontent-%COMP%_blink{0%{opacity:1}20%{opacity:0}40%{opacity:1}60%{opacity:0}80%{opacity:1}to{opacity:0}}.container_copy[_ngcontent-%COMP%]{width:auto}hr[_ngcontent-%COMP%]{margin:0;color:#ff0000b2}.img_pod[_ngcontent-%COMP%]{height:72px;width:75px;background:linear-gradient(90deg,#ff996681,#ff5e6191);z-index:10;box-shadow:1px 1px 2rem #0000004d;border-radius:20px;position:absolute;left:-20%;top:0%;display:flex;align-items:center;justify-content:center}.user_img[_ngcontent-%COMP%]{height:4.3rem;width:4.3rem;position:relative;border-radius:20px;box-shadow:1px 1px 2rem #0000004d;z-index:1}h3[_ngcontent-%COMP%]{color:#fff;font-size:1.25rem}.profile-card-3[_ngcontent-%COMP%]{font-family:Open Sans,Arial,sans-serif;position:relative;float:left;overflow:hidden;width:100%;text-align:center;height:99%;border:none}.profile-card-3[_ngcontent-%COMP%]   .background-block[_ngcontent-%COMP%]{float:left;width:100%;height:200px;overflow:hidden}.profile-card-3[_ngcontent-%COMP%]   .background-block[_ngcontent-%COMP%]   .background[_ngcontent-%COMP%]{width:100%;vertical-align:top;opacity:.9;filter:blur(.5px);transform:scale(2.8)}.profile-card-3[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{width:100%;padding:15px 25px;color:#232323;float:left;background:#efefef;height:50%;border-radius:0 0 5px 5px;position:relative;z-index:9999}.profile-card-3[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]:before{content:"";background:#efefef;width:120%;height:100%;left:11px;bottom:51px;position:absolute;z-index:-1;transform:rotate(-13deg)}.profile-card-3[_ngcontent-%COMP%]   .profile[_ngcontent-%COMP%]{border-radius:10px;position:absolute;bottom:50%;left:50%;max-width:100px;opacity:1;box-shadow:3px 3px 20px #00000080;border:2px solid rgba(255,255,255,1);transform:translate(-50%);z-index:99999}.profile-card-3[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 5px;font-weight:600;font-size:25px}.profile-card-3[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;font-size:15px;margin-top:10px}.profile-card-3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:inline-block;font-size:16px;color:#232323;text-align:center;border:1px solid #232323;width:30px;height:30px;line-height:30px;border-radius:50%;margin:0 5px}.profile-card-3[_ngcontent-%COMP%]   .icon-block[_ngcontent-%COMP%]{float:left;width:100%;margin-top:15px}.profile-card-3[_ngcontent-%COMP%]   .icon-block[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.profile-card-3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{background-color:#232323;color:#fff;text-decoration:none}']}),t})(),jG=(()=>{class t{constructor(e){this.http=e}getAttendanceData(){return this.http.get("assets/data.json")}}return t.\u0275fac=function(e){return new(e||t)(ce(AD))},t.\u0275prov=de({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),HG=(()=>{class t{constructor(e,r,o){this.el=e,this.renderer=r,this.attendanceService=o}loadData(){var e=this;return rc(function*(){try{e.loadingData=!0;const r=yield e.attendanceService.getAttendanceData().toPromise();e.attendanceData=r,console.log(r),console.log(e.attendanceData[0]),e.getCalender()}catch(r){console.error(r)}finally{e.loadingData=!1}})()}getCalender(){this.attendanceData&&this.attendanceData.forEach(e=>{1==e.class?$("#calendar").evoCalendar("addCalendarEvent",[{id:e.date,name:`Attendence(${e.date})`,date:`${e.date}/2023`,type:"event",color:"green",description:`Total-Absents: ${e.absent}`},{id:`Absent ${e.date}`,name:"Absentees Roll-No",date:`${e.date}/2023`,type:"event",color:"red",description:`${e.rollNo}`},{id:`Leave ${e.leave}`,name:"On-Leave Roll-No",date:`${e.date}/2023`,type:"event",color:"blue",description:`${e.leave}`}]):$("#calendar").evoCalendar("addCalendarEvent",[{id:e.date,name:"No Class",date:`${e.date}/2023`,type:"holiday",description:"No Class Has Taken On This Day"}])})}ngOnInit(){this.loadData(),$("#calendar").evoCalendar({theme:"Midnight Blue"}),$("#calendar").evoCalendar("toggleSidebar",!1),this.getCalender(),setTimeout(()=>{$("#calendar").evoCalendar("addCalendarEvent",[{id:"123",name:"dxfg",date:"04/04/2023",type:"event",color:"green",description:"Total-Absents:"}])},3e3)}addEvent(){const r=this.el.nativeElement.querySelector("#calendar");$(r).evoCalendar("addCalendarEvent",[{id:"345345",name:"345",date:"04/04/2023",type:"event",color:"green",description:"Total-Absents:"}])}}return t.\u0275fac=function(e){return new(e||t)(he(Ro),he(Ha),he(jG))},t.\u0275cmp=ai({type:t,selectors:[["app-teacher"]],decls:27,vars:0,consts:[["rel","stylesheet","href","https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/css/evo-calendar.min.css"],["rel","stylesheet","href","https://cdn.jsdelivr.net/npm/evo-calendar@1.1.3/evo-calendar/css/evo-calendar.midnight-blue.min.css"],[1,"mainBody"],[1,"containerss","mt-5"],[1,"row","d-flex","justify-content-center"],[1,"col-md-7"],[1,"card","p-3","py-4"],[1,"text-center"],["src","https://i.imgur.com/bDLhJiP.jpg","width","100",1,"rounded-circle"],[1,"text-center","mt-3"],[1,"bg-secondary","p-1","px-4","rounded","text-white"],[1,"mt-2","mb-0"],[1,"px-4","mt-1"],[1,"fonts"],[1,"buttons"],[1,"btn","btn-outline-primary","px-4"],[1,"btn","btn-primary","px-4","ms-3"],[1,"hero"],["id","calendar"]],template:function(e,r){1&e&&(re(0,"link",0)(1,"link",1),L(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),re(8,"img",8),V(),L(9,"div",9)(10,"span",10),X(11,"Teacher"),V(),L(12,"h5",11),X(13,"Imtiyaz Ali"),V(),L(14,"span"),X(15,"Subject: Discrete Mathematics"),V(),L(16,"div",12)(17,"p",13),X(18,"Originally From Ladakh is an Gold Medalist Teacher in Discrete Mathematics."),V()(),L(19,"div",14)(20,"button",15),X(21,"Message"),V(),L(22,"button",16),X(23,"Contact"),V()()()()()()(),Ol(24),L(25,"div",17),re(26,"div",18),V(),Nl(),V())},styles:[".mainBody[_ngcontent-%COMP%]{height:100vh;overflow:auto}.card[_ngcontent-%COMP%]{border:none;position:relative;overflow:hidden;border-radius:8px;cursor:pointer;color:var(--app-content-main-color);background:unset}.card[_ngcontent-%COMP%]:hover:after{transform:scaleY(1)}.fonts[_ngcontent-%COMP%]{font-size:11px}.social-list[_ngcontent-%COMP%]{display:flex;list-style:none;justify-content:center;padding:0}.social-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px;color:#8e24aa;font-size:19px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1){border:1px solid #8E24AA!important;color:#8e24aa;height:40px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(1):hover{border:1px solid #8E24AA!important;color:#fff;height:40px;background-color:#8e24aa}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){border:1px solid #8E24AA!important;background-color:#8e24aa;color:#fff;height:40px}.hero[_ngcontent-%COMP%]{width:100%;height:100%;display:grid}#calendar[_ngcontent-%COMP%]{width:90%;margin:40px auto}.calendar-events[_ngcontent-%COMP%]{background-color:red}@media screen and (max-width: 991px){.sidebar-hide[_ngcontent-%COMP%]   .calendar-inner[_ngcontent-%COMP%]{background-color:red}}"]}),t})();function WG(t,n){1&t&&re(0,"img",59),2&t&&Nn("src",Ll().$implicit.value.img,Ua)}function zG(t,n){if(1&t&&(L(0,"tr")(1,"th",51)(2,"li",52)(3,"button",53),re(4,"i",54),V()()(),L(5,"td"),X(6),V(),L(7,"td"),ci(8,WG,1,1,"img",55),X(9),V(),L(10,"td"),X(11),V(),L(12,"td",56)(13,"span",57),X(14),V(),re(15,"i",58),V()()),2&t){const e=n.$implicit;ht(6),Dr(e),ht(2),Nn("ngIf",e.value.img),ht(1),di(" | ",e.value.user_name,""),ht(2),Dr(e.value.subject),ht(3),Dr(e.value.class)}}function $G(t,n){1&t&&re(0,"img",59),2&t&&Nn("src",Ll().$implicit.value.img,Ua)}function GG(t,n){if(1&t&&(L(0,"tr")(1,"th",51)(2,"li",52)(3,"button",53),re(4,"i",54),V()()(),L(5,"td"),X(6),V(),L(7,"td"),ci(8,$G,1,1,"img",55),X(9),V(),L(10,"td"),X(11,"Wirecard for figma"),V(),L(12,"td",56)(13,"span",57),X(14,"$0.99"),V(),re(15,"i",58),V()()),2&t){const e=n.$implicit;ht(6),Dr(e.value.roll),ht(2),Nn("ngIf",e.value.img),ht(1),di(" | ",e.value.user_name,"")}}const qG=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",component:VG},{path:"teacher",component:HG},{path:"admin",component:(()=>{class t{constructor(){this.users={"9155CS20":{user_name:"Imtiyaz-Ali",roll:27,stream:"CS",img:"assets/me.jpeg"},"9028CS20":{user_name:"Kashinath S",roll:30,stream:"CS",img:"assets/kashi.jpg"},"8842CS20":{user_name:"Govind P",roll:26,stream:"CS",img:"assets/govind.jpg"},"9094CS20":{user_name:"AlanSavio",roll:7,stream:"CS",img:"assets/savio.jpg"}},this.teachers={1234:{user_name:"ManJu",class:27,subject:"Python Programming",img:"assets/test.jpeg"},5678:{user_name:"Apple Miss",class:10,subject:"Discrete Math",img:"assets/test.jpeg"},9076:{user_name:"Cat",class:27,subject:"Political Science",img:"assets/test.jpeg"}}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ai({type:t,selectors:[["app-admin"]],decls:123,vars:6,consts:[["rel","stylesheet","href","https://unicons.iconscout.com/release/v3.0.6/css/line.css"],["rel","stylesheet","href","https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"],[1,"mainbody"],[1,"p-4",2,"width","100%"],[1,"welcome"],[1,"content","rounded-3","p-3"],[1,"fs-3"],[1,"mb-0"],[1,"statistics","mt-4"],[1,"row"],[1,"col-lg-4"],[1,"box","d-flex","rounded-2","align-items-center","mb-4","mb-lg-0","p-3"],[1,"uil-envelope-shield","fs-2","text-center","bg-primary","rounded-circle"],[1,"ms-3"],[1,"d-flex","align-items-center"],[1,"d-block","ms-2"],[1,"fs-normal","mb-0"],[1,"uil-file","fs-2","text-center","bg-danger","rounded-circle"],[1,"box","d-flex","rounded-2","align-items-center","p-3"],[1,"uil-users-alt","fs-2","text-center","bg-success","rounded-circle"],[1,"p-4"],["href","https://fonts.googleapis.com/css?family=Work+Sans:400,600,700&display=swap","rel","stylesheet"],[1,"layout"],["name","nav","type","radio","id","home","checked","checked",1,"nav","home-radio"],[1,"page","home-page"],[1,"container","mt-5","px-2"],[1,"mb-2","d-flex","justify-content-between","align-items-center"],[1,"position-relative"],[1,"position-absolute","search"],[1,"fa","fa-search"],["placeholder","Search by order#, name...",1,"form-control","w-100"],[1,"px-2"],[1,"fa","fa-angle-down"],[1,"fa","fa-ellipsis-h","ms-3"],[1,"table-responsive"],[1,"table","table-responsive","table-borderless"],[1,"bg-light"],["scope","col","width","5%"],["scope","col","width","10%"],["scope","col","width","40%"],["scope","col","width","25%"],["scope","col","width","20%",1,"text-end"],[4,"ngFor","ngForOf"],["for","home",1,"nav"],["viewBox","0 0 24 24","width","24","height","24","stroke","currentColor","stroke-width","2","fill","none","stroke-linecap","round","stroke-linejoin","round",1,"css-i6dzq1"],["d","M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"],["points","9 22 9 12 15 12 15 22"],["name","nav","type","radio","id","contact",1,"contact-radio"],[1,"page","contact-page"],["for","contact",1,"nav"],["d","M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"],["scope","row"],[1,"list-inline-item"],["type","button","data-toggle","tooltip","data-placement","top","title","Edit",1,"btn","btn-success","btn-sm","rounded-0"],[1,"fa","fa-edit"],["class","user_image",3,"src",4,"ngIf"],[1,"text-end"],[1,"fw-bolder"],[1,"fa","fa-ellipsis-h","ms-2"],[1,"user_image",3,"src"]],template:function(e,r){1&e&&(re(0,"link",0)(1,"link",1),L(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h1",6),X(7,"Welcome to Admin Dashboard"),V(),L(8,"p",7),X(9,"Here You Can Add And Manipulate Data Of Student/Teachers."),V()()(),L(10,"section",8)(11,"div",9)(12,"div",10)(13,"div",11),re(14,"i",12),L(15,"div",13)(16,"div",14)(17,"h3",7),X(18,"10"),V(),L(19,"span",15),X(20,"Total Data"),V()(),L(21,"p",16),X(22,"..................."),V()()()(),L(23,"div",10)(24,"div",11),re(25,"i",17),L(26,"div",13)(27,"div",14)(28,"h3",7),X(29,"5"),V(),L(30,"span",15),X(31,"Teachers"),V()(),L(32,"p",16),X(33,".............."),V()()()(),L(34,"div",10)(35,"div",18),re(36,"i",19),L(37,"div",13)(38,"div",14)(39,"h3",7),X(40,"6"),V(),L(41,"span",15),X(42,"Students"),V()(),L(43,"p",16),X(44,"......................."),V()()()()()(),L(45,"div",20),re(46,"link",21),L(47,"div",22),re(48,"input",23),L(49,"div",24)(50,"div",25)(51,"div",26)(52,"div",27)(53,"span",28),re(54,"i",29),V(),re(55,"input",30),V(),L(56,"div",31)(57,"span"),X(58,"Filters "),re(59,"i",32),V(),re(60,"i",33),V()(),L(61,"div",34)(62,"table",35)(63,"thead")(64,"tr",36)(65,"th",37),X(66,"Edit"),V(),L(67,"th",38),X(68,"ID"),V(),L(69,"th",39),X(70,"Teacher"),V(),L(71,"th",40),X(72,"Subject"),V(),L(73,"th",41)(74,"span"),X(75,"Class-Taken"),V()()()(),L(76,"tbody"),ci(77,zG,16,5,"tr",42),rg(78,"keyvalue"),V()()()()(),L(79,"label",43)(80,"span"),fn(),L(81,"svg",44),re(82,"path",45)(83,"polyline",46),V(),X(84," Teacher "),V()(),kn(),re(85,"input",47),L(86,"div",48)(87,"div",25)(88,"div",26)(89,"div",27)(90,"span",28),re(91,"i",29),V(),re(92,"input",30),V(),L(93,"div",31)(94,"span"),X(95,"Filters "),re(96,"i",32),V(),re(97,"i",33),V()(),L(98,"div",34)(99,"table",35)(100,"thead")(101,"tr",36)(102,"th",37),X(103,"Edit"),V(),L(104,"th",38),X(105,"ID"),V(),L(106,"th",39),X(107,"Teacher"),V(),L(108,"th",40),X(109,"Subject"),V(),L(110,"th",41)(111,"span"),X(112,"Class-Taken"),V()()()(),L(113,"tbody"),ci(114,GG,16,3,"tr",42),rg(115,"keyvalue"),V()()()()(),L(116,"label",49)(117,"span"),fn(),L(118,"svg",44),re(119,"path",50),V(),X(120," Student "),V()()()(),kn(),L(121,"p"),X(122,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolor magnam illo incidunt suscipit inventore. Officia dolore nulla nobis qui. Voluptas beatae nostrum ipsam, quidem corrupti incidunt nesciunt! Sit suscipit harum tempora, enim, sapiente odio dolores, incidunt iure ipsa magni eum. Aspernatur tempore, molestiae id quos eos error possimus. At, commodi."),V()()()),2&e&&(ht(77),Nn("ngForOf",og(78,2,r.teachers)),ht(37),Nn("ngForOf",og(115,4,r.users)))},dependencies:[BC,dd,HC],styles:['.mainbody[_ngcontent-%COMP%]{height:100vh;overflow:auto}[_ngcontent-%COMP%]:root{--dk-gray-100: #F3F4F6;--dk-gray-200: #E5E7EB;--dk-gray-300: #D1D5DB;--dk-gray-400: #9CA3AF;--dk-gray-500: #6B7280;--dk-gray-600: #4B5563;--dk-gray-700: #374151;--dk-gray-800: #1F2937;--dk-gray-900: #111827;--dk-dark-bg: #313348;--dk-darker-bg: #2a2b3d;--navbar-bg-color: #6f6486;--sidebar-bg-color: #252636;--sidebar-width: 250px}.welcome[_ngcontent-%COMP%]{color:#d1d5db}.welcome[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{background-color:var(--dk-dark-bg);border:2px solid #D1D5DB}.welcome[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af}.statistics[_ngcontent-%COMP%]{color:#e5e7eb}.statistics[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{background-color:#313348}.statistics[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:60px;height:60px;line-height:60px}.statistics[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af}.admins[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   .admin[_ngcontent-%COMP%]{background-color:var(--dk-dark-bg)}.admins[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--dk-gray-300)}.admins[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--dk-gray-400)}.statis[_ngcontent-%COMP%]{color:var(--dk-gray-100)}.statis[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]{position:relative;overflow:hidden;border-radius:3px}.statis[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:after{content:"";height:2px;width:70%;margin:10px auto auto;background-color:#ffffff1f;display:block}.statis[_ngcontent-%COMP%]   .box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;height:70px;width:70px;font-size:22px;padding:15px;top:-25px;left:-25px;background-color:#ffffff26;line-height:60px;text-align:right;border-radius:50%}label[_ngcontent-%COMP%], a[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;text-decoration:none;display:inline-block;color:inherit;transition:border .2s;border-bottom:5px solid rgba(#8e44ad,.2);padding:3px 2px;&:hover{border-bottom-color:#9b59b6}}.layout[_ngcontent-%COMP%]{display:grid;height:100%;width:100%;overflow:hidden;grid-template-rows:50px 1fr;grid-template-columns:1fr 1fr}input[type=radio][_ngcontent-%COMP%]{display:none}label.nav[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;cursor:pointer;border-bottom:2px solid #8e44ad;background:#ecf0f1;-webkit-user-select:none;user-select:none;transition:background .4s,padding-left .2s;padding-left:0;input[type="radio"]:checked + .page + &{background: #9b59b6; color: #ffffff; padding-left: 20px; span{padding-left: 20px} svg{opacity: 1;}} span{padding-left: 0px; position: relative;} svg{left: 0; top: -3px; position: absolute; width: 15px; opacity: 0; transition: opacity .2s;}}.page[_ngcontent-%COMP%]{background-color:#313348;grid-column-start:1;grid-row-start:2;grid-column-end:span 3;padding:0 20px;display:flex;align-items:center}.page-contents[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:0;transform:translateY(20px);transition:opacity .2s,transform .2s;@for $c from 1 through 20{&:nth-child(#{$c}){transition-delay: .2s + ($c * .2s);}}}input[type=radio][_ngcontent-%COMP%] + .page[_ngcontent-%COMP%]{transition:transform .2s;transform:translate(100%)}input[type=radio][_ngcontent-%COMP%]:checked + .page[_ngcontent-%COMP%]{transform:translate(0);.page-contents > *{opacity: 1; transform: translateY(0px);}}.page-contents[_ngcontent-%COMP%]{max-width:100%;width:500px;margin:0 auto}.search[_ngcontent-%COMP%]{left:10px}.form-control[_ngcontent-%COMP%]{border:1px solid white;padding-left:32px}.form-control[_ngcontent-%COMP%]:focus{border:none;box-shadow:none}.green[_ngcontent-%COMP%]{color:green}td[_ngcontent-%COMP%]{color:#fff}tr[_ngcontent-%COMP%]{align-items:center}.user_image[_ngcontent-%COMP%]{border-radius:100%;object-fit:cover;width:45px;border:1px solid indianred;height:45px}']}),t})()}];let KG=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Do({type:t}),t.\u0275inj=Vr({imports:[YE.forRoot(qG),YE]}),t})(),XG=(()=>{class t{constructor(){this.showMobileNav=!1}switchMode(){var e=document.querySelector(".mode-switch");document.documentElement.classList.toggle("light"),e.classList.toggle("active")}mobileNav(){this.showMobileNav=!this.showMobileNav,document.querySelector(".menu__button");const r=document.querySelector(".menu__body");this.showMobileNav?r.removeAttribute("hidden"):r.setAttribute("hidden","")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=ai({type:t,selectors:[["app-root"]],decls:101,vars:0,consts:[[1,"app-container"],[1,"sidebar"],[1,"sidebar-header",2,"background","rgba(245, 245, 245, 0.842)"],[1,"app-icon"],["src","assets/college_logo.png","alt","","width","100%","height","32px","srcset",""],[1,"sidebar-list"],["routerLinkActive","active",1,"sidebar-list-item"],["routerLink","/home"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-home"],["d","M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"],["points","9 22 9 12 15 12 15 22"],["routerLink","/teacher"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-shopping-bag"],["d","M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"],["x1","3","y1","6","x2","21","y2","6"],["d","M16 10a4 4 0 0 1-8 0"],["routerLink","/admin"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-pie-chart"],["d","M21.21 15.89A10 10 0 1 1 8 2.83"],["d","M22 12A10 10 0 0 0 12 2v10z"],[1,"account-info"],[1,"account-info-picture"],["src","assets/profile.jpg?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTE2fHx3b21hbnxlbnwwfHwwfHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=900&q=60","alt","Account"],[1,"account-info-name"],[1,"account-info-more"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-more-horizontal"],["cx","12","cy","12","r","1"],["cx","19","cy","12","r","1"],["cx","5","cy","12","r","1"],[1,"mobileNav"],[1,"menu"],["title","logo"],[1,"menu-button","home"],["title","Home","routerLink","/home"],["routerLinkActive","active",1,"search"],["title","Teacher","routerLink","/about"],["routerLinkActive","active",1,"pencil"],["title","Admin","routerLink","/contact"],["routerLinkActive","active",1,"active","about"],[1,"app-content"],[1,"app-content-header"],[1,"app-content-headerText"],["title","Switch Theme",1,"mode-switch",3,"click"],["fill","none","stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","width","24","height","24","viewBox","0 0 24 24",1,"moon"],["d","M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"],["id","menu_button",1,"menu__button"],["type","checkbox","id","menu_checkbox",3,"click"],["for","menu_checkbox","id","menu_label"],["id","menu_text_bar"],["hidden","hidden",1,"menu__body"],[1,"d-flex","justify-content-between","align-items-center"],["type","button","aria-label","Close",1,"btn","btn-link",3,"click"],["aria-hidden","true"],[1,"list-group"],["routerLink","/home","routerLinkActive","active",1,"list-group-item"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-home"],["routerLink","/teacher","routerLinkActive","active",1,"list-group-item"],["routerLink","/about","routerLinkActive","active",1,"list-group-item"],["routerLink","/oo","routerLinkActive","active",1,"list-group-item"],["xmlns","http://www.w3.org/2000/svg","width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-inbox"],["points","22 12 16 12 14 15 10 15 8 12 2 12"],["d","M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"]],template:function(e,r){1&e&&(L(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),re(4,"img",4),V()(),L(5,"ul",5)(6,"li",6)(7,"a",7),fn(),L(8,"svg",8),re(9,"path",9)(10,"polyline",10),V(),kn(),L(11,"span"),X(12,"Attendence"),V()()(),L(13,"li",6)(14,"a",11),fn(),L(15,"svg",12),re(16,"path",13)(17,"line",14)(18,"path",15),V(),kn(),L(19,"span"),X(20,"Teacher"),V()()(),L(21,"li",6)(22,"a",16),fn(),L(23,"svg",17),re(24,"path",18)(25,"path",19),V(),kn(),L(26,"span"),X(27,"Admin"),V()()()(),L(28,"div",20)(29,"div",21),re(30,"img",22),V(),L(31,"div",23),X(32,"Imityaz Ali"),V(),L(33,"button",24),fn(),L(34,"svg",25),re(35,"circle",26)(36,"circle",27)(37,"circle",28),V()()()(),kn(),L(38,"div",29)(39,"ul",30)(40,"li",31)(41,"a",32),X(42,"Logo"),V()(),L(43,"li",33)(44,"a",34),X(45,"Home"),V()(),L(46,"li",35)(47,"a",36),X(48,"Teacher"),V()(),L(49,"li",37)(50,"a",38),X(51,"Admin"),V()()()(),L(52,"div",39)(53,"div",40)(54,"h1",41),X(55,"Products"),V(),L(56,"button",42),Xi("click",function(){return r.switchMode()}),fn(),L(57,"svg",43),re(58,"defs")(59,"path",44),V()(),kn(),L(60,"div",45)(61,"input",46),Xi("click",function(){return r.mobileNav()}),V(),L(62,"label",47),re(63,"div",48),V()()(),re(64,"router-outlet"),V()(),L(65,"section",49)(66,"div",50)(67,"h3"),X(68,"Navigate"),V(),L(69,"button",51),Xi("click",function(){return r.mobileNav()}),L(70,"span",52),X(71,"\xd7"),V()()(),L(72,"ul",53)(73,"li",54)(74,"i"),fn(),L(75,"svg",55),re(76,"path",9)(77,"polyline",10),V(),X(78," - "),V(),X(79," Home"),V(),kn(),L(80,"li",56)(81,"i"),fn(),L(82,"svg",12),re(83,"path",13)(84,"line",14)(85,"path",15),V(),X(86," - "),V(),X(87," Teacher"),V(),kn(),L(88,"li",57)(89,"i"),fn(),L(90,"svg",17),re(91,"path",18)(92,"path",19),V(),X(93," - "),V(),X(94," Admin"),V(),kn(),L(95,"li",58)(96,"i"),fn(),L(97,"svg",59),re(98,"polyline",60)(99,"path",61),V()(),X(100," Contact"),V()()())},dependencies:[Pv,zd,WE],styles:['@import"//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css";.app-container[_ngcontent-%COMP%]{border-radius:4px;width:100%;height:100%;max-height:100%;max-width:1280px;display:flex;overflow:hidden;box-shadow:#63636333 0 2px 8px;max-width:2000px;margin:0 auto}.sidebar[_ngcontent-%COMP%]{flex-basis:200px;max-width:200px;flex-shrink:0;background-color:var(--sidebar);display:flex;flex-direction:column}.sidebar-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px}.sidebar-list[_ngcontent-%COMP%]{list-style-type:none;padding:0}.sidebar-list-item[_ngcontent-%COMP%]{position:relative;margin-bottom:4px}.sidebar-list-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;padding:10px 16px;color:var(--sidebar-link);text-decoration:none;font-size:14px;line-height:24px}.sidebar-list-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{margin-right:8px}.sidebar-list-item[_ngcontent-%COMP%]:hover{background-color:var(--sidebar-hover-link)}.sidebar-list-item.active[_ngcontent-%COMP%]{background-color:var(--sidebar-active-link)}.sidebar-list-item.active[_ngcontent-%COMP%]:before{content:"";position:absolute;right:0;background-color:var(--action-color);height:100%;width:4px}@media screen and (max-width: 1024px){.sidebar[_ngcontent-%COMP%]{display:none}.mobileNav[_ngcontent-%COMP%]{display:block}}.mode-switch[_ngcontent-%COMP%]{background-color:transparent;border:none;padding:0;color:var(--app-content-main-color);display:flex;justify-content:center;align-items:center;margin-left:auto;margin-right:8px;cursor:pointer}.mode-switch[_ngcontent-%COMP%]   .moon[_ngcontent-%COMP%]{fill:var(--app-content-main-color)}.mode-switch.active[_ngcontent-%COMP%]   .moon[_ngcontent-%COMP%]{fill:none}.account-info[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px;margin-top:auto}.account-info-picture[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;overflow:hidden;flex-shrink:0}.account-info-picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.account-info-name[_ngcontent-%COMP%]{font-size:14px;color:var(--sidebar-main-color);margin:0 8px;overflow:hidden;max-width:100%;text-overflow:ellipsis;white-space:nowrap}.account-info-more[_ngcontent-%COMP%]{color:var(--sidebar-main-color);padding:0;border:none;background-color:transparent;margin-left:auto}.app-icon[_ngcontent-%COMP%]{color:var(--sidebar-main-color)}.app-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}.app-content[_ngcontent-%COMP%]{padding:16px;background-color:var(--app-bg);height:100%;flex:1;max-height:100%;display:flex;flex-direction:column}.app-content-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0 4px}.app-content-headerText[_ngcontent-%COMP%]{color:var(--app-content-main-color);font-size:24px;line-height:32px;margin:0}.app-content-headerButton[_ngcontent-%COMP%]{background-color:var(--action-color);color:#fff;font-size:14px;line-height:24px;border:none;border-radius:4px;height:32px;padding:0 16px;transition:.2s;cursor:pointer}.app-content-headerButton[_ngcontent-%COMP%]:hover{background-color:var(--action-color-hover)}.app-content-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 4px}.app-content-actions-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:auto}@media screen and (max-width: 520px){.app-content-actions[_ngcontent-%COMP%]{flex-direction:column}.app-content-actions[_ngcontent-%COMP%]   .app-content-actions-wrapper[_ngcontent-%COMP%]{padding-bottom:16px;order:1}}.menu[_ngcontent-%COMP%]{position:fixed;bottom:0;display:grid;align-content:center;left:0;height:100%;list-style-type:none;margin:0;padding:0;z-index:10;overflow:hidden;box-shadow:2px 0 18px #00000042}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;text-indent:-500em;height:5em;width:3em;line-height:5em;text-align:center;position:relative;border-bottom:1px solid rgba(0,0,0,.05);transition:background .1s ease-in-out}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:before{font-family:FontAwesome;text-indent:0em;position:absolute;bottom:0;left:0;width:100%;height:100%;font-size:1.4em}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.search[_ngcontent-%COMP%]:before{content:"\\f029"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.archive[_ngcontent-%COMP%]:before{content:"\\f187"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.pencil[_ngcontent-%COMP%]:before{content:"\\f040"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.contact[_ngcontent-%COMP%]:before{content:"\\f007"}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.about[_ngcontent-%COMP%]:before{content:"\\f003"}.activeLink[_ngcontent-%COMP%], .menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background:#267fdd;color:#fff}.para[_ngcontent-%COMP%]{color:#033f72;padding-left:100px;font-size:3em;margin-bottom:20px}.open[_ngcontent-%COMP%]{width:10em;height:100%}@media all and (max-width: 500px){.menu[_ngcontent-%COMP%]{height:5em;width:100%}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-block}.open[_ngcontent-%COMP%]{width:100%;height:auto}.para[_ngcontent-%COMP%]{padding-left:5px}}@media screen and (max-height: 34em){.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:70%}}@media screen and (max-height: 34em) and (max-width: 500px){.menu[_ngcontent-%COMP%]{height:3.5em}}.mobileNav[_ngcontent-%COMP%]{display:none}@media screen and (min-width: 512px) and (max-width:1024px){.mobileNav[_ngcontent-%COMP%]{display:block}}.menu__button[_ngcontent-%COMP%]{display:none}@media screen and (max-width: 512px){.fab[_ngcontent-%COMP%], .menu__button[_ngcontent-%COMP%]{display:block}}#menu_button[_ngcontent-%COMP%]{width:35px;overflow:hidden}#menu_checkbox[_ngcontent-%COMP%]{display:none}#menu_label[_ngcontent-%COMP%]{position:relative;display:block;height:30px;cursor:pointer}#menu_label[_ngcontent-%COMP%]:before, #menu_label[_ngcontent-%COMP%]:after, #menu_text_bar[_ngcontent-%COMP%]{position:absolute;left:0;width:100%;height:4px;background-color:var(--app-content-main-color)}#menu_label[_ngcontent-%COMP%]:before, #menu_label[_ngcontent-%COMP%]:after{content:"";transition:.4s cubic-bezier(.68,-.55,.27,1.55) left}#menu_label[_ngcontent-%COMP%]:before{top:0}#menu_label[_ngcontent-%COMP%]:after{top:12px}#menu_text_bar[_ngcontent-%COMP%]{top:24px}#menu_text_bar[_ngcontent-%COMP%]:before{content:"MENU";position:absolute;top:4px;right:0;left:0;color:var(--app-content-main-color);font-size:12px;font-weight:700;font-family:Montserrat,Arial,Helvetica,sans-serif}#menu_checkbox[_ngcontent-%COMP%]:checked + #menu_label[_ngcontent-%COMP%]:before{left:-39px}#menu_checkbox[_ngcontent-%COMP%]:checked + #menu_label[_ngcontent-%COMP%]:after{left:39px}#menu_checkbox[_ngcontent-%COMP%]:checked + #menu_label[_ngcontent-%COMP%]   #menu_text_bar[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_moveUpThenDown .8s ease .2s forwards,shakeWhileMovingUp .8s ease .2s forwards,shakeWhileMovingDown .2s ease .8s forwards}@keyframes _ngcontent-%COMP%_moveUpThenDown{0%{top:0}50%{top:-27px}to{top:-14px}}@keyframes _ngcontent-%COMP%_shakeWhileMovingUp{0%{transform:rotate(0)}25%{transform:rotate(-10deg)}50%{transform:rotate(0)}75%{transform:rotate(10deg)}to{transform:rotate(0)}}@keyframes _ngcontent-%COMP%_shakeWhileMovingDown{0%{transform:rotate(0)}80%{transform:rotate(3deg)}90%{transform:rotate(-3deg)}to{transform:rotate(0)}}.menu__body[_ngcontent-%COMP%]{--x: 0;--y: 0;--z: 0;display:block;width:100%;padding:0 30px 15px;color:var(--app-content-main-color);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 -9px 50px -30px #000;font-family:Montserrat,sans-serif;position:absolute;bottom:0;z-index:105;transform:translate3d(var(--x),var(--y),var(--z));transition:.2s cubic-bezier(.33,1,.53,1)}.menu__body[hidden][_ngcontent-%COMP%]{--y: 150%}li[_ngcontent-%COMP%]{font-weight:700}']}),t})(),QG=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Do({type:t,bootstrap:[XG]}),t.\u0275inj=Vr({imports:[UB,KG,iU,MU]}),t})();BB().bootstrapModule(QG).catch(t=>console.error(t))},369:()=>{},655:()=>{},118:()=>{}},Kf=>{Kf(Kf.s=490)}]);